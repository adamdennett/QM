<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Prof D’s Regression Sessions - Vol 2 – Quantitative Methods</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="..//img/favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-0a64b63d52573e9083ac7ef925da3e11.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-0a64b63d52573e9083ac7ef925da3e11.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-0a64b63d52573e9083ac7ef925da3e11.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-5457fb42737ce7af87b82faab80c0026.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-5457fb42737ce7af87b82faab80c0026.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-5457fb42737ce7af87b82faab80c0026.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script src="../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
<meta property="og:title" content="Prof D’s Regression Sessions - Vol 2 – Quantitative Methods">
<meta property="og:description" content="AKA - Multiple Regression">
<meta property="og:image" content="https://adamdennett.github.io/QM/sessions/L6_images/techncal.jpg">
<meta property="og:site_name" content="Foundations">
<meta property="og:locale" content="en_GB">
</head>
<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-md " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../img/logo/logo_only_sm.png" alt="" class="navbar-logo light-content"><img src="../img/logo/logo_only_sm.png" alt="" class="navbar-logo dark-content"></a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Quantitative Methods</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../setup/index.html"> 
<span class="menu-text">Setup</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-week-by-week" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Week-by-Week</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-week-by-week">
<li>
    <a class="dropdown-item" href="../sessions/index.html">
 <span class="dropdown-text">Overview</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Part 1: Basics</li>
        <li>
    <a class="dropdown-item" href="../sessions/week1.html">
 <span class="dropdown-text">1. Explanatory Data Analysis #1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week2.html">
 <span class="dropdown-text">2. Explanatory Data Analysis #2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week3.html">
 <span class="dropdown-text">3. Hypothesis Testing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week4.html">
 <span class="dropdown-text">4. Introduction to Linear Algebra</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Part 2: Correlation and Regression</li>
        <li>
    <a class="dropdown-item" href="../sessions/week5.html">
 <span class="dropdown-text">5. Measuring Relationship</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week6.html">
 <span class="dropdown-text">6. Introduction to Regression</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week7.html">
 <span class="dropdown-text">7. Multiple Regression</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week8.html">
 <span class="dropdown-text">8. Multilevel Regression</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Part 3: Dimension Reduction &amp; Clustering</li>
        <li>
    <a class="dropdown-item" href="../sessions/week9.html">
 <span class="dropdown-text">9. Dimension Reduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week10.html">
 <span class="dropdown-text">10. Clustering</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../references.qmd">
 <span class="dropdown-text">Bibliography</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-assessments" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Assessments</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-assessments">
<li>
    <a class="dropdown-item" href="../assessments/index.html">
 <span class="dropdown-text">Overview</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item">
    <a class="nav-link" href="../help.html"> 
<span class="menu-text">Getting Help</span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#preamble" id="toc-preamble" class="nav-link active" data-scroll-target="#preamble">Preamble</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#aims" id="toc-aims" class="nav-link" data-scroll-target="#aims">Aims</a></li>
  <li>
<a href="#tasks" id="toc-tasks" class="nav-link" data-scroll-target="#tasks">Tasks</a>
  <ul class="collapse">
<li><a href="#baseline-model" id="toc-baseline-model" class="nav-link" data-scroll-target="#baseline-model">1. Baseline Model</a></li>
  <li><a href="#data-prep-and-exploratory-data-analysis" id="toc-data-prep-and-exploratory-data-analysis" class="nav-link" data-scroll-target="#data-prep-and-exploratory-data-analysis">2. Data Prep and Exploratory Data Analysis</a></li>
  <li><a href="#multiple-regression-model" id="toc-multiple-regression-model" class="nav-link" data-scroll-target="#multiple-regression-model">3. Multiple Regression Model</a></li>
  <li><a href="#evaluation" id="toc-evaluation" class="nav-link" data-scroll-target="#evaluation">4. Evaluation</a></li>
  <li><a href="#interaction-effects" id="toc-interaction-effects" class="nav-link" data-scroll-target="#interaction-effects">5. Interaction Effects</a></li>
  </ul>
</li>
  <li><a href="#task-1---baseline-model" id="toc-task-1---baseline-model" class="nav-link" data-scroll-target="#task-1---baseline-model">Task 1 - Baseline Model</a></li>
  <li>
<a href="#task-2---exploratory-analysis-and-data-preparation" id="toc-task-2---exploratory-analysis-and-data-preparation" class="nav-link" data-scroll-target="#task-2---exploratory-analysis-and-data-preparation">Task 2 - Exploratory Analysis and Data Preparation</a>
  <ul class="collapse">
<li><a href="#changing-your-dummy-reference-category" id="toc-changing-your-dummy-reference-category" class="nav-link" data-scroll-target="#changing-your-dummy-reference-category">Changing your dummy reference category</a></li>
  <li><a href="#reclassifying-a-variable-into-fewer-categories" id="toc-reclassifying-a-variable-into-fewer-categories" class="nav-link" data-scroll-target="#reclassifying-a-variable-into-fewer-categories">Reclassifying a variable into fewer categories</a></li>
  </ul>
</li>
  <li>
<a href="#task-3---building-your-optimum-multiple-regression-model" id="toc-task-3---building-your-optimum-multiple-regression-model" class="nav-link" data-scroll-target="#task-3---building-your-optimum-multiple-regression-model">Task 3 - Building your optimum multiple regression model</a>
  <ul class="collapse">
<li><a href="#recipe-steps" id="toc-recipe-steps" class="nav-link" data-scroll-target="#recipe-steps">Recipe Steps</a></li>
  </ul>
</li>
  <li><a href="#task-4---evaluation" id="toc-task-4---evaluation" class="nav-link" data-scroll-target="#task-4---evaluation">Task 4 - Evaluation</a></li>
  <li><a href="#task-5---interacting-variables-extension-activity" id="toc-task-5---interacting-variables-extension-activity" class="nav-link" data-scroll-target="#task-5---interacting-variables-extension-activity">Task 5 - Interacting Variables (Extension activity)</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/huanfachen/QM/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="week7_practical.ipynb" download="week7_practical.ipynb"><i class="bi bi-journal-code"></i>Jupyter</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Prof D’s Regression Sessions - Vol 2</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">AKA - Multiple Regression</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><iframe data-testid="embed-iframe" style="border-radius:12px" src="https://open.spotify.com/embed/track/4gY2lwbx521ZlyqCzQE2JA?utm_source=generator" width="100%" height="352" frameborder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
<section id="preamble" class="level2"><h2 class="anchored" data-anchor-id="preamble">Preamble</h2>
<p>We’re going even deeper this week in Volume 2 of the Regression Sessions, so to help you along on your journey we have got Volume 2 of the Progression Sessions with Blame and DRS - Enjoy!</p>
</section><section id="introduction" class="level2"><h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Similar to last week’s practical, we will continue our investigation into the factors that affect school-level attainment figures, following the lecture you have just seen.</p>
<p>Last week, you created a data subset for England of some 30-odd variables related to different measures of attainment, and a selection of continuous and categorical variables which might help explain those attainment levels. This week we will use more of those variables to build a multiple regression model and evaluate its outputs.</p>
<p>Building a good regression model can be as much art as it is science! Back to our cake baking analogy last week - think of it a bit like the bake-off ‘technical challenge’ - same recipe, same ingredients, potentially some very different outcomes!</p>
<p><a href="L6_images/techncal.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="L6_images/techncal.jpg" class="img-fluid"></a></p>
<p>It takes a lot of practice, iteration and understanding of the various dimensions in your model to build a good regression model. It is <strong>much</strong> more than just a good R-squared and some ‘statistically significant’ coefficients!</p>
</section><section id="aims" class="level2"><h2 class="anchored" data-anchor-id="aims">Aims</h2>
<p>By the end of this week’s regression session you should:</p>
<ul>
<li>Consolidate your knowledge of using R or Python to process data in order to carry out a scientific investigation</li>
<li>Build on the skills learned last week to practice further plotting and visualising of data to assess relationships between multiple x variables and a selected y variable</li>
<li>Refresh your knowledge of using built-in statistical software functions in R and Python to run some more sophisticated regression models and produce statistical outputs from those models</li>
<li>Practice interpreting the outputs of those models thinking in particular about issues of confounding, mediating, multicollinearity and the independence of residuals</li>
<li>Practice experimenting with interaction effects in your model and the interpretation of those outputs</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>As with last week’s practical you will find code-blocks that will allow you to run your analysis in either R or Python. Again, it’s up to you which you decide to use.</p>
</div>
</div>
</section><section id="tasks" class="level2"><h2 class="anchored" data-anchor-id="tasks">Tasks</h2>
<p>This week we won’t look at individual local authorities, but will focus on the whole of England.</p>
<section id="baseline-model" class="level3"><h3 class="anchored" data-anchor-id="baseline-model">1. Baseline Model</h3>
<ul>
<li>Run your baseline bivariate, whole of England, regression model from last week</li>
</ul></section><section id="data-prep-and-exploratory-data-analysis" class="level3"><h3 class="anchored" data-anchor-id="data-prep-and-exploratory-data-analysis">2. Data Prep and Exploratory Data Analysis</h3>
<ul>
<li>Prepare your data and carry out some exploratory data analysis to understand what you are working with</li>
</ul></section><section id="multiple-regression-model" class="level3"><h3 class="anchored" data-anchor-id="multiple-regression-model">3. Multiple Regression Model</h3>
<ul>
<li>Experiment with adding additional explanatory variables one-by-one into your model - both continuous and categorical. You might even experiment with reclassifying variables to reduce any noise that might exist with excessive categories unclear continuous relationships</li>
<li>Try to find the model that best explains your attainment variable. One that strikes a good balance between:
<ul>
<li>explanatory power (a good <span class="math inline">\(R^2\)</span>, significant explanatory variables) - best doesn’t necessarily mean the highest <span class="math inline">\(R^2\)</span>, if a variable with more nuance allows you to say something more interesting about a relationship.</li>
<li>parsimony (the principle of simplicity - fewest variables, simplest possible explanation)</li>
</ul>
</li>
</ul></section><section id="evaluation" class="level3"><h3 class="anchored" data-anchor-id="evaluation">4. Evaluation</h3>
<ul>
<li>When you have your ‘best’ model, how do you interpret the coefficients?
<ul>
<li>Which variable(s) has(have) the most explanatory power (check t-values for this)?</li>
<li>How do you interpret the combined explanatory power of variables in your model?</li>
<li>What kind of confounding do you observe as you add more variables (if any)?</li>
<li>Do you have any issues of multicollinearity or residual independence? Does your model pass the standard tests?</li>
</ul>
</li>
</ul></section><section id="interaction-effects" class="level3"><h3 class="anchored" data-anchor-id="interaction-effects">5. Interaction Effects</h3>
<ul>
<li>Experiment with interacting some of the variables in your best multiple regression model and see if this adds any more explanatory nuance to your main analysis</li>
</ul>
<div class="tabset-margin-container"></div><div class="panel-tabset qna-question multicode">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href=""><img src="L6_images/python-logo-only.png" class="img-fluid" width="30"></a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href=""><img src="L6_images/Rlogo.png" width="41" height="30"></a></li>
</ul>
<div class="tab-content qna-question multicode">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">

</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">

</div>
</div>
</div>
</section></section><section id="task-1---baseline-model" class="level2"><h2 class="anchored" data-anchor-id="task-1---baseline-model">Task 1 - Baseline Model</h2>
<ul>
<li>First read in your data file from last week and run your final baseline model from last week</li>
<li>Then run a basic bivariate regression model for your attainment variable of choice (I am using raw Attainment 8 scores - <strong>ATT8SCR</strong> - , but last week you should have chosen one of the other different Attainment scores to try and model - therefore you will need to adjust your code accordingly)</li>
<li>Your choice of independent variable can be anything, but you might want to start with <strong>PTFSM6CLA1A (% of pupils at the end of key stage 4 who are disadvantaged)</strong> as I am.</li>
<li>Don’t forget, you probably will want to log-transform both of your variables</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The paths in the code below are specific to my home computer - you’ll need to adapt this code to read the csv from where it is on your computer.</p>
<p>And one more reminder - you will also need to change the variables to the ones you used last week - don’t just copy mine!</p>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset qna-question multicode">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true" href=""><img src="L6_images/python-logo-only.png" class="img-fluid" width="30"></a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false" href=""><img src="L6_images/Rlogo.png" width="41" height="30"></a></li>
</ul>
<div class="tab-content qna-question multicode">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> janitor</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># little function to define the file root on different machines</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_qm_root(start_path: Path <span class="op">=</span> Path.cwd(), anchor: <span class="bu">str</span> <span class="op">=</span> <span class="st">"QM"</span>) <span class="op">-&gt;</span> Path:</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Traverse up from the start_path until the anchor folder (e.g. 'QM' or 'QM_Fork')      is found. Returns the path to the anchor folder.</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> parent <span class="kw">in</span> [start_path] <span class="op">+</span> <span class="bu">list</span>(start_path.parents):</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> parent.name <span class="op">==</span> anchor:</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> parent</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">FileNotFoundError</span>(<span class="ss">f"Anchor folder '</span><span class="sc">{</span>anchor<span class="sc">}</span><span class="ss">' not found in path      hierarchy."</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>qm_root <span class="op">=</span> find_qm_root()</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>base_path <span class="op">=</span> qm_root <span class="op">/</span> <span class="st">"sessions"</span> <span class="op">/</span> <span class="st">"L6_data"</span> <span class="op">/</span> <span class="st">"Performancetables_130242"</span> <span class="op">/</span> <span class="st">"2022-2023"</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>na_all <span class="op">=</span> [<span class="st">""</span>, <span class="st">"NA"</span>, <span class="st">"SUPP"</span>, <span class="st">"NP"</span>, <span class="st">"NE"</span>, <span class="st">"SP"</span>, <span class="st">"SN"</span>, <span class="st">"LOWCOV"</span>, <span class="st">"NEW"</span>, <span class="st">"SUPPMAT"</span>, <span class="st">"NaN"</span>]</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>england_filtered <span class="op">=</span> pd.read_csv(base_path <span class="op">/</span> <span class="st">"england_filtered.csv"</span>, na_values<span class="op">=</span>na_all, dtype<span class="op">=</span>{<span class="st">"URN"</span>: <span class="bu">str</span>})</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Log-transform safely: replace non-positive values with NaN</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>england_filtered[<span class="st">'log_ATT8SCR'</span>] <span class="op">=</span> np.where(england_filtered[<span class="st">'ATT8SCR'</span>] <span class="op">&gt;</span> <span class="dv">0</span>, np.log(england_filtered[<span class="st">'ATT8SCR'</span>]), np.nan)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>england_filtered[<span class="st">'log_PTFSM6CLA1A'</span>] <span class="op">=</span> np.where(england_filtered[<span class="st">'PTFSM6CLA1A'</span>] <span class="op">&gt;</span> <span class="dv">0</span>, np.log(england_filtered[<span class="st">'PTFSM6CLA1A'</span>]), np.nan)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop rows with NaNs in either column</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>england_filtered_clean <span class="op">=</span> england_filtered.dropna(subset<span class="op">=</span>[<span class="st">'log_ATT8SCR'</span>, <span class="st">'log_PTFSM6CLA1A'</span>])</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Define independent and dependent variables</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(england_filtered_clean[<span class="st">'log_PTFSM6CLA1A'</span>])  <span class="co"># adds intercept</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> england_filtered_clean[<span class="st">'log_ATT8SCR'</span>]</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>england_model1 <span class="op">=</span> sm.OLS(y, X).fit()</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="co">#england_summary = extract_model_summary(england_model1, 'England Model')</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Print summary</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(england_model1.summary())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:            log_ATT8SCR   R-squared:                       0.468
Model:                            OLS   Adj. R-squared:                  0.468
Method:                 Least Squares   F-statistic:                     2611.
Date:                Wed, 29 Oct 2025   Prob (F-statistic):               0.00
Time:                        12:53:17   Log-Likelihood:                 1668.0
No. Observations:                2968   AIC:                            -3332.
Df Residuals:                    2966   BIC:                            -3320.
Df Model:                           1                                         
Covariance Type:            nonrobust                                         
===================================================================================
                      coef    std err          t      P&gt;|t|      [0.025      0.975]
-----------------------------------------------------------------------------------
const               4.4778      0.013    349.542      0.000       4.453       4.503
log_PTFSM6CLA1A    -0.2071      0.004    -51.095      0.000      -0.215      -0.199
==============================================================================
Omnibus:                      105.763   Durbin-Watson:                   1.313
Prob(Omnibus):                  0.000   Jarque-Bera (JB):              199.209
Skew:                           0.267   Prob(JB):                     5.53e-44
Kurtosis:                       4.151   Cond. No.                         17.5
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</code></pre>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sfirke/janitor">janitor</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org">readr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/">here</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">base_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://here.r-lib.org/reference/here.html">here</a></span><span class="op">(</span><span class="st">"sessions"</span>, <span class="st">"L6_data"</span>, <span class="st">"Performancetables_130242"</span>, <span class="st">"2022-2023"</span><span class="op">)</span></span>
<span><span class="va">na_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"NA"</span>, <span class="st">"SUPP"</span>, <span class="st">"NP"</span>, <span class="st">"NE"</span>, <span class="st">"SP"</span>, <span class="st">"SN"</span>, <span class="st">"LOWCOV"</span>, <span class="st">"NEW"</span>, <span class="st">"SUPPMAT"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">england_filtered</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">base_path</span>, <span class="st">"england_filtered.csv"</span><span class="op">)</span>, na <span class="op">=</span> <span class="va">na_all</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>URN <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">URN</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#str(england_filtered)</span></span>
<span></span>
<span><span class="va">england_filtered_clean</span> <span class="op">&lt;-</span> <span class="va">england_filtered</span><span class="op">[</span></span>
<span>  <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">england_filtered</span><span class="op">$</span><span class="va">ATT8SCR</span><span class="op">)</span> <span class="op">&amp;</span> </span>
<span>  <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">england_filtered</span><span class="op">$</span><span class="va">PTFSM6CLA1A</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="va">england_filtered</span><span class="op">$</span><span class="va">ATT8SCR</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;</span></span>
<span>  <span class="va">england_filtered</span><span class="op">$</span><span class="va">PTFSM6CLA1A</span> <span class="op">&gt;</span> <span class="fl">0</span>, </span>
<span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Fit linear model and get predicted values</span></span>
<span><span class="va">england_model1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">ATT8SCR</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">PTFSM6CLA1A</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">england_filtered_clean</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">england_model1</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log(ATT8SCR) ~ log(PTFSM6CLA1A), data = england_filtered_clean)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.65843 -0.08607 -0.00897  0.07800  0.55670 

Coefficients:
                  Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)       4.477823   0.012811  349.54   &lt;2e-16 ***
log(PTFSM6CLA1A) -0.207090   0.004053  -51.09   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.138 on 2966 degrees of freedom
Multiple R-squared:  0.4681,    Adjusted R-squared:  0.468 
F-statistic:  2611 on 1 and 2966 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section id="task-2---exploratory-analysis-and-data-preparation" class="level2"><h2 class="anchored" data-anchor-id="task-2---exploratory-analysis-and-data-preparation">Task 2 - Exploratory Analysis and Data Preparation</h2>
<ul>
<li>Right, we that was a nice and simple starter. We now have a baseline and something to compare your subsequent more sophisticated models to.</li>
<li>These next steps will be a little trickier and I will be expecting you to use some of the knowledge gained last week to complete the tasks, rather than me giving you all of the right code explicitly.</li>
</ul>
<div class="tabset-margin-container"></div><div class="panel-tabset qna-question multicode">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true" href=""><img src="L6_images/python-logo-only.png" class="img-fluid" width="30"></a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false" href=""><img src="L6_images/Rlogo.png" width="41" height="30"></a></li>
</ul>
<div class="tab-content qna-question multicode">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop unwanted numeric columns</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>numeric_cols <span class="op">=</span> england_filtered_clean.drop(columns<span class="op">=</span>[<span class="st">'easting'</span>, <span class="st">'northing'</span>, <span class="st">'LEA'</span>], errors<span class="op">=</span><span class="st">'ignore'</span>).select_dtypes(include<span class="op">=</span><span class="st">'number'</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to long format</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>numeric_long <span class="op">=</span> numeric_cols.melt(var_name<span class="op">=</span><span class="st">'variable'</span>, value_name<span class="op">=</span><span class="st">'value'</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up the figure</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>variables <span class="op">=</span> numeric_long[<span class="st">'variable'</span>].unique()</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>n_vars <span class="op">=</span> <span class="bu">len</span>(variables)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> <span class="dv">6</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>rows <span class="op">=</span> (n_vars <span class="op">+</span> cols <span class="op">-</span> <span class="dv">1</span>) <span class="op">//</span> cols</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(rows, cols, figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">3</span> <span class="op">*</span> rows))</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>axes <span class="op">=</span> axes.flatten()</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, var <span class="kw">in</span> <span class="bu">enumerate</span>(variables):</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    sns.histplot(data<span class="op">=</span>numeric_long[numeric_long[<span class="st">'variable'</span>] <span class="op">==</span> var], x<span class="op">=</span><span class="st">'value'</span>, bins<span class="op">=</span><span class="dv">30</span>, color<span class="op">=</span><span class="st">'steelblue'</span>, ax<span class="op">=</span>axes[i])</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    axes[i].set_title(var)</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    axes[i].set_xlabel(<span class="st">"Value"</span>)</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    axes[i].set_ylabel(<span class="st">"Count"</span>)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Hide unused subplots</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(i <span class="op">+</span> <span class="dv">1</span>, <span class="bu">len</span>(axes)):</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    fig.delaxes(axes[j])</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">"Histograms of Numerical Variables"</span>, y<span class="op">=</span><span class="fl">1.02</span>)</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>sns.despine()</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><a href="week7_practical_files/figure-html/unnamed-chunk-7-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="week7_practical_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="1728"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Log-transform relevant variables</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>england_filtered_clean[<span class="st">'log_ATT8SCR'</span>] <span class="op">=</span> np.log(england_filtered_clean[<span class="st">'ATT8SCR'</span>])</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>england_filtered_clean[<span class="st">'log_PTFSM6CLA1A'</span>] <span class="op">=</span> np.log(england_filtered_clean[<span class="st">'PTFSM6CLA1A'</span>])</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>england_filtered_clean[<span class="st">'log_PNUMEAL'</span>] <span class="op">=</span> np.log(england_filtered_clean[<span class="st">'PNUMEAL'</span>])</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>england_filtered_clean[<span class="st">'log_PERCTOT'</span>] <span class="op">=</span> np.log(england_filtered_clean[<span class="st">'PERCTOT'</span>])</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare long format data</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>long_df <span class="op">=</span> pd.melt(</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    england_filtered_clean,</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    id_vars<span class="op">=</span>[<span class="st">'log_ATT8SCR'</span>],</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    value_vars<span class="op">=</span>[<span class="st">'log_PTFSM6CLA1A'</span>, <span class="st">'log_PNUMEAL'</span>, <span class="st">'log_PERCTOT'</span>, <span class="st">'PTPRIORLO'</span>],</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    var_name<span class="op">=</span><span class="st">'predictor'</span>,</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    value_name<span class="op">=</span><span class="st">'x_value'</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Custom axis labels</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>axis_labels <span class="op">=</span> {</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">'log_PTFSM6CLA1A'</span>: <span class="st">'log(PTFSM6CLA1A)'</span>,</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">'log_PNUMEAL'</span>: <span class="st">'log(PNUMEAL)'</span>,</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">'log_PERCTOT'</span>: <span class="st">'log(PERCTOT)'</span>,</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">'PTPRIORLO'</span>: <span class="st">'PTPRIORLO'</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up the figure manually</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> long_df[<span class="st">'predictor'</span>].unique()</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>rows <span class="op">=</span> (<span class="bu">len</span>(predictors) <span class="op">+</span> cols <span class="op">-</span> <span class="dv">1</span>) <span class="op">//</span> cols</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(rows, cols, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">4</span> <span class="op">*</span> rows))</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>axes <span class="op">=</span> axes.flatten()</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, predictor <span class="kw">in</span> <span class="bu">enumerate</span>(predictors):</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> long_df[long_df[<span class="st">'predictor'</span>] <span class="op">==</span> predictor]</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>    sns.regplot(</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>        data<span class="op">=</span>subset,</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">'x_value'</span>,</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span><span class="st">'log_ATT8SCR'</span>,</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>        scatter_kws<span class="op">=</span>{<span class="st">'alpha'</span>: <span class="fl">0.5</span>, <span class="st">'color'</span>: <span class="st">'steelblue'</span>},</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>        line_kws<span class="op">=</span>{<span class="st">'color'</span>: <span class="st">'black'</span>},</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>        ax<span class="op">=</span>axes[i]</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>    axes[i].set_title(<span class="ss">f"log(ATT8SCR) vs </span><span class="sc">{</span>axis_labels[predictor]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>    axes[i].set_xlabel(axis_labels[predictor])</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>    axes[i].set_ylabel(<span class="st">"log(ATT8SCR)"</span>)</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Hide unused subplots</span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(i <span class="op">+</span> <span class="dv">1</span>, <span class="bu">len</span>(axes)):</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>    fig.delaxes(axes[j])</span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">"Scatter Plots of log(ATT8SCR) vs Predictors"</span>, y<span class="op">=</span><span class="fl">1.02</span>)</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>sns.despine()</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><a href="week7_practical_files/figure-html/unnamed-chunk-8-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="week7_practical_files/figure-html/unnamed-chunk-8-3.png" class="img-fluid figure-img" width="1152"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Select categorical columns and drop unwanted ones</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>categorical_cols <span class="op">=</span> england_filtered_clean.select_dtypes(include<span class="op">=</span><span class="st">'object'</span>).drop(</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span>[<span class="st">'URN'</span>, <span class="st">'SCHNAME.x'</span>, <span class="st">'LANAME'</span>, <span class="st">'TOWN.x'</span>, <span class="st">'SCHOOLTYPE.x'</span>], errors<span class="op">=</span><span class="st">'ignore'</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Determine layout</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>n_cols <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>n_rows <span class="op">=</span> (<span class="bu">len</span>(categorical_cols.columns) <span class="op">+</span> n_cols <span class="op">-</span> <span class="dv">1</span>) <span class="op">//</span> n_cols</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(n_rows, n_cols, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">4</span> <span class="op">*</span> n_rows))</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>axes <span class="op">=</span> axes.flatten()</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate bar plots</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, colname <span class="kw">in</span> <span class="bu">enumerate</span>(categorical_cols.columns):</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    sns.countplot(data<span class="op">=</span>categorical_cols, x<span class="op">=</span>colname, ax<span class="op">=</span>axes[i], color<span class="op">=</span><span class="st">'darkorange'</span>)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    axes[i].set_title(<span class="ss">f"Distribution of </span><span class="sc">{</span>colname<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    axes[i].set_xlabel(colname)</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    axes[i].set_ylabel(<span class="st">"Count"</span>)</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    axes[i].tick_params(axis<span class="op">=</span><span class="st">'x'</span>, rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Hide unused subplots</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(i <span class="op">+</span> <span class="dv">1</span>, <span class="bu">len</span>(axes)):</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    fig.delaxes(axes[j])</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><a href="week7_practical_files/figure-html/unnamed-chunk-9-5.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="week7_practical_files/figure-html/unnamed-chunk-9-5.png" class="img-fluid figure-img" width="1152"></a></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Select only numeric columns</span></span>
<span><span class="va">numeric_cols</span> <span class="op">&lt;-</span> <span class="va">england_filtered_clean</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html">where</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">easting</span>, <span class="op">-</span><span class="va">northing</span>, <span class="op">-</span><span class="va">LEA</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert to long format for faceting</span></span>
<span><span class="va">numeric_long</span> <span class="op">&lt;-</span> <span class="va">numeric_cols</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"variable"</span>, values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot faceted histograms</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">numeric_long</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">30</span>, fill <span class="op">=</span> <span class="st">"steelblue"</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">variable</span>, scales <span class="op">=</span> <span class="st">"free"</span>, ncol <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Histograms of Numerical Variables"</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><a href="week7_practical_files/figure-html/unnamed-chunk-10-7.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="week7_practical_files/figure-html/unnamed-chunk-10-7.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Prepare the data</span></span>
<span><span class="va">scatter_data</span> <span class="op">&lt;-</span> <span class="va">england_filtered_clean</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">ATT8SCR</span>, <span class="va">PTFSM6CLA1A</span>, <span class="va">PNUMEAL</span>, <span class="va">PERCTOT</span>, <span class="va">PTPRIORLO</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    log_ATT8SCR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">ATT8SCR</span><span class="op">)</span>,</span>
<span>    log_PTFSM6CLA1A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">PTFSM6CLA1A</span><span class="op">)</span>,</span>
<span>    log_PNUMEAL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">PNUMEAL</span><span class="op">)</span>,</span>
<span>    log_PERCTOT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">PERCTOT</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">log_PTFSM6CLA1A</span>, <span class="va">log_PNUMEAL</span>, <span class="va">log_PERCTOT</span>, <span class="va">PTPRIORLO</span><span class="op">)</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"predictor"</span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"x_value"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Create faceted scatter plots</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">scatter_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x_value</span>, y <span class="op">=</span> <span class="va">log_ATT8SCR</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span>, color <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">TRUE</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">predictor</span>, scales <span class="op">=</span> <span class="st">"free_x"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Scatter Plots of log(ATT8SCR) vs Predictors"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Predictor (log-transformed where applicable)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"log(ATT8SCR)"</span></span>
<span>  <span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><a href="week7_practical_files/figure-html/unnamed-chunk-11-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="week7_practical_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/">cowplot</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Drop unwanted columns</span></span>
<span><span class="va">categorical_cols</span> <span class="op">&lt;-</span> <span class="va">england_filtered_clean</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html">where</a></span><span class="op">(</span><span class="va">is.character</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">URN</span>, <span class="op">-</span><span class="va">SCHNAME.x</span>, <span class="op">-</span><span class="va">LANAME</span>, <span class="op">-</span><span class="va">TOWN.x</span>, <span class="op">-</span><span class="va">SCHOOLTYPE.x</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a list to store plots (unnamed)</span></span>
<span><span class="va">plot_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Loop through each categorical column and generate a bar plot</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">colname</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">categorical_cols</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">categorical_cols</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_.html">aes_string</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">colname</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"darkorange"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Distribution of"</span>, <span class="va">colname</span><span class="op">)</span>, x <span class="op">=</span> <span class="va">colname</span>, y <span class="op">=</span> <span class="st">"Count"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">plot_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/append.html">append</a></span><span class="op">(</span><span class="va">plot_list</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Append without naming</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Combine all plots into a single figure</span></span>
<span><span class="va">combined_plot</span> <span class="op">&lt;-</span> <span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span>plotlist <span class="op">=</span> <span class="va">plot_list</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">combined_plot</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><a href="week7_practical_files/figure-html/unnamed-chunk-12-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="week7_practical_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="768"></a></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<section id="changing-your-dummy-reference-category" class="level3"><h3 class="anchored" data-anchor-id="changing-your-dummy-reference-category">Changing your dummy reference category</h3>
<p>Your dummy variable reference category is the category within the variable that all other categories will be compared against in your model.</p>
<p>While the reference category has no effect on the model itself, it does make a difference for how you interpret your model.</p>
<p>For example, if you are using Regions in England as a dummy, setting your reference region as London will mean all other regions are compared to it and they might naturally be lower or higher.</p>
<p>A good strategy is to select the most or least numerous or important category in your variable, rather than something in the middle. Of course, you may not know which is most important until you run your model, so you may need to go back and reset the reference variable and run the model again.</p>
<p>Here is some code in R and Python to help you carry out the setting of the reference level (Yes, it’s more straightforward in R!)</p>
<div class="tabset-margin-container"></div><div class="panel-tabset qna-question multicode">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true" href=""><img src="L6_images/python-logo-only.png" class="img-fluid" width="30"></a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false" href=""><img src="L6_images/Rlogo.png" width="41" height="30"></a></li>
</ul>
<div class="tab-content qna-question multicode">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">

</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## In R, you can change the reference category using the relevel() function</span></span>
<span></span>
<span><span class="va">england_filtered_clean</span><span class="op">$</span><span class="va">gor_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/relevel.html">relevel</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">england_filtered_clean</span><span class="op">$</span><span class="va">gor_name</span><span class="op">)</span>, ref <span class="op">=</span> <span class="st">"South East"</span><span class="op">)</span></span>
<span><span class="va">england_filtered_clean</span><span class="op">$</span><span class="va">ofsted_rating_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/relevel.html">relevel</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">england_filtered_clean</span><span class="op">$</span><span class="va">OFSTEDRATING</span><span class="op">)</span>, ref <span class="op">=</span> <span class="st">"Good"</span><span class="op">)</span></span>
<span><span class="va">england_filtered_clean</span><span class="op">$</span><span class="va">ADMPOL_PT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/relevel.html">relevel</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">england_filtered_clean</span><span class="op">$</span><span class="va">ADMPOL_PT</span><span class="op">)</span>, ref <span class="op">=</span> <span class="st">"OTHER NON SEL"</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</div>
</div>
</div>
</section><section id="reclassifying-a-variable-into-fewer-categories" class="level3"><h3 class="anchored" data-anchor-id="reclassifying-a-variable-into-fewer-categories">Reclassifying a variable into fewer categories</h3>
<p>As mentioned in the lecture, it can sometimes be useful to reclassify a variable into fewer categories to see if a signal appears.</p>
<p>Let’s have a look at the religious character of a school variable and test it out as dummy in a basic model:</p>
<div class="{callout.note}">
<p>Note the Python code is far more complicated than the R code, but should prodice similar outputs</p>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset qna-question multicode">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true" href=""><img src="L6_images/python-logo-only.png" class="img-fluid" width="30"></a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false" href=""><img src="L6_images/Rlogo.png" width="41" height="30"></a></li>
</ul>
<div class="tab-content qna-question multicode">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop rows with missing values in relevant columns</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>model_df <span class="op">=</span> england_filtered_clean[[<span class="st">'ATT8SCR'</span>, <span class="st">'PTFSM6CLA1A'</span>, <span class="st">'RELCHAR'</span>]].dropna().copy()</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Log-transform numeric variables</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>model_df[<span class="st">'log_ATT8SCR'</span>] <span class="op">=</span> np.log(model_df[<span class="st">'ATT8SCR'</span>].astype(<span class="bu">float</span>))</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>model_df[<span class="st">'log_PTFSM6CLA1A'</span>] <span class="op">=</span> np.log(model_df[<span class="st">'PTFSM6CLA1A'</span>].astype(<span class="bu">float</span>))</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure RELCHAR is treated as categorical</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>model_df[<span class="st">'RELCHAR'</span>] <span class="op">=</span> model_df[<span class="st">'RELCHAR'</span>].astype(<span class="st">'category'</span>)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Create design matrix with dummy variables for RELCHAR</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.get_dummies(model_df[[<span class="st">'log_PTFSM6CLA1A'</span>, <span class="st">'RELCHAR'</span>]], drop_first<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Add constant</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(X)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Response variable</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> model_df[<span class="st">'log_ATT8SCR'</span>]</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure all columns are float64 to avoid dtype issues</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> X.astype(<span class="st">'float64'</span>)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> y.astype(<span class="st">'float64'</span>)</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit linear model using Pandas DataFrame directly</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.OLS(y, X).fit()</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Display summary with proper variable names</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:            log_ATT8SCR   R-squared:                       0.429
Model:                            OLS   Adj. R-squared:                  0.424
Method:                 Least Squares   F-statistic:                     99.29
Date:                Wed, 29 Oct 2025   Prob (F-statistic):          3.44e-213
Time:                        12:53:31   Log-Likelihood:                 1138.8
No. Observations:                1868   AIC:                            -2248.
Df Residuals:                    1853   BIC:                            -2165.
Df Model:                          14                                         
Covariance Type:            nonrobust                                         
============================================================================================================
                                               coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------------------------------------
const                                        4.2730      0.134     31.939      0.000       4.011       4.535
log_PTFSM6CLA1A                             -0.1860      0.005    -34.224      0.000      -0.197      -0.175
RELCHAR_Catholic                             0.1769      0.153      1.159      0.246      -0.122       0.476
RELCHAR_Christian                            0.2358      0.134      1.763      0.078      -0.027       0.498
RELCHAR_Church of England                    0.1498      0.133      1.130      0.259      -0.110       0.410
RELCHAR_Church of England/Christian          0.1546      0.187      0.827      0.408      -0.212       0.521
RELCHAR_Church of England/Roman Catholic     0.0989      0.141      0.700      0.484      -0.178       0.376
RELCHAR_Does not apply                       0.1255      0.132      0.950      0.342      -0.134       0.385
RELCHAR_Greek Orthodox                       0.1586      0.187      0.849      0.396      -0.208       0.525
RELCHAR_Hindu                                0.2145      0.187      1.146      0.252      -0.152       0.581
RELCHAR_Jewish                               0.1289      0.138      0.935      0.350      -0.141       0.399
RELCHAR_Muslim                               0.4221      0.136      3.106      0.002       0.156       0.689
RELCHAR_Roman Catholic                       0.1755      0.132      1.325      0.185      -0.084       0.435
RELCHAR_Roman Catholic/Church of England     0.0789      0.145      0.546      0.585      -0.205       0.363
RELCHAR_Sikh                                 0.1980      0.162      1.223      0.221      -0.119       0.515
==============================================================================
Omnibus:                       54.961   Durbin-Watson:                   1.338
Prob(Omnibus):                  0.000   Jarque-Bera (JB):              135.365
Skew:                           0.041   Prob(JB):                     4.04e-30
Kurtosis:                       4.316   Cond. No.                         561.
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</code></pre>
</div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Fit linear model and get predicted values</span></span>
<span><span class="va">england_model2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">ATT8SCR</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">PTFSM6CLA1A</span><span class="op">)</span> <span class="op">+</span> <span class="va">RELCHAR</span>, data <span class="op">=</span> <span class="va">england_filtered_clean</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">england_model2</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log(ATT8SCR) ~ log(PTFSM6CLA1A) + RELCHAR, data = england_filtered_clean)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.64638 -0.08524 -0.00935  0.07833  0.55537 

Coefficients:
                                         Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)                              4.353703   0.136250  31.954  &lt; 2e-16
log(PTFSM6CLA1A)                        -0.206428   0.004055 -50.910  &lt; 2e-16
RELCHARCatholic                          0.157465   0.156284   1.008  0.31375
RELCHARChristian                         0.218783   0.136987   1.597  0.11035
RELCHARChurch of England                 0.131462   0.135766   0.968  0.33298
RELCHARChurch of England/Christian       0.122838   0.191454   0.642  0.52118
RELCHARChurch of England/Roman Catholic  0.080702   0.144692   0.558  0.57706
RELCHARDoes not apply                    0.109962   0.135391   0.812  0.41675
RELCHARGreek Orthodox                    0.133210   0.191417   0.696  0.48654
RELCHARHindu                             0.173507   0.191523   0.906  0.36504
RELCHARJewish                            0.089840   0.141044   0.637  0.52420
RELCHARMuslim                            0.410154   0.139248   2.945  0.00325
RELCHARNone                              0.120208   0.135422   0.888  0.37480
RELCHARRoman Catholic                    0.156817   0.135599   1.156  0.24758
RELCHARRoman Catholic/Church of England  0.065413   0.148244   0.441  0.65906
RELCHARSikh                              0.177106   0.165766   1.068  0.28542
                                           
(Intercept)                             ***
log(PTFSM6CLA1A)                        ***
RELCHARCatholic                            
RELCHARChristian                           
RELCHARChurch of England                   
RELCHARChurch of England/Christian         
RELCHARChurch of England/Roman Catholic    
RELCHARDoes not apply                      
RELCHARGreek Orthodox                      
RELCHARHindu                               
RELCHARJewish                              
RELCHARMuslim                           ** 
RELCHARNone                                
RELCHARRoman Catholic                      
RELCHARRoman Catholic/Church of England    
RELCHARSikh                                
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.1353 on 2935 degrees of freedom
  (17 observations deleted due to missingness)
Multiple R-squared:  0.4904,    Adjusted R-squared:  0.4878 
F-statistic: 188.3 on 15 and 2935 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>You will notice that the religious character variables nearly all insignificant. As such, lets try collapsing into three groups - “None”, “Christian” and “Non-Christian”</p>
<div class="tabset-margin-container"></div><div class="panel-tabset qna-question multicode">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true" href=""><img src="L6_images/python-logo-only.png" class="img-fluid" width="30"></a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false" href=""><img src="L6_images/Rlogo.png" width="41" height="30"></a></li>
</ul>
<div class="tab-content qna-question multicode">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define mapping function</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> classify_relchar(value):</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> pd.isna(value):</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"None"</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> value <span class="kw">in</span> [<span class="st">"Does not apply"</span>, <span class="st">"None"</span>]:</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"None"</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> value <span class="kw">in</span> [</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Roman Catholic"</span>, <span class="st">"Greek Orthodox"</span>, <span class="st">"Church of England"</span>, <span class="st">"Catholic"</span>, <span class="st">"Christian"</span>,</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Church of England/Roman Catholic"</span>, <span class="st">"Roman Catholic/Church of England"</span>,</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Church of England/Christian"</span>, <span class="st">"Anglican/Church of England"</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    ]:</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"Christian"</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"Non-Christian"</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply classification</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>england_filtered_clean[<span class="st">'RELCHAR_Grp'</span>] <span class="op">=</span> england_filtered_clean[<span class="st">'RELCHAR'</span>].<span class="bu">apply</span>(classify_relchar)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">england_filtered_clean</span> <span class="op">&lt;-</span> <span class="va">england_filtered_clean</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>RELCHAR_Grp <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">RELCHAR</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Does not apply"</span>, <span class="st">"None"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"None"</span>,</span>
<span>    <span class="va">RELCHAR</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"Roman Catholic"</span>, <span class="st">"Greek Orthodox"</span>, <span class="st">"Church of England"</span>, <span class="st">"Catholic"</span>, <span class="st">"Christian"</span>,</span>
<span>      <span class="st">"Church of England/Roman Catholic"</span>, <span class="st">"Roman Catholic/Church of England"</span>,</span>
<span>      <span class="st">"Church of England/Christian"</span>, <span class="st">"Anglican/Church of England"</span></span>
<span>    <span class="op">)</span> <span class="op">~</span> <span class="st">"Christian"</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"Non-Christian"</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</div>
</div>
</div>
<p>Now re-run your model</p>
<div class="tabset-margin-container"></div><div class="panel-tabset qna-question multicode">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true" href=""><img src="L6_images/python-logo-only.png" class="img-fluid" width="30"></a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false" href=""><img src="L6_images/Rlogo.png" width="41" height="30"></a></li>
</ul>
<div class="tab-content qna-question multicode">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert RELCHAR_Grp to a categorical variable with "None" as the reference level</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>england_filtered_clean[<span class="st">'RELCHAR_Grp'</span>] <span class="op">=</span> pd.Categorical(</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    england_filtered_clean[<span class="st">'RELCHAR_Grp'</span>],</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    categories<span class="op">=</span>[<span class="st">"None"</span>, <span class="st">"Christian"</span>, <span class="st">"Non-Christian"</span>],</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    ordered<span class="op">=</span><span class="va">False</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop rows with missing values in relevant columns</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>model_df <span class="op">=</span> england_filtered_clean[[<span class="st">'ATT8SCR'</span>, <span class="st">'PTFSM6CLA1A'</span>, <span class="st">'RELCHAR_Grp'</span>]].dropna().copy()</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Log-transform numeric variables</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>model_df[<span class="st">'log_ATT8SCR'</span>] <span class="op">=</span> np.log(model_df[<span class="st">'ATT8SCR'</span>].astype(<span class="bu">float</span>))</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>model_df[<span class="st">'log_PTFSM6CLA1A'</span>] <span class="op">=</span> np.log(model_df[<span class="st">'PTFSM6CLA1A'</span>].astype(<span class="bu">float</span>))</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure RELCHAR is treated as categorical</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>model_df[<span class="st">'RELCHAR_Grp'</span>] <span class="op">=</span> model_df[<span class="st">'RELCHAR_Grp'</span>].astype(<span class="st">'category'</span>)</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Create design matrix with dummy variables for RELCHAR</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.get_dummies(model_df[[<span class="st">'log_PTFSM6CLA1A'</span>, <span class="st">'RELCHAR_Grp'</span>]], drop_first<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Add constant</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(X)</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Response variable</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> model_df[<span class="st">'log_ATT8SCR'</span>]</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure all columns are float64 to avoid dtype issues</span></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> X.astype(<span class="st">'float64'</span>)</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> y.astype(<span class="st">'float64'</span>)</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit linear model using Pandas DataFrame directly</span></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.OLS(y, X).fit()</span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Display summary with proper variable names</span></span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:            log_ATT8SCR   R-squared:                       0.480
Model:                            OLS   Adj. R-squared:                  0.479
Method:                 Least Squares   F-statistic:                     912.1
Date:                Wed, 29 Oct 2025   Prob (F-statistic):               0.00
Time:                        12:53:32   Log-Likelihood:                 1701.5
No. Observations:                2968   AIC:                            -3395.
Df Residuals:                    2964   BIC:                            -3371.
Df Model:                           3                                         
Covariance Type:            nonrobust                                         
=============================================================================================
                                coef    std err          t      P&gt;|t|      [0.025      0.975]
---------------------------------------------------------------------------------------------
const                         4.4636      0.013    348.686      0.000       4.438       4.489
log_PTFSM6CLA1A              -0.2051      0.004    -51.053      0.000      -0.213      -0.197
RELCHAR_Grp_Christian         0.0371      0.007      5.539      0.000       0.024       0.050
RELCHAR_Grp_Non-Christian     0.1544      0.024      6.347      0.000       0.107       0.202
==============================================================================
Omnibus:                       91.156   Durbin-Watson:                   1.356
Prob(Omnibus):                  0.000   Jarque-Bera (JB):              175.557
Skew:                           0.219   Prob(JB):                     7.55e-39
Kurtosis:                       4.108   Cond. No.                         32.2
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</code></pre>
</div>
</div>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Fit linear model and get predicted values</span></span>
<span><span class="co"># Ensure RELCHAR_Grp is a factor with "None" as the reference level</span></span>
<span><span class="va">england_filtered_clean</span> <span class="op">&lt;-</span> <span class="va">england_filtered_clean</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>RELCHAR_Grp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">RELCHAR_Grp</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"None"</span>, <span class="st">"Christian"</span>, <span class="st">"Non-Christian"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">england_model2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">ATT8SCR</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">PTFSM6CLA1A</span><span class="op">)</span> <span class="op">+</span> <span class="va">RELCHAR_Grp</span>, data <span class="op">=</span> <span class="va">england_filtered_clean</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">england_model2</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log(ATT8SCR) ~ log(PTFSM6CLA1A) + RELCHAR_Grp, data = england_filtered_clean)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.65098 -0.08639 -0.00989  0.07850  0.56101 

Coefficients:
                          Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)               4.467675   0.012825 348.354  &lt; 2e-16 ***
log(PTFSM6CLA1A)         -0.206242   0.004027 -51.213  &lt; 2e-16 ***
RELCHAR_GrpChristian      0.036648   0.006730   5.445 5.59e-08 ***
RELCHAR_GrpNon-Christian  0.080653   0.019773   4.079 4.64e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.137 on 2964 degrees of freedom
Multiple R-squared:  0.4759,    Adjusted R-squared:  0.4754 
F-statistic: 897.1 on 3 and 2964 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Has this made a difference? What’s happened to the significance of the religious character variable?</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>You can use this method to reclassify any different variable.</p>
<p>Think about how you might reclassify a continuous variable. You might think about converting something like ‘total number of pupils on roll’ into ‘small’, ‘medium’ and ‘large’ schools, for example, based on certain thresholds. How might you choose these thresholds? If you are struggling to think of how you might code this kind of reclassification up, this is exactly where AI can be very helpful in assisting you - although while it might be good at the code to do it, I can guarantee it will likely be pretty bad at deciding on useful breaks in your data, so this is where you might need to intervene.</p>
</div>
</div>
</section></section><section id="task-3---building-your-optimum-multiple-regression-model" class="level2"><h2 class="anchored" data-anchor-id="task-3---building-your-optimum-multiple-regression-model">Task 3 - Building your optimum multiple regression model</h2>
<section id="recipe-steps" class="level3"><h3 class="anchored" data-anchor-id="recipe-steps">Recipe Steps</h3>
<ul>
<li>Using the steps you learned last week and the information from this week’s lecture, I would like you to find the best possible <strong><em>7-dependent variable model</em></strong> for your chosen attainment variable (without interaction terms). These can be continuous or categorical variables or any combination of them. Remember:
<ul>
<li>Use exploratory analysis to check the distributions of your variables using histograms, box plots etc. or binary scatter plots with your dependent variable, <strong><em>before</em></strong> putting them into your model (you’ve already done some of this, but you may need to do some more)</li>
<li>you might run into issues with logging some variables that have real 0s in them - this might cause your model to break. You might need to filter these variables out of your dataset before running your model. Some of the code above will help with this - if you get stuck, ask a friendly AI for help</li>
<li>with your dummy variables, you might want to experiment with changing your reference category</li>
<li>you might also want to reclassify a variable if you suspect it is important, but that in its present form is coming out as insignificant</li>
<li>check you regression assumptions - linearity, homoscedasticity, normality of residuals, multicollinearity, independence of residuals - does your model pass?</li>
<li>which are the most important variables in your model in terms of t-values?</li>
</ul>
</li>
<li>You should try and build your model step by step, a variable at a time. Each time you run the model, check what is happening to the coefficients
<ul>
<li>What do you notice about confounding or mediation as you go?</li>
<li>Do any of your variables become insignificant? For example, what happens to religious character groups in the presence of regions, for example? If a variable becomes insignificant, you might we wise to drop it from the analysis (but maybe not until the end in case another variable makes it significant again)</li>
</ul>
</li>
</ul>
<section id="on-your-marks-get-set---go" class="level4"><h4 class="anchored" data-anchor-id="on-your-marks-get-set---go">ON YOUR MARKS, GET SET - GO!!!</h4>
<p>When you think you have your best model, move on to Task 4 below</p>
<div class="tabset-margin-container"></div><div class="panel-tabset qna-question multicode">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true" href=""><img src="L6_images/python-logo-only.png" class="img-fluid" width="30"></a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false" href=""><img src="L6_images/Rlogo.png" width="41" height="30"></a></li>
</ul>
<div class="tab-content qna-question multicode">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">

</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://easystats.github.io/performance/">performance</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://jtools.jacob-long.com">jtools</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">england_filtered_clean</span> <span class="op">&lt;-</span> <span class="va">england_filtered_clean</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">PTFSM6CLA1A</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="va">PERCTOT</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="va">PNUMEAL</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">england_model3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">ATT8SCR</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">PTFSM6CLA1A</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">PERCTOT</span><span class="op">)</span> <span class="op">+</span> <span class="va">RELCHAR_Grp</span>, data <span class="op">=</span> <span class="va">england_filtered_clean</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">england_model3</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log(ATT8SCR) ~ log(PTFSM6CLA1A) + log(PERCTOT) + 
    RELCHAR_Grp, data = england_filtered_clean)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.37259 -0.06589 -0.00213  0.06103  0.76031 

Coefficients:
                          Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)               5.058526   0.015456 327.295   &lt;2e-16 ***
log(PTFSM6CLA1A)         -0.112548   0.003571 -31.516   &lt;2e-16 ***
log(PERCTOT)             -0.400243   0.008238 -48.585   &lt;2e-16 ***
RELCHAR_GrpChristian     -0.004545   0.005082  -0.894    0.371    
RELCHAR_GrpNon-Christian -0.013948   0.014850  -0.939    0.348    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.102 on 2956 degrees of freedom
Multiple R-squared:  0.7092,    Adjusted R-squared:  0.7088 
F-statistic:  1802 on 4 and 2956 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">england_model4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">ATT8SCR</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">PTFSM6CLA1A</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">PERCTOT</span><span class="op">)</span> <span class="op">+</span> <span class="va">gor_name</span>, data <span class="op">=</span> <span class="va">england_filtered_clean</span>, na.action <span class="op">=</span> <span class="va">na.exclude</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">england_model4</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log(ATT8SCR) ~ log(PTFSM6CLA1A) + log(PERCTOT) + 
    gor_name, data = england_filtered_clean, na.action = na.exclude)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.39840 -0.06023 -0.00054  0.05878  0.71757 

Coefficients:
                                   Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                       5.0107282  0.0153085 327.317  &lt; 2e-16 ***
log(PTFSM6CLA1A)                 -0.1318266  0.0037583 -35.076  &lt; 2e-16 ***
log(PERCTOT)                     -0.3615186  0.0083599 -43.244  &lt; 2e-16 ***
gor_nameEast Midlands            -0.0101682  0.0076764  -1.325 0.185402    
gor_nameEast of England          -0.0032498  0.0070509  -0.461 0.644903    
gor_nameLondon                    0.0885951  0.0071258  12.433  &lt; 2e-16 ***
gor_nameNorth East                0.0716603  0.0097712   7.334 2.88e-13 ***
gor_nameNorth West               -0.0002658  0.0068006  -0.039 0.968826    
gor_nameSouth West                0.0206193  0.0073599   2.802 0.005118 ** 
gor_nameWest Midlands             0.0216499  0.0071195   3.041 0.002379 ** 
gor_nameYorkshire and the Humber  0.0272177  0.0074654   3.646 0.000271 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.09737 on 2950 degrees of freedom
Multiple R-squared:  0.7357,    Adjusted R-squared:  0.7348 
F-statistic: 821.1 on 10 and 2950 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">england_model5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">ATT8SCR</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">PTFSM6CLA1A</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">PERCTOT</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">PNUMEAL</span><span class="op">)</span> <span class="op">+</span> <span class="va">gor_name</span>, data <span class="op">=</span> <span class="va">england_filtered_clean</span>, na.action <span class="op">=</span> <span class="va">na.exclude</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">england_model5</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log(ATT8SCR) ~ log(PTFSM6CLA1A) + log(PERCTOT) + 
    log(PNUMEAL) + gor_name, data = england_filtered_clean, na.action = na.exclude)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.40707 -0.05726  0.00153  0.05906  0.66397 

Coefficients:
                                   Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                       4.9559677  0.0158886 311.920  &lt; 2e-16 ***
log(PTFSM6CLA1A)                 -0.1463138  0.0039338 -37.194  &lt; 2e-16 ***
log(PERCTOT)                     -0.3397722  0.0084583 -40.170  &lt; 2e-16 ***
log(PNUMEAL)                      0.0206186  0.0019433  10.610  &lt; 2e-16 ***
gor_nameEast Midlands            -0.0004914  0.0075902  -0.065 0.948380    
gor_nameEast of England           0.0007515  0.0069315   0.108 0.913676    
gor_nameLondon                    0.0745376  0.0071191  10.470  &lt; 2e-16 ***
gor_nameNorth East                0.0963456  0.0098697   9.762  &lt; 2e-16 ***
gor_nameNorth West                0.0098559  0.0067434   1.462 0.143966    
gor_nameSouth West                0.0343067  0.0073388   4.675 3.08e-06 ***
gor_nameWest Midlands             0.0256262  0.0069986   3.662 0.000255 ***
gor_nameYorkshire and the Humber  0.0359445  0.0073741   4.874 1.15e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.09558 on 2949 degrees of freedom
Multiple R-squared:  0.7454,    Adjusted R-squared:  0.7445 
F-statistic: 784.9 on 11 and 2949 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">england_model6</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">ATT8SCR</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">PTFSM6CLA1A</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">PERCTOT</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">PNUMEAL</span><span class="op">)</span> <span class="op">+</span> <span class="va">OFSTEDRATING</span> <span class="op">+</span> <span class="va">gor_name</span>, data <span class="op">=</span> <span class="va">england_filtered_clean</span>, na.action <span class="op">=</span> <span class="va">na.exclude</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">england_model6</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log(ATT8SCR) ~ log(PTFSM6CLA1A) + log(PERCTOT) + 
    log(PNUMEAL) + OFSTEDRATING + gor_name, data = england_filtered_clean, 
    na.action = na.exclude)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.39799 -0.05644  0.00150  0.05800  0.54719 

Coefficients:
                                  Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                       4.841810   0.017103 283.105  &lt; 2e-16 ***
log(PTFSM6CLA1A)                 -0.140453   0.003814 -36.829  &lt; 2e-16 ***
log(PERCTOT)                     -0.293625   0.008762 -33.510  &lt; 2e-16 ***
log(PNUMEAL)                      0.017114   0.001899   9.011  &lt; 2e-16 ***
OFSTEDRATINGOutstanding           0.067858   0.005310  12.779  &lt; 2e-16 ***
OFSTEDRATINGRequires improvement -0.051879   0.005492  -9.445  &lt; 2e-16 ***
OFSTEDRATINGSerious Weaknesses   -0.039225   0.019715  -1.990   0.0467 *  
OFSTEDRATINGSpecial Measures     -0.090715   0.023054  -3.935 8.52e-05 ***
gor_nameEast Midlands             0.004759   0.007336   0.649   0.5166    
gor_nameEast of England           0.001422   0.006674   0.213   0.8313    
gor_nameLondon                    0.071049   0.006851  10.371  &lt; 2e-16 ***
gor_nameNorth East                0.085795   0.009534   8.999  &lt; 2e-16 ***
gor_nameNorth West                0.016287   0.006545   2.489   0.0129 *  
gor_nameSouth West                0.033397   0.007066   4.727 2.39e-06 ***
gor_nameWest Midlands             0.027829   0.006750   4.123 3.85e-05 ***
gor_nameYorkshire and the Humber  0.033224   0.007109   4.673 3.10e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.09112 on 2886 degrees of freedom
  (59 observations deleted due to missingness)
Multiple R-squared:  0.7694,    Adjusted R-squared:  0.7682 
F-statistic: 642.1 on 15 and 2886 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">england_model7</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">ATT8SCR</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">PTFSM6CLA1A</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">PERCTOT</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">PNUMEAL</span><span class="op">)</span> <span class="op">+</span> <span class="va">OFSTEDRATING</span> <span class="op">+</span> <span class="va">gor_name</span> <span class="op">+</span> <span class="va">PTPRIORLO</span> <span class="op">+</span> <span class="va">ADMPOL_PT</span>, data <span class="op">=</span> <span class="va">england_filtered_clean</span>, na.action <span class="op">=</span> <span class="va">na.exclude</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">england_model7</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log(ATT8SCR) ~ log(PTFSM6CLA1A) + log(PERCTOT) + 
    log(PNUMEAL) + OFSTEDRATING + gor_name + PTPRIORLO + ADMPOL_PT, 
    data = england_filtered_clean, na.action = na.exclude)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.37723 -0.04528  0.00333  0.04912  0.30081 

Coefficients:
                                      Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                          4.6296089  0.0154652 299.356  &lt; 2e-16 ***
log(PTFSM6CLA1A)                    -0.0699264  0.0036900 -18.950  &lt; 2e-16 ***
log(PERCTOT)                        -0.2244960  0.0074455 -30.152  &lt; 2e-16 ***
log(PNUMEAL)                         0.0179676  0.0016174  11.109  &lt; 2e-16 ***
OFSTEDRATINGOutstanding              0.0551690  0.0043794  12.597  &lt; 2e-16 ***
OFSTEDRATINGRequires improvement    -0.0516629  0.0045211 -11.427  &lt; 2e-16 ***
OFSTEDRATINGSerious Weaknesses      -0.0602663  0.0162207  -3.715 0.000207 ***
OFSTEDRATINGSpecial Measures        -0.0951661  0.0189679  -5.017 5.56e-07 ***
gor_nameEast Midlands                0.0128394  0.0060587   2.119 0.034161 *  
gor_nameEast of England              0.0185393  0.0056555   3.278 0.001058 ** 
gor_nameLondon                       0.0395373  0.0058383   6.772 1.53e-11 ***
gor_nameNorth East                   0.0331207  0.0080787   4.100 4.25e-05 ***
gor_nameNorth West                  -0.0010765  0.0054833  -0.196 0.844374    
gor_nameSouth West                   0.0382890  0.0059572   6.427 1.51e-10 ***
gor_nameWest Midlands                0.0187024  0.0057100   3.275 0.001068 ** 
gor_nameYorkshire and the Humber     0.0328390  0.0060105   5.464 5.06e-08 ***
PTPRIORLO                           -0.0069371  0.0002201 -31.525  &lt; 2e-16 ***
ADMPOL_PTNON SEL IN HIGHLY SEL AREA -0.0154098  0.0060930  -2.529 0.011488 *  
ADMPOL_PTSEL                         0.0652773  0.0077220   8.453  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.07492 on 2883 degrees of freedom
  (59 observations deleted due to missingness)
Multiple R-squared:  0.8443,    Adjusted R-squared:  0.8433 
F-statistic: 868.5 on 18 and 2883 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#Get fitted values with NA for excluded rows</span></span>
<span><span class="va">fitted_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html">fitted</a></span><span class="op">(</span><span class="va">england_model7</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add fitted values to the dataframe</span></span>
<span><span class="va">england_filtered_clean</span><span class="op">$</span><span class="va">fitted7</span> <span class="op">&lt;-</span> <span class="va">fitted_vals</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</div>
</div>
</div>
</section></section></section><section id="task-4---evaluation" class="level2"><h2 class="anchored" data-anchor-id="task-4---evaluation">Task 4 - Evaluation</h2>
<ul>
<li>When you have your ‘best’ model, how do you interpret the coefficients?
<ul>
<li>Which variable(s) has(have) the most explanatory power (check t-values for this)?</li>
<li>How do you interpret the combined explanatory power of variables in your model?</li>
<li>What kind of confounding do you observe as you add more variables (if any)?</li>
<li>Do you have any issues of multicollinearity or residual independence? Does your model pass the standard tests?</li>
</ul>
</li>
</ul>
<p>Here’s my best model compared with some of the others I built as I went along</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">england_model3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] "(Intercept)"              "log(PTFSM6CLA1A)"        
[3] "log(PERCTOT)"             "RELCHAR_GrpChristian"    
[5] "RELCHAR_GrpNon-Christian"</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">coef_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"Constant"</span> <span class="op">=</span> <span class="st">"(Intercept)"</span>,</span>
<span>  <span class="co">#"Religious Christian" = "RELCHAR_GrpChristian",</span></span>
<span>  <span class="co">#"Religious not-Christian","RELCHAR_GrpNon-Christian",</span></span>
<span>  <span class="st">"% Disadvantaged end KS4 (log)"</span> <span class="op">=</span> <span class="st">"log(PTFSM6CLA1A)"</span>,</span>
<span>  <span class="st">"% overall absence (log)"</span> <span class="op">=</span> <span class="st">"log(PERCTOT)"</span>,</span>
<span>  <span class="st">"% English Not First Language (log)"</span> <span class="op">=</span> <span class="st">"log(PNUMEAL)"</span>,</span>
<span>  <span class="st">"Ofsted: Outstanding"</span> <span class="op">=</span> <span class="st">"OFSTEDRATINGOutstanding"</span>,</span>
<span>  <span class="st">"Ofsted: Requires Improvement"</span> <span class="op">=</span> <span class="st">"OFSTEDRATINGRequires improvement"</span>,</span>
<span>  <span class="st">"Ofsted: Serious Weaknesses"</span> <span class="op">=</span> <span class="st">"OFSTEDRATINGSerious Weaknesses"</span>,</span>
<span>  <span class="st">"Ofsted: Special Measures"</span> <span class="op">=</span> <span class="st">"OFSTEDRATINGSpecial Measures"</span>,</span>
<span>  <span class="st">"Region: East Midlands"</span> <span class="op">=</span> <span class="st">"gor_nameEast Midlands"</span>,</span>
<span>  <span class="st">"Region: East of England"</span> <span class="op">=</span> <span class="st">"gor_nameEast of England"</span>,</span>
<span>  <span class="st">"Region: London"</span> <span class="op">=</span> <span class="st">"gor_nameLondon"</span>,</span>
<span>  <span class="st">"Region: North East"</span> <span class="op">=</span> <span class="st">"gor_nameNorth East"</span>,</span>
<span>  <span class="st">"Region: North West"</span> <span class="op">=</span> <span class="st">"gor_nameNorth West"</span>,</span>
<span>  <span class="st">"Region: South West"</span> <span class="op">=</span> <span class="st">"gor_nameSouth West"</span>,</span>
<span>  <span class="st">"Region: West Midlands"</span> <span class="op">=</span> <span class="st">"gor_nameWest Midlands"</span>,</span>
<span>  <span class="st">"Region: Yorkshire and the Humber"</span> <span class="op">=</span> <span class="st">"gor_nameYorkshire and the Humber"</span>,</span>
<span>  <span class="st">"% Low Prior Attainment"</span> <span class="op">=</span> <span class="st">"PTPRIORLO"</span>,</span>
<span>  <span class="st">"Admissions: Non-selective in Highly Selective Area"</span> <span class="op">=</span> <span class="st">"ADMPOL_PTNON SEL IN HIGHLY SEL AREA"</span>,</span>
<span>  <span class="st">"Admissions: Selective"</span> <span class="op">=</span> <span class="st">"ADMPOL_PTSEL"</span></span>
<span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://jtools.jacob-long.com">jtools</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://jtools.jacob-long.com/reference/export_summs.html">export_summs</a></span><span class="op">(</span></span>
<span>  <span class="va">england_model3</span>, <span class="va">england_model4</span>, <span class="va">england_model5</span>, <span class="va">england_model6</span>, <span class="va">england_model7</span>, </span>
<span>  robust <span class="op">=</span> <span class="st">"HC3"</span>,</span>
<span>  coefs <span class="op">=</span> <span class="va">coef_names</span></span>
<span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<table class="huxtable" data-quarto-disable-processing="true" style="margin-left: auto; margin-right: auto;">
<colgroup><col>
<col>
<col>
<col>
<col>
<col>
</colgroup><thead><tr>
<th class="huxtable-cell huxtable-header" style="text-align: center;  border-style: solid solid solid solid; border-width: 0.8pt 0pt 0pt 0pt;      font-weight: normal;"></th>
<th class="huxtable-cell huxtable-header" style="text-align: center;  border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt;      font-weight: normal;">Model 1</th>
<th class="huxtable-cell huxtable-header" style="text-align: center;  border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt;      font-weight: normal;">Model 2</th>
<th class="huxtable-cell huxtable-header" style="text-align: center;  border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt;      font-weight: normal;">Model 3</th>
<th class="huxtable-cell huxtable-header" style="text-align: center;  border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt;      font-weight: normal;">Model 4</th>
<th class="huxtable-cell huxtable-header" style="text-align: center;  border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt;      font-weight: normal;">Model 5</th>
</tr></thead>
<tbody>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;">Constant</th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;">5.06 ***</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;">5.01 ***</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;">4.96 ***</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;">4.84 ***</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;">4.63 ***</td>
</tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;"></th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.02)&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.02)&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.02)&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.02)&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.02)&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;">% Disadvantaged end KS4 (log)</th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">-0.11 ***</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">-0.13 ***</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">-0.15 ***</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">-0.14 ***</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">-0.07 ***</td>
</tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;"></th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.00)&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.00)&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.00)&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.00)&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.00)&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;">% overall absence (log)</th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">-0.40 ***</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">-0.36 ***</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">-0.34 ***</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">-0.29 ***</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">-0.22 ***</td>
</tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;"></th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.01)&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.01)&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.01)&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.01)&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.01)&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;">% English Not First Language (log)</th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">0.02 ***</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">0.02 ***</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">0.02 ***</td>
</tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;"></th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.00)&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.00)&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.00)&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;">Ofsted: Outstanding</th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">0.07 ***</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">0.06 ***</td>
</tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;"></th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.01)&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.00)&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;">Ofsted: Requires Improvement</th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">-0.05 ***</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">-0.05 ***</td>
</tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;"></th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.01)&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.01)&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;">Ofsted: Serious Weaknesses</th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">-0.04&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">-0.06 **&nbsp;</td>
</tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;"></th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.02)&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.02)&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;">Ofsted: Special Measures</th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">-0.09 ***</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">-0.10 ***</td>
</tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;"></th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.02)&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.02)&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;">Region: East Midlands</th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">-0.01&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">-0.00&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">0.00&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">0.01 *&nbsp;&nbsp;</td>
</tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;"></th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.01)&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.01)&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.01)&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.01)&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;">Region: East of England</th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">-0.00&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">0.00&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">0.00&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">0.02 ***</td>
</tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;"></th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.01)&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.01)&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.01)&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.01)&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;">Region: London</th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">0.09 ***</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">0.07 ***</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">0.07 ***</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">0.04 ***</td>
</tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;"></th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.01)&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.01)&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.01)&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.01)&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;">Region: North East</th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">0.07 ***</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">0.10 ***</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">0.09 ***</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">0.03 ***</td>
</tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;"></th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.01)&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.01)&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.01)&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.01)&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;">Region: North West</th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">-0.00&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">0.01&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">0.02 *&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">-0.00&nbsp;&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;"></th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.01)&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.01)&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.01)&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.01)&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;">Region: South West</th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">0.02 **&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">0.03 ***</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">0.03 ***</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">0.04 ***</td>
</tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;"></th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.01)&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.01)&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.01)&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.01)&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;">Region: West Midlands</th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">0.02 **&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">0.03 ***</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">0.03 ***</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">0.02 **&nbsp;</td>
</tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;"></th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.01)&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.01)&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.01)&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.01)&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;">Region: Yorkshire and the Humber</th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">0.03 ***</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">0.04 ***</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">0.03 ***</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">0.03 ***</td>
</tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;"></th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.01)&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.01)&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.01)&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.01)&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;">% Low Prior Attainment</th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">-0.01 ***</td>
</tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;"></th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.00)&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;">Admissions: Non-selective in Highly Selective Area</th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">-0.02 *&nbsp;&nbsp;</td>
</tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;"></th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.01)&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;">Admissions: Selective</th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">0.07 ***</td>
</tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;"></th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;">(0.01)&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;">N</th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;">2961&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;">2961&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;">2961&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;">2902&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;">2902&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;      font-weight: normal;">R2</th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;">0.71&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;">0.74&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;">0.75&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;">0.77&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;">0.84&nbsp;&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr><th class="huxtable-cell huxtable-header" colspan="6" style="border-style: solid solid solid solid; border-width: 0.8pt 0pt 0pt 0pt;      font-weight: normal;">Standard errors are heteroskedasticity robust. *** p &lt; 0.001; ** p &lt; 0.01; * p &lt; 0.05.</th></tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://easystats.github.io/performance/reference/check_model.html">check_model</a></span><span class="op">(</span><span class="va">england_model7</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><a href="week7_practical_files/figure-html/unnamed-chunk-25-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img src="week7_practical_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="768"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggrepel.slowkow.com/">ggrepel</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert fitted values back to original scale</span></span>
<span><span class="va">england_filtered_clean</span> <span class="op">&lt;-</span> <span class="va">england_filtered_clean</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    fitted_original <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">fitted7</span><span class="op">)</span>,</span>
<span>    highlight <span class="op">=</span> <span class="va">LANAME</span> <span class="op">==</span> <span class="st">"Brighton and Hove"</span>,</span>
<span>    label <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">highlight</span>, <span class="va">SCHNAME.x</span>, <span class="cn">NA_character_</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Scatter plot with layered points and full-model fit line</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">england_filtered_clean</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">fitted_original</span>, y <span class="op">=</span> <span class="va">ATT8SCR</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># All schools in grey</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey80"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span></span>
<span>  <span class="co"># Brighton and Hove schools in orange</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">england_filtered_clean</span>, <span class="va">highlight</span><span class="op">)</span>,</span>
<span>             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">fitted_original</span>, y <span class="op">=</span> <span class="va">ATT8SCR</span><span class="op">)</span>,</span>
<span>             color <span class="op">=</span> <span class="st">"darkorange"</span>, size <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span> <span class="op">+</span></span>
<span></span>
<span>  <span class="co"># Labels for Brighton and Hove schools</span></span>
<span>  <span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html">geom_text_repel</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">england_filtered_clean</span>, <span class="va">highlight</span><span class="op">)</span>,</span>
<span>                  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">label</span><span class="op">)</span>,</span>
<span>                  size <span class="op">=</span> <span class="fl">3</span>, max.overlaps <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">+</span></span>
<span></span>
<span>  <span class="co"># Line of best fit for all schools</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">TRUE</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  </span>
<span><span class="co"># Mirror x and y axes</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span></span>
<span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Observed vs Fitted ATT8SCR (Original Scale)"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Modelled Attainment 8, 2022-23"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Observed Attainment 8, 2022-23"</span></span>
<span>  <span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><a href="week7_practical_files/figure-html/unnamed-chunk-26-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9"><img src="week7_practical_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Filter for Brighton and Hove only</span></span>
<span><span class="va">brighton_data</span> <span class="op">&lt;-</span> <span class="va">england_filtered_clean</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">LANAME</span> <span class="op">==</span> <span class="st">"Brighton and Hove"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot with regression line</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">brighton_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">fitted_original</span>, y <span class="op">=</span> <span class="va">ATT8SCR</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkorange"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">TRUE</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html">geom_text_repel</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">SCHNAME.x</span><span class="op">)</span>, max.overlaps <span class="op">=</span> <span class="fl">20</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Observed vs Fitted ATT8SCR for Brighton and Hove Schools"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Modelled Attainment 8, 2022-23"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Observed Attainment 8, 2022-23"</span></span>
<span>  <span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><a href="week7_practical_files/figure-html/unnamed-chunk-27-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10"><img src="week7_practical_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate residuals and filter for Brighton and Hove</span></span>
<span><span class="va">brighton_residuals</span> <span class="op">&lt;-</span> <span class="va">england_filtered_clean</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">LANAME</span> <span class="op">==</span> <span class="st">"Brighton and Hove"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    fitted_original <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">fitted7</span><span class="op">)</span>,</span>
<span>    residual <span class="op">=</span> <span class="va">ATT8SCR</span> <span class="op">-</span> <span class="va">fitted_original</span>,</span>
<span>    abs_residual <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">residual</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a bar plot centered on zero</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">brighton_residuals</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">SCHNAME.x</span>, <span class="va">residual</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">residual</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"darkorange"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"grey40"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Residuals of ATT8SCR for Brighton and Hove Schools"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"School"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Residual (Observed - Fitted)"</span></span>
<span>  <span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><a href="week7_practical_files/figure-html/unnamed-chunk-28-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11"><img src="week7_practical_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section><section id="task-5---interacting-variables-extension-activity" class="level2"><h2 class="anchored" data-anchor-id="task-5---interacting-variables-extension-activity">Task 5 - Interacting Variables (Extension activity)</h2>
<p>In the lecture, you saw how we could look at how some of the continuous variables (like disadvantage or absence) vary by categorical variable levels (like region). Or indeed, whether continuous variables might interact with each other - for example do levels of unauthorised absence and disadvantage affect each other.</p>
<p>As you saw in the lecture, interpreting interactions can be complex, so here I would just like you to have a brief experiment with some of the variables in your best model.</p>
<p>If you are struggling to understand these effects, again, an AI helper like Gemini or ChatGPT might help you understand these interactions if you feed it your model outputs.</p>
<p>Most of the time in most of the regression models you build, you might not need to interact variables, but it can be informative. Next week, however, we will look at other alternatives to interacting variables when we move onto linear mixed effects models. So at this point, just some experimentation is what I would like you to achieve.</p>


<!-- -->

</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/adamdennett\.github\.io\/QM\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb41" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Prof D's Regression Sessions - Vol 2"</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "AKA - Multiple Regression"</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="co">  ipynb: default</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="an">filters:</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="co">  - qna</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="co">  - multicode</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="co">  - quarto # keep Quarto’s built-ins as the last filter or it won't work</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a><span class="fu">here</span>()</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a><span class="do">## Notes - make sure that reticulate is pointing to a local reticulate install of python or things might go squiffy.</span></span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a><span class="do">## in terminal type: where python - to find out where reticulate might have stashed a version of the python.exe</span></span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a><span class="do">## make sure you point to it before installing these packages using:</span></span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a><span class="do">## reticulate::use_python("C:/Path/To/Your/Python/python.exe", required = TRUE)</span></span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a><span class="co">#renv::install("C:/GitHubRepos/casaviz.zip")</span></span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Get all packages from the lockfile</span></span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a><span class="co">#lockfile &lt;- renv::load("renv.lock")</span></span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a><span class="co">#packages &lt;- setdiff(names(lockfile$Packages), "casaviz")</span></span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Restore only the selected packages</span></span>
<span id="cb41-48"><a href="#cb41-48" aria-hidden="true" tabindex="-1"></a><span class="co">#renv::restore(packages = packages)</span></span>
<span id="cb41-49"><a href="#cb41-49" aria-hidden="true" tabindex="-1"></a><span class="co">#Sys.unsetenv("VIRTUAL_ENV")</span></span>
<span id="cb41-50"><a href="#cb41-50" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reticulate)</span>
<span id="cb41-51"><a href="#cb41-51" aria-hidden="true" tabindex="-1"></a><span class="co">#use_python("/QM_Fork/venv/Scripts/python.exe", required = TRUE)</span></span>
<span id="cb41-52"><a href="#cb41-52" aria-hidden="true" tabindex="-1"></a><span class="co"># point reticulate to the right python installation - ideally the one reticulate installed. </span></span>
<span id="cb41-53"><a href="#cb41-53" aria-hidden="true" tabindex="-1"></a><span class="co">#reticulate::use_python("C:/Users/Adam/AppData/Local/R/cache/R/reticulate/uv/cache/archive-v0/EiTNi4omakhlev5ckz2WP/Scripts/python.exe", required = TRUE)</span></span>
<span id="cb41-54"><a href="#cb41-54" aria-hidden="true" tabindex="-1"></a><span class="co">#use_condaenv("qmEnv", conda = "C:/Users/adam_/anaconda3/Scripts/conda.exe", required = TRUE)</span></span>
<span id="cb41-55"><a href="#cb41-55" aria-hidden="true" tabindex="-1"></a><span class="co">#reticulate::use_python("C:/Users/adam_/anaconda3/envs/qmEnv/python.exe", required = TRUE)</span></span>
<span id="cb41-56"><a href="#cb41-56" aria-hidden="true" tabindex="-1"></a><span class="co">#py_run_string("import pyproj; print(pyproj.CRS.from_epsg(27700))")</span></span>
<span id="cb41-57"><a href="#cb41-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-58"><a href="#cb41-58" aria-hidden="true" tabindex="-1"></a><span class="co">#virtualenv_create("r-reticulate", python = "C:/Users/Adam/AppData/Local/R/cache/R/reticulate/uv/cache/archive-v0/EiTNi4omakhlev5ckz2WP/Scripts/python.exe")</span></span>
<span id="cb41-59"><a href="#cb41-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-60"><a href="#cb41-60" aria-hidden="true" tabindex="-1"></a><span class="co">#virtualenv_install("r-reticulate", packages = c("pyyaml", "jupyter", "statsmodels","pyjanitor","pathlib","matplotlib","pandas", "numpy", "scipy", "seaborn", "geopandas", "folium", "branca"))</span></span>
<span id="cb41-61"><a href="#cb41-61" aria-hidden="true" tabindex="-1"></a><span class="co">#use_virtualenv("r-reticulate", required = TRUE)</span></span>
<span id="cb41-62"><a href="#cb41-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-63"><a href="#cb41-63" aria-hidden="true" tabindex="-1"></a><span class="co"># reticulate::py_config()</span></span>
<span id="cb41-64"><a href="#cb41-64" aria-hidden="true" tabindex="-1"></a><span class="co"># reticulate::py_require("pyyaml")</span></span>
<span id="cb41-65"><a href="#cb41-65" aria-hidden="true" tabindex="-1"></a><span class="co"># reticulate::py_require("jupyter")</span></span>
<span id="cb41-66"><a href="#cb41-66" aria-hidden="true" tabindex="-1"></a><span class="co"># reticulate::py_require("statsmodels")</span></span>
<span id="cb41-67"><a href="#cb41-67" aria-hidden="true" tabindex="-1"></a><span class="co"># reticulate::py_require("pandas")</span></span>
<span id="cb41-68"><a href="#cb41-68" aria-hidden="true" tabindex="-1"></a><span class="co"># reticulate::py_require("numpy")</span></span>
<span id="cb41-69"><a href="#cb41-69" aria-hidden="true" tabindex="-1"></a><span class="co"># reticulate::py_require("pyjanitor")</span></span>
<span id="cb41-70"><a href="#cb41-70" aria-hidden="true" tabindex="-1"></a><span class="co"># reticulate::py_require("pathlib") </span></span>
<span id="cb41-71"><a href="#cb41-71" aria-hidden="true" tabindex="-1"></a><span class="co"># reticulate::py_require("matplotlib") </span></span>
<span id="cb41-72"><a href="#cb41-72" aria-hidden="true" tabindex="-1"></a><span class="co"># reticulate::py_require("seaborn") </span></span>
<span id="cb41-73"><a href="#cb41-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-74"><a href="#cb41-74" aria-hidden="true" tabindex="-1"></a><span class="co">#reticulate::py_install("folium")</span></span>
<span id="cb41-75"><a href="#cb41-75" aria-hidden="true" tabindex="-1"></a><span class="co">#reticulate::py_install("geopandas") </span></span>
<span id="cb41-76"><a href="#cb41-76" aria-hidden="true" tabindex="-1"></a><span class="co">#reticulate::py_install("contextily", pip = TRUE)</span></span>
<span id="cb41-77"><a href="#cb41-77" aria-hidden="true" tabindex="-1"></a><span class="co">#reticulate::py_install("scikit-learn", pip = TRUE)</span></span>
<span id="cb41-78"><a href="#cb41-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-79"><a href="#cb41-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-80"><a href="#cb41-80" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-81"><a href="#cb41-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-82"><a href="#cb41-82" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb41-83"><a href="#cb41-83" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;iframe data-testid="embed-iframe" style="border-radius:12px" src="https://open.spotify.com/embed/track/4gY2lwbx521ZlyqCzQE2JA?utm_source=generator" width="100%" height="352" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"&gt;&lt;/iframe&gt;</span></span>
<span id="cb41-84"><a href="#cb41-84" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-85"><a href="#cb41-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-86"><a href="#cb41-86" aria-hidden="true" tabindex="-1"></a><span class="fu">## Preamble</span></span>
<span id="cb41-87"><a href="#cb41-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-88"><a href="#cb41-88" aria-hidden="true" tabindex="-1"></a>We're going even deeper this week in Volume 2 of the Regression Sessions, so to help you along on your journey we have got Volume 2 of the Progression Sessions with Blame and DRS - Enjoy!</span>
<span id="cb41-89"><a href="#cb41-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-90"><a href="#cb41-90" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction</span></span>
<span id="cb41-91"><a href="#cb41-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-92"><a href="#cb41-92" aria-hidden="true" tabindex="-1"></a>Similar to last week's practical, we will continue our investigation into the factors that affect school-level attainment figures, following the lecture you have just seen.</span>
<span id="cb41-93"><a href="#cb41-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-94"><a href="#cb41-94" aria-hidden="true" tabindex="-1"></a>Last week, you created a data subset for England of some 30-odd variables related to different measures of attainment, and a selection of continuous and categorical variables which might help explain those attainment levels. This week we will use more of those variables to build a multiple regression model and evaluate its outputs.</span>
<span id="cb41-95"><a href="#cb41-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-96"><a href="#cb41-96" aria-hidden="true" tabindex="-1"></a>Building a good regression model can be as much art as it is science! Back to our cake baking analogy last week - think of it a bit like the bake-off 'technical challenge' - same recipe, same ingredients, potentially some very different outcomes!</span>
<span id="cb41-97"><a href="#cb41-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-98"><a href="#cb41-98" aria-hidden="true" tabindex="-1"></a><span class="al">![](L6_images/techncal.jpg)</span></span>
<span id="cb41-99"><a href="#cb41-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-100"><a href="#cb41-100" aria-hidden="true" tabindex="-1"></a>It takes a lot of practice, iteration and understanding of the various dimensions in your model to build a good regression model. It is **much** more than just a good R-squared and some 'statistically significant' coefficients!</span>
<span id="cb41-101"><a href="#cb41-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-102"><a href="#cb41-102" aria-hidden="true" tabindex="-1"></a><span class="fu">## Aims</span></span>
<span id="cb41-103"><a href="#cb41-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-104"><a href="#cb41-104" aria-hidden="true" tabindex="-1"></a>By the end of this week's regression session you should:</span>
<span id="cb41-105"><a href="#cb41-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-106"><a href="#cb41-106" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Consolidate your knowledge of using R or Python to process data in order to carry out a scientific investigation</span>
<span id="cb41-107"><a href="#cb41-107" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Build on the skills learned last week to practice further plotting and visualising of data to assess relationships between multiple x variables and a selected y variable</span>
<span id="cb41-108"><a href="#cb41-108" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Refresh your knowledge of using built-in statistical software functions in R and Python to run some more sophisticated regression models and produce statistical outputs from those models</span>
<span id="cb41-109"><a href="#cb41-109" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Practice interpreting the outputs of those models thinking in particular about issues of confounding, mediating, multicollinearity and the independence of residuals</span>
<span id="cb41-110"><a href="#cb41-110" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Practice experimenting with interaction effects in your model and the interpretation of those outputs</span>
<span id="cb41-111"><a href="#cb41-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-112"><a href="#cb41-112" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb41-113"><a href="#cb41-113" aria-hidden="true" tabindex="-1"></a>As with last week's practical you will find code-blocks that will allow you to run your analysis in either R or Python. Again, it's up to you which you decide to use.</span>
<span id="cb41-114"><a href="#cb41-114" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb41-115"><a href="#cb41-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-116"><a href="#cb41-116" aria-hidden="true" tabindex="-1"></a><span class="fu">## Tasks</span></span>
<span id="cb41-117"><a href="#cb41-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-118"><a href="#cb41-118" aria-hidden="true" tabindex="-1"></a>This week we won't look at individual local authorities, but will focus on the whole of England.</span>
<span id="cb41-119"><a href="#cb41-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-120"><a href="#cb41-120" aria-hidden="true" tabindex="-1"></a><span class="fu">### 1. Baseline Model</span></span>
<span id="cb41-121"><a href="#cb41-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-122"><a href="#cb41-122" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Run your baseline bivariate, whole of England, regression model from last week</span>
<span id="cb41-123"><a href="#cb41-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-124"><a href="#cb41-124" aria-hidden="true" tabindex="-1"></a><span class="fu">### 2. Data Prep and Exploratory Data Analysis</span></span>
<span id="cb41-125"><a href="#cb41-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-126"><a href="#cb41-126" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Prepare your data and carry out some exploratory data analysis to understand what you are working with</span>
<span id="cb41-127"><a href="#cb41-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-128"><a href="#cb41-128" aria-hidden="true" tabindex="-1"></a><span class="fu">### 3. Multiple Regression Model</span></span>
<span id="cb41-129"><a href="#cb41-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-130"><a href="#cb41-130" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Experiment with adding additional explanatory variables one-by-one into your model - both continuous and categorical. You might even experiment with reclassifying variables to reduce any noise that might exist with excessive categories unclear continuous relationships</span>
<span id="cb41-131"><a href="#cb41-131" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Try to find the model that best explains your attainment variable. One that strikes a good balance between:</span>
<span id="cb41-132"><a href="#cb41-132" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>explanatory power (a good $R^2$, significant explanatory variables) - best doesn't necessarily mean the highest $R^2$, if a variable with more nuance allows you to say something more interesting about a relationship.</span>
<span id="cb41-133"><a href="#cb41-133" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>parsimony (the principle of simplicity - fewest variables, simplest possible explanation)</span>
<span id="cb41-134"><a href="#cb41-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-135"><a href="#cb41-135" aria-hidden="true" tabindex="-1"></a><span class="fu">### 4. Evaluation</span></span>
<span id="cb41-136"><a href="#cb41-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-137"><a href="#cb41-137" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>When you have your 'best' model, how do you interpret the coefficients?</span>
<span id="cb41-138"><a href="#cb41-138" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Which variable(s) has(have) the most explanatory power (check t-values for this)?</span>
<span id="cb41-139"><a href="#cb41-139" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>How do you interpret the combined explanatory power of variables in your model?</span>
<span id="cb41-140"><a href="#cb41-140" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>What kind of confounding do you observe as you add more variables (if any)?</span>
<span id="cb41-141"><a href="#cb41-141" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Do you have any issues of multicollinearity or residual independence? Does your model pass the standard tests?</span>
<span id="cb41-142"><a href="#cb41-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-143"><a href="#cb41-143" aria-hidden="true" tabindex="-1"></a><span class="fu">### 5. Interaction Effects</span></span>
<span id="cb41-144"><a href="#cb41-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-145"><a href="#cb41-145" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Experiment with interacting some of the variables in your best multiple regression model and see if this adds any more explanatory nuance to your main analysis</span>
<span id="cb41-146"><a href="#cb41-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-147"><a href="#cb41-147" aria-hidden="true" tabindex="-1"></a>::: multicode</span>
<span id="cb41-148"><a href="#cb41-148" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/python-logo-only.png){width="30"}</span></span>
<span id="cb41-149"><a href="#cb41-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-152"><a href="#cb41-152" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb41-153"><a href="#cb41-153" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-154"><a href="#cb41-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-155"><a href="#cb41-155" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/Rlogo.png){width="41" height="30"}</span></span>
<span id="cb41-156"><a href="#cb41-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-159"><a href="#cb41-159" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-160"><a href="#cb41-160" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-161"><a href="#cb41-161" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb41-162"><a href="#cb41-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-163"><a href="#cb41-163" aria-hidden="true" tabindex="-1"></a><span class="fu">## Task 1 - Baseline Model</span></span>
<span id="cb41-164"><a href="#cb41-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-165"><a href="#cb41-165" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>First read in your data file from last week and run your final baseline model from last week</span>
<span id="cb41-166"><a href="#cb41-166" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Then run a basic bivariate regression model for your attainment variable of choice (I am using raw Attainment 8 scores - **ATT8SCR** - , but last week you should have chosen one of the other different Attainment scores to try and model - therefore you will need to adjust your code accordingly)</span>
<span id="cb41-167"><a href="#cb41-167" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Your choice of independent variable can be anything, but you might want to start with **PTFSM6CLA1A (% of pupils at the end of key stage 4 who are disadvantaged)** as I am. </span>
<span id="cb41-168"><a href="#cb41-168" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Don't forget, you probably will want to log-transform both of your variables</span>
<span id="cb41-169"><a href="#cb41-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-170"><a href="#cb41-170" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb41-171"><a href="#cb41-171" aria-hidden="true" tabindex="-1"></a>The paths in the code below are specific to my home computer - you'll need to adapt this code to read the csv from where it is on your computer.</span>
<span id="cb41-172"><a href="#cb41-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-173"><a href="#cb41-173" aria-hidden="true" tabindex="-1"></a>And one more reminder - you will also need to change the variables to the ones you used last week - don't just copy mine!</span>
<span id="cb41-174"><a href="#cb41-174" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb41-175"><a href="#cb41-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-176"><a href="#cb41-176" aria-hidden="true" tabindex="-1"></a>::: multicode</span>
<span id="cb41-177"><a href="#cb41-177" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/python-logo-only.png){width="30"}</span></span>
<span id="cb41-178"><a href="#cb41-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-181"><a href="#cb41-181" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb41-182"><a href="#cb41-182" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb41-183"><a href="#cb41-183" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb41-184"><a href="#cb41-184" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb41-185"><a href="#cb41-185" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb41-186"><a href="#cb41-186" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> janitor</span>
<span id="cb41-187"><a href="#cb41-187" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb41-188"><a href="#cb41-188" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb41-189"><a href="#cb41-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-190"><a href="#cb41-190" aria-hidden="true" tabindex="-1"></a><span class="co"># little function to define the file root on different machines</span></span>
<span id="cb41-191"><a href="#cb41-191" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_qm_root(start_path: Path <span class="op">=</span> Path.cwd(), anchor: <span class="bu">str</span> <span class="op">=</span> <span class="st">"QM"</span>) <span class="op">-&gt;</span> Path:</span>
<span id="cb41-192"><a href="#cb41-192" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb41-193"><a href="#cb41-193" aria-hidden="true" tabindex="-1"></a><span class="co">    Traverse up from the start_path until the anchor folder (e.g. 'QM' or 'QM_Fork')      is found. Returns the path to the anchor folder.</span></span>
<span id="cb41-194"><a href="#cb41-194" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb41-195"><a href="#cb41-195" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> parent <span class="kw">in</span> [start_path] <span class="op">+</span> <span class="bu">list</span>(start_path.parents):</span>
<span id="cb41-196"><a href="#cb41-196" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> parent.name <span class="op">==</span> anchor:</span>
<span id="cb41-197"><a href="#cb41-197" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> parent</span>
<span id="cb41-198"><a href="#cb41-198" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">FileNotFoundError</span>(<span class="ss">f"Anchor folder '</span><span class="sc">{</span>anchor<span class="sc">}</span><span class="ss">' not found in path      hierarchy."</span>)</span>
<span id="cb41-199"><a href="#cb41-199" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-200"><a href="#cb41-200" aria-hidden="true" tabindex="-1"></a>qm_root <span class="op">=</span> find_qm_root()</span>
<span id="cb41-201"><a href="#cb41-201" aria-hidden="true" tabindex="-1"></a>base_path <span class="op">=</span> qm_root <span class="op">/</span> <span class="st">"sessions"</span> <span class="op">/</span> <span class="st">"L6_data"</span> <span class="op">/</span> <span class="st">"Performancetables_130242"</span> <span class="op">/</span> <span class="st">"2022-2023"</span></span>
<span id="cb41-202"><a href="#cb41-202" aria-hidden="true" tabindex="-1"></a>na_all <span class="op">=</span> [<span class="st">""</span>, <span class="st">"NA"</span>, <span class="st">"SUPP"</span>, <span class="st">"NP"</span>, <span class="st">"NE"</span>, <span class="st">"SP"</span>, <span class="st">"SN"</span>, <span class="st">"LOWCOV"</span>, <span class="st">"NEW"</span>, <span class="st">"SUPPMAT"</span>, <span class="st">"NaN"</span>]</span>
<span id="cb41-203"><a href="#cb41-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-204"><a href="#cb41-204" aria-hidden="true" tabindex="-1"></a>england_filtered <span class="op">=</span> pd.read_csv(base_path <span class="op">/</span> <span class="st">"england_filtered.csv"</span>, na_values<span class="op">=</span>na_all, dtype<span class="op">=</span>{<span class="st">"URN"</span>: <span class="bu">str</span>})</span>
<span id="cb41-205"><a href="#cb41-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-206"><a href="#cb41-206" aria-hidden="true" tabindex="-1"></a><span class="co"># Log-transform safely: replace non-positive values with NaN</span></span>
<span id="cb41-207"><a href="#cb41-207" aria-hidden="true" tabindex="-1"></a>england_filtered[<span class="st">'log_ATT8SCR'</span>] <span class="op">=</span> np.where(england_filtered[<span class="st">'ATT8SCR'</span>] <span class="op">&gt;</span> <span class="dv">0</span>, np.log(england_filtered[<span class="st">'ATT8SCR'</span>]), np.nan)</span>
<span id="cb41-208"><a href="#cb41-208" aria-hidden="true" tabindex="-1"></a>england_filtered[<span class="st">'log_PTFSM6CLA1A'</span>] <span class="op">=</span> np.where(england_filtered[<span class="st">'PTFSM6CLA1A'</span>] <span class="op">&gt;</span> <span class="dv">0</span>, np.log(england_filtered[<span class="st">'PTFSM6CLA1A'</span>]), np.nan)</span>
<span id="cb41-209"><a href="#cb41-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-210"><a href="#cb41-210" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop rows with NaNs in either column</span></span>
<span id="cb41-211"><a href="#cb41-211" aria-hidden="true" tabindex="-1"></a>england_filtered_clean <span class="op">=</span> england_filtered.dropna(subset<span class="op">=</span>[<span class="st">'log_ATT8SCR'</span>, <span class="st">'log_PTFSM6CLA1A'</span>])</span>
<span id="cb41-212"><a href="#cb41-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-213"><a href="#cb41-213" aria-hidden="true" tabindex="-1"></a><span class="co"># Define independent and dependent variables</span></span>
<span id="cb41-214"><a href="#cb41-214" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(england_filtered_clean[<span class="st">'log_PTFSM6CLA1A'</span>])  <span class="co"># adds intercept</span></span>
<span id="cb41-215"><a href="#cb41-215" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> england_filtered_clean[<span class="st">'log_ATT8SCR'</span>]</span>
<span id="cb41-216"><a href="#cb41-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-217"><a href="#cb41-217" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb41-218"><a href="#cb41-218" aria-hidden="true" tabindex="-1"></a>england_model1 <span class="op">=</span> sm.OLS(y, X).fit()</span>
<span id="cb41-219"><a href="#cb41-219" aria-hidden="true" tabindex="-1"></a><span class="co">#england_summary = extract_model_summary(england_model1, 'England Model')</span></span>
<span id="cb41-220"><a href="#cb41-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-221"><a href="#cb41-221" aria-hidden="true" tabindex="-1"></a><span class="co"># Print summary</span></span>
<span id="cb41-222"><a href="#cb41-222" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(england_model1.summary())</span>
<span id="cb41-223"><a href="#cb41-223" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-224"><a href="#cb41-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-225"><a href="#cb41-225" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/Rlogo.png){width="41" height="30"}</span></span>
<span id="cb41-226"><a href="#cb41-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-229"><a href="#cb41-229" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-230"><a href="#cb41-230" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb41-231"><a href="#cb41-231" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb41-232"><a href="#cb41-232" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb41-233"><a href="#cb41-233" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb41-234"><a href="#cb41-234" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb41-235"><a href="#cb41-235" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb41-236"><a href="#cb41-236" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb41-237"><a href="#cb41-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-238"><a href="#cb41-238" aria-hidden="true" tabindex="-1"></a>base_path <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">"sessions"</span>, <span class="st">"L6_data"</span>, <span class="st">"Performancetables_130242"</span>, <span class="st">"2022-2023"</span>)</span>
<span id="cb41-239"><a href="#cb41-239" aria-hidden="true" tabindex="-1"></a>na_all <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">"NA"</span>, <span class="st">"SUPP"</span>, <span class="st">"NP"</span>, <span class="st">"NE"</span>, <span class="st">"SP"</span>, <span class="st">"SN"</span>, <span class="st">"LOWCOV"</span>, <span class="st">"NEW"</span>, <span class="st">"SUPPMAT"</span>)</span>
<span id="cb41-240"><a href="#cb41-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-241"><a href="#cb41-241" aria-hidden="true" tabindex="-1"></a>england_filtered <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">file.path</span>(base_path, <span class="st">"england_filtered.csv"</span>), <span class="at">na =</span> na_all) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">URN =</span> <span class="fu">as.character</span>(URN))</span>
<span id="cb41-242"><a href="#cb41-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-243"><a href="#cb41-243" aria-hidden="true" tabindex="-1"></a><span class="co">#str(england_filtered)</span></span>
<span id="cb41-244"><a href="#cb41-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-245"><a href="#cb41-245" aria-hidden="true" tabindex="-1"></a>england_filtered_clean <span class="ot">&lt;-</span> england_filtered[</span>
<span id="cb41-246"><a href="#cb41-246" aria-hidden="true" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(england_filtered<span class="sc">$</span>ATT8SCR) <span class="sc">&amp;</span> </span>
<span id="cb41-247"><a href="#cb41-247" aria-hidden="true" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(england_filtered<span class="sc">$</span>PTFSM6CLA1A) <span class="sc">&amp;</span></span>
<span id="cb41-248"><a href="#cb41-248" aria-hidden="true" tabindex="-1"></a>  england_filtered<span class="sc">$</span>ATT8SCR <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span></span>
<span id="cb41-249"><a href="#cb41-249" aria-hidden="true" tabindex="-1"></a>  england_filtered<span class="sc">$</span>PTFSM6CLA1A <span class="sc">&gt;</span> <span class="dv">0</span>, </span>
<span id="cb41-250"><a href="#cb41-250" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb41-251"><a href="#cb41-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-252"><a href="#cb41-252" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit linear model and get predicted values</span></span>
<span id="cb41-253"><a href="#cb41-253" aria-hidden="true" tabindex="-1"></a>england_model1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(ATT8SCR) <span class="sc">~</span> <span class="fu">log</span>(PTFSM6CLA1A), <span class="at">data =</span> england_filtered_clean)</span>
<span id="cb41-254"><a href="#cb41-254" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(england_model1)</span>
<span id="cb41-255"><a href="#cb41-255" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-256"><a href="#cb41-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-257"><a href="#cb41-257" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb41-258"><a href="#cb41-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-259"><a href="#cb41-259" aria-hidden="true" tabindex="-1"></a><span class="fu">## Task 2 - Exploratory Analysis and Data Preparation</span></span>
<span id="cb41-260"><a href="#cb41-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-261"><a href="#cb41-261" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Right, we that was a nice and simple starter. We now have a baseline and something to compare your subsequent more sophisticated models to. </span>
<span id="cb41-262"><a href="#cb41-262" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>These next steps will be a little trickier and I will be expecting you to use some of the knowledge gained last week to complete the tasks, rather than me giving you all of the right code explicitly.</span>
<span id="cb41-263"><a href="#cb41-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-264"><a href="#cb41-264" aria-hidden="true" tabindex="-1"></a>::: multicode</span>
<span id="cb41-265"><a href="#cb41-265" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/python-logo-only.png){width="30"}</span></span>
<span id="cb41-266"><a href="#cb41-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-269"><a href="#cb41-269" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb41-270"><a href="#cb41-270" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb41-271"><a href="#cb41-271" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb41-272"><a href="#cb41-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-273"><a href="#cb41-273" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb41-274"><a href="#cb41-274" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb41-275"><a href="#cb41-275" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb41-276"><a href="#cb41-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-277"><a href="#cb41-277" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop unwanted numeric columns</span></span>
<span id="cb41-278"><a href="#cb41-278" aria-hidden="true" tabindex="-1"></a>numeric_cols <span class="op">=</span> england_filtered_clean.drop(columns<span class="op">=</span>[<span class="st">'easting'</span>, <span class="st">'northing'</span>, <span class="st">'LEA'</span>], errors<span class="op">=</span><span class="st">'ignore'</span>).select_dtypes(include<span class="op">=</span><span class="st">'number'</span>)</span>
<span id="cb41-279"><a href="#cb41-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-280"><a href="#cb41-280" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to long format</span></span>
<span id="cb41-281"><a href="#cb41-281" aria-hidden="true" tabindex="-1"></a>numeric_long <span class="op">=</span> numeric_cols.melt(var_name<span class="op">=</span><span class="st">'variable'</span>, value_name<span class="op">=</span><span class="st">'value'</span>)</span>
<span id="cb41-282"><a href="#cb41-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-283"><a href="#cb41-283" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up the figure</span></span>
<span id="cb41-284"><a href="#cb41-284" aria-hidden="true" tabindex="-1"></a>variables <span class="op">=</span> numeric_long[<span class="st">'variable'</span>].unique()</span>
<span id="cb41-285"><a href="#cb41-285" aria-hidden="true" tabindex="-1"></a>n_vars <span class="op">=</span> <span class="bu">len</span>(variables)</span>
<span id="cb41-286"><a href="#cb41-286" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> <span class="dv">6</span></span>
<span id="cb41-287"><a href="#cb41-287" aria-hidden="true" tabindex="-1"></a>rows <span class="op">=</span> (n_vars <span class="op">+</span> cols <span class="op">-</span> <span class="dv">1</span>) <span class="op">//</span> cols</span>
<span id="cb41-288"><a href="#cb41-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-289"><a href="#cb41-289" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(rows, cols, figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">3</span> <span class="op">*</span> rows))</span>
<span id="cb41-290"><a href="#cb41-290" aria-hidden="true" tabindex="-1"></a>axes <span class="op">=</span> axes.flatten()</span>
<span id="cb41-291"><a href="#cb41-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-292"><a href="#cb41-292" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, var <span class="kw">in</span> <span class="bu">enumerate</span>(variables):</span>
<span id="cb41-293"><a href="#cb41-293" aria-hidden="true" tabindex="-1"></a>    sns.histplot(data<span class="op">=</span>numeric_long[numeric_long[<span class="st">'variable'</span>] <span class="op">==</span> var], x<span class="op">=</span><span class="st">'value'</span>, bins<span class="op">=</span><span class="dv">30</span>, color<span class="op">=</span><span class="st">'steelblue'</span>, ax<span class="op">=</span>axes[i])</span>
<span id="cb41-294"><a href="#cb41-294" aria-hidden="true" tabindex="-1"></a>    axes[i].set_title(var)</span>
<span id="cb41-295"><a href="#cb41-295" aria-hidden="true" tabindex="-1"></a>    axes[i].set_xlabel(<span class="st">"Value"</span>)</span>
<span id="cb41-296"><a href="#cb41-296" aria-hidden="true" tabindex="-1"></a>    axes[i].set_ylabel(<span class="st">"Count"</span>)</span>
<span id="cb41-297"><a href="#cb41-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-298"><a href="#cb41-298" aria-hidden="true" tabindex="-1"></a><span class="co"># Hide unused subplots</span></span>
<span id="cb41-299"><a href="#cb41-299" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(i <span class="op">+</span> <span class="dv">1</span>, <span class="bu">len</span>(axes)):</span>
<span id="cb41-300"><a href="#cb41-300" aria-hidden="true" tabindex="-1"></a>    fig.delaxes(axes[j])</span>
<span id="cb41-301"><a href="#cb41-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-302"><a href="#cb41-302" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb41-303"><a href="#cb41-303" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">"Histograms of Numerical Variables"</span>, y<span class="op">=</span><span class="fl">1.02</span>)</span>
<span id="cb41-304"><a href="#cb41-304" aria-hidden="true" tabindex="-1"></a>sns.despine()</span>
<span id="cb41-305"><a href="#cb41-305" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb41-306"><a href="#cb41-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-307"><a href="#cb41-307" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-308"><a href="#cb41-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-311"><a href="#cb41-311" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb41-312"><a href="#cb41-312" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb41-313"><a href="#cb41-313" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb41-314"><a href="#cb41-314" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb41-315"><a href="#cb41-315" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb41-316"><a href="#cb41-316" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb41-317"><a href="#cb41-317" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb41-318"><a href="#cb41-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-319"><a href="#cb41-319" aria-hidden="true" tabindex="-1"></a><span class="co"># Log-transform relevant variables</span></span>
<span id="cb41-320"><a href="#cb41-320" aria-hidden="true" tabindex="-1"></a>england_filtered_clean[<span class="st">'log_ATT8SCR'</span>] <span class="op">=</span> np.log(england_filtered_clean[<span class="st">'ATT8SCR'</span>])</span>
<span id="cb41-321"><a href="#cb41-321" aria-hidden="true" tabindex="-1"></a>england_filtered_clean[<span class="st">'log_PTFSM6CLA1A'</span>] <span class="op">=</span> np.log(england_filtered_clean[<span class="st">'PTFSM6CLA1A'</span>])</span>
<span id="cb41-322"><a href="#cb41-322" aria-hidden="true" tabindex="-1"></a>england_filtered_clean[<span class="st">'log_PNUMEAL'</span>] <span class="op">=</span> np.log(england_filtered_clean[<span class="st">'PNUMEAL'</span>])</span>
<span id="cb41-323"><a href="#cb41-323" aria-hidden="true" tabindex="-1"></a>england_filtered_clean[<span class="st">'log_PERCTOT'</span>] <span class="op">=</span> np.log(england_filtered_clean[<span class="st">'PERCTOT'</span>])</span>
<span id="cb41-324"><a href="#cb41-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-325"><a href="#cb41-325" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare long format data</span></span>
<span id="cb41-326"><a href="#cb41-326" aria-hidden="true" tabindex="-1"></a>long_df <span class="op">=</span> pd.melt(</span>
<span id="cb41-327"><a href="#cb41-327" aria-hidden="true" tabindex="-1"></a>    england_filtered_clean,</span>
<span id="cb41-328"><a href="#cb41-328" aria-hidden="true" tabindex="-1"></a>    id_vars<span class="op">=</span>[<span class="st">'log_ATT8SCR'</span>],</span>
<span id="cb41-329"><a href="#cb41-329" aria-hidden="true" tabindex="-1"></a>    value_vars<span class="op">=</span>[<span class="st">'log_PTFSM6CLA1A'</span>, <span class="st">'log_PNUMEAL'</span>, <span class="st">'log_PERCTOT'</span>, <span class="st">'PTPRIORLO'</span>],</span>
<span id="cb41-330"><a href="#cb41-330" aria-hidden="true" tabindex="-1"></a>    var_name<span class="op">=</span><span class="st">'predictor'</span>,</span>
<span id="cb41-331"><a href="#cb41-331" aria-hidden="true" tabindex="-1"></a>    value_name<span class="op">=</span><span class="st">'x_value'</span></span>
<span id="cb41-332"><a href="#cb41-332" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-333"><a href="#cb41-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-334"><a href="#cb41-334" aria-hidden="true" tabindex="-1"></a><span class="co"># Custom axis labels</span></span>
<span id="cb41-335"><a href="#cb41-335" aria-hidden="true" tabindex="-1"></a>axis_labels <span class="op">=</span> {</span>
<span id="cb41-336"><a href="#cb41-336" aria-hidden="true" tabindex="-1"></a>    <span class="st">'log_PTFSM6CLA1A'</span>: <span class="st">'log(PTFSM6CLA1A)'</span>,</span>
<span id="cb41-337"><a href="#cb41-337" aria-hidden="true" tabindex="-1"></a>    <span class="st">'log_PNUMEAL'</span>: <span class="st">'log(PNUMEAL)'</span>,</span>
<span id="cb41-338"><a href="#cb41-338" aria-hidden="true" tabindex="-1"></a>    <span class="st">'log_PERCTOT'</span>: <span class="st">'log(PERCTOT)'</span>,</span>
<span id="cb41-339"><a href="#cb41-339" aria-hidden="true" tabindex="-1"></a>    <span class="st">'PTPRIORLO'</span>: <span class="st">'PTPRIORLO'</span></span>
<span id="cb41-340"><a href="#cb41-340" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-341"><a href="#cb41-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-342"><a href="#cb41-342" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up the figure manually</span></span>
<span id="cb41-343"><a href="#cb41-343" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> long_df[<span class="st">'predictor'</span>].unique()</span>
<span id="cb41-344"><a href="#cb41-344" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb41-345"><a href="#cb41-345" aria-hidden="true" tabindex="-1"></a>rows <span class="op">=</span> (<span class="bu">len</span>(predictors) <span class="op">+</span> cols <span class="op">-</span> <span class="dv">1</span>) <span class="op">//</span> cols</span>
<span id="cb41-346"><a href="#cb41-346" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(rows, cols, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">4</span> <span class="op">*</span> rows))</span>
<span id="cb41-347"><a href="#cb41-347" aria-hidden="true" tabindex="-1"></a>axes <span class="op">=</span> axes.flatten()</span>
<span id="cb41-348"><a href="#cb41-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-349"><a href="#cb41-349" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, predictor <span class="kw">in</span> <span class="bu">enumerate</span>(predictors):</span>
<span id="cb41-350"><a href="#cb41-350" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> long_df[long_df[<span class="st">'predictor'</span>] <span class="op">==</span> predictor]</span>
<span id="cb41-351"><a href="#cb41-351" aria-hidden="true" tabindex="-1"></a>    sns.regplot(</span>
<span id="cb41-352"><a href="#cb41-352" aria-hidden="true" tabindex="-1"></a>        data<span class="op">=</span>subset,</span>
<span id="cb41-353"><a href="#cb41-353" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">'x_value'</span>,</span>
<span id="cb41-354"><a href="#cb41-354" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span><span class="st">'log_ATT8SCR'</span>,</span>
<span id="cb41-355"><a href="#cb41-355" aria-hidden="true" tabindex="-1"></a>        scatter_kws<span class="op">=</span>{<span class="st">'alpha'</span>: <span class="fl">0.5</span>, <span class="st">'color'</span>: <span class="st">'steelblue'</span>},</span>
<span id="cb41-356"><a href="#cb41-356" aria-hidden="true" tabindex="-1"></a>        line_kws<span class="op">=</span>{<span class="st">'color'</span>: <span class="st">'black'</span>},</span>
<span id="cb41-357"><a href="#cb41-357" aria-hidden="true" tabindex="-1"></a>        ax<span class="op">=</span>axes[i]</span>
<span id="cb41-358"><a href="#cb41-358" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb41-359"><a href="#cb41-359" aria-hidden="true" tabindex="-1"></a>    axes[i].set_title(<span class="ss">f"log(ATT8SCR) vs </span><span class="sc">{</span>axis_labels[predictor]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb41-360"><a href="#cb41-360" aria-hidden="true" tabindex="-1"></a>    axes[i].set_xlabel(axis_labels[predictor])</span>
<span id="cb41-361"><a href="#cb41-361" aria-hidden="true" tabindex="-1"></a>    axes[i].set_ylabel(<span class="st">"log(ATT8SCR)"</span>)</span>
<span id="cb41-362"><a href="#cb41-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-363"><a href="#cb41-363" aria-hidden="true" tabindex="-1"></a><span class="co"># Hide unused subplots</span></span>
<span id="cb41-364"><a href="#cb41-364" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(i <span class="op">+</span> <span class="dv">1</span>, <span class="bu">len</span>(axes)):</span>
<span id="cb41-365"><a href="#cb41-365" aria-hidden="true" tabindex="-1"></a>    fig.delaxes(axes[j])</span>
<span id="cb41-366"><a href="#cb41-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-367"><a href="#cb41-367" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb41-368"><a href="#cb41-368" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">"Scatter Plots of log(ATT8SCR) vs Predictors"</span>, y<span class="op">=</span><span class="fl">1.02</span>)</span>
<span id="cb41-369"><a href="#cb41-369" aria-hidden="true" tabindex="-1"></a>sns.despine()</span>
<span id="cb41-370"><a href="#cb41-370" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb41-371"><a href="#cb41-371" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-372"><a href="#cb41-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-373"><a href="#cb41-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-376"><a href="#cb41-376" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb41-377"><a href="#cb41-377" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb41-378"><a href="#cb41-378" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb41-379"><a href="#cb41-379" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb41-380"><a href="#cb41-380" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 14</span></span>
<span id="cb41-381"><a href="#cb41-381" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb41-382"><a href="#cb41-382" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb41-383"><a href="#cb41-383" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb41-384"><a href="#cb41-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-385"><a href="#cb41-385" aria-hidden="true" tabindex="-1"></a><span class="co"># Select categorical columns and drop unwanted ones</span></span>
<span id="cb41-386"><a href="#cb41-386" aria-hidden="true" tabindex="-1"></a>categorical_cols <span class="op">=</span> england_filtered_clean.select_dtypes(include<span class="op">=</span><span class="st">'object'</span>).drop(</span>
<span id="cb41-387"><a href="#cb41-387" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span>[<span class="st">'URN'</span>, <span class="st">'SCHNAME.x'</span>, <span class="st">'LANAME'</span>, <span class="st">'TOWN.x'</span>, <span class="st">'SCHOOLTYPE.x'</span>], errors<span class="op">=</span><span class="st">'ignore'</span></span>
<span id="cb41-388"><a href="#cb41-388" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-389"><a href="#cb41-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-390"><a href="#cb41-390" aria-hidden="true" tabindex="-1"></a><span class="co"># Determine layout</span></span>
<span id="cb41-391"><a href="#cb41-391" aria-hidden="true" tabindex="-1"></a>n_cols <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb41-392"><a href="#cb41-392" aria-hidden="true" tabindex="-1"></a>n_rows <span class="op">=</span> (<span class="bu">len</span>(categorical_cols.columns) <span class="op">+</span> n_cols <span class="op">-</span> <span class="dv">1</span>) <span class="op">//</span> n_cols</span>
<span id="cb41-393"><a href="#cb41-393" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(n_rows, n_cols, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">4</span> <span class="op">*</span> n_rows))</span>
<span id="cb41-394"><a href="#cb41-394" aria-hidden="true" tabindex="-1"></a>axes <span class="op">=</span> axes.flatten()</span>
<span id="cb41-395"><a href="#cb41-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-396"><a href="#cb41-396" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate bar plots</span></span>
<span id="cb41-397"><a href="#cb41-397" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, colname <span class="kw">in</span> <span class="bu">enumerate</span>(categorical_cols.columns):</span>
<span id="cb41-398"><a href="#cb41-398" aria-hidden="true" tabindex="-1"></a>    sns.countplot(data<span class="op">=</span>categorical_cols, x<span class="op">=</span>colname, ax<span class="op">=</span>axes[i], color<span class="op">=</span><span class="st">'darkorange'</span>)</span>
<span id="cb41-399"><a href="#cb41-399" aria-hidden="true" tabindex="-1"></a>    axes[i].set_title(<span class="ss">f"Distribution of </span><span class="sc">{</span>colname<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb41-400"><a href="#cb41-400" aria-hidden="true" tabindex="-1"></a>    axes[i].set_xlabel(colname)</span>
<span id="cb41-401"><a href="#cb41-401" aria-hidden="true" tabindex="-1"></a>    axes[i].set_ylabel(<span class="st">"Count"</span>)</span>
<span id="cb41-402"><a href="#cb41-402" aria-hidden="true" tabindex="-1"></a>    axes[i].tick_params(axis<span class="op">=</span><span class="st">'x'</span>, rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb41-403"><a href="#cb41-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-404"><a href="#cb41-404" aria-hidden="true" tabindex="-1"></a><span class="co"># Hide unused subplots</span></span>
<span id="cb41-405"><a href="#cb41-405" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(i <span class="op">+</span> <span class="dv">1</span>, <span class="bu">len</span>(axes)):</span>
<span id="cb41-406"><a href="#cb41-406" aria-hidden="true" tabindex="-1"></a>    fig.delaxes(axes[j])</span>
<span id="cb41-407"><a href="#cb41-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-408"><a href="#cb41-408" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb41-409"><a href="#cb41-409" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb41-410"><a href="#cb41-410" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-411"><a href="#cb41-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-412"><a href="#cb41-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-413"><a href="#cb41-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-414"><a href="#cb41-414" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/Rlogo.png){width="41" height="30"}</span></span>
<span id="cb41-415"><a href="#cb41-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-418"><a href="#cb41-418" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-419"><a href="#cb41-419" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb41-420"><a href="#cb41-420" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb41-421"><a href="#cb41-421" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb41-422"><a href="#cb41-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-423"><a href="#cb41-423" aria-hidden="true" tabindex="-1"></a><span class="co"># Select only numeric columns</span></span>
<span id="cb41-424"><a href="#cb41-424" aria-hidden="true" tabindex="-1"></a>numeric_cols <span class="ot">&lt;-</span> england_filtered_clean <span class="sc">%&gt;%</span> </span>
<span id="cb41-425"><a href="#cb41-425" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric)) <span class="sc">%&gt;%</span> </span>
<span id="cb41-426"><a href="#cb41-426" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>easting, <span class="sc">-</span>northing, <span class="sc">-</span>LEA)</span>
<span id="cb41-427"><a href="#cb41-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-428"><a href="#cb41-428" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to long format for faceting</span></span>
<span id="cb41-429"><a href="#cb41-429" aria-hidden="true" tabindex="-1"></a>numeric_long <span class="ot">&lt;-</span> numeric_cols <span class="sc">%&gt;%</span></span>
<span id="cb41-430"><a href="#cb41-430" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"variable"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>)</span>
<span id="cb41-431"><a href="#cb41-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-432"><a href="#cb41-432" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot faceted histograms</span></span>
<span id="cb41-433"><a href="#cb41-433" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(numeric_long, <span class="fu">aes</span>(<span class="at">x =</span> value)) <span class="sc">+</span></span>
<span id="cb41-434"><a href="#cb41-434" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>, <span class="at">fill =</span> <span class="st">"steelblue"</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb41-435"><a href="#cb41-435" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> variable, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">ncol =</span> <span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb41-436"><a href="#cb41-436" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb41-437"><a href="#cb41-437" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histograms of Numerical Variables"</span>)</span>
<span id="cb41-438"><a href="#cb41-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-439"><a href="#cb41-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-440"><a href="#cb41-440" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-441"><a href="#cb41-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-444"><a href="#cb41-444" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-445"><a href="#cb41-445" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb41-446"><a href="#cb41-446" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb41-447"><a href="#cb41-447" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb41-448"><a href="#cb41-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-449"><a href="#cb41-449" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare the data</span></span>
<span id="cb41-450"><a href="#cb41-450" aria-hidden="true" tabindex="-1"></a>scatter_data <span class="ot">&lt;-</span> england_filtered_clean <span class="sc">%&gt;%</span></span>
<span id="cb41-451"><a href="#cb41-451" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ATT8SCR, PTFSM6CLA1A, PNUMEAL, PERCTOT, PTPRIORLO) <span class="sc">%&gt;%</span></span>
<span id="cb41-452"><a href="#cb41-452" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb41-453"><a href="#cb41-453" aria-hidden="true" tabindex="-1"></a>    <span class="at">log_ATT8SCR =</span> <span class="fu">log</span>(ATT8SCR),</span>
<span id="cb41-454"><a href="#cb41-454" aria-hidden="true" tabindex="-1"></a>    <span class="at">log_PTFSM6CLA1A =</span> <span class="fu">log</span>(PTFSM6CLA1A),</span>
<span id="cb41-455"><a href="#cb41-455" aria-hidden="true" tabindex="-1"></a>    <span class="at">log_PNUMEAL =</span> <span class="fu">log</span>(PNUMEAL),</span>
<span id="cb41-456"><a href="#cb41-456" aria-hidden="true" tabindex="-1"></a>    <span class="at">log_PERCTOT =</span> <span class="fu">log</span>(PERCTOT)</span>
<span id="cb41-457"><a href="#cb41-457" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb41-458"><a href="#cb41-458" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb41-459"><a href="#cb41-459" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(log_PTFSM6CLA1A, log_PNUMEAL, log_PERCTOT, PTPRIORLO),</span>
<span id="cb41-460"><a href="#cb41-460" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"predictor"</span>,</span>
<span id="cb41-461"><a href="#cb41-461" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"x_value"</span></span>
<span id="cb41-462"><a href="#cb41-462" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb41-463"><a href="#cb41-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-464"><a href="#cb41-464" aria-hidden="true" tabindex="-1"></a><span class="co"># Create faceted scatter plots</span></span>
<span id="cb41-465"><a href="#cb41-465" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(scatter_data, <span class="fu">aes</span>(<span class="at">x =</span> x_value, <span class="at">y =</span> log_ATT8SCR)) <span class="sc">+</span></span>
<span id="cb41-466"><a href="#cb41-466" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb41-467"><a href="#cb41-467" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb41-468"><a href="#cb41-468" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> predictor, <span class="at">scales =</span> <span class="st">"free_x"</span>) <span class="sc">+</span></span>
<span id="cb41-469"><a href="#cb41-469" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb41-470"><a href="#cb41-470" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb41-471"><a href="#cb41-471" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Scatter Plots of log(ATT8SCR) vs Predictors"</span>,</span>
<span id="cb41-472"><a href="#cb41-472" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Predictor (log-transformed where applicable)"</span>,</span>
<span id="cb41-473"><a href="#cb41-473" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"log(ATT8SCR)"</span></span>
<span id="cb41-474"><a href="#cb41-474" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb41-475"><a href="#cb41-475" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-476"><a href="#cb41-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-479"><a href="#cb41-479" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-480"><a href="#cb41-480" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb41-481"><a href="#cb41-481" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb41-482"><a href="#cb41-482" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb41-483"><a href="#cb41-483" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 14</span></span>
<span id="cb41-484"><a href="#cb41-484" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb41-485"><a href="#cb41-485" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb41-486"><a href="#cb41-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-487"><a href="#cb41-487" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop unwanted columns</span></span>
<span id="cb41-488"><a href="#cb41-488" aria-hidden="true" tabindex="-1"></a>categorical_cols <span class="ot">&lt;-</span> england_filtered_clean <span class="sc">%&gt;%</span></span>
<span id="cb41-489"><a href="#cb41-489" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.character)) <span class="sc">%&gt;%</span></span>
<span id="cb41-490"><a href="#cb41-490" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>URN, <span class="sc">-</span>SCHNAME.x, <span class="sc">-</span>LANAME, <span class="sc">-</span>TOWN.x, <span class="sc">-</span>SCHOOLTYPE.x)</span>
<span id="cb41-491"><a href="#cb41-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-492"><a href="#cb41-492" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a list to store plots (unnamed)</span></span>
<span id="cb41-493"><a href="#cb41-493" aria-hidden="true" tabindex="-1"></a>plot_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb41-494"><a href="#cb41-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-495"><a href="#cb41-495" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through each categorical column and generate a bar plot</span></span>
<span id="cb41-496"><a href="#cb41-496" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (colname <span class="cf">in</span> <span class="fu">names</span>(categorical_cols)) {</span>
<span id="cb41-497"><a href="#cb41-497" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(categorical_cols, <span class="fu">aes_string</span>(<span class="at">x =</span> colname)) <span class="sc">+</span></span>
<span id="cb41-498"><a href="#cb41-498" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">fill =</span> <span class="st">"darkorange"</span>) <span class="sc">+</span></span>
<span id="cb41-499"><a href="#cb41-499" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb41-500"><a href="#cb41-500" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Distribution of"</span>, colname), <span class="at">x =</span> colname, <span class="at">y =</span> <span class="st">"Count"</span>) <span class="sc">+</span></span>
<span id="cb41-501"><a href="#cb41-501" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb41-502"><a href="#cb41-502" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-503"><a href="#cb41-503" aria-hidden="true" tabindex="-1"></a>  plot_list <span class="ot">&lt;-</span> <span class="fu">append</span>(plot_list, <span class="fu">list</span>(p))  <span class="co"># Append without naming</span></span>
<span id="cb41-504"><a href="#cb41-504" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-505"><a href="#cb41-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-506"><a href="#cb41-506" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine all plots into a single figure</span></span>
<span id="cb41-507"><a href="#cb41-507" aria-hidden="true" tabindex="-1"></a>combined_plot <span class="ot">&lt;-</span> cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(<span class="at">plotlist =</span> plot_list, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb41-508"><a href="#cb41-508" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(combined_plot)</span>
<span id="cb41-509"><a href="#cb41-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-510"><a href="#cb41-510" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-511"><a href="#cb41-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-512"><a href="#cb41-512" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb41-513"><a href="#cb41-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-514"><a href="#cb41-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-515"><a href="#cb41-515" aria-hidden="true" tabindex="-1"></a><span class="fu">### Changing your dummy reference category</span></span>
<span id="cb41-516"><a href="#cb41-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-517"><a href="#cb41-517" aria-hidden="true" tabindex="-1"></a>Your dummy variable reference category is the category within the variable that all other categories will be compared against in your model. </span>
<span id="cb41-518"><a href="#cb41-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-519"><a href="#cb41-519" aria-hidden="true" tabindex="-1"></a>While the reference category has no effect on the model itself, it does make a difference for how you interpret your model. </span>
<span id="cb41-520"><a href="#cb41-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-521"><a href="#cb41-521" aria-hidden="true" tabindex="-1"></a>For example, if you are using Regions in England as a dummy, setting your reference region as London will mean all other regions are compared to it and they might naturally be lower or higher. </span>
<span id="cb41-522"><a href="#cb41-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-523"><a href="#cb41-523" aria-hidden="true" tabindex="-1"></a>A good strategy is to select the most or least numerous or important category in your variable, rather than something in the middle. Of course, you may not know which is most important until you run your model, so you may need to go back and reset the reference variable and run the model again. </span>
<span id="cb41-524"><a href="#cb41-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-525"><a href="#cb41-525" aria-hidden="true" tabindex="-1"></a>Here is some code in R and Python to help you carry out the setting of the reference level (Yes, it's more straightforward in R!)</span>
<span id="cb41-526"><a href="#cb41-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-527"><a href="#cb41-527" aria-hidden="true" tabindex="-1"></a>::: multicode</span>
<span id="cb41-528"><a href="#cb41-528" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/python-logo-only.png){width="30"}</span></span>
<span id="cb41-529"><a href="#cb41-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-532"><a href="#cb41-532" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb41-533"><a href="#cb41-533" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb41-534"><a href="#cb41-534" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb41-535"><a href="#cb41-535" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb41-536"><a href="#cb41-536" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pandas.api.types <span class="im">import</span> CategoricalDtype</span>
<span id="cb41-537"><a href="#cb41-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-538"><a href="#cb41-538" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure it's a copy to avoid SettingWithCopyWarning</span></span>
<span id="cb41-539"><a href="#cb41-539" aria-hidden="true" tabindex="-1"></a>england_filtered_clean <span class="op">=</span> england_filtered_clean.copy()</span>
<span id="cb41-540"><a href="#cb41-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-541"><a href="#cb41-541" aria-hidden="true" tabindex="-1"></a><span class="co"># Set reference level for gor_name</span></span>
<span id="cb41-542"><a href="#cb41-542" aria-hidden="true" tabindex="-1"></a>gor_dtype <span class="op">=</span> CategoricalDtype(</span>
<span id="cb41-543"><a href="#cb41-543" aria-hidden="true" tabindex="-1"></a>    categories<span class="op">=</span>[<span class="st">"South East"</span>] <span class="op">+</span> <span class="bu">sorted</span>(<span class="bu">set</span>(england_filtered_clean[<span class="st">"gor_name"</span>]) <span class="op">-</span> {<span class="st">"South East"</span>}),</span>
<span id="cb41-544"><a href="#cb41-544" aria-hidden="true" tabindex="-1"></a>    ordered<span class="op">=</span><span class="va">True</span></span>
<span id="cb41-545"><a href="#cb41-545" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-546"><a href="#cb41-546" aria-hidden="true" tabindex="-1"></a>england_filtered_clean[<span class="st">"gor_name"</span>] <span class="op">=</span> england_filtered_clean[<span class="st">"gor_name"</span>].astype(gor_dtype)</span>
<span id="cb41-547"><a href="#cb41-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-548"><a href="#cb41-548" aria-hidden="true" tabindex="-1"></a><span class="co"># Set reference level for ofsted_rating_name</span></span>
<span id="cb41-549"><a href="#cb41-549" aria-hidden="true" tabindex="-1"></a>ofsted_dtype <span class="op">=</span> CategoricalDtype(</span>
<span id="cb41-550"><a href="#cb41-550" aria-hidden="true" tabindex="-1"></a>    categories<span class="op">=</span>[<span class="st">"Good"</span>] <span class="op">+</span> <span class="bu">sorted</span>(<span class="bu">set</span>(england_filtered_clean[<span class="st">"OFSTEDRATING"</span>].dropna()) <span class="op">-</span> {<span class="st">"Good"</span>}),</span>
<span id="cb41-551"><a href="#cb41-551" aria-hidden="true" tabindex="-1"></a>    ordered<span class="op">=</span><span class="va">True</span></span>
<span id="cb41-552"><a href="#cb41-552" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-553"><a href="#cb41-553" aria-hidden="true" tabindex="-1"></a>england_filtered_clean[<span class="st">"ofsted_rating_name"</span>] <span class="op">=</span> england_filtered_clean[<span class="st">"OFSTEDRATING"</span>].astype(ofsted_dtype)</span>
<span id="cb41-554"><a href="#cb41-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-555"><a href="#cb41-555" aria-hidden="true" tabindex="-1"></a><span class="co"># Set reference level for ADMPOL_PT</span></span>
<span id="cb41-556"><a href="#cb41-556" aria-hidden="true" tabindex="-1"></a>admpol_dtype <span class="op">=</span> CategoricalDtype(</span>
<span id="cb41-557"><a href="#cb41-557" aria-hidden="true" tabindex="-1"></a>    categories<span class="op">=</span>[<span class="st">"OTHER NON SEL"</span>] <span class="op">+</span> <span class="bu">sorted</span>(<span class="bu">set</span>(england_filtered_clean[<span class="st">"ADMPOL_PT"</span>]) <span class="op">-</span> {<span class="st">"OTHER NON SEL"</span>}),</span>
<span id="cb41-558"><a href="#cb41-558" aria-hidden="true" tabindex="-1"></a>    ordered<span class="op">=</span><span class="va">True</span></span>
<span id="cb41-559"><a href="#cb41-559" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-560"><a href="#cb41-560" aria-hidden="true" tabindex="-1"></a>england_filtered_clean[<span class="st">"ADMPOL_PT"</span>] <span class="op">=</span> england_filtered_clean[<span class="st">"ADMPOL_PT"</span>].astype(admpol_dtype)</span>
<span id="cb41-561"><a href="#cb41-561" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-562"><a href="#cb41-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-563"><a href="#cb41-563" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/Rlogo.png){width="41" height="30"}</span></span>
<span id="cb41-564"><a href="#cb41-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-567"><a href="#cb41-567" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-568"><a href="#cb41-568" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb41-569"><a href="#cb41-569" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb41-570"><a href="#cb41-570" aria-hidden="true" tabindex="-1"></a><span class="do">## In R, you can change the reference category using the relevel() function</span></span>
<span id="cb41-571"><a href="#cb41-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-572"><a href="#cb41-572" aria-hidden="true" tabindex="-1"></a>england_filtered_clean<span class="sc">$</span>gor_name <span class="ot">&lt;-</span> <span class="fu">relevel</span>(<span class="fu">factor</span>(england_filtered_clean<span class="sc">$</span>gor_name), <span class="at">ref =</span> <span class="st">"South East"</span>)</span>
<span id="cb41-573"><a href="#cb41-573" aria-hidden="true" tabindex="-1"></a>england_filtered_clean<span class="sc">$</span>ofsted_rating_name <span class="ot">&lt;-</span> <span class="fu">relevel</span>(<span class="fu">factor</span>(england_filtered_clean<span class="sc">$</span>OFSTEDRATING), <span class="at">ref =</span> <span class="st">"Good"</span>)</span>
<span id="cb41-574"><a href="#cb41-574" aria-hidden="true" tabindex="-1"></a>england_filtered_clean<span class="sc">$</span>ADMPOL_PT <span class="ot">&lt;-</span> <span class="fu">relevel</span>(<span class="fu">factor</span>(england_filtered_clean<span class="sc">$</span>ADMPOL_PT), <span class="at">ref =</span> <span class="st">"OTHER NON SEL"</span>)</span>
<span id="cb41-575"><a href="#cb41-575" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-576"><a href="#cb41-576" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb41-577"><a href="#cb41-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-578"><a href="#cb41-578" aria-hidden="true" tabindex="-1"></a><span class="fu">### Reclassifying a variable into fewer categories</span></span>
<span id="cb41-579"><a href="#cb41-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-580"><a href="#cb41-580" aria-hidden="true" tabindex="-1"></a>As mentioned in the lecture, it can sometimes be useful to reclassify a variable into fewer categories to see if a signal appears. </span>
<span id="cb41-581"><a href="#cb41-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-582"><a href="#cb41-582" aria-hidden="true" tabindex="-1"></a>Let's have a look at the religious character of a school variable and test it out as dummy in a basic model:</span>
<span id="cb41-583"><a href="#cb41-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-584"><a href="#cb41-584" aria-hidden="true" tabindex="-1"></a>:::{callout.note}</span>
<span id="cb41-585"><a href="#cb41-585" aria-hidden="true" tabindex="-1"></a>Note the Python code is far more complicated than the R code, but should prodice similar outputs</span>
<span id="cb41-586"><a href="#cb41-586" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb41-587"><a href="#cb41-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-588"><a href="#cb41-588" aria-hidden="true" tabindex="-1"></a>::: multicode</span>
<span id="cb41-589"><a href="#cb41-589" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/python-logo-only.png){width="30"}</span></span>
<span id="cb41-590"><a href="#cb41-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-593"><a href="#cb41-593" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb41-594"><a href="#cb41-594" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb41-595"><a href="#cb41-595" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb41-596"><a href="#cb41-596" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb41-597"><a href="#cb41-597" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb41-598"><a href="#cb41-598" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb41-599"><a href="#cb41-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-600"><a href="#cb41-600" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop rows with missing values in relevant columns</span></span>
<span id="cb41-601"><a href="#cb41-601" aria-hidden="true" tabindex="-1"></a>model_df <span class="op">=</span> england_filtered_clean[[<span class="st">'ATT8SCR'</span>, <span class="st">'PTFSM6CLA1A'</span>, <span class="st">'RELCHAR'</span>]].dropna().copy()</span>
<span id="cb41-602"><a href="#cb41-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-603"><a href="#cb41-603" aria-hidden="true" tabindex="-1"></a><span class="co"># Log-transform numeric variables</span></span>
<span id="cb41-604"><a href="#cb41-604" aria-hidden="true" tabindex="-1"></a>model_df[<span class="st">'log_ATT8SCR'</span>] <span class="op">=</span> np.log(model_df[<span class="st">'ATT8SCR'</span>].astype(<span class="bu">float</span>))</span>
<span id="cb41-605"><a href="#cb41-605" aria-hidden="true" tabindex="-1"></a>model_df[<span class="st">'log_PTFSM6CLA1A'</span>] <span class="op">=</span> np.log(model_df[<span class="st">'PTFSM6CLA1A'</span>].astype(<span class="bu">float</span>))</span>
<span id="cb41-606"><a href="#cb41-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-607"><a href="#cb41-607" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure RELCHAR is treated as categorical</span></span>
<span id="cb41-608"><a href="#cb41-608" aria-hidden="true" tabindex="-1"></a>model_df[<span class="st">'RELCHAR'</span>] <span class="op">=</span> model_df[<span class="st">'RELCHAR'</span>].astype(<span class="st">'category'</span>)</span>
<span id="cb41-609"><a href="#cb41-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-610"><a href="#cb41-610" aria-hidden="true" tabindex="-1"></a><span class="co"># Create design matrix with dummy variables for RELCHAR</span></span>
<span id="cb41-611"><a href="#cb41-611" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.get_dummies(model_df[[<span class="st">'log_PTFSM6CLA1A'</span>, <span class="st">'RELCHAR'</span>]], drop_first<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb41-612"><a href="#cb41-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-613"><a href="#cb41-613" aria-hidden="true" tabindex="-1"></a><span class="co"># Add constant</span></span>
<span id="cb41-614"><a href="#cb41-614" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(X)</span>
<span id="cb41-615"><a href="#cb41-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-616"><a href="#cb41-616" aria-hidden="true" tabindex="-1"></a><span class="co"># Response variable</span></span>
<span id="cb41-617"><a href="#cb41-617" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> model_df[<span class="st">'log_ATT8SCR'</span>]</span>
<span id="cb41-618"><a href="#cb41-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-619"><a href="#cb41-619" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure all columns are float64 to avoid dtype issues</span></span>
<span id="cb41-620"><a href="#cb41-620" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> X.astype(<span class="st">'float64'</span>)</span>
<span id="cb41-621"><a href="#cb41-621" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> y.astype(<span class="st">'float64'</span>)</span>
<span id="cb41-622"><a href="#cb41-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-623"><a href="#cb41-623" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit linear model using Pandas DataFrame directly</span></span>
<span id="cb41-624"><a href="#cb41-624" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.OLS(y, X).fit()</span>
<span id="cb41-625"><a href="#cb41-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-626"><a href="#cb41-626" aria-hidden="true" tabindex="-1"></a><span class="co"># Display summary with proper variable names</span></span>
<span id="cb41-627"><a href="#cb41-627" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())</span>
<span id="cb41-628"><a href="#cb41-628" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-629"><a href="#cb41-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-630"><a href="#cb41-630" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/Rlogo.png){width="41" height="30"}</span></span>
<span id="cb41-631"><a href="#cb41-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-634"><a href="#cb41-634" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-635"><a href="#cb41-635" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb41-636"><a href="#cb41-636" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb41-637"><a href="#cb41-637" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit linear model and get predicted values</span></span>
<span id="cb41-638"><a href="#cb41-638" aria-hidden="true" tabindex="-1"></a>england_model2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(ATT8SCR) <span class="sc">~</span> <span class="fu">log</span>(PTFSM6CLA1A) <span class="sc">+</span> RELCHAR, <span class="at">data =</span> england_filtered_clean)</span>
<span id="cb41-639"><a href="#cb41-639" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(england_model2)</span>
<span id="cb41-640"><a href="#cb41-640" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-641"><a href="#cb41-641" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb41-642"><a href="#cb41-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-643"><a href="#cb41-643" aria-hidden="true" tabindex="-1"></a>You will notice that the religious character variables nearly all insignificant. As such, lets try collapsing into three groups - "None", "Christian" and "Non-Christian"</span>
<span id="cb41-644"><a href="#cb41-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-645"><a href="#cb41-645" aria-hidden="true" tabindex="-1"></a>::: multicode</span>
<span id="cb41-646"><a href="#cb41-646" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/python-logo-only.png){width="30"}</span></span>
<span id="cb41-647"><a href="#cb41-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-650"><a href="#cb41-650" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb41-651"><a href="#cb41-651" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb41-652"><a href="#cb41-652" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb41-653"><a href="#cb41-653" aria-hidden="true" tabindex="-1"></a><span class="co"># Define mapping function</span></span>
<span id="cb41-654"><a href="#cb41-654" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> classify_relchar(value):</span>
<span id="cb41-655"><a href="#cb41-655" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> pd.isna(value):</span>
<span id="cb41-656"><a href="#cb41-656" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"None"</span></span>
<span id="cb41-657"><a href="#cb41-657" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> value <span class="kw">in</span> [<span class="st">"Does not apply"</span>, <span class="st">"None"</span>]:</span>
<span id="cb41-658"><a href="#cb41-658" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"None"</span></span>
<span id="cb41-659"><a href="#cb41-659" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> value <span class="kw">in</span> [</span>
<span id="cb41-660"><a href="#cb41-660" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Roman Catholic"</span>, <span class="st">"Greek Orthodox"</span>, <span class="st">"Church of England"</span>, <span class="st">"Catholic"</span>, <span class="st">"Christian"</span>,</span>
<span id="cb41-661"><a href="#cb41-661" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Church of England/Roman Catholic"</span>, <span class="st">"Roman Catholic/Church of England"</span>,</span>
<span id="cb41-662"><a href="#cb41-662" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Church of England/Christian"</span>, <span class="st">"Anglican/Church of England"</span></span>
<span id="cb41-663"><a href="#cb41-663" aria-hidden="true" tabindex="-1"></a>    ]:</span>
<span id="cb41-664"><a href="#cb41-664" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"Christian"</span></span>
<span id="cb41-665"><a href="#cb41-665" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb41-666"><a href="#cb41-666" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"Non-Christian"</span></span>
<span id="cb41-667"><a href="#cb41-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-668"><a href="#cb41-668" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply classification</span></span>
<span id="cb41-669"><a href="#cb41-669" aria-hidden="true" tabindex="-1"></a>england_filtered_clean[<span class="st">'RELCHAR_Grp'</span>] <span class="op">=</span> england_filtered_clean[<span class="st">'RELCHAR'</span>].<span class="bu">apply</span>(classify_relchar)</span>
<span id="cb41-670"><a href="#cb41-670" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-671"><a href="#cb41-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-672"><a href="#cb41-672" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/Rlogo.png){width="41" height="30"}</span></span>
<span id="cb41-673"><a href="#cb41-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-676"><a href="#cb41-676" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-677"><a href="#cb41-677" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb41-678"><a href="#cb41-678" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb41-679"><a href="#cb41-679" aria-hidden="true" tabindex="-1"></a>england_filtered_clean <span class="ot">&lt;-</span> england_filtered_clean <span class="sc">%&gt;%</span></span>
<span id="cb41-680"><a href="#cb41-680" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">RELCHAR_Grp =</span> <span class="fu">case_when</span>(</span>
<span id="cb41-681"><a href="#cb41-681" aria-hidden="true" tabindex="-1"></a>    RELCHAR <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Does not apply"</span>, <span class="st">"None"</span>) <span class="sc">~</span> <span class="st">"None"</span>,</span>
<span id="cb41-682"><a href="#cb41-682" aria-hidden="true" tabindex="-1"></a>    RELCHAR <span class="sc">%in%</span> <span class="fu">c</span>(</span>
<span id="cb41-683"><a href="#cb41-683" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Roman Catholic"</span>, <span class="st">"Greek Orthodox"</span>, <span class="st">"Church of England"</span>, <span class="st">"Catholic"</span>, <span class="st">"Christian"</span>,</span>
<span id="cb41-684"><a href="#cb41-684" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Church of England/Roman Catholic"</span>, <span class="st">"Roman Catholic/Church of England"</span>,</span>
<span id="cb41-685"><a href="#cb41-685" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Church of England/Christian"</span>, <span class="st">"Anglican/Church of England"</span></span>
<span id="cb41-686"><a href="#cb41-686" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">~</span> <span class="st">"Christian"</span>,</span>
<span id="cb41-687"><a href="#cb41-687" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Non-Christian"</span></span>
<span id="cb41-688"><a href="#cb41-688" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb41-689"><a href="#cb41-689" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-690"><a href="#cb41-690" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb41-691"><a href="#cb41-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-692"><a href="#cb41-692" aria-hidden="true" tabindex="-1"></a>Now re-run your model</span>
<span id="cb41-693"><a href="#cb41-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-694"><a href="#cb41-694" aria-hidden="true" tabindex="-1"></a>::: multicode</span>
<span id="cb41-695"><a href="#cb41-695" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/python-logo-only.png){width="30"}</span></span>
<span id="cb41-696"><a href="#cb41-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-699"><a href="#cb41-699" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb41-700"><a href="#cb41-700" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb41-701"><a href="#cb41-701" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb41-702"><a href="#cb41-702" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb41-703"><a href="#cb41-703" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb41-704"><a href="#cb41-704" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb41-705"><a href="#cb41-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-706"><a href="#cb41-706" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert RELCHAR_Grp to a categorical variable with "None" as the reference level</span></span>
<span id="cb41-707"><a href="#cb41-707" aria-hidden="true" tabindex="-1"></a>england_filtered_clean[<span class="st">'RELCHAR_Grp'</span>] <span class="op">=</span> pd.Categorical(</span>
<span id="cb41-708"><a href="#cb41-708" aria-hidden="true" tabindex="-1"></a>    england_filtered_clean[<span class="st">'RELCHAR_Grp'</span>],</span>
<span id="cb41-709"><a href="#cb41-709" aria-hidden="true" tabindex="-1"></a>    categories<span class="op">=</span>[<span class="st">"None"</span>, <span class="st">"Christian"</span>, <span class="st">"Non-Christian"</span>],</span>
<span id="cb41-710"><a href="#cb41-710" aria-hidden="true" tabindex="-1"></a>    ordered<span class="op">=</span><span class="va">False</span></span>
<span id="cb41-711"><a href="#cb41-711" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-712"><a href="#cb41-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-713"><a href="#cb41-713" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop rows with missing values in relevant columns</span></span>
<span id="cb41-714"><a href="#cb41-714" aria-hidden="true" tabindex="-1"></a>model_df <span class="op">=</span> england_filtered_clean[[<span class="st">'ATT8SCR'</span>, <span class="st">'PTFSM6CLA1A'</span>, <span class="st">'RELCHAR_Grp'</span>]].dropna().copy()</span>
<span id="cb41-715"><a href="#cb41-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-716"><a href="#cb41-716" aria-hidden="true" tabindex="-1"></a><span class="co"># Log-transform numeric variables</span></span>
<span id="cb41-717"><a href="#cb41-717" aria-hidden="true" tabindex="-1"></a>model_df[<span class="st">'log_ATT8SCR'</span>] <span class="op">=</span> np.log(model_df[<span class="st">'ATT8SCR'</span>].astype(<span class="bu">float</span>))</span>
<span id="cb41-718"><a href="#cb41-718" aria-hidden="true" tabindex="-1"></a>model_df[<span class="st">'log_PTFSM6CLA1A'</span>] <span class="op">=</span> np.log(model_df[<span class="st">'PTFSM6CLA1A'</span>].astype(<span class="bu">float</span>))</span>
<span id="cb41-719"><a href="#cb41-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-720"><a href="#cb41-720" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure RELCHAR is treated as categorical</span></span>
<span id="cb41-721"><a href="#cb41-721" aria-hidden="true" tabindex="-1"></a>model_df[<span class="st">'RELCHAR_Grp'</span>] <span class="op">=</span> model_df[<span class="st">'RELCHAR_Grp'</span>].astype(<span class="st">'category'</span>)</span>
<span id="cb41-722"><a href="#cb41-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-723"><a href="#cb41-723" aria-hidden="true" tabindex="-1"></a><span class="co"># Create design matrix with dummy variables for RELCHAR</span></span>
<span id="cb41-724"><a href="#cb41-724" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.get_dummies(model_df[[<span class="st">'log_PTFSM6CLA1A'</span>, <span class="st">'RELCHAR_Grp'</span>]], drop_first<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb41-725"><a href="#cb41-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-726"><a href="#cb41-726" aria-hidden="true" tabindex="-1"></a><span class="co"># Add constant</span></span>
<span id="cb41-727"><a href="#cb41-727" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(X)</span>
<span id="cb41-728"><a href="#cb41-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-729"><a href="#cb41-729" aria-hidden="true" tabindex="-1"></a><span class="co"># Response variable</span></span>
<span id="cb41-730"><a href="#cb41-730" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> model_df[<span class="st">'log_ATT8SCR'</span>]</span>
<span id="cb41-731"><a href="#cb41-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-732"><a href="#cb41-732" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure all columns are float64 to avoid dtype issues</span></span>
<span id="cb41-733"><a href="#cb41-733" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> X.astype(<span class="st">'float64'</span>)</span>
<span id="cb41-734"><a href="#cb41-734" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> y.astype(<span class="st">'float64'</span>)</span>
<span id="cb41-735"><a href="#cb41-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-736"><a href="#cb41-736" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit linear model using Pandas DataFrame directly</span></span>
<span id="cb41-737"><a href="#cb41-737" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.OLS(y, X).fit()</span>
<span id="cb41-738"><a href="#cb41-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-739"><a href="#cb41-739" aria-hidden="true" tabindex="-1"></a><span class="co"># Display summary with proper variable names</span></span>
<span id="cb41-740"><a href="#cb41-740" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())</span>
<span id="cb41-741"><a href="#cb41-741" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-742"><a href="#cb41-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-743"><a href="#cb41-743" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/Rlogo.png){width="41" height="30"}</span></span>
<span id="cb41-744"><a href="#cb41-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-747"><a href="#cb41-747" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-748"><a href="#cb41-748" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb41-749"><a href="#cb41-749" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb41-750"><a href="#cb41-750" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit linear model and get predicted values</span></span>
<span id="cb41-751"><a href="#cb41-751" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure RELCHAR_Grp is a factor with "None" as the reference level</span></span>
<span id="cb41-752"><a href="#cb41-752" aria-hidden="true" tabindex="-1"></a>england_filtered_clean <span class="ot">&lt;-</span> england_filtered_clean <span class="sc">%&gt;%</span></span>
<span id="cb41-753"><a href="#cb41-753" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">RELCHAR_Grp =</span> <span class="fu">factor</span>(RELCHAR_Grp, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"None"</span>, <span class="st">"Christian"</span>, <span class="st">"Non-Christian"</span>)))</span>
<span id="cb41-754"><a href="#cb41-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-755"><a href="#cb41-755" aria-hidden="true" tabindex="-1"></a>england_model2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(ATT8SCR) <span class="sc">~</span> <span class="fu">log</span>(PTFSM6CLA1A) <span class="sc">+</span> RELCHAR_Grp, <span class="at">data =</span> england_filtered_clean)</span>
<span id="cb41-756"><a href="#cb41-756" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(england_model2)</span>
<span id="cb41-757"><a href="#cb41-757" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-758"><a href="#cb41-758" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb41-759"><a href="#cb41-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-760"><a href="#cb41-760" aria-hidden="true" tabindex="-1"></a>Has this made a difference? What's happened to the significance of the religious character variable?</span>
<span id="cb41-761"><a href="#cb41-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-762"><a href="#cb41-762" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip}</span>
<span id="cb41-763"><a href="#cb41-763" aria-hidden="true" tabindex="-1"></a>You can use this method to reclassify any different variable. </span>
<span id="cb41-764"><a href="#cb41-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-765"><a href="#cb41-765" aria-hidden="true" tabindex="-1"></a>Think about how you might reclassify a continuous variable. You might think about converting something like 'total number of pupils on roll' into 'small', 'medium' and 'large' schools, for example, based on certain thresholds. How might you choose these thresholds? If you are struggling to think of how you might code this kind of reclassification up, this is exactly where AI can be very helpful in assisting you - although while it might be good at the code to do it, I can guarantee it will likely be pretty bad at deciding on useful breaks in your data, so this is where you might need to intervene. </span>
<span id="cb41-766"><a href="#cb41-766" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb41-767"><a href="#cb41-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-768"><a href="#cb41-768" aria-hidden="true" tabindex="-1"></a><span class="fu">## Task 3 - Building your optimum multiple regression model</span></span>
<span id="cb41-769"><a href="#cb41-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-770"><a href="#cb41-770" aria-hidden="true" tabindex="-1"></a><span class="fu">### Recipe Steps</span></span>
<span id="cb41-771"><a href="#cb41-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-772"><a href="#cb41-772" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Using the steps you learned last week and the information from this week's lecture, I would like you to find the best possible ***7-dependent variable model*** for your chosen attainment variable (without interaction terms). These can be continuous or categorical variables or any combination of them. Remember:</span>
<span id="cb41-773"><a href="#cb41-773" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Use exploratory analysis to check the distributions of your variables using histograms, box plots etc. or binary scatter plots with your dependent variable, ***before*** putting them into your model (you've already done some of this, but you may need to do some more)</span>
<span id="cb41-774"><a href="#cb41-774" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>you might run into issues with logging some variables that have real 0s in them - this might cause your model to break. You might need to filter these variables out of your dataset before running your model. Some of the code above will help with this - if you get stuck, ask a friendly AI for help</span>
<span id="cb41-775"><a href="#cb41-775" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>with your dummy variables, you might want to experiment with changing your reference category</span>
<span id="cb41-776"><a href="#cb41-776" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>you might also want to reclassify a variable if you suspect it is important, but that in its present form is coming out as insignificant</span>
<span id="cb41-777"><a href="#cb41-777" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>check you regression assumptions - linearity, homoscedasticity, normality of residuals, multicollinearity, independence of residuals - does your model pass?</span>
<span id="cb41-778"><a href="#cb41-778" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>which are the most important variables in your model in terms of t-values?</span>
<span id="cb41-779"><a href="#cb41-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-780"><a href="#cb41-780" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>You should try and build your model step by step, a variable at a time. Each time you run the model, check what is happening to the coefficients</span>
<span id="cb41-781"><a href="#cb41-781" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>What do you notice about confounding or mediation as you go?</span>
<span id="cb41-782"><a href="#cb41-782" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Do any of your variables become insignificant? For example, what happens to religious character groups in the presence of regions, for example? If a variable becomes insignificant, you might we wise to drop it from the analysis (but maybe not until the end in case another variable makes it significant again) </span>
<span id="cb41-783"><a href="#cb41-783" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-784"><a href="#cb41-784" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ON YOUR MARKS, GET SET - GO!!!</span></span>
<span id="cb41-785"><a href="#cb41-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-786"><a href="#cb41-786" aria-hidden="true" tabindex="-1"></a>When you think you have your best model, move on to Task 4 below</span>
<span id="cb41-787"><a href="#cb41-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-788"><a href="#cb41-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-789"><a href="#cb41-789" aria-hidden="true" tabindex="-1"></a>::: multicode</span>
<span id="cb41-790"><a href="#cb41-790" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/python-logo-only.png){width="30"}</span></span>
<span id="cb41-791"><a href="#cb41-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-794"><a href="#cb41-794" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb41-795"><a href="#cb41-795" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb41-796"><a href="#cb41-796" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb41-797"><a href="#cb41-797" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb41-798"><a href="#cb41-798" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-799"><a href="#cb41-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-800"><a href="#cb41-800" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/Rlogo.png){width="41" height="30"}</span></span>
<span id="cb41-801"><a href="#cb41-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-804"><a href="#cb41-804" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-805"><a href="#cb41-805" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb41-806"><a href="#cb41-806" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb41-807"><a href="#cb41-807" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(performance)</span>
<span id="cb41-808"><a href="#cb41-808" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jtools)</span>
<span id="cb41-809"><a href="#cb41-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-810"><a href="#cb41-810" aria-hidden="true" tabindex="-1"></a>england_filtered_clean <span class="ot">&lt;-</span> england_filtered_clean <span class="sc">%&gt;%</span></span>
<span id="cb41-811"><a href="#cb41-811" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PTFSM6CLA1A <span class="sc">&gt;</span> <span class="dv">0</span>, PERCTOT <span class="sc">&gt;</span> <span class="dv">0</span>, PNUMEAL <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb41-812"><a href="#cb41-812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-813"><a href="#cb41-813" aria-hidden="true" tabindex="-1"></a>england_model3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(ATT8SCR) <span class="sc">~</span> <span class="fu">log</span>(PTFSM6CLA1A) <span class="sc">+</span> <span class="fu">log</span>(PERCTOT) <span class="sc">+</span> RELCHAR_Grp, <span class="at">data =</span> england_filtered_clean)</span>
<span id="cb41-814"><a href="#cb41-814" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(england_model3)</span>
<span id="cb41-815"><a href="#cb41-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-816"><a href="#cb41-816" aria-hidden="true" tabindex="-1"></a>england_model4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(ATT8SCR) <span class="sc">~</span> <span class="fu">log</span>(PTFSM6CLA1A) <span class="sc">+</span> <span class="fu">log</span>(PERCTOT) <span class="sc">+</span> gor_name, <span class="at">data =</span> england_filtered_clean, <span class="at">na.action =</span> na.exclude)</span>
<span id="cb41-817"><a href="#cb41-817" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(england_model4)</span>
<span id="cb41-818"><a href="#cb41-818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-819"><a href="#cb41-819" aria-hidden="true" tabindex="-1"></a>england_model5 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(ATT8SCR) <span class="sc">~</span> <span class="fu">log</span>(PTFSM6CLA1A) <span class="sc">+</span> <span class="fu">log</span>(PERCTOT) <span class="sc">+</span> <span class="fu">log</span>(PNUMEAL) <span class="sc">+</span> gor_name, <span class="at">data =</span> england_filtered_clean, <span class="at">na.action =</span> na.exclude)</span>
<span id="cb41-820"><a href="#cb41-820" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(england_model5)</span>
<span id="cb41-821"><a href="#cb41-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-822"><a href="#cb41-822" aria-hidden="true" tabindex="-1"></a>england_model6 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(ATT8SCR) <span class="sc">~</span> <span class="fu">log</span>(PTFSM6CLA1A) <span class="sc">+</span> <span class="fu">log</span>(PERCTOT) <span class="sc">+</span> <span class="fu">log</span>(PNUMEAL) <span class="sc">+</span> OFSTEDRATING <span class="sc">+</span> gor_name, <span class="at">data =</span> england_filtered_clean, <span class="at">na.action =</span> na.exclude)</span>
<span id="cb41-823"><a href="#cb41-823" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(england_model6)</span>
<span id="cb41-824"><a href="#cb41-824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-825"><a href="#cb41-825" aria-hidden="true" tabindex="-1"></a>england_model7 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(ATT8SCR) <span class="sc">~</span> <span class="fu">log</span>(PTFSM6CLA1A) <span class="sc">+</span> <span class="fu">log</span>(PERCTOT) <span class="sc">+</span> <span class="fu">log</span>(PNUMEAL) <span class="sc">+</span> OFSTEDRATING <span class="sc">+</span> gor_name <span class="sc">+</span> PTPRIORLO <span class="sc">+</span> ADMPOL_PT, <span class="at">data =</span> england_filtered_clean, <span class="at">na.action =</span> na.exclude)</span>
<span id="cb41-826"><a href="#cb41-826" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(england_model7)</span>
<span id="cb41-827"><a href="#cb41-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-828"><a href="#cb41-828" aria-hidden="true" tabindex="-1"></a><span class="co">#Get fitted values with NA for excluded rows</span></span>
<span id="cb41-829"><a href="#cb41-829" aria-hidden="true" tabindex="-1"></a>fitted_vals <span class="ot">&lt;-</span> <span class="fu">fitted</span>(england_model7)</span>
<span id="cb41-830"><a href="#cb41-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-831"><a href="#cb41-831" aria-hidden="true" tabindex="-1"></a><span class="co"># Add fitted values to the dataframe</span></span>
<span id="cb41-832"><a href="#cb41-832" aria-hidden="true" tabindex="-1"></a>england_filtered_clean<span class="sc">$</span>fitted7 <span class="ot">&lt;-</span> fitted_vals</span>
<span id="cb41-833"><a href="#cb41-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-834"><a href="#cb41-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-835"><a href="#cb41-835" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-836"><a href="#cb41-836" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb41-837"><a href="#cb41-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-838"><a href="#cb41-838" aria-hidden="true" tabindex="-1"></a><span class="fu">## Task 4 - Evaluation</span></span>
<span id="cb41-839"><a href="#cb41-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-840"><a href="#cb41-840" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>When you have your 'best' model, how do you interpret the coefficients?</span>
<span id="cb41-841"><a href="#cb41-841" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Which variable(s) has(have) the most explanatory power (check t-values for this)?</span>
<span id="cb41-842"><a href="#cb41-842" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>How do you interpret the combined explanatory power of variables in your model?</span>
<span id="cb41-843"><a href="#cb41-843" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>What kind of confounding do you observe as you add more variables (if any)?</span>
<span id="cb41-844"><a href="#cb41-844" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Do you have any issues of multicollinearity or residual independence? Does your model pass the standard tests?</span>
<span id="cb41-845"><a href="#cb41-845" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-846"><a href="#cb41-846" aria-hidden="true" tabindex="-1"></a>Here's my best model compared with some of the others I built as I went along</span>
<span id="cb41-847"><a href="#cb41-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-850"><a href="#cb41-850" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-851"><a href="#cb41-851" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(<span class="fu">coef</span>(england_model3))</span>
<span id="cb41-852"><a href="#cb41-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-853"><a href="#cb41-853" aria-hidden="true" tabindex="-1"></a>coef_names <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb41-854"><a href="#cb41-854" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Constant"</span> <span class="ot">=</span> <span class="st">"(Intercept)"</span>,</span>
<span id="cb41-855"><a href="#cb41-855" aria-hidden="true" tabindex="-1"></a>  <span class="co">#"Religious Christian" = "RELCHAR_GrpChristian",</span></span>
<span id="cb41-856"><a href="#cb41-856" aria-hidden="true" tabindex="-1"></a>  <span class="co">#"Religious not-Christian","RELCHAR_GrpNon-Christian",</span></span>
<span id="cb41-857"><a href="#cb41-857" aria-hidden="true" tabindex="-1"></a>  <span class="st">"% Disadvantaged end KS4 (log)"</span> <span class="ot">=</span> <span class="st">"log(PTFSM6CLA1A)"</span>,</span>
<span id="cb41-858"><a href="#cb41-858" aria-hidden="true" tabindex="-1"></a>  <span class="st">"% overall absence (log)"</span> <span class="ot">=</span> <span class="st">"log(PERCTOT)"</span>,</span>
<span id="cb41-859"><a href="#cb41-859" aria-hidden="true" tabindex="-1"></a>  <span class="st">"% English Not First Language (log)"</span> <span class="ot">=</span> <span class="st">"log(PNUMEAL)"</span>,</span>
<span id="cb41-860"><a href="#cb41-860" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Ofsted: Outstanding"</span> <span class="ot">=</span> <span class="st">"OFSTEDRATINGOutstanding"</span>,</span>
<span id="cb41-861"><a href="#cb41-861" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Ofsted: Requires Improvement"</span> <span class="ot">=</span> <span class="st">"OFSTEDRATINGRequires improvement"</span>,</span>
<span id="cb41-862"><a href="#cb41-862" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Ofsted: Serious Weaknesses"</span> <span class="ot">=</span> <span class="st">"OFSTEDRATINGSerious Weaknesses"</span>,</span>
<span id="cb41-863"><a href="#cb41-863" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Ofsted: Special Measures"</span> <span class="ot">=</span> <span class="st">"OFSTEDRATINGSpecial Measures"</span>,</span>
<span id="cb41-864"><a href="#cb41-864" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Region: East Midlands"</span> <span class="ot">=</span> <span class="st">"gor_nameEast Midlands"</span>,</span>
<span id="cb41-865"><a href="#cb41-865" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Region: East of England"</span> <span class="ot">=</span> <span class="st">"gor_nameEast of England"</span>,</span>
<span id="cb41-866"><a href="#cb41-866" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Region: London"</span> <span class="ot">=</span> <span class="st">"gor_nameLondon"</span>,</span>
<span id="cb41-867"><a href="#cb41-867" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Region: North East"</span> <span class="ot">=</span> <span class="st">"gor_nameNorth East"</span>,</span>
<span id="cb41-868"><a href="#cb41-868" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Region: North West"</span> <span class="ot">=</span> <span class="st">"gor_nameNorth West"</span>,</span>
<span id="cb41-869"><a href="#cb41-869" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Region: South West"</span> <span class="ot">=</span> <span class="st">"gor_nameSouth West"</span>,</span>
<span id="cb41-870"><a href="#cb41-870" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Region: West Midlands"</span> <span class="ot">=</span> <span class="st">"gor_nameWest Midlands"</span>,</span>
<span id="cb41-871"><a href="#cb41-871" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Region: Yorkshire and the Humber"</span> <span class="ot">=</span> <span class="st">"gor_nameYorkshire and the Humber"</span>,</span>
<span id="cb41-872"><a href="#cb41-872" aria-hidden="true" tabindex="-1"></a>  <span class="st">"% Low Prior Attainment"</span> <span class="ot">=</span> <span class="st">"PTPRIORLO"</span>,</span>
<span id="cb41-873"><a href="#cb41-873" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Admissions: Non-selective in Highly Selective Area"</span> <span class="ot">=</span> <span class="st">"ADMPOL_PTNON SEL IN HIGHLY SEL AREA"</span>,</span>
<span id="cb41-874"><a href="#cb41-874" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Admissions: Selective"</span> <span class="ot">=</span> <span class="st">"ADMPOL_PTSEL"</span></span>
<span id="cb41-875"><a href="#cb41-875" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-876"><a href="#cb41-876" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-877"><a href="#cb41-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-880"><a href="#cb41-880" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-881"><a href="#cb41-881" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jtools)</span>
<span id="cb41-882"><a href="#cb41-882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-883"><a href="#cb41-883" aria-hidden="true" tabindex="-1"></a><span class="fu">export_summs</span>(</span>
<span id="cb41-884"><a href="#cb41-884" aria-hidden="true" tabindex="-1"></a>  england_model3, england_model4, england_model5, england_model6, england_model7, </span>
<span id="cb41-885"><a href="#cb41-885" aria-hidden="true" tabindex="-1"></a>  <span class="at">robust =</span> <span class="st">"HC3"</span>,</span>
<span id="cb41-886"><a href="#cb41-886" aria-hidden="true" tabindex="-1"></a>  <span class="at">coefs =</span> coef_names</span>
<span id="cb41-887"><a href="#cb41-887" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-888"><a href="#cb41-888" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-889"><a href="#cb41-889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-890"><a href="#cb41-890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-891"><a href="#cb41-891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-894"><a href="#cb41-894" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-895"><a href="#cb41-895" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb41-896"><a href="#cb41-896" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 10</span></span>
<span id="cb41-897"><a href="#cb41-897" aria-hidden="true" tabindex="-1"></a><span class="fu">check_model</span>(england_model7)</span>
<span id="cb41-898"><a href="#cb41-898" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-899"><a href="#cb41-899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-900"><a href="#cb41-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-903"><a href="#cb41-903" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-904"><a href="#cb41-904" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb41-905"><a href="#cb41-905" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb41-906"><a href="#cb41-906" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb41-907"><a href="#cb41-907" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb41-908"><a href="#cb41-908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-909"><a href="#cb41-909" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert fitted values back to original scale</span></span>
<span id="cb41-910"><a href="#cb41-910" aria-hidden="true" tabindex="-1"></a>england_filtered_clean <span class="ot">&lt;-</span> england_filtered_clean <span class="sc">%&gt;%</span></span>
<span id="cb41-911"><a href="#cb41-911" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb41-912"><a href="#cb41-912" aria-hidden="true" tabindex="-1"></a>    <span class="at">fitted_original =</span> <span class="fu">exp</span>(fitted7),</span>
<span id="cb41-913"><a href="#cb41-913" aria-hidden="true" tabindex="-1"></a>    <span class="at">highlight =</span> LANAME <span class="sc">==</span> <span class="st">"Brighton and Hove"</span>,</span>
<span id="cb41-914"><a href="#cb41-914" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">if_else</span>(highlight, SCHNAME.x, <span class="cn">NA_character_</span>)</span>
<span id="cb41-915"><a href="#cb41-915" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb41-916"><a href="#cb41-916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-917"><a href="#cb41-917" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter plot with layered points and full-model fit line</span></span>
<span id="cb41-918"><a href="#cb41-918" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(england_filtered_clean, <span class="fu">aes</span>(<span class="at">x =</span> fitted_original, <span class="at">y =</span> ATT8SCR)) <span class="sc">+</span></span>
<span id="cb41-919"><a href="#cb41-919" aria-hidden="true" tabindex="-1"></a>  <span class="co"># All schools in grey</span></span>
<span id="cb41-920"><a href="#cb41-920" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"grey80"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb41-921"><a href="#cb41-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-922"><a href="#cb41-922" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Brighton and Hove schools in orange</span></span>
<span id="cb41-923"><a href="#cb41-923" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">filter</span>(england_filtered_clean, highlight),</span>
<span id="cb41-924"><a href="#cb41-924" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> fitted_original, <span class="at">y =</span> ATT8SCR),</span>
<span id="cb41-925"><a href="#cb41-925" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"darkorange"</span>, <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb41-926"><a href="#cb41-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-927"><a href="#cb41-927" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Labels for Brighton and Hove schools</span></span>
<span id="cb41-928"><a href="#cb41-928" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">data =</span> <span class="fu">filter</span>(england_filtered_clean, highlight),</span>
<span id="cb41-929"><a href="#cb41-929" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">label =</span> label),</span>
<span id="cb41-930"><a href="#cb41-930" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> <span class="dv">3</span>, <span class="at">max.overlaps =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb41-931"><a href="#cb41-931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-932"><a href="#cb41-932" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Line of best fit for all schools</span></span>
<span id="cb41-933"><a href="#cb41-933" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb41-934"><a href="#cb41-934" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-935"><a href="#cb41-935" aria-hidden="true" tabindex="-1"></a><span class="co"># Mirror x and y axes</span></span>
<span id="cb41-936"><a href="#cb41-936" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb41-937"><a href="#cb41-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-938"><a href="#cb41-938" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-939"><a href="#cb41-939" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb41-940"><a href="#cb41-940" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb41-941"><a href="#cb41-941" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Observed vs Fitted ATT8SCR (Original Scale)"</span>,</span>
<span id="cb41-942"><a href="#cb41-942" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Modelled Attainment 8, 2022-23"</span>,</span>
<span id="cb41-943"><a href="#cb41-943" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Observed Attainment 8, 2022-23"</span></span>
<span id="cb41-944"><a href="#cb41-944" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb41-945"><a href="#cb41-945" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-946"><a href="#cb41-946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-949"><a href="#cb41-949" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-950"><a href="#cb41-950" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb41-951"><a href="#cb41-951" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb41-952"><a href="#cb41-952" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for Brighton and Hove only</span></span>
<span id="cb41-953"><a href="#cb41-953" aria-hidden="true" tabindex="-1"></a>brighton_data <span class="ot">&lt;-</span> england_filtered_clean <span class="sc">%&gt;%</span></span>
<span id="cb41-954"><a href="#cb41-954" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(LANAME <span class="sc">==</span> <span class="st">"Brighton and Hove"</span>)</span>
<span id="cb41-955"><a href="#cb41-955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-956"><a href="#cb41-956" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot with regression line</span></span>
<span id="cb41-957"><a href="#cb41-957" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(brighton_data, <span class="fu">aes</span>(<span class="at">x =</span> fitted_original, <span class="at">y =</span> ATT8SCR)) <span class="sc">+</span></span>
<span id="cb41-958"><a href="#cb41-958" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"darkorange"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb41-959"><a href="#cb41-959" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb41-960"><a href="#cb41-960" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> SCHNAME.x), <span class="at">max.overlaps =</span> <span class="dv">20</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb41-961"><a href="#cb41-961" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb41-962"><a href="#cb41-962" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb41-963"><a href="#cb41-963" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Observed vs Fitted ATT8SCR for Brighton and Hove Schools"</span>,</span>
<span id="cb41-964"><a href="#cb41-964" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Modelled Attainment 8, 2022-23"</span>,</span>
<span id="cb41-965"><a href="#cb41-965" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Observed Attainment 8, 2022-23"</span></span>
<span id="cb41-966"><a href="#cb41-966" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb41-967"><a href="#cb41-967" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-968"><a href="#cb41-968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-971"><a href="#cb41-971" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-972"><a href="#cb41-972" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb41-973"><a href="#cb41-973" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb41-974"><a href="#cb41-974" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb41-975"><a href="#cb41-975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-976"><a href="#cb41-976" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate residuals and filter for Brighton and Hove</span></span>
<span id="cb41-977"><a href="#cb41-977" aria-hidden="true" tabindex="-1"></a>brighton_residuals <span class="ot">&lt;-</span> england_filtered_clean <span class="sc">%&gt;%</span></span>
<span id="cb41-978"><a href="#cb41-978" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(LANAME <span class="sc">==</span> <span class="st">"Brighton and Hove"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb41-979"><a href="#cb41-979" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb41-980"><a href="#cb41-980" aria-hidden="true" tabindex="-1"></a>    <span class="at">fitted_original =</span> <span class="fu">exp</span>(fitted7),</span>
<span id="cb41-981"><a href="#cb41-981" aria-hidden="true" tabindex="-1"></a>    <span class="at">residual =</span> ATT8SCR <span class="sc">-</span> fitted_original,</span>
<span id="cb41-982"><a href="#cb41-982" aria-hidden="true" tabindex="-1"></a>    <span class="at">abs_residual =</span> <span class="fu">abs</span>(residual)</span>
<span id="cb41-983"><a href="#cb41-983" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb41-984"><a href="#cb41-984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-985"><a href="#cb41-985" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a bar plot centered on zero</span></span>
<span id="cb41-986"><a href="#cb41-986" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(brighton_residuals, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(SCHNAME.x, residual), <span class="at">y =</span> residual)) <span class="sc">+</span></span>
<span id="cb41-987"><a href="#cb41-987" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"darkorange"</span>) <span class="sc">+</span></span>
<span id="cb41-988"><a href="#cb41-988" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"grey40"</span>) <span class="sc">+</span></span>
<span id="cb41-989"><a href="#cb41-989" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb41-990"><a href="#cb41-990" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb41-991"><a href="#cb41-991" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb41-992"><a href="#cb41-992" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Residuals of ATT8SCR for Brighton and Hove Schools"</span>,</span>
<span id="cb41-993"><a href="#cb41-993" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"School"</span>,</span>
<span id="cb41-994"><a href="#cb41-994" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Residual (Observed - Fitted)"</span></span>
<span id="cb41-995"><a href="#cb41-995" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb41-996"><a href="#cb41-996" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-997"><a href="#cb41-997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-998"><a href="#cb41-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-999"><a href="#cb41-999" aria-hidden="true" tabindex="-1"></a><span class="fu">## Task 5 - Interacting Variables (Extension activity)</span></span>
<span id="cb41-1000"><a href="#cb41-1000" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1001"><a href="#cb41-1001" aria-hidden="true" tabindex="-1"></a>In the lecture, you saw how we could look at how some of the continuous variables (like disadvantage or absence) vary by categorical variable levels (like region). Or indeed, whether continuous variables might interact with each other - for example do levels of unauthorised absence and disadvantage affect each other. </span>
<span id="cb41-1002"><a href="#cb41-1002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1003"><a href="#cb41-1003" aria-hidden="true" tabindex="-1"></a>As you saw in the lecture, interpreting interactions can be complex, so here I would just like you to have a brief experiment with some of the variables in your best model. </span>
<span id="cb41-1004"><a href="#cb41-1004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1005"><a href="#cb41-1005" aria-hidden="true" tabindex="-1"></a>If you are struggling to understand these effects, again, an AI helper like Gemini or ChatGPT might help you understand these interactions if you feed it your model outputs. </span>
<span id="cb41-1006"><a href="#cb41-1006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1007"><a href="#cb41-1007" aria-hidden="true" tabindex="-1"></a>Most of the time in most of the regression models you build, you might not need to interact variables, but it can be informative. Next week, however, we will look at other alternatives to interacting variables when we move onto linear mixed effects models. So at this point, just some experimentation is what I would like you to achieve. </span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 2025–, Huanfa Chen, Adam Dennett, Bea Taylor</p>
</div>   
    <div class="nav-footer-center">
<p><img src="../img/logo/logo_only_sm.png" height="25"> Quantitative Methods</p>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/huanfachen/QM/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
<li class="nav-item compact">
    <a class="nav-link" href="https://github.com/huanfachen/QM">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/huanfa-chen/">
      <i class="bi bi-LinkedIn" role="img">
</i> 
    </a>
  </li>  
</ul>
</div>
  </div>
</footer><script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>


</body></html>