<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Prof D’s Regression Sessions - Vol 1 – Quantitative Methods</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="..//img/favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-0a64b63d52573e9083ac7ef925da3e11.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-0a64b63d52573e9083ac7ef925da3e11.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-0a64b63d52573e9083ac7ef925da3e11.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-5457fb42737ce7af87b82faab80c0026.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-5457fb42737ce7af87b82faab80c0026.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-5457fb42737ce7af87b82faab80c0026.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script src="../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><link href="../site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="../site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script><script src="../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><link href="../site_libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="../site_libs/leaflet-1.3.1/leaflet.js"></script><link href="../site_libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="../site_libs/proj4-2.6.2/proj4.min.js"></script><script src="../site_libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="../site_libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="../site_libs/leaflet-binding-2.2.3/leaflet.js"></script><script src="../site_libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script><script src="../site_libs/leaflet-providers-plugin-2.2.3/leaflet-providers-plugin.js"></script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
<meta property="og:title" content="Prof D’s Regression Sessions - Vol 1 – Quantitative Methods">
<meta property="og:description" content="AKA - Applied Linear Regression - Basics">
<meta property="og:image" content="https://adamdennett.github.io/QM/sessions/L6_images/python-logo-only.png">
<meta property="og:site_name" content="Foundations">
<meta property="og:locale" content="en_GB">
<meta property="og:image:height" content="326">
<meta property="og:image:width" content="269">
</head>
<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-md " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../img/logo/logo_only_sm.png" alt="" class="navbar-logo light-content"><img src="../img/logo/logo_only_sm.png" alt="" class="navbar-logo dark-content"></a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Quantitative Methods</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../setup/index.html"> 
<span class="menu-text">Setup</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-week-by-week" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Week-by-Week</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-week-by-week">
<li>
    <a class="dropdown-item" href="../sessions/index.html">
 <span class="dropdown-text">Overview</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Part 1: Basics</li>
        <li>
    <a class="dropdown-item" href="../sessions/week1.html">
 <span class="dropdown-text">1. Explanatory Data Analysis #1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week2.html">
 <span class="dropdown-text">2. Explanatory Data Analysis #2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week3.html">
 <span class="dropdown-text">3. Hypothesis Testing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week4.html">
 <span class="dropdown-text">4. Introduction to Linear Algebra</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Part 2: Correlation and Regression</li>
        <li>
    <a class="dropdown-item" href="../sessions/week5.html">
 <span class="dropdown-text">5. Measuring Relationship</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week6.html">
 <span class="dropdown-text">6. Introduction to Regression</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week7.html">
 <span class="dropdown-text">7. Multiple Regression</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week8.html">
 <span class="dropdown-text">8. Multilevel Regression</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Part 3: Dimension Reduction &amp; Clustering</li>
        <li>
    <a class="dropdown-item" href="../sessions/week9.html">
 <span class="dropdown-text">9. Dimension Reduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week10.html">
 <span class="dropdown-text">10. Clustering</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../references.qmd">
 <span class="dropdown-text">Bibliography</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-assessments" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Assessments</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-assessments">
<li>
    <a class="dropdown-item" href="../assessments/index.html">
 <span class="dropdown-text">Overview</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item">
    <a class="nav-link" href="../help.html"> 
<span class="menu-text">Getting Help</span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#preamble" id="toc-preamble" class="nav-link active" data-scroll-target="#preamble">Preamble</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#aims" id="toc-aims" class="nav-link" data-scroll-target="#aims">Aims</a></li>
  <li>
<a href="#tasks" id="toc-tasks" class="nav-link" data-scroll-target="#tasks">Tasks</a>
  <ul class="collapse">
<li><a href="#downloading-download-and-read-data-into-your-software-environment" id="toc-downloading-download-and-read-data-into-your-software-environment" class="nav-link" data-scroll-target="#downloading-download-and-read-data-into-your-software-environment">1. Downloading: Download and read data into your software environment:</a></li>
  <li><a href="#data-munging-join-filter-select-and-subset" id="toc-data-munging-join-filter-select-and-subset" class="nav-link" data-scroll-target="#data-munging-join-filter-select-and-subset">2. Data Munging: Join, filter, select and subset:</a></li>
  <li><a href="#exploratory-data-analysis" id="toc-exploratory-data-analysis" class="nav-link" data-scroll-target="#exploratory-data-analysis">3. Exploratory Data Analysis</a></li>
  <li><a href="#explanatory-data-analysis---attainment-and-factors-affecting-it-in-different-parts-of-england" id="toc-explanatory-data-analysis---attainment-and-factors-affecting-it-in-different-parts-of-england" class="nav-link" data-scroll-target="#explanatory-data-analysis---attainment-and-factors-affecting-it-in-different-parts-of-england">4. Explanatory Data Analysis - Attainment and Factors Affecting it in Different Parts of England</a></li>
  </ul>
</li>
  <li><a href="#task-1---download-your-data-and-read-into-your-software-environment" id="toc-task-1---download-your-data-and-read-into-your-software-environment" class="nav-link" data-scroll-target="#task-1---download-your-data-and-read-into-your-software-environment">Task 1 - Download your data and read into your software environment</a></li>
  <li><a href="#task-2---data-munging" id="toc-task-2---data-munging" class="nav-link" data-scroll-target="#task-2---data-munging">Task 2 - Data Munging</a></li>
  <li><a href="#task-2-continued---filtering-selecting-and-subsetting" id="toc-task-2-continued---filtering-selecting-and-subsetting" class="nav-link" data-scroll-target="#task-2-continued---filtering-selecting-and-subsetting">Task 2 (continued) - Filtering, Selecting and Subsetting</a></li>
  <li><a href="#task-3---further-exploratory-analysis-and-visual-modelling" id="toc-task-3---further-exploratory-analysis-and-visual-modelling" class="nav-link" data-scroll-target="#task-3---further-exploratory-analysis-and-visual-modelling">Task 3 - Further Exploratory Analysis and Visual Modelling</a></li>
  <li>
<a href="#task-4---explanatory-analysis---running-your-regression-model" id="toc-task-4---explanatory-analysis---running-your-regression-model" class="nav-link" data-scroll-target="#task-4---explanatory-analysis---running-your-regression-model">Task 4 - Explanatory Analysis - Running Your Regression Model</a>
  <ul class="collapse">
<li><a href="#linearity" id="toc-linearity" class="nav-link" data-scroll-target="#linearity">Linearity</a></li>
  <li><a href="#homoscedasticity-constant-variance" id="toc-homoscedasticity-constant-variance" class="nav-link" data-scroll-target="#homoscedasticity-constant-variance">Homoscedasticity (Constant variance)?</a></li>
  <li><a href="#normality-of-residuals" id="toc-normality-of-residuals" class="nav-link" data-scroll-target="#normality-of-residuals">Normality of Residuals</a></li>
  <li><a href="#influence-of-outliers" id="toc-influence-of-outliers" class="nav-link" data-scroll-target="#influence-of-outliers">Influence of Outliers</a></li>
  <li><a href="#what-does-my-model-show" id="toc-what-does-my-model-show" class="nav-link" data-scroll-target="#what-does-my-model-show">What does my model show?</a></li>
  <li><a href="#your-turn" id="toc-your-turn" class="nav-link" data-scroll-target="#your-turn">Your Turn</a></li>
  </ul>
</li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/huanfachen/QM/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="week6_practical.ipynb" download="week6_practical.ipynb"><i class="bi bi-journal-code"></i>Jupyter</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Prof D’s Regression Sessions - Vol 1</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">AKA - Applied Linear Regression - Basics</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><iframe data-testid="embed-iframe" style="border-radius:12px" src="https://open.spotify.com/embed/track/1f2SbTAoE90QelFZlrpzxT?utm_source=generator" width="100%" height="352" frameborder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
<section id="preamble" class="level2"><h2 class="anchored" data-anchor-id="preamble">Preamble</h2>
<p>Over the next 3 weeks we are going <strong>DEEP</strong> into linear regression. The QM Regression Sessions will be tough, but we will be eased through the journey in the company of LTJ Bukem, Blame, Conrad and others. Plug into the Progression Sessions, let them sooth your mind and allow you to get fully into the Regression Sessions!</p>
</section><section id="introduction" class="level2"><h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>This week’s practical is focused on understanding the most basic form of regression analysis, but in an applied context discovering what these models help you understand about your data in great detail. You will essentially re-create some of the analysis you saw in the lecture, but for slightly different variables and for different places.</p>
<p>Most of what you will be doing in this practical won’t actually be modelling - although this will come at the end - but you will be getting to know your data so that your final models make sense. This is how it should be!! Going back to our bake-off analogy, the modelling is really just the final bake after hours of preparation.</p>
</section><section id="aims" class="level2"><h2 class="anchored" data-anchor-id="aims">Aims</h2>
<p>By the end of this week’s regression session you should:</p>
<ul>
<li>Be able to use R or Python to process data in order to carry out a scientific investigation</li>
<li>Feel comfortable in plotting and visualising that processed data to assess relationships between x and y variables</li>
<li>Understand how to use built-in statistical software functions in R and Python to run specify and a basic regression model and produce statistical outputs from those models</li>
<li>Interpret those model outputs critically in order to evaluate the strenght and direction of the relationships you are observing.</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Below you will find code-blocks that will allow you to run your analysis in either R or Python. It’s up to you which you decide to use - you might even want to try both to compare (Of course, R will be better)!</p>
<p>The Juypter notebook attached to this practical <em>might</em> work, but you are probably better off just firing up RStudio or VS code, creating a new notebook and editing from scratch on your local machine.</p>
</div>
</div>
</section><section id="tasks" class="level2"><h2 class="anchored" data-anchor-id="tasks">Tasks</h2>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Make sure you complete each of the tasks below, 1-4. All of these will be covered in the code examples as you work your way down the page, but this is the full <a href="https://dictionary.cambridge.org/dictionary/english/workflow">workflow</a>:</p>
</div>
</div>
<section id="downloading-download-and-read-data-into-your-software-environment" class="level3"><h3 class="anchored" data-anchor-id="downloading-download-and-read-data-into-your-software-environment">1. Downloading: Download and read data into your software environment:</h3>
<ul>
<li><p>School locational and attribute information, downloaded from here - <a href="https://get-information-schools.service.gov.uk/Downloads" class="uri">https://get-information-schools.service.gov.uk/Downloads</a> - or read it in using the code supplied below. This will include the following datasets:</p></li>
<li><p><strong>edubase_schools</strong> = this is the ‘all establishment’ data for every school in England and Wales</p></li>
<li>
<p>School-level Key Stage 4 (14-16 GCSE level) attainment and other attribute information. <a href="https://moodle.ucl.ac.uk/mod/folder/view.php?id=8199904">I have put this on Moodle here</a>, but it can also be downloaded from here - <a href="https://www.compare-school-performance.service.gov.uk/download-data" class="uri">https://www.compare-school-performance.service.gov.uk/download-data</a>.</p>
<p>Download to a local drive on your computer from Moodle, unzip it and then read it in using the code supplied below. The zip folders contain the following data files in one folder and the associated metadata in the other folder:</p>
<ol type="a">
<li><p><strong>england_ks4final</strong> = data on the 2022/23 academic year, school-level, KS4 outcomes and associated statistics</p></li>
<li><p><strong>england_abs</strong> = data on the 2022/23 academic year, school-level absence rates</p></li>
<li><p><strong>england_census</strong> = additional school-level pupil information for the 2022/23 academic year</p></li>
<li><p><strong>england_school_information</strong> = additional school-level institution information such as Ofsted rating etc. for the 2022/23 academic year</p></li>
<li><p><strong>england_ks4_pupdest</strong> = pupil destination data (where students go once they leave school at 16)</p></li>
</ol>
</li>
</ul></section><section id="data-munging-join-filter-select-and-subset" class="level3"><h3 class="anchored" data-anchor-id="data-munging-join-filter-select-and-subset">2. Data Munging: Join, filter, select and subset:</h3>
<ul>
<li>Create a master file for England called <strong>england_school_2022_23.</strong> This will be made by joining together all of the school-level data above into a single file and then reducing it in size using:
<ol type="a">
<li>
<strong>filter</strong> - so that it just contains open secondary schools</li>
<li>
<strong>select</strong> - so that only a few key variables relating to attainment, progress, deprivation, absence and school quality remain, alongside key locational and other attributes.</li>
</ol>
</li>
<li>Create two local authority data <strong>subsets</strong> from this main file:
<ol type="a">
<li>A subset containing all of the secondary schools in one of the 32 London Boroughs (not including the City of London)</li>
<li>A subset containing all of the secondary schools in any other local authority in England. Any local authority you like - go wild!</li>
</ol>
</li>
</ul>
<p>At the end of this you will have <strong>x3 datasets</strong> - one national and two local authority subsets</p>
</section><section id="exploratory-data-analysis" class="level3"><h3 class="anchored" data-anchor-id="exploratory-data-analysis">3. Exploratory Data Analysis</h3>
<ul>
<li>Choose:
<ol type="a">
<li>one attainment related dependent variable from your set</li>
<li>one possible explanatory variable which you think might help explain levels of attainment in schools</li>
</ol>
</li>
<li>Create a series of graphs and statistical outputs to allow you to understand the structure and composition of your data. You should produce:
<ol type="a">
<li>A histogram for the dependent and independent variables you are analysing for <strong>both your two subsets</strong> and the <strong>national dataset</strong> (x6 histograms in total). You might want to augment your histograms to include:
<ol type="i">
<li>mean and median lines</li>
<li>lines for the upper and lower quartiles</li>
<li>indications of outliners</li>
<li>a kernel density smoothing</li>
</ol>
</li>
<li>Alternative plots such as violin plots or box plots to compare with the histogram</li>
<li>Point Maps of the locations of your schools in your two subsets - points sized by either of your variables</li>
<li>A scatter plot of your dependent (attainment) and independent (disadvantage) variables (national and two local subsets) - on these plots you might want to include:
<ol type="i">
<li>a regression line of best fit</li>
<li>the R-squared, slope and intercept parameters</li>
</ol>
</li>
</ol>
</li>
</ul></section><section id="explanatory-data-analysis---attainment-and-factors-affecting-it-in-different-parts-of-england" class="level3"><h3 class="anchored" data-anchor-id="explanatory-data-analysis---attainment-and-factors-affecting-it-in-different-parts-of-england">4. Explanatory Data Analysis - Attainment and Factors Affecting it in Different Parts of England</h3>
<ul>
<li>Carry out a bi-variate regression analysis to explore the relationship between your chosen attainment dependent variable and your single explanatory independent variable, for your two subsets and the national dataset. <strong>Questions to Answer</strong>:
<ol type="a">
<li>After visualising the relationships using scatter plots, do you think you need to transform your variables (e.g.&nbsp;using a log transformation) before putting into a regression model? Maybe plot scatter plots of your logged variables too!</li>
<li>What are the slope and intercept coefficients in each model? Are they statistically significant and how do vary between your two subsets? How do they compare with the national picture?</li>
<li>How do the R-squared values differ and how reliable do you think they are (what do the degrees of freedom tell you)?</li>
<li>What observations can you make about your two local authority study areas relative to the national picture?</li>
</ol>
</li>
</ul></section></section><section id="task-1---download-your-data-and-read-into-your-software-environment" class="level2"><h2 class="anchored" data-anchor-id="task-1---download-your-data-and-read-into-your-software-environment">Task 1 - Download your data and read into your software environment</h2>
<ul>
<li>I’ve made this task easy for you by giving you the code to download all of this data. You’ll need to download a selection of files - click on either tab to see the code for each.</li>
<li>In order to run this code, you should first <a href="https://moodle.ucl.ac.uk/mod/folder/view.php?id=8199904">download and unzip the data from Moodle</a>, before editing the code below so that you can read the data from a local folder on your computer:</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>I would encourage you <strong>NOT</strong> to just copy and paste this code blindly, but try to understand what it is doing at each stage.</p>
<p>You may notice that there are some bits that are redundant (some of the NA code that I was messing with before deciding on a single way of removing NAs).</p>
<p>What am I doing to the URN field? Why might I be doing that?</p>
<p>What is the regex function doing and why might I be searching out those characters? What might happen to the data if I didn’t handle those first?</p>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset qna-question">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href=""><img src="L6_images/python-logo-only.png" class="img-fluid" width="30"></a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href=""><img src="L6_images/Rlogo.png" width="41" height="30"></a></li>
</ul>
<div class="tab-content qna-question">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> janitor</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># little function to define the file root on different machines</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_qm_root(start_path: Path <span class="op">=</span> Path.cwd(), anchor: <span class="bu">str</span> <span class="op">=</span> <span class="st">"QM"</span>) <span class="op">-&gt;</span> Path:</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">    Traverse up from the start_path until the anchor folder (e.g., 'QM')      is found. Returns the path to the anchor folder.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> parent <span class="kw">in</span> [start_path] <span class="op">+</span> <span class="bu">list</span>(start_path.parents):</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> parent.name <span class="op">==</span> anchor:</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> parent</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">FileNotFoundError</span>(<span class="ss">f"Anchor folder '</span><span class="sc">{</span>anchor<span class="sc">}</span><span class="ss">' not found in path      hierarchy."</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>qm_root <span class="op">=</span> find_qm_root()</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Read CSV file</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>edubase_schools <span class="op">=</span> pd.read_csv(</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"https://www.dropbox.com/scl/fi/fhzafgt27v30lmmuo084y/edubasealldata20241003.csv?rlkey=uorw43s44hnw5k9js3z0ksuuq&amp;raw=1"</span>,</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    encoding<span class="op">=</span><span class="st">"cp1252"</span>,</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    low_memory<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    dtype<span class="op">=</span>{<span class="st">"URN"</span>: <span class="bu">str</span>}</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>edubase_schools <span class="op">=</span> edubase_schools.clean_names()</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co">#py_edubase_schools.dtypes</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co">#dtype_df = py_edubase_schools.dtypes.reset_index()</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="co">#dtype_df.columns = ["column_name", "dtype"]</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="co">########################################</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Define base path and common NA values - </span><span class="al">NOTE</span><span class="co"> YOU WILL NEED TO DOWNLOAD THIS DATA AND PUT INTO YOUR OWN base_path LOCATION ON YOUR MACHINE - not this one as this is my path!!!</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="co">#base_path = Path("E:/QM/sessions/L6_data/Performancetables_130242/2022-2023")</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>base_path <span class="op">=</span> qm_root <span class="op">/</span> <span class="st">"sessions"</span> <span class="op">/</span> <span class="st">"L6_data"</span> <span class="op">/</span> <span class="st">"Performancetables_130242"</span> <span class="op">/</span> <span class="st">"2022-2023"</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="co">##################################################</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>na_values_common <span class="op">=</span> [<span class="st">""</span>, <span class="st">"NA"</span>, <span class="st">"SUPP"</span>, <span class="st">"NP"</span>, <span class="st">"NE"</span>]</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>na_values_extended <span class="op">=</span> na_values_common <span class="op">+</span> [<span class="st">"SP"</span>, <span class="st">"SN"</span>]</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>na_values_attainment <span class="op">=</span> na_values_extended <span class="op">+</span> [<span class="st">"LOWCOV"</span>, <span class="st">"NEW"</span>]</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>na_values_mats <span class="op">=</span> na_values_common <span class="op">+</span> [<span class="st">"SUPPMAT"</span>]</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>na_all <span class="op">=</span> [<span class="st">""</span>, <span class="st">"NA"</span>, <span class="st">"SUPP"</span>, <span class="st">"NP"</span>, <span class="st">"NE"</span>, <span class="st">"SP"</span>, <span class="st">"SN"</span>, <span class="st">"LOWCOV"</span>, <span class="st">"NEW"</span>, <span class="st">"SUPPMAT"</span>, <span class="st">"NaN"</span>]</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Absence data</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>england_abs <span class="op">=</span> pd.read_csv(base_path <span class="op">/</span> <span class="st">"england_abs.csv"</span>, na_values<span class="op">=</span>na_all, dtype<span class="op">=</span>{<span class="st">"URN"</span>: <span class="bu">str</span>})</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Census data</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>england_census <span class="op">=</span> pd.read_csv(base_path <span class="op">/</span> <span class="st">"england_census.csv"</span>, na_values<span class="op">=</span>na_all, dtype<span class="op">=</span>{<span class="st">"URN"</span>: <span class="bu">str</span>})</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>england_census.iloc[:, <span class="dv">4</span>:<span class="dv">23</span>] <span class="op">=</span> england_census.iloc[:, <span class="dv">4</span>:<span class="dv">23</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> col: pd.to_numeric(col.astype(<span class="bu">str</span>).<span class="bu">str</span>.replace(<span class="st">'%'</span>, <span class="st">''</span>, regex<span class="op">=</span><span class="va">False</span>), errors<span class="op">=</span><span class="st">"coerce"</span>))</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a><span class="co"># KS4 MATs performance data</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>england_ks4_mats_performance <span class="op">=</span> pd.read_csv(base_path <span class="op">/</span> <span class="st">"england_ks4-mats-performance.csv"</span>, na_values<span class="op">=</span>na_all, encoding<span class="op">=</span><span class="st">"cp1252"</span>, low_memory<span class="op">=</span><span class="va">False</span>, dtype<span class="op">=</span>{<span class="st">"URN"</span>: <span class="bu">str</span>})</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>england_ks4_mats_performance[<span class="st">"TRUST_UID"</span>] <span class="op">=</span> england_ks4_mats_performance[<span class="st">"TRUST_UID"</span>].astype(<span class="bu">str</span>)</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>england_ks4_mats_performance[<span class="st">"P8_BANDING"</span>] <span class="op">=</span> england_ks4_mats_performance[<span class="st">"P8_BANDING"</span>].astype(<span class="bu">str</span>)</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>england_ks4_mats_performance[<span class="st">"INSTITUTIONS_INMAT"</span>] <span class="op">=</span> england_ks4_mats_performance[<span class="st">"INSTITUTIONS_INMAT"</span>].astype(<span class="bu">str</span>)</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>cols_to_convert <span class="op">=</span> england_ks4_mats_performance.columns[<span class="dv">10</span>:]</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>exclude <span class="op">=</span> [<span class="st">"P8_BANDING"</span>, <span class="st">"INSTITUTIONS_INMAT"</span>]</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>cols_to_convert <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> cols_to_convert <span class="cf">if</span> col <span class="kw">not</span> <span class="kw">in</span> exclude]</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>england_ks4_mats_performance[cols_to_convert] <span class="op">=</span> england_ks4_mats_performance[cols_to_convert].<span class="bu">apply</span>(<span class="kw">lambda</span> col: pd.to_numeric(col.astype(<span class="bu">str</span>).<span class="bu">str</span>.replace(<span class="st">'%'</span>, <span class="st">''</span>, regex<span class="op">=</span><span class="va">False</span>), errors<span class="op">=</span><span class="st">"coerce"</span>))</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a><span class="co"># KS4 pupil destination data</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>england_ks4_pupdest <span class="op">=</span> pd.read_csv(base_path <span class="op">/</span> <span class="st">"england_ks4-pupdest.csv"</span>, na_values<span class="op">=</span>na_all, dtype<span class="op">=</span>{<span class="st">"URN"</span>: <span class="bu">str</span>})</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>england_ks4_pupdest.iloc[:, <span class="dv">7</span>:<span class="dv">82</span>] <span class="op">=</span> england_ks4_pupdest.iloc[:, <span class="dv">7</span>:<span class="dv">82</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> col: pd.to_numeric(col.astype(<span class="bu">str</span>).<span class="bu">str</span>.replace(<span class="st">'%'</span>, <span class="st">''</span>, regex<span class="op">=</span><span class="va">False</span>), errors<span class="op">=</span><span class="st">"coerce"</span>))</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a><span class="co"># KS4 final attainment data</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>england_ks4final <span class="op">=</span> pd.read_csv(base_path <span class="op">/</span> <span class="st">"england_ks4final.csv"</span>, na_values<span class="op">=</span>na_all, dtype<span class="op">=</span>{<span class="st">"URN"</span>: <span class="bu">str</span>})</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>start_col <span class="op">=</span> <span class="st">"TOTPUPS"</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>end_col <span class="op">=</span> <span class="st">"PTOTENT_E_COVID_IMPACTED_PTQ_EE"</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>cols_range <span class="op">=</span> england_ks4final.loc[:, start_col:end_col].columns</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Strip % signs and convert to numeric</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>england_ks4final[cols_range] <span class="op">=</span> england_ks4final[cols_range].<span class="bu">apply</span>(</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> col: pd.to_numeric(col.astype(<span class="bu">str</span>).<span class="bu">str</span>.replace(<span class="st">'%'</span>, <span class="st">''</span>, regex<span class="op">=</span><span class="va">False</span>), errors<span class="op">=</span><span class="st">"coerce"</span>)</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a><span class="co"># School information data</span></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>england_school_information <span class="op">=</span> pd.read_csv(</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>    base_path <span class="op">/</span> <span class="st">"england_school_information.csv"</span>,</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>    na_values<span class="op">=</span>na_all,</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>    dtype<span class="op">=</span>{<span class="st">"URN"</span>: <span class="bu">str</span>},</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>    parse_dates<span class="op">=</span>[<span class="st">"OFSTEDLASTINSP"</span>],</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>    dayfirst<span class="op">=</span><span class="va">True</span>  <span class="co"># Adjust if needed</span></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sfirke/janitor">janitor</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org">readr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/">here</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Read CSV file</span></span>
<span><span class="va">edubase_schools</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"https://www.dropbox.com/scl/fi/fhzafgt27v30lmmuo084y/edubasealldata20241003.csv?rlkey=uorw43s44hnw5k9js3z0ksuuq&amp;raw=1"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://sfirke.github.io/janitor/reference/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>urn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">urn</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#str(r_edubase_schools)</span></span>
<span></span>
<span><span class="co"># Define base path and common NA values - NOTE YOU WILL NEED TO DOWNLOAD THIS DATA AND PUT INTO YOUR OWN base_path LOCATION ON YOUR MACHINE</span></span>
<span><span class="va">base_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://here.r-lib.org/reference/here.html">here</a></span><span class="op">(</span><span class="st">"sessions"</span>, <span class="st">"L6_data"</span>, <span class="st">"Performancetables_130242"</span>, <span class="st">"2022-2023"</span><span class="op">)</span></span>
<span><span class="va">na_common</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"NA"</span>, <span class="st">"SUPP"</span>, <span class="st">"NP"</span>, <span class="st">"NE"</span><span class="op">)</span></span>
<span><span class="va">na_extended</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">na_common</span>, <span class="st">"SP"</span>, <span class="st">"SN"</span><span class="op">)</span></span>
<span><span class="va">na_attainment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">na_extended</span>, <span class="st">"LOWCOV"</span>, <span class="st">"NEW"</span><span class="op">)</span></span>
<span><span class="va">na_mats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">na_common</span>, <span class="st">"SUPPMAT"</span><span class="op">)</span></span>
<span><span class="va">na_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"NA"</span>, <span class="st">"SUPP"</span>, <span class="st">"NP"</span>, <span class="st">"NE"</span>, <span class="st">"SP"</span>, <span class="st">"SN"</span>, <span class="st">"LOWCOV"</span>, <span class="st">"NEW"</span>, <span class="st">"SUPPMAT"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Absence data</span></span>
<span><span class="va">england_abs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">base_path</span>, <span class="st">"england_abs.csv"</span><span class="op">)</span>, na <span class="op">=</span> <span class="va">na_all</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>URN <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">URN</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Other School Census data</span></span>
<span><span class="va">england_census</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">base_path</span>, <span class="st">"england_census.csv"</span><span class="op">)</span>, na <span class="op">=</span> <span class="va">na_all</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>URN <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">URN</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fl">5</span><span class="op">:</span><span class="fl">23</span>, <span class="op">~</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_number.html">parse_number</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># KS4 MATs performance data</span></span>
<span><span class="co">#First read</span></span>
<span><span class="va">england_ks4_mats_performance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">base_path</span>, <span class="st">"england_ks4-mats-performance.csv"</span><span class="op">)</span>,</span>
<span>  na <span class="op">=</span> <span class="va">na_all</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    TRUST_UID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">TRUST_UID</span><span class="op">)</span>,</span>
<span>    P8_BANDING <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">P8_BANDING</span><span class="op">)</span>,</span>
<span>    INSTITUTIONS_INMAT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">INSTITUTIONS_INMAT</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Then Identify columns to convert (excluding character columns)</span></span>
<span><span class="va">cols_to_convert</span> <span class="op">&lt;-</span> <span class="va">england_ks4_mats_performance</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>, <span class="op">-</span><span class="va">P8_BANDING</span>, <span class="op">-</span><span class="va">INSTITUTIONS_INMAT</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Then apply parse_number safely to convert characters to numbers</span></span>
<span><span class="va">england_ks4_mats_performance</span> <span class="op">&lt;-</span> <span class="va">england_ks4_mats_performance</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">cols_to_convert</span><span class="op">)</span>, <span class="op">~</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_number.html">parse_number</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># KS4 pupil destination data</span></span>
<span><span class="va">england_ks4_pupdest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">base_path</span>, <span class="st">"england_ks4-pupdest.csv"</span><span class="op">)</span>, na <span class="op">=</span> <span class="va">na_all</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>URN <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">URN</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fl">8</span><span class="op">:</span><span class="fl">82</span>, <span class="op">~</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_number.html">parse_number</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># KS4 final attainment data</span></span>
<span><span class="va">england_ks4final</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">base_path</span>, <span class="st">"england_ks4final.csv"</span><span class="op">)</span>, na <span class="op">=</span> <span class="va">na_all</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>URN <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">URN</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="va">TOTPUPS</span><span class="op">:</span><span class="va">PTOTENT_E_COVID_IMPACTED_PTQ_EE</span>, <span class="op">~</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_number.html">parse_number</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># School information data</span></span>
<span><span class="va">england_school_information</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">base_path</span>, <span class="st">"england_school_information.csv"</span><span class="op">)</span>,</span>
<span>  na <span class="op">=</span> <span class="va">na_all</span>,</span>
<span>  col_types <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html">cols</a></span><span class="op">(</span></span>
<span>    URN <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html">col_character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    OFSTEDLASTINSP <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_datetime.html">col_date</a></span><span class="op">(</span>format <span class="op">=</span> <span class="st">"%d-%m-%Y"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</div>
</div>
</section><section id="task-2---data-munging" class="level2"><h2 class="anchored" data-anchor-id="task-2---data-munging">Task 2 - Data Munging</h2>
<ul>
<li>Use Python or R to join all of the datasets you loaded in the previous step into a single master file that we will called <code>england_school_2022_23</code> using the unique school reference number (URN) as the key.</li>
<li>Create the master file:</li>
</ul>
<div class="tabset-margin-container"></div><div class="panel-tabset qna-question">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true" href=""><img src="L6_images/python-logo-only.png" class="img-fluid" width="30"></a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false" href=""><img src="L6_images/Rlogo.png" width="41" height="30"></a></li>
</ul>
<div class="tab-content qna-question">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Left join england_ks4final with england_abs, census, and school information</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>england_school_2022_23 <span class="op">=</span> (</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    england_ks4final</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    .merge(england_abs, on<span class="op">=</span><span class="st">"URN"</span>, how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    .merge(england_census, on<span class="op">=</span><span class="st">"URN"</span>, how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    .merge(england_school_information, on<span class="op">=</span><span class="st">"URN"</span>, how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    .merge(edubase_schools, left_on<span class="op">=</span><span class="st">"URN"</span>, right_on<span class="op">=</span><span class="st">"urn"</span>, how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Left join england_ks4final with england_abs</span></span>
<span><span class="va">england_school_2022_23</span> <span class="op">&lt;-</span> <span class="va">england_ks4final</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">england_abs</span>, by <span class="op">=</span> <span class="st">"URN"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">england_census</span>, by <span class="op">=</span> <span class="st">"URN"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">england_school_information</span>, by <span class="op">=</span> <span class="st">"URN"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">edubase_schools</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"URN"</span> <span class="op">=</span> <span class="st">"urn"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</div>
</div>
<section id="iterative-checking-and-initial-exploratory-analysis" class="level4"><h4 class="anchored" data-anchor-id="iterative-checking-and-initial-exploratory-analysis">Iterative Checking and initial exploratory analysis</h4>
<ul>
<li>It’s never too soon to start exploring your data - even (or indeed especially) in the data ‘munging’ (processing, cleaning etc.) stage.</li>
<li>You will probably find yourself iteratively plotting, filtering, plotting again, switching variables, plotting again, over and over again until you are happy with the data you have. This is all part of the Exploratory Data Analysis Process and vital before applying any other methods to your data!</li>
<li>If you recall from the lecture, the histogram of attainment 8 in the whole of England dataset looked a bit odd:</li>
</ul>
<div class="tabset-margin-container"></div><div class="panel-tabset qna-question multicode">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true" href=""><img src="L6_images/python-logo-only.png" class="img-fluid" width="30"></a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false" href=""><img src="L6_images/Rlogo.png" width="41" height="30"></a></li>
</ul>
<div class="tab-content qna-question multicode">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute statistics</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>median_value <span class="op">=</span> england_school_2022_23[<span class="st">"ATT8SCR"</span>].median(skipna<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>mean_value <span class="op">=</span> england_school_2022_23[<span class="st">"ATT8SCR"</span>].mean(skipna<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>sd_value <span class="op">=</span> england_school_2022_23[<span class="st">"ATT8SCR"</span>].std(skipna<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up the figure</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogram with density</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>sns.histplot(</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>england_school_2022_23,</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"ATT8SCR"</span>,</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    stat<span class="op">=</span><span class="st">"density"</span>,</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    binwidth<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">"#4E3C56"</span>,</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.4</span>,</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    linewidth<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    edgecolor<span class="op">=</span><span class="st">"white"</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Overlay normal distribution curve</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>x_vals <span class="op">=</span> np.linspace(</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>    england_school_2022_23[<span class="st">"ATT8SCR"</span>].<span class="bu">min</span>(),</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    england_school_2022_23[<span class="st">"ATT8SCR"</span>].<span class="bu">max</span>(),</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    <span class="dv">500</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>normal_density <span class="op">=</span> (</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span> <span class="op">/</span> (sd_value <span class="op">*</span> np.sqrt(<span class="dv">2</span> <span class="op">*</span> np.pi))</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>) <span class="op">*</span> np.exp(<span class="op">-</span><span class="fl">0.5</span> <span class="op">*</span> ((x_vals <span class="op">-</span> mean_value) <span class="op">/</span> sd_value) <span class="op">**</span> <span class="dv">2</span>)</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>plt.plot(x_vals, normal_density, color<span class="op">=</span><span class="st">"#2E6260"</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Add vertical lines for median and mean</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>plt.axvline(median_value, color<span class="op">=</span><span class="st">"black"</span>, linestyle<span class="op">=</span><span class="st">"dotted"</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>plt.axvline(mean_value, color<span class="op">=</span><span class="st">"#F9DD73"</span>, linestyle<span class="op">=</span><span class="st">"solid"</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Annotate median and mean</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>plt.text(median_value, plt.gca().get_ylim()[<span class="dv">1</span>]<span class="op">*</span><span class="fl">0.95</span>, <span class="ss">f"Median = </span><span class="sc">{</span>median_value<span class="sc">:.1f}</span><span class="ss">"</span>,</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">"black"</span>, ha<span class="op">=</span><span class="st">"center"</span>, va<span class="op">=</span><span class="st">"top"</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>plt.text(mean_value, plt.gca().get_ylim()[<span class="dv">1</span>]<span class="op">*</span><span class="fl">0.85</span>, <span class="ss">f"Mean = </span><span class="sc">{</span>mean_value<span class="sc">:.1f}</span><span class="ss">"</span>,</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">"#F9DD73"</span>, ha<span class="op">=</span><span class="st">"center"</span>, va<span class="op">=</span><span class="st">"top"</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize labels and theme</span></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Attainment 8 - All Schools England and Wales, 2022/23 Academic Year"</span>)</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Attainment 8 Score"</span>)</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Density"</span>)</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>sns.despine()</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the plot</span></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.show()</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><a href="week6_practical_files/figure-html/unnamed-chunk-7-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="week6_practical_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="960"></a></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">median_value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">england_school_2022_23</span><span class="op">$</span><span class="va">ATT8SCR</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">mean_value</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">england_school_2022_23</span><span class="op">$</span><span class="va">ATT8SCR</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">sd_value</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">england_school_2022_23</span><span class="op">$</span><span class="va">ATT8SCR</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">england_school_2022_23</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">ATT8SCR</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">..density..</span><span class="op">)</span>, binwidth <span class="op">=</span> <span class="fl">1</span>, fill <span class="op">=</span> <span class="st">"#4E3C56"</span>, alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html">stat_function</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">dnorm</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="va">mean_value</span>, sd <span class="op">=</span> <span class="va">sd_value</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"#2E6260"</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">median_value</span>, color <span class="op">=</span> <span class="st">"black"</span>, linetype <span class="op">=</span> <span class="st">"dotted"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">mean_value</span>, color <span class="op">=</span> <span class="st">"#F9DD73"</span>, linetype <span class="op">=</span> <span class="st">"solid"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>,</span>
<span>           x <span class="op">=</span> <span class="va">median_value</span>, y <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>           label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Median = "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">median_value</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>           vjust <span class="op">=</span> <span class="fl">1.3</span>, color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">3.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>,</span>
<span>           x <span class="op">=</span> <span class="va">mean_value</span>, y <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>           label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Mean = "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">mean_value</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>           vjust <span class="op">=</span> <span class="fl">30.5</span>, color <span class="op">=</span> <span class="st">"#F9DD73"</span>, size <span class="op">=</span> <span class="fl">3.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html">expansion</a></span><span class="op">(</span>mult <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.08</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Attainment 8 - All Schools England and Wales, 2022/23 Academic Year"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Attainment 8 Score"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Density"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><a href="week6_practical_files/figure-html/unnamed-chunk-8-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="week6_practical_files/figure-html/unnamed-chunk-8-3.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<ul>
<li>You may also recall from the lecture that this odd distribution was related to different types of school in the system. We can create a similar visualisation here:</li>
</ul>
<div class="tabset-margin-container"></div><div class="panel-tabset qna-question multicode">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true" href=""><img src="L6_images/python-logo-only.png" class="img-fluid" width="30"></a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false" href=""><img src="L6_images/Rlogo.png" width="41" height="30"></a></li>
</ul>
<div class="tab-content qna-question multicode">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up the figure</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplot grouped by MINORGROUP</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>sns.boxplot(</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'ATT8SCR'</span>,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>england_school_2022_23,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">"#EDD971"</span>,</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    fliersize<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    linewidth<span class="op">=</span><span class="dv">1</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Jittered points</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>sns.stripplot(</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'ATT8SCR'</span>,</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>england_school_2022_23,</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    hue<span class="op">=</span><span class="st">'MINORGROUP'</span>,</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    dodge<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    jitter<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    size<span class="op">=</span><span class="dv">4</span>,</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    palette<span class="op">=</span><span class="st">'turbo'</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize the plot</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Attainment 8 - All Schools 2022/23 Academic Year"</span>)</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Attainment 8 Score"</span>)</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">""</span>)</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">"School Type"</span>, loc<span class="op">=</span><span class="st">'lower center'</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.25</span>), ncol<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>sns.despine()</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the plot</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><a href="week6_practical_files/figure-html/unnamed-chunk-9-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="week6_practical_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="1152"></a></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">england_school_2022_23</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">ATT8SCR</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#EDD971"</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>, outlier.shape <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span>    </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">MINORGROUP</span><span class="op">)</span>, height <span class="op">=</span> <span class="fl">0.2</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_colour_viridis_d</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"turbo"</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># applies the default casaviz discrete palette</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Attainment 8 - All Schools 2022/23 Academic Year"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Attainment 8 Score"</span>,</span>
<span>    y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    colour <span class="op">=</span> <span class="st">"School Type"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>    legend.key.size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">10</span>, <span class="st">"mm"</span><span class="op">)</span>,   <span class="co"># increase dot space</span></span>
<span>    legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>  <span class="co"># optional: larger legend labels</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><a href="week6_practical_files/figure-html/unnamed-chunk-10-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="week6_practical_files/figure-html/unnamed-chunk-10-3.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section id="further-filtering-and-subsetting" class="level4"><h4 class="anchored" data-anchor-id="further-filtering-and-subsetting">Further filtering and subsetting</h4>
<ul>
<li>Having joined all of these data frames into a single master dataframe for the whole of England and observed some issues, we will need to filter out some of the rows we don’t want and the columns that we don’t need</li>
<li>In the two folders you downloaded from Moodle, one contains all of the data we need, the other contains all of the metadata which tells us what the variables are</li>
<li>If you open up, for example <code>ks4_meta.xlsx</code> these are the variables related to attainment for each school.</li>
<li>Similarly <code>abbreviations.xlsx</code> attaches some meaning to some of the codes associated with some of these variables, with other metadata files containing other info. Take some time to look at these so you understand the range of variables we’ll be exploring.</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>One of the key filtering asks carried out in the code below is to filter the schools so that we only retain the maintained schools and the academies in the dataset</p>
</div>
</div>
</section></section><section id="task-2-continued---filtering-selecting-and-subsetting" class="level2"><h2 class="anchored" data-anchor-id="task-2-continued---filtering-selecting-and-subsetting">Task 2 (continued) - Filtering, Selecting and Subsetting</h2>
<p>The Code Below already has the syntax to allow you to filter your dataset and drop special schools, independent schools and colleges.</p>
<p>It also contains the start of some code to allow you to select a smaller set of variables from the 700-odd in the main file.</p>
<ol type="1">
<li>Adapt this Python or R code so that it contains these variables plus the additional variables listed below (see the note about how you may need to adjust the names depending on whether using Python or R). - You should end up with 34 in total</li>
<li>Once you have created this filtered and reduced file called <code>england_filtered</code>, write it out as a csv (e.g.&nbsp;england_filtered.csv) and save to your local working directory - we will use it again in future practicals</li>
<li>Now you have your <code>england_filtered</code> file, use this code below as the template for creating two new data subsets:
<ol type="a">
<li>london_borough_sub</li>
<li>england_lad_sub These two new files should create a subset which has filtered on the name or code of a London borough and another local authority in England</li>
</ol>
</li>
</ol>
<div class="tabset-margin-container"></div><div class="panel-tabset qna-question multicode">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true" href=""><img src="L6_images/python-logo-only.png" class="img-fluid" width="30"></a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false" href=""><img src="L6_images/Rlogo.png" width="41" height="30"></a></li>
</ul>
<div class="tab-content qna-question multicode">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming england_filtered is a pandas DataFrame</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>england_filtered.to_csv(<span class="st">"england_filtered.csv"</span>, index<span class="op">=</span><span class="va">False</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="va">england_filtered</span>, <span class="st">"england_filtered.csv"</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you are unsure of the names of the local authorities in England, use the <code>la_and_region_codes_meta.csv</code> file in your metadata folder to help you. You might want to name your “sub” files according to the names of the local authorities you choose.</p>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset qna-question">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true" href=""><img src="L6_images/python-logo-only.png" class="img-fluid" width="30"></a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false" href=""><img src="L6_images/Rlogo.png" width="41" height="30"></a></li>
</ul>
<div class="tab-content qna-question">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">## check all of your variable names first as R and python will call them something different</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>column_df <span class="op">=</span> pd.DataFrame({<span class="st">'Column Names'</span>: england_school_2022_23.columns.tolist()})</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Define excluded MINORGROUP values</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>excluded_groups <span class="op">=</span> [<span class="st">"Special school"</span>, <span class="st">"Independent school"</span>, <span class="st">"College"</span>, <span class="va">None</span>]</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter and select columns</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>england_filtered <span class="op">=</span> (</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    england_school_2022_23[</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">~</span>england_school_2022_23[<span class="st">"MINORGROUP"</span>].isin(excluded_groups) <span class="op">&amp;</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>        (england_school_2022_23[<span class="st">"phaseofeducation_name_"</span>] <span class="op">==</span> <span class="st">"Secondary"</span>) <span class="op">&amp;</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>        (england_school_2022_23[<span class="st">"establishmentstatus_name_"</span>] <span class="op">==</span> <span class="st">"Open"</span>)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    ][[<span class="st">"URN"</span>, <span class="st">"SCHNAME_x"</span>, <span class="st">"LEA"</span>, <span class="st">"TOWN_x"</span>, <span class="st">"TOTPUPS"</span>, <span class="st">"ATT8SCR"</span>, <span class="st">"OFSTEDRATING"</span>, <span class="st">"MINORGROUP"</span>, <span class="st">"PTFSM6CLA1A"</span>]]</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Filter data</span></span>
<span><span class="va">england_filtered</span> <span class="op">&lt;-</span> <span class="va">england_school_2022_23</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">MINORGROUP</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Special school"</span>, <span class="st">"Independent school"</span>, <span class="st">"College"</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">phase_of_education_name</span> <span class="op">==</span> <span class="st">"Secondary"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">establishment_status_name</span> <span class="op">==</span> <span class="st">"Open"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">URN</span>, <span class="va">SCHNAME.x</span>, <span class="va">TOWN.x</span>, <span class="va">TOTPUPS</span>, <span class="va">ATT8SCR</span>, <span class="va">OFSTEDRATING</span>, <span class="va">MINORGROUP</span>, <span class="va">PTFSM6CLA1A</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled" title="Other variables to include in your reduced dataset">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Other variables to include in your reduced dataset
</div>
</div>
<div class="callout-body-container callout-body">
<p>Other variables to include in your reduced dataset:</p>
<ol type="1">
<li>Local Authority (LEA) Code and Name - <strong>LEA</strong> and <strong>LANAME</strong>
</li>
<li>Total Number of Pupils on Roll (all ages) - <strong>TOTPUPS</strong>
</li>
<li>Average Attainment 8 score per pupil for English element - <strong>ATT8SCRENG</strong>
</li>
<li>Average Attainment 8 score per pupil for mathematics element - <strong>ATT8SCRMAT</strong>
</li>
<li>Average Attainment 8 score per disadvantaged pupil - <strong>ATT8SCR_FSM6CLA1A</strong>
</li>
<li>Average Attainment 8 score per non-disadvantaged pupil - <strong>ATT8SCR_NFSM6CLA1A</strong>
</li>
<li>Average Attainment 8 score per boy - <strong>ATT8SCR_BOYS</strong>
</li>
<li>Average Attainment 8 score per girl - <strong>ATT8SCR_GIRLS</strong>
</li>
<li>Progress 8 measure after adjustment for extreme scores - <strong>P8MEA</strong>
</li>
<li>Adjusted Progress 8 measure - disadvantaged pupils - <strong>P8MEA_FSM6CLA1A</strong>
</li>
<li>Adjusted Progress 8 measure - non-disadvantaged pupils - <strong>P8MEA_NFSM6CLA1A</strong>
</li>
<li>% of pupils at the end of key stage 4 who are disadvantaged - <strong>PTFSM6CLA1A</strong>
</li>
<li>% of pupils at the end of key stage 4 who are not disadvantaged - <strong>PTNOTFSM6CLA1A</strong>
</li>
<li>% pupils where English not first language - <strong>PNUMEAL</strong>
</li>
<li>% pupils with English first language - <strong>PNUMENGFL</strong>
</li>
<li>% of pupils at the end of key stage 4 with low prior attainment at the end of key stage 2 - <strong>PTPRIORLO</strong>
</li>
<li>% of pupils at the end of key stage 4 with high prior attainment at the end of key stage 2 - <strong>PTPRIORHI</strong>
</li>
<li>Total boys on roll (including part-time pupils) - <strong>NORB</strong>
</li>
<li>Total girls on roll (including part-time pupils) - <strong>NORG</strong>
</li>
<li>Percentage of pupils eligible for FSM at any time during the past 6 years - <strong>PNUMFSMEVER</strong>
</li>
<li>Percentage of overall absence - <strong>PERCTOT</strong>
</li>
<li>Percentage of enrolments who are persistent absentees - <strong>PPERSABS10</strong>
</li>
<li>School Type e.g.&nbsp;Voluntary Aided school - <strong>SCHOOLTYPE</strong>
</li>
<li>Religious character - <strong>RELCHAR</strong>
</li>
<li>Admissions Policy - <strong>ADMPOL</strong>
</li>
<li>Admissions Policy new definition from 2019 - <strong>ADMPOL_PT</strong>
</li>
<li>Government Office Region Name - <strong>gor_name</strong>
</li>
<li>Mixed or Single Sex - <strong>gender_name</strong>
</li>
</ol>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>When you joined your datasets earlier, you will find that some variables appear in more than one of the datasets. This may cause a problem now as R and Python will try and distinguish them in the join by appending a <code>.x</code> or <code>.y</code> (R) or <code>_x</code> or <code>_y</code> (Python) so you may get an error when joining, particularly with the <strong>SCHOOLTYPE</strong> and <strong>ADMPOL</strong> variables. For these try <strong>SCHOOLTYPE.x</strong> and <strong>ADMPOL.y</strong> (underscore for Python) instead.</p>
</div>
</div>
</section><section id="task-3---further-exploratory-analysis-and-visual-modelling" class="level2"><h2 class="anchored" data-anchor-id="task-3---further-exploratory-analysis-and-visual-modelling">Task 3 - Further Exploratory Analysis and Visual Modelling</h2>
<ul>
<li>Using the example code below as a guide, select your own <span class="math inline">\(Y\)</span> variable related to attainment from your smaller filtered dataset. You have a range of attainment or progress related variables in there</li>
<li>Select your own <span class="math inline">\(X\)</span> variable that might help explain attainment, this might relate to disadvantage, prior attainment, absence or anything else that is a <strong>continuous</strong> variable (DO NOT SELECT A CATEGORICAL VARIABLE AT THIS TIME).</li>
<li>Once you have selected your two variables, plot them against each other on a scatter plot to see if there is an obvious relationship - again, use the code below as a guide.</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled" title="AI tip">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>AI tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>AI - yes, that dreaded thing that’s invading everything. Well, it’s hear to stay and while it’s here, you might as well use it to help you with your coding. Of course, I don’t want you to blindly copy things and not understand what’s going on, but if you get stuck with syntax and getting plots to look how you want - feed your favourite AI with your code and get it to help you out.</p>
</div>
</div>
<section id="exploratory-data-analysis-plots" class="level4"><h4 class="anchored" data-anchor-id="exploratory-data-analysis-plots">Exploratory Data Analysis Plots</h4>
<div class="callout callout-style-default callout-tip callout-titled" title="Questions to Answer">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Questions to Answer
</div>
</div>
<div class="callout-body-container callout-body">
<p>Just from looking at your plots: - How do you expect the intercepts (baseline Y) to differ between your London and non-London local authority (if at all)? Which is higher and which is lower? - How do you think the slope values (influence of X on Y) are different (if at all)?</p>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset qna-question multicode">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true" href=""><img src="L6_images/python-logo-only.png" class="img-fluid" width="30"></a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false" href=""><img src="L6_images/Rlogo.png" width="41" height="30"></a></li>
</ul>
<div class="tab-content qna-question multicode">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the datasets</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>combined_data <span class="op">=</span> pd.concat([camden_sub, leeds_sub])</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a function to make and customize the plot</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_plot():</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> sns.FacetGrid(combined_data, col<span class="op">=</span><span class="st">"LANAME"</span>, height<span class="op">=</span><span class="dv">5</span>, aspect<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    g.map_dataframe(</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>        sns.scatterplot,</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">"PTFSM6CLA1A"</span>,</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span><span class="st">"ATT8SCR"</span>,</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">"steelblue"</span>,</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>        alpha<span class="op">=</span><span class="fl">0.7</span>,</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>        s<span class="op">=</span><span class="dv">60</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    g.set_axis_labels(<span class="st">"% KS4 Pupils Disadvantaged (PTFSM6CLA1A)"</span>, <span class="st">"Attainment 8 Score (ATT8SCR)"</span>)</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    g.fig.suptitle(<span class="st">"Attainment 8 vs % Disadvantaged by Local Authority"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>    g.fig.tight_layout()</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    g.fig.subplots_adjust(top<span class="op">=</span><span class="fl">0.85</span>)</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Call the function once</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>make_plot()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><a href="week6_practical_files/figure-html/unnamed-chunk-20-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="week6_practical_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="960"></a></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine the datasets and label them</span></span>
<span><span class="va">combined_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="va">camden_sub</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Area <span class="op">=</span> <span class="st">"Camden"</span><span class="op">)</span>,</span>
<span>  <span class="va">leeds_sub</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Area <span class="op">=</span> <span class="st">"Leeds"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create faceted scatter plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">combined_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">PTFSM6CLA1A</span>, y <span class="op">=</span> <span class="va">ATT8SCR</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.7</span>, size <span class="op">=</span> <span class="fl">3</span>, color <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">Area</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Attainment 8 vs % Disadvantaged by Local Authority"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"% KS4 Pupils Disadvantaged (PTFSM6CLA1A)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Attainment 8 Score (ATT8SCR)"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><a href="week6_practical_files/figure-html/unnamed-chunk-21-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="week6_practical_files/figure-html/unnamed-chunk-21-3.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section id="exploratory-data-analysis-maps" class="level4"><h4 class="anchored" data-anchor-id="exploratory-data-analysis-maps">Exploratory Data Analysis Maps</h4>
<ul>
<li>Maps are great, they help you understand all kinds of things if your data have a spatial identifier. Try some maps out here!</li>
<li>You might find R is a bit better at mapping things. Just saying.</li>
</ul>
<div class="tabset-margin-container"></div><div class="panel-tabset qna-question multicode">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true" href=""><img src="L6_images/python-logo-only.png" class="img-fluid" width="30"></a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false" href=""><img src="L6_images/Rlogo.png" width="41" height="30"></a></li>
</ul>
<div class="tab-content qna-question multicode">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.cm <span class="im">as</span> cm</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.colors <span class="im">import</span> Normalize</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> contextily <span class="im">as</span> ctx</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Reproject to Web Mercator for contextily</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>sf_df_mercator <span class="op">=</span> sf_df_bng.to_crs(epsg<span class="op">=</span><span class="dv">3857</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Scale marker size</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>min_val <span class="op">=</span> sf_df_mercator[<span class="st">'TOTPUPS'</span>].<span class="bu">min</span>()</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>max_val <span class="op">=</span> sf_df_mercator[<span class="st">'TOTPUPS'</span>].<span class="bu">max</span>()</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>sf_df_mercator[<span class="st">'size_scale'</span>] <span class="op">=</span> <span class="dv">4</span> <span class="op">+</span> (sf_df_mercator[<span class="st">'TOTPUPS'</span>] <span class="op">-</span> min_val) <span class="op">*</span> (<span class="dv">12</span> <span class="op">-</span> <span class="dv">4</span>) <span class="op">/</span> (max_val <span class="op">-</span> min_val)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Color mapping</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>norm <span class="op">=</span> Normalize(vmin<span class="op">=</span>sf_df_mercator[<span class="st">'ATT8SCR'</span>].<span class="bu">min</span>(), vmax<span class="op">=</span>sf_df_mercator[<span class="st">'ATT8SCR'</span>].<span class="bu">max</span>())</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>cmap <span class="op">=</span> plt.colormaps[<span class="st">'magma'</span>]</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>sf_df_mercator[<span class="st">'color'</span>] <span class="op">=</span> sf_df_mercator[<span class="st">'ATT8SCR'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: cmap(norm(x)))</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>sf_df_mercator.plot(ax<span class="op">=</span>ax, color<span class="op">=</span>sf_df_mercator[<span class="st">'color'</span>], markersize<span class="op">=</span>sf_df_mercator[<span class="st">'size_scale'</span>]<span class="op">**</span><span class="dv">2</span>, alpha<span class="op">=</span><span class="fl">0.8</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&lt;Axes: &gt;</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add basemap</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>ctx.add_basemap(ax, source<span class="op">=</span>ctx.providers.CartoDB.Positron)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Final touches</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Static Map of Schools Colored by ATT8SCR and Sized by TOTPUPS"</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Text(0.5, 1.0, 'Static Map of Schools Colored by ATT8SCR and Sized by TOTPUPS')</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Colorbar</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>sm <span class="op">=</span> cm.ScalarMappable(cmap<span class="op">=</span>cmap, norm<span class="op">=</span>norm)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>sm.set_array([])</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>cbar <span class="op">=</span> fig.colorbar(sm, ax<span class="op">=</span>ax, orientation<span class="op">=</span><span class="st">'vertical'</span>, fraction<span class="op">=</span><span class="fl">0.03</span>, pad<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>cbar.set_label(<span class="st">'ATT8SCR'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">"static_school_map_with_basemap.png"</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><a href="week6_practical_files/figure-html/unnamed-chunk-23-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="week6_practical_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="960"></a></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/leaflet/">leaflet</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org">scales</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/">viridis</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert to sf object with EPSG:27700</span></span>
<span><span class="va">sf_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="va">leeds_sub</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"easting"</span>, <span class="st">"northing"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">27700</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Transform to EPSG:4326</span></span>
<span><span class="va">sf_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">sf_df</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract lat/lon for leaflet</span></span>
<span><span class="va">sf_df</span> <span class="op">&lt;-</span> <span class="va">sf_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    lon <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>    lat <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Define size and color scales</span></span>
<span><span class="va">size_scale</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://scales.r-lib.org/reference/rescale.html">rescale</a></span><span class="op">(</span><span class="va">sf_df</span><span class="op">$</span><span class="va">TOTPUPS</span>, to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">15</span><span class="op">)</span><span class="op">)</span>  <span class="co"># radius from 4 to 12</span></span>
<span></span>
<span><span class="co"># Create a color palette based on ATT8SCR</span></span>
<span><span class="va">pal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/colorNumeric.html">colorNumeric</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"magma"</span>, domain <span class="op">=</span> <span class="va">sf_df</span><span class="op">$</span><span class="va">ATT8SCR</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rstudio.github.io/leaflet/reference/leaflet.html">leaflet</a></span><span class="op">(</span><span class="va">sf_df</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/addProviderTiles.html">addProviderTiles</a></span><span class="op">(</span><span class="st">"CartoDB.Positron"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/map-layers.html">addCircleMarkers</a></span><span class="op">(</span></span>
<span>    lng <span class="op">=</span> <span class="op">~</span><span class="va">lon</span>,</span>
<span>    lat <span class="op">=</span> <span class="op">~</span><span class="va">lat</span>,</span>
<span>    radius <span class="op">=</span> <span class="va">size_scale</span>,</span>
<span>    stroke <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    fillOpacity <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>    color <span class="op">=</span> <span class="op">~</span><span class="fu">pal</span><span class="op">(</span><span class="va">ATT8SCR</span><span class="op">)</span>,</span>
<span>    popup <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span></span>
<span>      <span class="st">"&lt;strong&gt;"</span>, <span class="va">SCHNAME.x</span>, <span class="st">"&lt;/strong&gt;&lt;br&gt;"</span>,</span>
<span>      <span class="st">"Pupils: "</span>, <span class="va">TOTPUPS</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/addLegend.html">addLegend</a></span><span class="op">(</span></span>
<span>    <span class="st">"bottomright"</span>,</span>
<span>    pal <span class="op">=</span> <span class="va">pal</span>,</span>
<span>    values <span class="op">=</span> <span class="op">~</span><span class="va">ATT8SCR</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"ATT8SCR"</span>,</span>
<span>    opacity <span class="op">=</span> <span class="fl">0.8</span></span>
<span>  <span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div class="leaflet html-widget html-fill-item" id="htmlwidget-c69182d1b494bc8f4b50" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-c69182d1b494bc8f4b50">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron",null,null,{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addCircleMarkers","args":[[53.83394634055382,53.84093983092549,53.85034857386938,53.85712277299099,53.82017744375353,53.90039841956449,53.75656004662164,53.74558690458779,53.8387499079027,53.76566481366035,53.74785512138476,53.76006383630605,53.80288115128293,53.81070125174928,53.79721268666177,53.79235390646338,53.79514273396459,53.78344398433403,53.78683288703903,53.8713904925365,53.84229861871142,53.81544011630753,53.83589750626852,53.81758602453261,53.81551080341188,53.85370943046657,53.81414331569527,53.74218241498903,53.79386270979967,53.91268570640318,53.73733196122085,53.7988428504004,53.85674672875195,53.7306067899343,53.79097463962646,53.88125617657391,53.79654340248619,53.80000595654007,53.78823862185425,53.92960845400619,53.72987776155618],[-1.608423239084215,-1.524073025507307,-1.551662338143588,-1.68346318744024,-1.476550927178206,-1.36196893706364,-1.382153401796083,-1.620192354862328,-1.560250705548742,-1.537818960574211,-1.532085267275583,-1.558933938220971,-1.520950890789299,-1.687351169609469,-1.484791994789932,-1.656702836658199,-1.607676318817181,-1.61998739256515,-1.391088902611243,-1.717483226940705,-1.640838474112415,-1.434796568204613,-1.595108904930247,-1.558573543807087,-1.461906770359417,-1.544329442771105,-1.654444227262337,-1.606865522760626,-1.52688289356914,-1.693852141772329,-1.459842998496006,-1.662904935937967,-1.607800074111826,-1.500854894689133,-1.53533993921077,-1.727867413822788,-1.461329674570659,-1.514485461178211,-1.534398738002605,-1.380713206258969,-1.585532609441064],[13.08621667612025,13.49914917753829,12.61769710720363,12.17300056721497,5.820192853091322,10.72773681225184,11.07714123652864,10.02098695405559,7.193987521270562,9.504821327283041,3.231423709585933,10.02098695405559,6.749290981281906,8.575723199092455,6.923993193420307,8.790130459444129,6.94781622234827,11.74418604651163,15,10.9977311401021,12.32387975042541,4.978445830969938,11.53771979580261,7.233692569483835,8.115144639818491,1,11.0850822461713,11.2597844583097,7.40045377197958,12.95121951219512,7.932501418037436,10.53715258082813,8.186613726602381,12.99092456040839,10.24333522404991,9.663641520136132,10.30686330119115,3.699943278502552,3.287010777084515,5.502552467385138,14.57912648893931],null,null,{"interactive":true,"className":"","stroke":false,"color":["#FED597","#C13B75","#FCECAD","#D5446D","#4A1079","#FEC98C","#D8456C","#FA7D5E","#FECF92","#CD4071","#808080","#F1605D","#000004","#E04C67","#782281","#BC3978","#140E36","#FB8560","#FC8961","#FE9D6C","#FCF4B6","#491078","#B1357B","#53137D","#681C81","#A9337D","#7F2482","#FCFDBF","#F66D5C","#FEC287","#FC8D63","#E44F64","#B5367A","#DA476A","#F56B5C","#FCEDAF","#EA5661","#808080","#AF357B","#F4695C","#F4695C"],"weight":5,"opacity":0.5,"fill":true,"fillColor":["#FED597","#C13B75","#FCECAD","#D5446D","#4A1079","#FEC98C","#D8456C","#FA7D5E","#FECF92","#CD4071","#808080","#F1605D","#000004","#E04C67","#782281","#BC3978","#140E36","#FB8560","#FC8961","#FE9D6C","#FCF4B6","#491078","#B1357B","#53137D","#681C81","#A9337D","#7F2482","#FCFDBF","#F66D5C","#FEC287","#FC8D63","#E44F64","#B5367A","#DA476A","#F56B5C","#FCEDAF","#EA5661","#808080","#AF357B","#F4695C","#F4695C"],"fillOpacity":0.8},null,null,["<strong>Abbey Grange Church of England Academy<\/strong><br>Pupils: 1659","<strong>Allerton Grange School<\/strong><br>Pupils: 1711","<strong>Allerton High School<\/strong><br>Pupils: 1600","<strong>Benton Park School<\/strong><br>Pupils: 1544","<strong>Bishop Young Church of England Academy<\/strong><br>Pupils: 744","<strong>Boston Spa Academy<\/strong><br>Pupils: 1362","<strong>Brigshaw High School<\/strong><br>Pupils: 1406","<strong>Bruntcliffe Academy<\/strong><br>Pupils: 1273","<strong>Cardinal Heenan Catholic High School<\/strong><br>Pupils: 917","<strong>Cockburn John Charles Academy<\/strong><br>Pupils: 1208","<strong>Cockburn Laurence Calvert Academy<\/strong><br>Pupils: 418","<strong>Cockburn School<\/strong><br>Pupils: 1273","<strong>Co-op Academy Leeds<\/strong><br>Pupils: 861","<strong>Co-op Academy Priesthorpe<\/strong><br>Pupils: 1091","<strong>Corpus Christi Catholic College, A Voluntary Academy<\/strong><br>Pupils: 883","<strong>Crawshaw Academy<\/strong><br>Pupils: 1118","<strong>Dixons Unity Academy<\/strong><br>Pupils: 886","<strong>The Farnley Academy<\/strong><br>Pupils: 1490","<strong>Garforth Academy<\/strong><br>Pupils: 1900","<strong>Guiseley School<\/strong><br>Pupils: 1396","<strong>Horsforth School<\/strong><br>Pupils: 1563","<strong>John Smeaton Academy<\/strong><br>Pupils: 638","<strong>Lawnswood School<\/strong><br>Pupils: 1464","<strong>Leeds City Academy<\/strong><br>Pupils: 922","<strong>Leeds East Academy<\/strong><br>Pupils: 1033","<strong>Leeds Jewish Free School<\/strong><br>Pupils: 137","<strong>Leeds West Academy<\/strong><br>Pupils: 1407","<strong>The Morley Academy<\/strong><br>Pupils: 1429","<strong>Mount St Mary's Catholic High School<\/strong><br>Pupils: 943","<strong>Otley Prince Henry's Grammar School Specialist Language College<\/strong><br>Pupils: 1642","<strong>Oulton Academy<\/strong><br>Pupils: 1010","<strong>Pudsey Grammar School<\/strong><br>Pupils: 1338","<strong>Ralph Thoresby School<\/strong><br>Pupils: 1042","<strong>Rodillian Academy<\/strong><br>Pupils: 1647","<strong>The Ruth Gorse Academy<\/strong><br>Pupils: 1301","<strong>St. Mary's Menston, a Catholic Voluntary Academy<\/strong><br>Pupils: 1228","<strong>Temple Moor High School<\/strong><br>Pupils: 1309","<strong>Trinity Academy Leeds<\/strong><br>Pupils: 477","<strong>University Technical College Leeds<\/strong><br>Pupils: 425","<strong>Wetherby High School<\/strong><br>Pupils: 704","<strong>Woodkirk Academy<\/strong><br>Pupils: 1847"],null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addLegend","args":[{"colors":["#000004 , #0C0925 6.93069306930693%, #4A1079 23.4323432343234%, #8C2981 39.9339933993399%, #D0416F 56.4356435643564%, #FA7D5E 72.9372937293729%, #FECC8F 89.4389438943894%, #FCFDBF "],"labels":["30","35","40","45","50","55"],"na_color":"#808080","na_label":"NA","opacity":0.8,"position":"bottomright","type":"numeric","title":"ATT8SCR","extra":{"p_1":0.06930693069306934,"p_n":0.8943894389438943},"layerId":null,"className":"info legend","group":null}]}],"limits":{"lat":[53.72987776155618,53.92960845400619],"lng":[-1.727867413822788,-1.36196893706364]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
</div>
</div>
</section><section id="exploratory-data-analysis---distributions-and-slicing-and-dicing" class="level4"><h4 class="anchored" data-anchor-id="exploratory-data-analysis---distributions-and-slicing-and-dicing">Exploratory Data Analysis - Distributions and slicing and dicing</h4>
<ul>
<li>You can also explore the scatter plot for your whole of England dataset.</li>
<li>One really interesting thing to do is to slice and dice your data according to some of the categorical variables.</li>
<li>In the R visualisation, you can see how we can start to slide and dice by regions, for example. Maybe try some of your other categorical variables.</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>You will notice that in the plots below I have used a log10() transformation, but you could also use the natural log() or a range of other possible transformations. If you want to understand a bit more about transformations for normalisng your data, you should explore Tukey’s Ladder of Powers - <a href="https://onlinestatbook.com/2/transformations/tukey.html" class="uri">https://onlinestatbook.com/2/transformations/tukey.html</a> - in R (and probably in Python too) there are packages to apply appropriate Tukey transformations so your data gets a little closer to a normal distribution.</p>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset qna-question multicode">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true" href=""><img src="L6_images/python-logo-only.png" class="img-fluid" width="30"></a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false" href=""><img src="L6_images/Rlogo.png" width="41" height="30"></a></li>
</ul>
<div class="tab-content qna-question multicode">
<div id="tabset-9-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Load your data into a DataFrame named england_filtered</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co"># england_filtered = pd.read_csv("your_data.csv")</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply log10 transformation (replace 0s to avoid log(0))</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>england_filtered[<span class="st">'log_PTFSM6CLA1A'</span>] <span class="op">=</span> np.log10(england_filtered[<span class="st">'PTFSM6CLA1A'</span>].replace(<span class="dv">0</span>, np.nan))</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>england_filtered[<span class="st">'log_ATT8SCR'</span>] <span class="op">=</span> np.log10(england_filtered[<span class="st">'ATT8SCR'</span>].replace(<span class="dv">0</span>, np.nan))</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop rows with NaNs from log(0)</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>england_filtered <span class="op">=</span> england_filtered.dropna(subset<span class="op">=</span>[<span class="st">'log_PTFSM6CLA1A'</span>, <span class="st">'log_ATT8SCR'</span>])</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Set theme</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>sns.set_theme(style<span class="op">=</span><span class="st">"darkgrid"</span>)</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Create jointplot</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> sns.jointplot(</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"log_PTFSM6CLA1A"</span>,</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">"log_ATT8SCR"</span>,</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>england_filtered,</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>    kind<span class="op">=</span><span class="st">"reg"</span>,</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>    truncate<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">"m"</span>,</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>    height<span class="op">=</span><span class="dv">7</span></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Label axes</span></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>g.set_axis_labels(<span class="st">"log10(PTFSM6CLA1A)"</span>, <span class="st">"log10(ATT8SCR)"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&lt;seaborn.axisgrid.JointGrid object at 0x7f818a72e830&gt;</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><a href="week6_practical_files/figure-html/unnamed-chunk-25-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img src="week6_practical_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-9-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jtlandis/ggside">ggside</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">england_filtered</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">PTFSM6CLA1A</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">ATT8SCR</span><span class="op">)</span>, colour <span class="op">=</span> <span class="va">gor_name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggside/man/geom_xsidedensity.html">geom_xsidedensity</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">density</span><span class="op">)</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>, size <span class="op">=</span> <span class="fl">1</span>, position <span class="op">=</span> <span class="st">"stack"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggside/man/geom_xsidedensity.html">geom_ysidedensity</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">density</span><span class="op">)</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>, size <span class="op">=</span> <span class="fl">1</span>, position <span class="op">=</span> <span class="st">"stack"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>ggside.panel.scale.x <span class="op">=</span> <span class="fl">0.4</span>,ggside.panel.scale.y <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><a href="week6_practical_files/figure-html/unnamed-chunk-26-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9"><img src="week6_practical_files/figure-html/unnamed-chunk-26-3.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset qna-question multicode">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-10-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-1" role="tab" aria-controls="tabset-10-1" aria-selected="true" href=""><img src="L6_images/python-logo-only.png" class="img-fluid" width="30"></a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-2" role="tab" aria-controls="tabset-10-2" aria-selected="false" href=""><img src="L6_images/Rlogo.png" width="41" height="30"></a></li>
</ul>
<div class="tab-content qna-question multicode">
<div id="tabset-10-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-10-1-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the theme</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>sns.set_theme(style<span class="op">=</span><span class="st">"darkgrid"</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create side-by-side histograms</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">6</span>))</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogram for PTFSM6CLA1A</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>sns.histplot(data<span class="op">=</span>england_filtered, x<span class="op">=</span><span class="st">"PTFSM6CLA1A"</span>, ax<span class="op">=</span>axes[<span class="dv">0</span>], kde<span class="op">=</span><span class="va">True</span>, color<span class="op">=</span><span class="st">"skyblue"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&lt;Axes: xlabel='PTFSM6CLA1A', ylabel='Count'&gt;</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">"Histogram of PTFSM6CLA1A"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Text(0.5, 1.0, 'Histogram of PTFSM6CLA1A')</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">"PTFSM6CLA1A"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Text(0.5, 0, 'PTFSM6CLA1A')</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">"Frequency"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Text(0, 0.5, 'Frequency')</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogram for ATT8SCR</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>sns.histplot(data<span class="op">=</span>england_filtered, x<span class="op">=</span><span class="st">"ATT8SCR"</span>, ax<span class="op">=</span>axes[<span class="dv">1</span>], kde<span class="op">=</span><span class="va">True</span>, color<span class="op">=</span><span class="st">"salmon"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&lt;Axes: xlabel='ATT8SCR', ylabel='Count'&gt;</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">"Histogram of ATT8SCR"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Text(0.5, 1.0, 'Histogram of ATT8SCR')</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">"ATT8SCR"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Text(0.5, 0, 'ATT8SCR')</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">"Frequency"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Text(0, 0.5, 'Frequency')</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><a href="week6_practical_files/figure-html/unnamed-chunk-27-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10"><img src="week6_practical_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="1344"></a></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-10-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-2-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Histogram for PTFSM6CLA1A</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">england_filtered</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">PTFSM6CLA1A</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">1</span>, fill <span class="op">=</span> <span class="st">"skyblue"</span>, color <span class="op">=</span> <span class="st">"white"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">..count..</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"skyblue"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Histogram of PTFSM6CLA1A"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"PTFSM6CLA1A"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Frequency"</span></span>
<span>  <span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><a href="week6_practical_files/figure-html/unnamed-chunk-28-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11"><img src="week6_practical_files/figure-html/unnamed-chunk-28-3.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Histogram for ATT8SCR</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">england_filtered</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">ATT8SCR</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">1</span>, fill <span class="op">=</span> <span class="st">"salmon"</span>, color <span class="op">=</span> <span class="st">"white"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">..count..</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"salmon"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Histogram of ATT8SCR"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"ATT8SCR"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Frequency"</span></span>
<span>  <span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><a href="week6_practical_files/figure-html/unnamed-chunk-28-4.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12"><img src="week6_practical_files/figure-html/unnamed-chunk-28-4.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Explore Different Visualisations">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Explore Different Visualisations
</div>
</div>
<div class="callout-body-container callout-body">
<p>I’ve just given you a few very basic visualisation types here, but there are so many extensions and options available in packages like <a href="https://exts.ggplot2.tidyverse.org/gallery/">ggplot2</a> in R and <a href="https://seaborn.pydata.org/examples/index.html">Seaborn</a> in Python so you can get visualising in very creative ways - have a look at some of these gallery examples in the links and maybe try experimenting with a few different ones! There are no excuses these days for 💩 data visualisations!</p>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">england_filtered</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">PTFSM6CLA1A</span>, y <span class="op">=</span> <span class="va">ATT8SCR</span>, fill <span class="op">=</span> <span class="va">gor_name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html">geom_violin</a></span><span class="op">(</span></span>
<span>    position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span>    draw_quantiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">gor_name</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Violin Plot of Attainment 8 Score with Quantiles by Region"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"% Disadvantaged"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Attainment 8 Score"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Region"</span></span>
<span>  <span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><a href="week6_practical_files/figure-html/unnamed-chunk-29-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13"><img src="week6_practical_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mjskay.github.io/ggdist/">ggdist</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">england_filtered</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">PTFSM6CLA1A</span>, y <span class="op">=</span> <span class="va">gor_name</span>, fill <span class="op">=</span> <span class="va">gor_name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://mjskay.github.io/ggdist/reference/stat_slab.html">stat_slab</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>thickness <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">pdf</span><span class="op">*</span><span class="va">n</span><span class="op">)</span><span class="op">)</span>, scale <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://mjskay.github.io/ggdist/reference/stat_dotsinterval.html">stat_dotsinterval</a></span><span class="op">(</span>side <span class="op">=</span> <span class="st">"bottom"</span>, scale <span class="op">=</span> <span class="fl">1</span>, slab_linewidth <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://mjskay.github.io/ggdist/reference/theme_ggdist.html">theme_ggdist</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Rain Cloud Plot of % Disadvantage in Schools by Region"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"% Disadvantaged"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Region"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Region"</span></span>
<span>  <span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><a href="week6_practical_files/figure-html/unnamed-chunk-30-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14"><img src="week6_practical_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section></section><section id="task-4---explanatory-analysis---running-your-regression-model" class="level2"><h2 class="anchored" data-anchor-id="task-4---explanatory-analysis---running-your-regression-model">Task 4 - Explanatory Analysis - Running Your Regression Model</h2>
<ul>
<li>Now you have carried out some appropriate exploratory data analysis, you should run a simple bi-variate regression model for your two local authority areas and compare it with a similar analysis run on the national dataset</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Depending on your variables and whether or not there appears to be a linear relationship or a log-log or level-log relationship, if you transform a variable for the national data or one of your subsets, you could also transform it for the others, otherwise it will be impossible to compare</li>
</ul>
</div>
</div>
<ul>
<li>The Code below is an example using my variables, but you should use the variables you have selected.</li>
</ul>
<section id="running-the-model-for-the-first-london-local-authority" class="level4"><h4 class="anchored" data-anchor-id="running-the-model-for-the-first-london-local-authority">Running the Model for the first (London) local authority</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset qna-question multicode">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-11-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-1" role="tab" aria-controls="tabset-11-1" aria-selected="true" href=""><img src="L6_images/python-logo-only.png" class="img-fluid" width="30"></a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-2" role="tab" aria-controls="tabset-11-2" aria-selected="false" href=""><img src="L6_images/Rlogo.png" width="41" height="30"></a></li>
</ul>
<div class="tab-content qna-question multicode">
<div id="tabset-11-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-11-1-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Log-transform the variables</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>camden_sub[<span class="st">'log_ATT8SCR'</span>] <span class="op">=</span> np.log(camden_sub[<span class="st">'ATT8SCR'</span>])</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>camden_sub[<span class="st">'log_PTFSM6CLA1A'</span>] <span class="op">=</span> np.log(camden_sub[<span class="st">'PTFSM6CLA1A'</span>])</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Define independent and dependent variables</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(camden_sub[<span class="st">'log_PTFSM6CLA1A'</span>])  <span class="co"># adds intercept</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> camden_sub[<span class="st">'log_ATT8SCR'</span>]</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>camden_model1 <span class="op">=</span> sm.OLS(y, X).fit()</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a><span class="co">#camden_summary = extract_model_summary(camden_model1, 'Camden Model')</span></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Print summary</span></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(camden_model1.summary())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>/opt/hostedtoolcache/Python/3.10.18/x64/lib/python3.10/site-packages/scipy/stats/_axis_nan_policy.py:430: UserWarning: `kurtosistest` p-value may be inaccurate with fewer than 20 observations; only n=10 observations were given.
  return hypotest_fun_in(*args, **kwds)
                            OLS Regression Results                            
==============================================================================
Dep. Variable:            log_ATT8SCR   R-squared:                       0.576
Model:                            OLS   Adj. R-squared:                  0.523
Method:                 Least Squares   F-statistic:                     10.88
Date:                Sat, 25 Oct 2025   Prob (F-statistic):             0.0109
Time:                        14:41:17   Log-Likelihood:                 9.4809
No. Observations:                  10   AIC:                            -14.96
Df Residuals:                       8   BIC:                            -14.36
Df Model:                           1                                         
Covariance Type:            nonrobust                                         
===================================================================================
                      coef    std err          t      P&gt;|t|      [0.025      0.975]
-----------------------------------------------------------------------------------
const               6.1206      0.678      9.023      0.000       4.556       7.685
log_PTFSM6CLA1A    -0.5784      0.175     -3.298      0.011      -0.983      -0.174
==============================================================================
Omnibus:                        2.491   Durbin-Watson:                   2.528
Prob(Omnibus):                  0.288   Jarque-Bera (JB):                0.897
Skew:                           0.002   Prob(JB):                        0.639
Kurtosis:                       1.533   Cond. No.                         84.4
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</code></pre>
</div>
</div>
</div>
<div id="tabset-11-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-2-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Fit linear model and get predicted values</span></span>
<span><span class="va">camden_model1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">ATT8SCR</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">PTFSM6CLA1A</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">camden_sub</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">camden_model1</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log(ATT8SCR) ~ log(PTFSM6CLA1A), data = camden_sub)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.12111 -0.10124  0.01187  0.06663  0.13871 

Coefficients:
                 Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)        6.1206     0.6783   9.023 1.82e-05 ***
log(PTFSM6CLA1A)  -0.5784     0.1753  -3.298   0.0109 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.1048 on 8 degrees of freedom
Multiple R-squared:  0.5763,    Adjusted R-squared:  0.5233 
F-statistic: 10.88 on 1 and 8 DF,  p-value: 0.01088</code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section id="running-the-model-for-the-second-local-authority" class="level4"><h4 class="anchored" data-anchor-id="running-the-model-for-the-second-local-authority">Running the Model for the second local authority</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset qna-question multicode">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-12-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-1" role="tab" aria-controls="tabset-12-1" aria-selected="true" href=""><img src="L6_images/python-logo-only.png" class="img-fluid" width="30"></a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-2" role="tab" aria-controls="tabset-12-2" aria-selected="false" href=""><img src="L6_images/Rlogo.png" width="41" height="30"></a></li>
</ul>
<div class="tab-content qna-question multicode">
<div id="tabset-12-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-12-1-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Log-transform safely: replace non-positive values with NaN</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>leeds_sub[<span class="st">'log_ATT8SCR'</span>] <span class="op">=</span> np.where(leeds_sub[<span class="st">'ATT8SCR'</span>] <span class="op">&gt;</span> <span class="dv">0</span>, np.log(leeds_sub[<span class="st">'ATT8SCR'</span>]), np.nan)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>leeds_sub[<span class="st">'log_PTFSM6CLA1A'</span>] <span class="op">=</span> np.where(leeds_sub[<span class="st">'PTFSM6CLA1A'</span>] <span class="op">&gt;</span> <span class="dv">0</span>, np.log(leeds_sub[<span class="st">'PTFSM6CLA1A'</span>]), np.nan)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop rows with NaNs in either column</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>leeds_clean <span class="op">=</span> leeds_sub.dropna(subset<span class="op">=</span>[<span class="st">'log_ATT8SCR'</span>, <span class="st">'log_PTFSM6CLA1A'</span>])</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Define independent and dependent variables</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(leeds_clean[<span class="st">'log_PTFSM6CLA1A'</span>])  <span class="co"># adds intercept</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> leeds_clean[<span class="st">'log_ATT8SCR'</span>]</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>leeds_model1 <span class="op">=</span> sm.OLS(y, X).fit()</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a><span class="co">#leeds_summary = extract_model_summary(leeds_model1, 'Leeds Model')</span></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Print summary</span></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(leeds_model1.summary())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:            log_ATT8SCR   R-squared:                       0.491
Model:                            OLS   Adj. R-squared:                  0.477
Method:                 Least Squares   F-statistic:                     35.71
Date:                Sat, 25 Oct 2025   Prob (F-statistic):           6.77e-07
Time:                        14:41:18   Log-Likelihood:                 26.542
No. Observations:                  39   AIC:                            -49.08
Df Residuals:                      37   BIC:                            -45.76
Df Model:                           1                                         
Covariance Type:            nonrobust                                         
===================================================================================
                      coef    std err          t      P&gt;|t|      [0.025      0.975]
-----------------------------------------------------------------------------------
const               4.5473      0.123     36.940      0.000       4.298       4.797
log_PTFSM6CLA1A    -0.2201      0.037     -5.976      0.000      -0.295      -0.145
==============================================================================
Omnibus:                        0.518   Durbin-Watson:                   2.333
Prob(Omnibus):                  0.772   Jarque-Bera (JB):                0.654
Skew:                          -0.200   Prob(JB):                        0.721
Kurtosis:                       2.508   Cond. No.                         22.2
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</code></pre>
</div>
</div>
</div>
<div id="tabset-12-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-2-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Fit linear model and get predicted values</span></span>
<span><span class="va">leeds_model1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">ATT8SCR</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">PTFSM6CLA1A</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">leeds_sub</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">leeds_model1</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log(ATT8SCR) ~ log(PTFSM6CLA1A), data = leeds_sub)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.310438 -0.085062 -0.003004  0.116129  0.205687 

Coefficients:
                 Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)       4.54727    0.12310  36.940  &lt; 2e-16 ***
log(PTFSM6CLA1A) -0.22006    0.03682  -5.976 6.77e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.1258 on 37 degrees of freedom
  (2 observations deleted due to missingness)
Multiple R-squared:  0.4911,    Adjusted R-squared:  0.4774 
F-statistic: 35.71 on 1 and 37 DF,  p-value: 6.767e-07</code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section id="running-the-model-for-all-schools-in-england" class="level4"><h4 class="anchored" data-anchor-id="running-the-model-for-all-schools-in-england">Running the Model for all Schools in England</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset qna-question multicode">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-13-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-1" role="tab" aria-controls="tabset-13-1" aria-selected="true" href=""><img src="L6_images/python-logo-only.png" class="img-fluid" width="30"></a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-2" role="tab" aria-controls="tabset-13-2" aria-selected="false" href=""><img src="L6_images/Rlogo.png" width="41" height="30"></a></li>
</ul>
<div class="tab-content qna-question multicode">
<div id="tabset-13-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-13-1-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Log-transform safely: replace non-positive values with NaN</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>england_filtered[<span class="st">'log_ATT8SCR'</span>] <span class="op">=</span> np.where(england_filtered[<span class="st">'ATT8SCR'</span>] <span class="op">&gt;</span> <span class="dv">0</span>, np.log(england_filtered[<span class="st">'ATT8SCR'</span>]), np.nan)</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>england_filtered[<span class="st">'log_PTFSM6CLA1A'</span>] <span class="op">=</span> np.where(england_filtered[<span class="st">'PTFSM6CLA1A'</span>] <span class="op">&gt;</span> <span class="dv">0</span>, np.log(england_filtered[<span class="st">'PTFSM6CLA1A'</span>]), np.nan)</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop rows with NaNs in either column</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>england_clean <span class="op">=</span> england_filtered.dropna(subset<span class="op">=</span>[<span class="st">'log_ATT8SCR'</span>, <span class="st">'log_PTFSM6CLA1A'</span>])</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Define independent and dependent variables</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(england_clean[<span class="st">'log_PTFSM6CLA1A'</span>])  <span class="co"># adds intercept</span></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> england_clean[<span class="st">'log_ATT8SCR'</span>]</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>england_model1 <span class="op">=</span> sm.OLS(y, X).fit()</span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a><span class="co">#england_summary = extract_model_summary(england_model1, 'England Model')</span></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Print summary</span></span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(england_model1.summary())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:            log_ATT8SCR   R-squared:                       0.468
Model:                            OLS   Adj. R-squared:                  0.468
Method:                 Least Squares   F-statistic:                     2611.
Date:                Sat, 25 Oct 2025   Prob (F-statistic):               0.00
Time:                        14:41:18   Log-Likelihood:                 1668.0
No. Observations:                2968   AIC:                            -3332.
Df Residuals:                    2966   BIC:                            -3320.
Df Model:                           1                                         
Covariance Type:            nonrobust                                         
===================================================================================
                      coef    std err          t      P&gt;|t|      [0.025      0.975]
-----------------------------------------------------------------------------------
const               4.4778      0.013    349.542      0.000       4.453       4.503
log_PTFSM6CLA1A    -0.2071      0.004    -51.095      0.000      -0.215      -0.199
==============================================================================
Omnibus:                      105.763   Durbin-Watson:                   1.313
Prob(Omnibus):                  0.000   Jarque-Bera (JB):              199.209
Skew:                           0.267   Prob(JB):                     5.53e-44
Kurtosis:                       4.151   Cond. No.                         17.5
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</code></pre>
</div>
</div>
</div>
<div id="tabset-13-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-2-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Fit linear model and get predicted values</span></span>
<span><span class="va">england_filtered_clean</span> <span class="op">&lt;-</span> <span class="va">england_filtered</span><span class="op">[</span></span>
<span>  <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">england_filtered</span><span class="op">$</span><span class="va">ATT8SCR</span><span class="op">)</span> <span class="op">&amp;</span> </span>
<span>  <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">england_filtered</span><span class="op">$</span><span class="va">PTFSM6CLA1A</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="va">england_filtered</span><span class="op">$</span><span class="va">ATT8SCR</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;</span></span>
<span>  <span class="va">england_filtered</span><span class="op">$</span><span class="va">PTFSM6CLA1A</span> <span class="op">&gt;</span> <span class="fl">0</span>, </span>
<span><span class="op">]</span></span>
<span></span>
<span><span class="va">england_model1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">ATT8SCR</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">PTFSM6CLA1A</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">england_filtered_clean</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">england_model1</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log(ATT8SCR) ~ log(PTFSM6CLA1A), data = england_filtered_clean)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.65843 -0.08607 -0.00897  0.07800  0.55670 

Coefficients:
                  Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)       4.477823   0.012811  349.54   &lt;2e-16 ***
log(PTFSM6CLA1A) -0.207090   0.004053  -51.09   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.138 on 2966 degrees of freedom
Multiple R-squared:  0.4681,    Adjusted R-squared:  0.468 
F-statistic:  2611 on 1 and 2966 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section id="combining-your-outputs-for-comparison" class="level4"><h4 class="anchored" data-anchor-id="combining-your-outputs-for-comparison">Combining your outputs for comparison</h4>
<p>Don’t forget to run some basic regression modelling checks on all of your models:</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you are doing this in Python, it appears there isn’t a nice little package with the code for diagnostic plots already created. However, the statsmodels pages do have some code we can borrow - https://www.statsmodels.org/dev/examples/notebooks/generated/linear_regression_diagnostics_plots.html - run this first before using the functions below</p>
</div>
</div>
</section><section id="linearity" class="level3"><h3 class="anchored" data-anchor-id="linearity">Linearity</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset qna-question multicode">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-14-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-1" role="tab" aria-controls="tabset-14-1" aria-selected="true" href=""><img src="L6_images/python-logo-only.png" class="img-fluid" width="30"></a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-2" role="tab" aria-controls="tabset-14-2" aria-selected="false" href=""><img src="L6_images/Rlogo.png" width="41" height="30"></a></li>
</ul>
<div class="tab-content qna-question multicode">
<div id="tabset-14-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-14-1-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>cls <span class="op">=</span> LinearRegDiagnostic(england_model1)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>cls.residual_plot()<span class="op">;</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><a href="week6_practical_files/figure-html/unnamed-chunk-38-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15"><img src="week6_practical_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-14-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-2-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://easystats.github.io/performance/">performance</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://easystats.github.io/performance/reference/check_model.html">check_model</a></span><span class="op">(</span><span class="va">england_model1</span>, </span>
<span>            check <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"linearity"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><a href="week6_practical_files/figure-html/unnamed-chunk-39-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-16"><img src="week6_practical_files/figure-html/unnamed-chunk-39-3.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section id="homoscedasticity-constant-variance" class="level3"><h3 class="anchored" data-anchor-id="homoscedasticity-constant-variance">Homoscedasticity (Constant variance)?</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset qna-question multicode">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-15-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-1" role="tab" aria-controls="tabset-15-1" aria-selected="true" href=""><img src="L6_images/python-logo-only.png" class="img-fluid" width="30"></a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-15-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-2" role="tab" aria-controls="tabset-15-2" aria-selected="false" href=""><img src="L6_images/Rlogo.png" width="41" height="30"></a></li>
</ul>
<div class="tab-content qna-question multicode">
<div id="tabset-15-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-15-1-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>cls.scale_location_plot()<span class="op">;</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><a href="week6_practical_files/figure-html/unnamed-chunk-40-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-17"><img src="week6_practical_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-15-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-15-2-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb61"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://easystats.github.io/performance/reference/check_model.html">check_model</a></span><span class="op">(</span><span class="va">england_model1</span>, </span>
<span>            check <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"homogeneity"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><a href="week6_practical_files/figure-html/unnamed-chunk-41-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-18"><img src="week6_practical_files/figure-html/unnamed-chunk-41-3.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section id="normality-of-residuals" class="level3"><h3 class="anchored" data-anchor-id="normality-of-residuals">Normality of Residuals</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset qna-question multicode">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-16-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-1" role="tab" aria-controls="tabset-16-1" aria-selected="true" href=""><img src="L6_images/python-logo-only.png" class="img-fluid" width="30"></a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-16-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-2" role="tab" aria-controls="tabset-16-2" aria-selected="false" href=""><img src="L6_images/Rlogo.png" width="41" height="30"></a></li>
</ul>
<div class="tab-content qna-question multicode">
<div id="tabset-16-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-16-1-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>cls.qq_plot()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&lt;Axes: title={'center': 'Normal Q-Q'}, xlabel='Theoretical Quantiles', ylabel='Standardized Residuals'&gt;</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><a href="week6_practical_files/figure-html/unnamed-chunk-42-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-19"><img src="week6_practical_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-16-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-16-2-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb65"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://easystats.github.io/performance/reference/check_model.html">check_model</a></span><span class="op">(</span><span class="va">england_model1</span>, </span>
<span>            check <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"qq"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><a href="week6_practical_files/figure-html/unnamed-chunk-43-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-20"><img src="week6_practical_files/figure-html/unnamed-chunk-43-3.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section id="influence-of-outliers" class="level3"><h3 class="anchored" data-anchor-id="influence-of-outliers">Influence of Outliers</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset qna-question multicode">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-17-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-1" role="tab" aria-controls="tabset-17-1" aria-selected="true" href=""><img src="L6_images/python-logo-only.png" class="img-fluid" width="30"></a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-17-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-2" role="tab" aria-controls="tabset-17-2" aria-selected="false" href=""><img src="L6_images/Rlogo.png" width="41" height="30"></a></li>
</ul>
<div class="tab-content qna-question multicode">
<div id="tabset-17-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-17-1-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>cls.leverage_plot(high_leverage_threshold<span class="op">=</span><span class="va">True</span>, cooks_threshold<span class="op">=</span><span class="st">"dof"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&lt;Axes: title={'center': 'Residuals vs Leverage'}, xlabel='Leverage', ylabel='Standardized Residuals'&gt;</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><a href="week6_practical_files/figure-html/unnamed-chunk-44-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-21"><img src="week6_practical_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-17-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-17-2-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb69"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://easystats.github.io/performance/reference/check_model.html">check_model</a></span><span class="op">(</span><span class="va">england_model1</span>, </span>
<span>            check <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"outliers"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><a href="week6_practical_files/figure-html/unnamed-chunk-45-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-22"><img src="week6_practical_files/figure-html/unnamed-chunk-45-3.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<section id="combining-your-outputs-for-comparison-1" class="level4"><h4 class="anchored" data-anchor-id="combining-your-outputs-for-comparison-1">Combining your outputs for comparison</h4>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>You might notice that R is a bit better at things like manipulating model outputs than Python!</p>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset qna-question multicode">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-18-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-18-1" role="tab" aria-controls="tabset-18-1" aria-selected="true" href=""><img src="L6_images/python-logo-only.png" class="img-fluid" width="30"></a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-18-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-18-2" role="tab" aria-controls="tabset-18-2" aria-selected="false" href=""><img src="L6_images/Rlogo.png" width="41" height="30"></a></li>
</ul>
<div class="tab-content qna-question multicode">
<div id="tabset-18-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-18-1-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.iolib.summary2 <span class="im">import</span> summary_col </span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>results_table <span class="op">=</span> summary_col(</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>    results<span class="op">=</span>[camden_model1, leeds_model1, england_model1],</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>    model_names<span class="op">=</span>[<span class="st">'Camden Model'</span>, <span class="st">'Leeds Model'</span>, <span class="st">'England Model'</span>],</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>    stars<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>    float_format<span class="op">=</span><span class="st">"</span><span class="sc">%0.3f</span><span class="st">"</span>,</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># You can customize what model statistics show up here (like R2, N, F-stat)</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>    info_dict<span class="op">=</span>{<span class="st">'N'</span>:<span class="kw">lambda</span> x: <span class="st">"</span><span class="sc">{0:d}</span><span class="st">"</span>.<span class="bu">format</span>(<span class="bu">int</span>(x.nobs))}</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a><span class="co"># # Round for readability</span></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(results_table)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
======================================================
                Camden Model Leeds Model England Model
------------------------------------------------------
const           6.121***     4.547***    4.478***     
                (0.678)      (0.123)     (0.013)      
log_PTFSM6CLA1A -0.578**     -0.220***   -0.207***    
                (0.175)      (0.037)     (0.004)      
R-squared       0.576        0.491       0.468        
R-squared Adj.  0.523        0.477       0.468        
N               10           39          2968         
======================================================
Standard errors in parentheses.
* p&lt;.1, ** p&lt;.05, ***p&lt;.01</code></pre>
</div>
</div>
</div>
<div id="tabset-18-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-18-2-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb72"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://jtools.jacob-long.com">jtools</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://jtools.jacob-long.com/reference/export_summs.html">export_summs</a></span><span class="op">(</span><span class="va">camden_model1</span>, <span class="va">leeds_model1</span>, <span class="va">england_model1</span>, error_format <span class="op">=</span> <span class="st">""</span>, error_pos <span class="op">=</span> <span class="st">"same"</span>, model.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Camden Model"</span>, <span class="st">"Leeds Model"</span>, <span class="st">"England Model"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<table class="huxtable" data-quarto-disable-processing="true" style="margin-left: auto; margin-right: auto;">
<colgroup><col>
<col>
<col>
<col>
</colgroup><thead><tr>
<th class="huxtable-cell huxtable-header" style="text-align: center;  border-style: solid solid solid solid; border-width: 0.8pt 0pt 0pt 0pt;      font-weight: normal;"></th>
<th class="huxtable-cell huxtable-header" style="text-align: center;  border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt;      font-weight: normal;">Camden Model</th>
<th class="huxtable-cell huxtable-header" style="text-align: center;  border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt;      font-weight: normal;">Leeds Model</th>
<th class="huxtable-cell huxtable-header" style="text-align: center;  border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt;      font-weight: normal;">England Model</th>
</tr></thead>
<tbody>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;">(Intercept)</th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;">6.12 *** </td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;">4.55 *** </td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;">4.48 *** </td>
</tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;">log(PTFSM6CLA1A)</th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;">-0.58 * &nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;">-0.22 *** </td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;">-0.21 *** </td>
</tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;">N</th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;">10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;">39&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;">2968&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;      font-weight: normal;">R2</th>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;">0.58&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;">0.49&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;">0.47&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr><th class="huxtable-cell huxtable-header" colspan="4" style="border-style: solid solid solid solid; border-width: 0.8pt 0pt 0pt 0pt;      font-weight: normal;">*** p &lt; 0.001; ** p &lt; 0.01; * p &lt; 0.05.</th></tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Questions to Answer">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Questions to Answer
</div>
</div>
<div class="callout-body-container callout-body">
<p>Comparing your three regression models:</p>
<p>1. How do the intercept (baseline) attainment values differ between your three models? <strong>remember, if you (natural)logged your variables, you will need to take the exponential of the coefficient to interpret it back on the original scale.</strong></p>
<p>2. What do the differences in the slope values tell you?</p>
<p>3. Are your intercept and slope values statistically significant? If so, at what level?</p>
<p>4. How do the R-squared values differ between your models?</p>
<p>5. What can you say about your degrees of freedom and the reliability of your R-squared and other coefficients between your models?</p>
<p>6. What is the overall story of the relationship between your attainment variable and your explanatory variable considering both your local examples and comparison with schools across the rest of England?</p>
</div>
</div>
</section></section><section id="what-does-my-model-show" class="level3"><h3 class="anchored" data-anchor-id="what-does-my-model-show">What does my model show?</h3>
<ol type="1">
<li><p>Baseline attainment (intercept) is much higher in Camden than in Leeds or the whole of England. Exp(6.12) = 455.32. So the Attainment 8 Score in Camden would be 455 (an impossible score) when % of disadvantaged children in a school are 0. This compares to exp(4.547) = 94.35 in Leeds and exp(4.478) = 88.06 in England as a whole. All of these intercepts are statistically significant (i.e.&nbsp;observed values not a chance relationship). While unrealistic (potentially due to the low degrees of freedom), the Camden intercept shows us that after controlling for disadvantage, baseline attainment in Camden is better than in Leeds or the rest of England.</p></li>
<li>
<p>The slope value of -0.207 for England shows that across the country. As this is a log-log model, it is an <strong>Elasticity</strong>: A 1% increase in % of disadvantaged students in a school is associated with a 0.21% decrease in attainment. HOWEVER, as this is a log-log model, the effect is far stronger at one end of the distribution than the other.</p>
<ul>
<li>What this means is that a change from 1% to 10% of disadvantaged students in a school there is a 37.9% decrease in attainment, however, change from 21% to 30% leads to just a 7.1% decrease in attainment.</li>
</ul>
</li>
</ol>
<div class="callout callout-style-default callout-tip callout-titled" title="AI can help here!">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>AI can help here!
</div>
</div>
<div class="callout-body-container callout-body">
<p>One of the things that large language models are quite good at is interpreting regression coefficients in the context of real data.</p>
<p>They don’t always get it right, so <strong>USE WITH EXTREME CAUTION AND ALWAYS DOUBLE CHECK WITH YOUR OWN UNDERSTANDING</strong>, however, they <em>can</em> help explain what YOUR model coefficients mean in relation to YOUR data in an incredibly helpful way. If you get stuck, try feeding an LLM (ChatGTP, Gemini etc.) with your regression outputs and a description of your data and see what it can tell you</p>
</div>
</div>
<p>This effect is similar for Leeds, but apparently far more severe in Camden where the slope is much steeper. However, Camden doesn’t experience very low levels of disadvantage in its schools (unlike in Leeds and the rest of the county), with the lowest level around 35%. With low numbers of schools in the Borough, this observation is potentially unreliable.</p>
<ol start="3" type="1">
<li><p>The slopes and intercept coefficients in all models are all apparently statistically significant - but as we have seen with Camden, this does not necessarily mean our observations are generalisable! This is a good lesson in the difference between statistical significance (p-values are not a panacea!) and why you should always interrogate your model fully when interpreting outputs.</p></li>
<li><p>Again, R-squared values might fool you into thinking the Camden model is ‘better’ than the other models, however, the R-squared is partially an artefact of the low degrees of freedom in the model.</p></li>
<li><p>See above.</p></li>
<li><p>Overall, we can make some crucial observations that encourage further research. While the model for England suggests a moderately strong log-log relationship between levels of disadvantage in a school and attainment, looking at this relationship for a London Borough (Camden) - and another Local Authority in England (Leeds) it’s the case that this is unlikely to be a universal relationship.</p></li>
</ol>
<p>The baseline of attainment in Camden, controlling for disadvantage, is much higher than in the rest of the country. Students get higher levels of attainment, even when controlling for disadvantage. The log log relationship is crucial as it shows that on average, at low levels of disadvantage small increases have a more severe impact on attainment level, whereas at higher levels, similar changes have much reduced effects.</p>
</section><section id="your-turn" class="level3"><h3 class="anchored" data-anchor-id="your-turn">Your Turn</h3>
<p>To finish off the practical, see if you can answer the questions above for your example.</p>


<!-- -->

</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/adamdennett\.github\.io\/QM\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb73" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Prof D's Regression Sessions - Vol 1"</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "AKA - Applied Linear Regression - Basics"</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a><span class="co">  ipynb: default</span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a><span class="an">filters:</span></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a><span class="co">  - qna</span></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a><span class="co">  - multicode</span></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a><span class="co">  - quarto # keep Quarto’s built-ins as the last filter or it won't work</span></span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-23"><a href="#cb73-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb73-24"><a href="#cb73-24" aria-hidden="true" tabindex="-1"></a><span class="fu">here</span>()</span>
<span id="cb73-25"><a href="#cb73-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-26"><a href="#cb73-26" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-27"><a href="#cb73-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-28"><a href="#cb73-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-31"><a href="#cb73-31" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-32"><a href="#cb73-32" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb73-33"><a href="#cb73-33" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb73-34"><a href="#cb73-34" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb73-35"><a href="#cb73-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-36"><a href="#cb73-36" aria-hidden="true" tabindex="-1"></a><span class="do">## Notes - make sure that reticulate is pointing to a local reticulate install of python or things might go squiffy.</span></span>
<span id="cb73-37"><a href="#cb73-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-38"><a href="#cb73-38" aria-hidden="true" tabindex="-1"></a><span class="do">## in terminal type: where python - to find out where reticulate might have stashed a version of the python.exe</span></span>
<span id="cb73-39"><a href="#cb73-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-40"><a href="#cb73-40" aria-hidden="true" tabindex="-1"></a><span class="do">## make sure you point to it before installing these packages using:</span></span>
<span id="cb73-41"><a href="#cb73-41" aria-hidden="true" tabindex="-1"></a><span class="do">## reticulate::use_python("C:/Path/To/Your/Python/python.exe", required = TRUE)</span></span>
<span id="cb73-42"><a href="#cb73-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-43"><a href="#cb73-43" aria-hidden="true" tabindex="-1"></a><span class="co">#renv::install("C:/GitHubRepos/casaviz.zip")</span></span>
<span id="cb73-44"><a href="#cb73-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Get all packages from the lockfile</span></span>
<span id="cb73-45"><a href="#cb73-45" aria-hidden="true" tabindex="-1"></a><span class="co">#lockfile &lt;- renv::load("renv.lock")</span></span>
<span id="cb73-46"><a href="#cb73-46" aria-hidden="true" tabindex="-1"></a><span class="co">#packages &lt;- setdiff(names(lockfile$Packages), "casaviz")</span></span>
<span id="cb73-47"><a href="#cb73-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-48"><a href="#cb73-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Restore only the selected packages</span></span>
<span id="cb73-49"><a href="#cb73-49" aria-hidden="true" tabindex="-1"></a><span class="co">#renv::restore(packages = packages)</span></span>
<span id="cb73-50"><a href="#cb73-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-51"><a href="#cb73-51" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reticulate)</span>
<span id="cb73-52"><a href="#cb73-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-53"><a href="#cb73-53" aria-hidden="true" tabindex="-1"></a><span class="co">#virtualenv_list()</span></span>
<span id="cb73-54"><a href="#cb73-54" aria-hidden="true" tabindex="-1"></a><span class="co">#virtualenv_root()</span></span>
<span id="cb73-55"><a href="#cb73-55" aria-hidden="true" tabindex="-1"></a><span class="co">#use_virtualenv(virtualenv = NULL, required = NULL)</span></span>
<span id="cb73-56"><a href="#cb73-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-57"><a href="#cb73-57" aria-hidden="true" tabindex="-1"></a><span class="co">#reticulate::virtualenv_remove("r-reticulate")</span></span>
<span id="cb73-58"><a href="#cb73-58" aria-hidden="true" tabindex="-1"></a><span class="co"># point reticulate to the right python installation - ideally the one reticulate installed. </span></span>
<span id="cb73-59"><a href="#cb73-59" aria-hidden="true" tabindex="-1"></a><span class="co">#reticulate::use_python("C:/Users/Adam/AppData/Local/R/cache/R/reticulate/uv/cache/archive-v0/EiTNi4omakhlev5ckz2WP/Scripts/python.exe", required = TRUE)</span></span>
<span id="cb73-60"><a href="#cb73-60" aria-hidden="true" tabindex="-1"></a><span class="co">#use_condaenv("qmEnv", conda = "C:/Users/adam_/anaconda3/Scripts/conda.exe", required = TRUE)</span></span>
<span id="cb73-61"><a href="#cb73-61" aria-hidden="true" tabindex="-1"></a><span class="co">#reticulate::use_python("C:/Users/adam_/anaconda3/envs/qmEnv/python.exe", required = TRUE)</span></span>
<span id="cb73-62"><a href="#cb73-62" aria-hidden="true" tabindex="-1"></a><span class="co">#py_run_string("import pyproj; print(pyproj.CRS.from_epsg(27700))")</span></span>
<span id="cb73-63"><a href="#cb73-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-64"><a href="#cb73-64" aria-hidden="true" tabindex="-1"></a><span class="co">#virtualenv_create("r-reticulate", python = "C:/Users/Adam/AppData/Local/R/cache/R/reticulate/uv/cache/archive-v0/EiTNi4omakhlev5ckz2WP/Scripts/python.exe")</span></span>
<span id="cb73-65"><a href="#cb73-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-66"><a href="#cb73-66" aria-hidden="true" tabindex="-1"></a><span class="co">#virtualenv_install("r-reticulate", packages = c("pyyaml", "jupyter", "statsmodels","pyjanitor","pathlib","matplotlib","pandas", "numpy", "scipy", "seaborn", "geopandas", "folium", "branca"))</span></span>
<span id="cb73-67"><a href="#cb73-67" aria-hidden="true" tabindex="-1"></a><span class="co">#use_virtualenv("r-reticulate", required = TRUE)</span></span>
<span id="cb73-68"><a href="#cb73-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-69"><a href="#cb73-69" aria-hidden="true" tabindex="-1"></a><span class="co"># reticulate::py_config()</span></span>
<span id="cb73-70"><a href="#cb73-70" aria-hidden="true" tabindex="-1"></a><span class="co"># reticulate::py_require("pyyaml")</span></span>
<span id="cb73-71"><a href="#cb73-71" aria-hidden="true" tabindex="-1"></a><span class="co"># reticulate::py_require("jupyter")</span></span>
<span id="cb73-72"><a href="#cb73-72" aria-hidden="true" tabindex="-1"></a><span class="co"># reticulate::py_require("statsmodels")</span></span>
<span id="cb73-73"><a href="#cb73-73" aria-hidden="true" tabindex="-1"></a><span class="co"># reticulate::py_require("pandas")</span></span>
<span id="cb73-74"><a href="#cb73-74" aria-hidden="true" tabindex="-1"></a><span class="co"># reticulate::py_require("numpy")</span></span>
<span id="cb73-75"><a href="#cb73-75" aria-hidden="true" tabindex="-1"></a><span class="co"># reticulate::py_require("pyjanitor")</span></span>
<span id="cb73-76"><a href="#cb73-76" aria-hidden="true" tabindex="-1"></a><span class="co"># reticulate::py_require("pathlib") </span></span>
<span id="cb73-77"><a href="#cb73-77" aria-hidden="true" tabindex="-1"></a><span class="co"># reticulate::py_require("matplotlib") </span></span>
<span id="cb73-78"><a href="#cb73-78" aria-hidden="true" tabindex="-1"></a><span class="co"># reticulate::py_require("seaborn") </span></span>
<span id="cb73-79"><a href="#cb73-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-80"><a href="#cb73-80" aria-hidden="true" tabindex="-1"></a><span class="co">#reticulate::py_install("folium")</span></span>
<span id="cb73-81"><a href="#cb73-81" aria-hidden="true" tabindex="-1"></a><span class="co">#reticulate::py_install("geopandas") </span></span>
<span id="cb73-82"><a href="#cb73-82" aria-hidden="true" tabindex="-1"></a><span class="co">#reticulate::py_install("contextily", pip = TRUE)</span></span>
<span id="cb73-83"><a href="#cb73-83" aria-hidden="true" tabindex="-1"></a><span class="co">#reticulate::py_install("scikit-learn", pip = TRUE)</span></span>
<span id="cb73-84"><a href="#cb73-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-85"><a href="#cb73-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-86"><a href="#cb73-86" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-87"><a href="#cb73-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-88"><a href="#cb73-88" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb73-89"><a href="#cb73-89" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;iframe data-testid="embed-iframe" style="border-radius:12px" src="https://open.spotify.com/embed/track/1f2SbTAoE90QelFZlrpzxT?utm_source=generator" width="100%" height="352" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"&gt;&lt;/iframe&gt;</span></span>
<span id="cb73-90"><a href="#cb73-90" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-91"><a href="#cb73-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-92"><a href="#cb73-92" aria-hidden="true" tabindex="-1"></a><span class="fu">## Preamble</span></span>
<span id="cb73-93"><a href="#cb73-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-94"><a href="#cb73-94" aria-hidden="true" tabindex="-1"></a>Over the next 3 weeks we are going **DEEP** into linear regression. The QM Regression Sessions will be tough, but we will be eased through the journey in the company of LTJ Bukem, Blame, Conrad and others. Plug into the Progression Sessions, let them sooth your mind and allow you to get fully into the Regression Sessions!</span>
<span id="cb73-95"><a href="#cb73-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-96"><a href="#cb73-96" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction</span></span>
<span id="cb73-97"><a href="#cb73-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-98"><a href="#cb73-98" aria-hidden="true" tabindex="-1"></a>This week's practical is focused on understanding the most basic form of regression analysis, but in an applied context discovering what these models help you understand about your data in great detail. You will essentially re-create some of the analysis you saw in the lecture, but for slightly different variables and for different places.</span>
<span id="cb73-99"><a href="#cb73-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-100"><a href="#cb73-100" aria-hidden="true" tabindex="-1"></a>Most of what you will be doing in this practical won't actually be modelling - although this will come at the end - but you will be getting to know your data so that your final models make sense. This is how it should be!! Going back to our bake-off analogy, the modelling is really just the final bake after hours of preparation.</span>
<span id="cb73-101"><a href="#cb73-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-102"><a href="#cb73-102" aria-hidden="true" tabindex="-1"></a><span class="fu">## Aims</span></span>
<span id="cb73-103"><a href="#cb73-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-104"><a href="#cb73-104" aria-hidden="true" tabindex="-1"></a>By the end of this week's regression session you should:</span>
<span id="cb73-105"><a href="#cb73-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-106"><a href="#cb73-106" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Be able to use R or Python to process data in order to carry out a scientific investigation</span>
<span id="cb73-107"><a href="#cb73-107" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Feel comfortable in plotting and visualising that processed data to assess relationships between x and y variables</span>
<span id="cb73-108"><a href="#cb73-108" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Understand how to use built-in statistical software functions in R and Python to run specify and a basic regression model and produce statistical outputs from those models</span>
<span id="cb73-109"><a href="#cb73-109" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Interpret those model outputs critically in order to evaluate the strenght and direction of the relationships you are observing. </span>
<span id="cb73-110"><a href="#cb73-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-111"><a href="#cb73-111" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb73-112"><a href="#cb73-112" aria-hidden="true" tabindex="-1"></a>Below you will find code-blocks that will allow you to run your analysis in either R or Python. It's up to you which you decide to use - you might even want to try both to compare (Of course, R will be better)!</span>
<span id="cb73-113"><a href="#cb73-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-114"><a href="#cb73-114" aria-hidden="true" tabindex="-1"></a>The Juypter notebook attached to this practical *might* work, but you are probably better off just firing up RStudio or VS code, creating a new notebook and editing from scratch on your local machine.</span>
<span id="cb73-115"><a href="#cb73-115" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb73-116"><a href="#cb73-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-117"><a href="#cb73-117" aria-hidden="true" tabindex="-1"></a><span class="fu">## Tasks</span></span>
<span id="cb73-118"><a href="#cb73-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-119"><a href="#cb73-119" aria-hidden="true" tabindex="-1"></a>::: callout-warning</span>
<span id="cb73-120"><a href="#cb73-120" aria-hidden="true" tabindex="-1"></a>Make sure you complete each of the tasks below, 1-4. All of these will be covered in the code examples as you work your way down the page, but this is the full <span class="co">[</span><span class="ot">workflow</span><span class="co">](https://dictionary.cambridge.org/dictionary/english/workflow)</span>:</span>
<span id="cb73-121"><a href="#cb73-121" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb73-122"><a href="#cb73-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-123"><a href="#cb73-123" aria-hidden="true" tabindex="-1"></a><span class="fu">### 1. Downloading: Download and read data into your software environment:</span></span>
<span id="cb73-124"><a href="#cb73-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-125"><a href="#cb73-125" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>School locational and attribute information, downloaded from here - <span class="ot">&lt;https://get-information-schools.service.gov.uk/Downloads&gt;</span> - or read it in using the code supplied below. This will include the following datasets:</span>
<span id="cb73-126"><a href="#cb73-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-127"><a href="#cb73-127" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**edubase_schools** = this is the 'all establishment' data for every school in England and Wales</span>
<span id="cb73-128"><a href="#cb73-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-129"><a href="#cb73-129" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>School-level Key Stage 4 (14-16 GCSE level) attainment and other attribute information. <span class="co">[</span><span class="ot">I have put this on Moodle here</span><span class="co">](https://moodle.ucl.ac.uk/mod/folder/view.php?id=8199904)</span>, but it can also be downloaded from here - <span class="ot">&lt;https://www.compare-school-performance.service.gov.uk/download-data&gt;</span>.</span>
<span id="cb73-130"><a href="#cb73-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-131"><a href="#cb73-131" aria-hidden="true" tabindex="-1"></a>    Download to a local drive on your computer from Moodle, unzip it and then read it in using the code supplied below. The zip folders contain the following data files in one folder and the associated metadata in the other folder:</span>
<span id="cb73-132"><a href="#cb73-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-133"><a href="#cb73-133" aria-hidden="true" tabindex="-1"></a>    a.  **england_ks4final** = data on the 2022/23 academic year, school-level, KS4 outcomes and associated statistics</span>
<span id="cb73-134"><a href="#cb73-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-135"><a href="#cb73-135" aria-hidden="true" tabindex="-1"></a>    b.  **england_abs** = data on the 2022/23 academic year, school-level absence rates</span>
<span id="cb73-136"><a href="#cb73-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-137"><a href="#cb73-137" aria-hidden="true" tabindex="-1"></a>    c.  **england_census** = additional school-level pupil information for the 2022/23 academic year</span>
<span id="cb73-138"><a href="#cb73-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-139"><a href="#cb73-139" aria-hidden="true" tabindex="-1"></a>    d.  **england_school_information** = additional school-level institution information such as Ofsted rating etc. for the 2022/23 academic year</span>
<span id="cb73-140"><a href="#cb73-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-141"><a href="#cb73-141" aria-hidden="true" tabindex="-1"></a>    e.  **england_ks4_pupdest** = pupil destination data (where students go once they leave school at 16)</span>
<span id="cb73-142"><a href="#cb73-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-143"><a href="#cb73-143" aria-hidden="true" tabindex="-1"></a><span class="fu">### 2. Data Munging: Join, filter, select and subset:</span></span>
<span id="cb73-144"><a href="#cb73-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-145"><a href="#cb73-145" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Create a master file for England called **england_school_2022_23.** This will be made by joining together all of the school-level data above into a single file and then reducing it in size using:</span>
<span id="cb73-146"><a href="#cb73-146" aria-hidden="true" tabindex="-1"></a>    a.  **filter** - so that it just contains open secondary schools</span>
<span id="cb73-147"><a href="#cb73-147" aria-hidden="true" tabindex="-1"></a>    b.  **select** - so that only a few key variables relating to attainment, progress, deprivation, absence and school quality remain, alongside key locational and other attributes.</span>
<span id="cb73-148"><a href="#cb73-148" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Create two local authority data **subsets** from this main file:</span>
<span id="cb73-149"><a href="#cb73-149" aria-hidden="true" tabindex="-1"></a>    a.  A subset containing all of the secondary schools in one of the 32 London Boroughs (not including the City of London)</span>
<span id="cb73-150"><a href="#cb73-150" aria-hidden="true" tabindex="-1"></a>    b.  A subset containing all of the secondary schools in any other local authority in England. Any local authority you like - go wild!</span>
<span id="cb73-151"><a href="#cb73-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-152"><a href="#cb73-152" aria-hidden="true" tabindex="-1"></a>At the end of this you will have **x3 datasets** - one national and two local authority subsets</span>
<span id="cb73-153"><a href="#cb73-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-154"><a href="#cb73-154" aria-hidden="true" tabindex="-1"></a><span class="fu">### 3. Exploratory Data Analysis</span></span>
<span id="cb73-155"><a href="#cb73-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-156"><a href="#cb73-156" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Choose:</span>
<span id="cb73-157"><a href="#cb73-157" aria-hidden="true" tabindex="-1"></a>    a.  one attainment related dependent variable from your set</span>
<span id="cb73-158"><a href="#cb73-158" aria-hidden="true" tabindex="-1"></a>    b.  one possible explanatory variable which you think might help explain levels of attainment in schools</span>
<span id="cb73-159"><a href="#cb73-159" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Create a series of graphs and statistical outputs to allow you to understand the structure and composition of your data. You should produce:</span>
<span id="cb73-160"><a href="#cb73-160" aria-hidden="true" tabindex="-1"></a>    a.  A histogram for the dependent and independent variables you are analysing for **both your two subsets** and the **national dataset** (x6 histograms in total). You might want to augment your histograms to include:</span>
<span id="cb73-161"><a href="#cb73-161" aria-hidden="true" tabindex="-1"></a>        i.  mean and median lines</span>
<span id="cb73-162"><a href="#cb73-162" aria-hidden="true" tabindex="-1"></a>        ii. lines for the upper and lower quartiles</span>
<span id="cb73-163"><a href="#cb73-163" aria-hidden="true" tabindex="-1"></a>        iii. indications of outliners</span>
<span id="cb73-164"><a href="#cb73-164" aria-hidden="true" tabindex="-1"></a>        iv. a kernel density smoothing</span>
<span id="cb73-165"><a href="#cb73-165" aria-hidden="true" tabindex="-1"></a>    b.  Alternative plots such as violin plots or box plots to compare with the histogram</span>
<span id="cb73-166"><a href="#cb73-166" aria-hidden="true" tabindex="-1"></a>    c.  Point Maps of the locations of your schools in your two subsets - points sized by either of your variables</span>
<span id="cb73-167"><a href="#cb73-167" aria-hidden="true" tabindex="-1"></a>    d.  A scatter plot of your dependent (attainment) and independent (disadvantage) variables (national and two local subsets) - on these plots you might want to include:</span>
<span id="cb73-168"><a href="#cb73-168" aria-hidden="true" tabindex="-1"></a>        i.  a regression line of best fit</span>
<span id="cb73-169"><a href="#cb73-169" aria-hidden="true" tabindex="-1"></a>        ii. the R-squared, slope and intercept parameters</span>
<span id="cb73-170"><a href="#cb73-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-171"><a href="#cb73-171" aria-hidden="true" tabindex="-1"></a><span class="fu">### 4. Explanatory Data Analysis - Attainment and Factors Affecting it in Different Parts of England</span></span>
<span id="cb73-172"><a href="#cb73-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-173"><a href="#cb73-173" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Carry out a bi-variate regression analysis to explore the relationship between your chosen attainment dependent variable and your single explanatory independent variable, for your two subsets and the national dataset. **Questions to Answer**:</span>
<span id="cb73-174"><a href="#cb73-174" aria-hidden="true" tabindex="-1"></a>    a.  After visualising the relationships using scatter plots, do you think you need to transform your variables (e.g. using a log transformation) before putting into a regression model? Maybe plot scatter plots of your logged variables too!</span>
<span id="cb73-175"><a href="#cb73-175" aria-hidden="true" tabindex="-1"></a>    b.  What are the slope and intercept coefficients in each model? Are they statistically significant and how do vary between your two subsets? How do they compare with the national picture?</span>
<span id="cb73-176"><a href="#cb73-176" aria-hidden="true" tabindex="-1"></a>    c.  How do the R-squared values differ and how reliable do you think they are (what do the degrees of freedom tell you)?</span>
<span id="cb73-177"><a href="#cb73-177" aria-hidden="true" tabindex="-1"></a>    d.  What observations can you make about your two local authority study areas relative to the national picture?</span>
<span id="cb73-178"><a href="#cb73-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-179"><a href="#cb73-179" aria-hidden="true" tabindex="-1"></a><span class="fu">## Task 1 - Download your data and read into your software environment</span></span>
<span id="cb73-180"><a href="#cb73-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-181"><a href="#cb73-181" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>I've made this task easy for you by giving you the code to download all of this data. You'll need to download a selection of files - click on either tab to see the code for each.</span>
<span id="cb73-182"><a href="#cb73-182" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>In order to run this code, you should first <span class="co">[</span><span class="ot">download and unzip the data from Moodle</span><span class="co">](https://moodle.ucl.ac.uk/mod/folder/view.php?id=8199904)</span>, before editing the code below so that you can read the data from a local folder on your computer:</span>
<span id="cb73-183"><a href="#cb73-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-184"><a href="#cb73-184" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb73-185"><a href="#cb73-185" aria-hidden="true" tabindex="-1"></a>I would encourage you **NOT** to just copy and paste this code blindly, but try to understand what it is doing at each stage.</span>
<span id="cb73-186"><a href="#cb73-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-187"><a href="#cb73-187" aria-hidden="true" tabindex="-1"></a>You may notice that there are some bits that are redundant (some of the NA code that I was messing with before deciding on a single way of removing NAs).</span>
<span id="cb73-188"><a href="#cb73-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-189"><a href="#cb73-189" aria-hidden="true" tabindex="-1"></a>What am I doing to the URN field? Why might I be doing that?</span>
<span id="cb73-190"><a href="#cb73-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-191"><a href="#cb73-191" aria-hidden="true" tabindex="-1"></a>What is the regex function doing and why might I be searching out those characters? What might happen to the data if I didn't handle those first?</span>
<span id="cb73-192"><a href="#cb73-192" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb73-193"><a href="#cb73-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-194"><a href="#cb73-194" aria-hidden="true" tabindex="-1"></a>::: qna</span>
<span id="cb73-195"><a href="#cb73-195" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/python-logo-only.png){width="30"}</span></span>
<span id="cb73-196"><a href="#cb73-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-199"><a href="#cb73-199" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb73-200"><a href="#cb73-200" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb73-201"><a href="#cb73-201" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb73-202"><a href="#cb73-202" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> janitor</span>
<span id="cb73-203"><a href="#cb73-203" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb73-204"><a href="#cb73-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-205"><a href="#cb73-205" aria-hidden="true" tabindex="-1"></a><span class="co"># little function to define the file root on different machines</span></span>
<span id="cb73-206"><a href="#cb73-206" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_qm_root(start_path: Path <span class="op">=</span> Path.cwd(), anchor: <span class="bu">str</span> <span class="op">=</span> <span class="st">"QM"</span>) <span class="op">-&gt;</span> Path:</span>
<span id="cb73-207"><a href="#cb73-207" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb73-208"><a href="#cb73-208" aria-hidden="true" tabindex="-1"></a><span class="co">    Traverse up from the start_path until the anchor folder (e.g., 'QM')      is found. Returns the path to the anchor folder.</span></span>
<span id="cb73-209"><a href="#cb73-209" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb73-210"><a href="#cb73-210" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> parent <span class="kw">in</span> [start_path] <span class="op">+</span> <span class="bu">list</span>(start_path.parents):</span>
<span id="cb73-211"><a href="#cb73-211" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> parent.name <span class="op">==</span> anchor:</span>
<span id="cb73-212"><a href="#cb73-212" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> parent</span>
<span id="cb73-213"><a href="#cb73-213" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">FileNotFoundError</span>(<span class="ss">f"Anchor folder '</span><span class="sc">{</span>anchor<span class="sc">}</span><span class="ss">' not found in path      hierarchy."</span>)</span>
<span id="cb73-214"><a href="#cb73-214" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb73-215"><a href="#cb73-215" aria-hidden="true" tabindex="-1"></a>qm_root <span class="op">=</span> find_qm_root()</span>
<span id="cb73-216"><a href="#cb73-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-217"><a href="#cb73-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-218"><a href="#cb73-218" aria-hidden="true" tabindex="-1"></a><span class="co"># Read CSV file</span></span>
<span id="cb73-219"><a href="#cb73-219" aria-hidden="true" tabindex="-1"></a>edubase_schools <span class="op">=</span> pd.read_csv(</span>
<span id="cb73-220"><a href="#cb73-220" aria-hidden="true" tabindex="-1"></a>    <span class="st">"https://www.dropbox.com/scl/fi/fhzafgt27v30lmmuo084y/edubasealldata20241003.csv?rlkey=uorw43s44hnw5k9js3z0ksuuq&amp;raw=1"</span>,</span>
<span id="cb73-221"><a href="#cb73-221" aria-hidden="true" tabindex="-1"></a>    encoding<span class="op">=</span><span class="st">"cp1252"</span>,</span>
<span id="cb73-222"><a href="#cb73-222" aria-hidden="true" tabindex="-1"></a>    low_memory<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb73-223"><a href="#cb73-223" aria-hidden="true" tabindex="-1"></a>    dtype<span class="op">=</span>{<span class="st">"URN"</span>: <span class="bu">str</span>}</span>
<span id="cb73-224"><a href="#cb73-224" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb73-225"><a href="#cb73-225" aria-hidden="true" tabindex="-1"></a>edubase_schools <span class="op">=</span> edubase_schools.clean_names()</span>
<span id="cb73-226"><a href="#cb73-226" aria-hidden="true" tabindex="-1"></a><span class="co">#py_edubase_schools.dtypes</span></span>
<span id="cb73-227"><a href="#cb73-227" aria-hidden="true" tabindex="-1"></a><span class="co">#dtype_df = py_edubase_schools.dtypes.reset_index()</span></span>
<span id="cb73-228"><a href="#cb73-228" aria-hidden="true" tabindex="-1"></a><span class="co">#dtype_df.columns = ["column_name", "dtype"]</span></span>
<span id="cb73-229"><a href="#cb73-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-230"><a href="#cb73-230" aria-hidden="true" tabindex="-1"></a><span class="co">########################################</span></span>
<span id="cb73-231"><a href="#cb73-231" aria-hidden="true" tabindex="-1"></a><span class="co"># Define base path and common NA values - </span><span class="al">NOTE</span><span class="co"> YOU WILL NEED TO DOWNLOAD THIS DATA AND PUT INTO YOUR OWN base_path LOCATION ON YOUR MACHINE - not this one as this is my path!!!</span></span>
<span id="cb73-232"><a href="#cb73-232" aria-hidden="true" tabindex="-1"></a><span class="co">#base_path = Path("E:/QM/sessions/L6_data/Performancetables_130242/2022-2023")</span></span>
<span id="cb73-233"><a href="#cb73-233" aria-hidden="true" tabindex="-1"></a>base_path <span class="op">=</span> qm_root <span class="op">/</span> <span class="st">"sessions"</span> <span class="op">/</span> <span class="st">"L6_data"</span> <span class="op">/</span> <span class="st">"Performancetables_130242"</span> <span class="op">/</span> <span class="st">"2022-2023"</span></span>
<span id="cb73-234"><a href="#cb73-234" aria-hidden="true" tabindex="-1"></a><span class="co">##################################################</span></span>
<span id="cb73-235"><a href="#cb73-235" aria-hidden="true" tabindex="-1"></a>na_values_common <span class="op">=</span> [<span class="st">""</span>, <span class="st">"NA"</span>, <span class="st">"SUPP"</span>, <span class="st">"NP"</span>, <span class="st">"NE"</span>]</span>
<span id="cb73-236"><a href="#cb73-236" aria-hidden="true" tabindex="-1"></a>na_values_extended <span class="op">=</span> na_values_common <span class="op">+</span> [<span class="st">"SP"</span>, <span class="st">"SN"</span>]</span>
<span id="cb73-237"><a href="#cb73-237" aria-hidden="true" tabindex="-1"></a>na_values_attainment <span class="op">=</span> na_values_extended <span class="op">+</span> [<span class="st">"LOWCOV"</span>, <span class="st">"NEW"</span>]</span>
<span id="cb73-238"><a href="#cb73-238" aria-hidden="true" tabindex="-1"></a>na_values_mats <span class="op">=</span> na_values_common <span class="op">+</span> [<span class="st">"SUPPMAT"</span>]</span>
<span id="cb73-239"><a href="#cb73-239" aria-hidden="true" tabindex="-1"></a>na_all <span class="op">=</span> [<span class="st">""</span>, <span class="st">"NA"</span>, <span class="st">"SUPP"</span>, <span class="st">"NP"</span>, <span class="st">"NE"</span>, <span class="st">"SP"</span>, <span class="st">"SN"</span>, <span class="st">"LOWCOV"</span>, <span class="st">"NEW"</span>, <span class="st">"SUPPMAT"</span>, <span class="st">"NaN"</span>]</span>
<span id="cb73-240"><a href="#cb73-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-241"><a href="#cb73-241" aria-hidden="true" tabindex="-1"></a><span class="co"># Absence data</span></span>
<span id="cb73-242"><a href="#cb73-242" aria-hidden="true" tabindex="-1"></a>england_abs <span class="op">=</span> pd.read_csv(base_path <span class="op">/</span> <span class="st">"england_abs.csv"</span>, na_values<span class="op">=</span>na_all, dtype<span class="op">=</span>{<span class="st">"URN"</span>: <span class="bu">str</span>})</span>
<span id="cb73-243"><a href="#cb73-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-244"><a href="#cb73-244" aria-hidden="true" tabindex="-1"></a><span class="co"># Census data</span></span>
<span id="cb73-245"><a href="#cb73-245" aria-hidden="true" tabindex="-1"></a>england_census <span class="op">=</span> pd.read_csv(base_path <span class="op">/</span> <span class="st">"england_census.csv"</span>, na_values<span class="op">=</span>na_all, dtype<span class="op">=</span>{<span class="st">"URN"</span>: <span class="bu">str</span>})</span>
<span id="cb73-246"><a href="#cb73-246" aria-hidden="true" tabindex="-1"></a>england_census.iloc[:, <span class="dv">4</span>:<span class="dv">23</span>] <span class="op">=</span> england_census.iloc[:, <span class="dv">4</span>:<span class="dv">23</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> col: pd.to_numeric(col.astype(<span class="bu">str</span>).<span class="bu">str</span>.replace(<span class="st">'%'</span>, <span class="st">''</span>, regex<span class="op">=</span><span class="va">False</span>), errors<span class="op">=</span><span class="st">"coerce"</span>))</span>
<span id="cb73-247"><a href="#cb73-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-248"><a href="#cb73-248" aria-hidden="true" tabindex="-1"></a><span class="co"># KS4 MATs performance data</span></span>
<span id="cb73-249"><a href="#cb73-249" aria-hidden="true" tabindex="-1"></a>england_ks4_mats_performance <span class="op">=</span> pd.read_csv(base_path <span class="op">/</span> <span class="st">"england_ks4-mats-performance.csv"</span>, na_values<span class="op">=</span>na_all, encoding<span class="op">=</span><span class="st">"cp1252"</span>, low_memory<span class="op">=</span><span class="va">False</span>, dtype<span class="op">=</span>{<span class="st">"URN"</span>: <span class="bu">str</span>})</span>
<span id="cb73-250"><a href="#cb73-250" aria-hidden="true" tabindex="-1"></a>england_ks4_mats_performance[<span class="st">"TRUST_UID"</span>] <span class="op">=</span> england_ks4_mats_performance[<span class="st">"TRUST_UID"</span>].astype(<span class="bu">str</span>)</span>
<span id="cb73-251"><a href="#cb73-251" aria-hidden="true" tabindex="-1"></a>england_ks4_mats_performance[<span class="st">"P8_BANDING"</span>] <span class="op">=</span> england_ks4_mats_performance[<span class="st">"P8_BANDING"</span>].astype(<span class="bu">str</span>)</span>
<span id="cb73-252"><a href="#cb73-252" aria-hidden="true" tabindex="-1"></a>england_ks4_mats_performance[<span class="st">"INSTITUTIONS_INMAT"</span>] <span class="op">=</span> england_ks4_mats_performance[<span class="st">"INSTITUTIONS_INMAT"</span>].astype(<span class="bu">str</span>)</span>
<span id="cb73-253"><a href="#cb73-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-254"><a href="#cb73-254" aria-hidden="true" tabindex="-1"></a>cols_to_convert <span class="op">=</span> england_ks4_mats_performance.columns[<span class="dv">10</span>:]</span>
<span id="cb73-255"><a href="#cb73-255" aria-hidden="true" tabindex="-1"></a>exclude <span class="op">=</span> [<span class="st">"P8_BANDING"</span>, <span class="st">"INSTITUTIONS_INMAT"</span>]</span>
<span id="cb73-256"><a href="#cb73-256" aria-hidden="true" tabindex="-1"></a>cols_to_convert <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> cols_to_convert <span class="cf">if</span> col <span class="kw">not</span> <span class="kw">in</span> exclude]</span>
<span id="cb73-257"><a href="#cb73-257" aria-hidden="true" tabindex="-1"></a>england_ks4_mats_performance[cols_to_convert] <span class="op">=</span> england_ks4_mats_performance[cols_to_convert].<span class="bu">apply</span>(<span class="kw">lambda</span> col: pd.to_numeric(col.astype(<span class="bu">str</span>).<span class="bu">str</span>.replace(<span class="st">'%'</span>, <span class="st">''</span>, regex<span class="op">=</span><span class="va">False</span>), errors<span class="op">=</span><span class="st">"coerce"</span>))</span>
<span id="cb73-258"><a href="#cb73-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-259"><a href="#cb73-259" aria-hidden="true" tabindex="-1"></a><span class="co"># KS4 pupil destination data</span></span>
<span id="cb73-260"><a href="#cb73-260" aria-hidden="true" tabindex="-1"></a>england_ks4_pupdest <span class="op">=</span> pd.read_csv(base_path <span class="op">/</span> <span class="st">"england_ks4-pupdest.csv"</span>, na_values<span class="op">=</span>na_all, dtype<span class="op">=</span>{<span class="st">"URN"</span>: <span class="bu">str</span>})</span>
<span id="cb73-261"><a href="#cb73-261" aria-hidden="true" tabindex="-1"></a>england_ks4_pupdest.iloc[:, <span class="dv">7</span>:<span class="dv">82</span>] <span class="op">=</span> england_ks4_pupdest.iloc[:, <span class="dv">7</span>:<span class="dv">82</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> col: pd.to_numeric(col.astype(<span class="bu">str</span>).<span class="bu">str</span>.replace(<span class="st">'%'</span>, <span class="st">''</span>, regex<span class="op">=</span><span class="va">False</span>), errors<span class="op">=</span><span class="st">"coerce"</span>))</span>
<span id="cb73-262"><a href="#cb73-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-263"><a href="#cb73-263" aria-hidden="true" tabindex="-1"></a><span class="co"># KS4 final attainment data</span></span>
<span id="cb73-264"><a href="#cb73-264" aria-hidden="true" tabindex="-1"></a>england_ks4final <span class="op">=</span> pd.read_csv(base_path <span class="op">/</span> <span class="st">"england_ks4final.csv"</span>, na_values<span class="op">=</span>na_all, dtype<span class="op">=</span>{<span class="st">"URN"</span>: <span class="bu">str</span>})</span>
<span id="cb73-265"><a href="#cb73-265" aria-hidden="true" tabindex="-1"></a>start_col <span class="op">=</span> <span class="st">"TOTPUPS"</span></span>
<span id="cb73-266"><a href="#cb73-266" aria-hidden="true" tabindex="-1"></a>end_col <span class="op">=</span> <span class="st">"PTOTENT_E_COVID_IMPACTED_PTQ_EE"</span></span>
<span id="cb73-267"><a href="#cb73-267" aria-hidden="true" tabindex="-1"></a>cols_range <span class="op">=</span> england_ks4final.loc[:, start_col:end_col].columns</span>
<span id="cb73-268"><a href="#cb73-268" aria-hidden="true" tabindex="-1"></a><span class="co"># Strip % signs and convert to numeric</span></span>
<span id="cb73-269"><a href="#cb73-269" aria-hidden="true" tabindex="-1"></a>england_ks4final[cols_range] <span class="op">=</span> england_ks4final[cols_range].<span class="bu">apply</span>(</span>
<span id="cb73-270"><a href="#cb73-270" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> col: pd.to_numeric(col.astype(<span class="bu">str</span>).<span class="bu">str</span>.replace(<span class="st">'%'</span>, <span class="st">''</span>, regex<span class="op">=</span><span class="va">False</span>), errors<span class="op">=</span><span class="st">"coerce"</span>)</span>
<span id="cb73-271"><a href="#cb73-271" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb73-272"><a href="#cb73-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-273"><a href="#cb73-273" aria-hidden="true" tabindex="-1"></a><span class="co"># School information data</span></span>
<span id="cb73-274"><a href="#cb73-274" aria-hidden="true" tabindex="-1"></a>england_school_information <span class="op">=</span> pd.read_csv(</span>
<span id="cb73-275"><a href="#cb73-275" aria-hidden="true" tabindex="-1"></a>    base_path <span class="op">/</span> <span class="st">"england_school_information.csv"</span>,</span>
<span id="cb73-276"><a href="#cb73-276" aria-hidden="true" tabindex="-1"></a>    na_values<span class="op">=</span>na_all,</span>
<span id="cb73-277"><a href="#cb73-277" aria-hidden="true" tabindex="-1"></a>    dtype<span class="op">=</span>{<span class="st">"URN"</span>: <span class="bu">str</span>},</span>
<span id="cb73-278"><a href="#cb73-278" aria-hidden="true" tabindex="-1"></a>    parse_dates<span class="op">=</span>[<span class="st">"OFSTEDLASTINSP"</span>],</span>
<span id="cb73-279"><a href="#cb73-279" aria-hidden="true" tabindex="-1"></a>    dayfirst<span class="op">=</span><span class="va">True</span>  <span class="co"># Adjust if needed</span></span>
<span id="cb73-280"><a href="#cb73-280" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb73-281"><a href="#cb73-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-282"><a href="#cb73-282" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-283"><a href="#cb73-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-284"><a href="#cb73-284" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/Rlogo.png){width="41" height="30"}</span></span>
<span id="cb73-285"><a href="#cb73-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-288"><a href="#cb73-288" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-289"><a href="#cb73-289" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb73-290"><a href="#cb73-290" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb73-291"><a href="#cb73-291" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb73-292"><a href="#cb73-292" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb73-293"><a href="#cb73-293" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb73-294"><a href="#cb73-294" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb73-295"><a href="#cb73-295" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb73-296"><a href="#cb73-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-297"><a href="#cb73-297" aria-hidden="true" tabindex="-1"></a><span class="co"># Read CSV file</span></span>
<span id="cb73-298"><a href="#cb73-298" aria-hidden="true" tabindex="-1"></a>edubase_schools <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://www.dropbox.com/scl/fi/fhzafgt27v30lmmuo084y/edubasealldata20241003.csv?rlkey=uorw43s44hnw5k9js3z0ksuuq&amp;raw=1"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb73-299"><a href="#cb73-299" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb73-300"><a href="#cb73-300" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">urn =</span> <span class="fu">as.character</span>(urn))</span>
<span id="cb73-301"><a href="#cb73-301" aria-hidden="true" tabindex="-1"></a><span class="co">#str(r_edubase_schools)</span></span>
<span id="cb73-302"><a href="#cb73-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-303"><a href="#cb73-303" aria-hidden="true" tabindex="-1"></a><span class="co"># Define base path and common NA values - </span><span class="al">NOTE</span><span class="co"> YOU WILL NEED TO DOWNLOAD THIS DATA AND PUT INTO YOUR OWN base_path LOCATION ON YOUR MACHINE</span></span>
<span id="cb73-304"><a href="#cb73-304" aria-hidden="true" tabindex="-1"></a>base_path <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">"sessions"</span>, <span class="st">"L6_data"</span>, <span class="st">"Performancetables_130242"</span>, <span class="st">"2022-2023"</span>)</span>
<span id="cb73-305"><a href="#cb73-305" aria-hidden="true" tabindex="-1"></a>na_common <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">"NA"</span>, <span class="st">"SUPP"</span>, <span class="st">"NP"</span>, <span class="st">"NE"</span>)</span>
<span id="cb73-306"><a href="#cb73-306" aria-hidden="true" tabindex="-1"></a>na_extended <span class="ot">&lt;-</span> <span class="fu">c</span>(na_common, <span class="st">"SP"</span>, <span class="st">"SN"</span>)</span>
<span id="cb73-307"><a href="#cb73-307" aria-hidden="true" tabindex="-1"></a>na_attainment <span class="ot">&lt;-</span> <span class="fu">c</span>(na_extended, <span class="st">"LOWCOV"</span>, <span class="st">"NEW"</span>)</span>
<span id="cb73-308"><a href="#cb73-308" aria-hidden="true" tabindex="-1"></a>na_mats <span class="ot">&lt;-</span> <span class="fu">c</span>(na_common, <span class="st">"SUPPMAT"</span>)</span>
<span id="cb73-309"><a href="#cb73-309" aria-hidden="true" tabindex="-1"></a>na_all <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">"NA"</span>, <span class="st">"SUPP"</span>, <span class="st">"NP"</span>, <span class="st">"NE"</span>, <span class="st">"SP"</span>, <span class="st">"SN"</span>, <span class="st">"LOWCOV"</span>, <span class="st">"NEW"</span>, <span class="st">"SUPPMAT"</span>)</span>
<span id="cb73-310"><a href="#cb73-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-311"><a href="#cb73-311" aria-hidden="true" tabindex="-1"></a><span class="co"># Absence data</span></span>
<span id="cb73-312"><a href="#cb73-312" aria-hidden="true" tabindex="-1"></a>england_abs <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">file.path</span>(base_path, <span class="st">"england_abs.csv"</span>), <span class="at">na =</span> na_all) <span class="sc">|&gt;</span></span>
<span id="cb73-313"><a href="#cb73-313" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">URN =</span> <span class="fu">as.character</span>(URN))</span>
<span id="cb73-314"><a href="#cb73-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-315"><a href="#cb73-315" aria-hidden="true" tabindex="-1"></a><span class="co"># Other School Census data</span></span>
<span id="cb73-316"><a href="#cb73-316" aria-hidden="true" tabindex="-1"></a>england_census <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">file.path</span>(base_path, <span class="st">"england_census.csv"</span>), <span class="at">na =</span> na_all) <span class="sc">|&gt;</span></span>
<span id="cb73-317"><a href="#cb73-317" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">URN =</span> <span class="fu">as.character</span>(URN)) <span class="sc">|&gt;</span></span>
<span id="cb73-318"><a href="#cb73-318" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">23</span>, <span class="sc">~</span> <span class="fu">parse_number</span>(<span class="fu">as.character</span>(.))))</span>
<span id="cb73-319"><a href="#cb73-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-320"><a href="#cb73-320" aria-hidden="true" tabindex="-1"></a><span class="co"># KS4 MATs performance data</span></span>
<span id="cb73-321"><a href="#cb73-321" aria-hidden="true" tabindex="-1"></a><span class="co">#First read</span></span>
<span id="cb73-322"><a href="#cb73-322" aria-hidden="true" tabindex="-1"></a>england_ks4_mats_performance <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb73-323"><a href="#cb73-323" aria-hidden="true" tabindex="-1"></a>  <span class="fu">file.path</span>(base_path, <span class="st">"england_ks4-mats-performance.csv"</span>),</span>
<span id="cb73-324"><a href="#cb73-324" aria-hidden="true" tabindex="-1"></a>  <span class="at">na =</span> na_all</span>
<span id="cb73-325"><a href="#cb73-325" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb73-326"><a href="#cb73-326" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb73-327"><a href="#cb73-327" aria-hidden="true" tabindex="-1"></a>    <span class="at">TRUST_UID =</span> <span class="fu">as.character</span>(TRUST_UID),</span>
<span id="cb73-328"><a href="#cb73-328" aria-hidden="true" tabindex="-1"></a>    <span class="at">P8_BANDING =</span> <span class="fu">as.character</span>(P8_BANDING),</span>
<span id="cb73-329"><a href="#cb73-329" aria-hidden="true" tabindex="-1"></a>    <span class="at">INSTITUTIONS_INMAT =</span> <span class="fu">as.character</span>(INSTITUTIONS_INMAT)</span>
<span id="cb73-330"><a href="#cb73-330" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb73-331"><a href="#cb73-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-332"><a href="#cb73-332" aria-hidden="true" tabindex="-1"></a><span class="co"># Then Identify columns to convert (excluding character columns)</span></span>
<span id="cb73-333"><a href="#cb73-333" aria-hidden="true" tabindex="-1"></a>cols_to_convert <span class="ot">&lt;-</span> england_ks4_mats_performance <span class="sc">|&gt;</span></span>
<span id="cb73-334"><a href="#cb73-334" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>), <span class="sc">-</span>P8_BANDING, <span class="sc">-</span>INSTITUTIONS_INMAT) <span class="sc">|&gt;</span></span>
<span id="cb73-335"><a href="#cb73-335" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>()</span>
<span id="cb73-336"><a href="#cb73-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-337"><a href="#cb73-337" aria-hidden="true" tabindex="-1"></a><span class="co"># Then apply parse_number safely to convert characters to numbers</span></span>
<span id="cb73-338"><a href="#cb73-338" aria-hidden="true" tabindex="-1"></a>england_ks4_mats_performance <span class="ot">&lt;-</span> england_ks4_mats_performance <span class="sc">|&gt;</span></span>
<span id="cb73-339"><a href="#cb73-339" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(cols_to_convert), <span class="sc">~</span> <span class="fu">parse_number</span>(<span class="fu">as.character</span>(.))))</span>
<span id="cb73-340"><a href="#cb73-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-341"><a href="#cb73-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-342"><a href="#cb73-342" aria-hidden="true" tabindex="-1"></a><span class="co"># KS4 pupil destination data</span></span>
<span id="cb73-343"><a href="#cb73-343" aria-hidden="true" tabindex="-1"></a>england_ks4_pupdest <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">file.path</span>(base_path, <span class="st">"england_ks4-pupdest.csv"</span>), <span class="at">na =</span> na_all) <span class="sc">|&gt;</span></span>
<span id="cb73-344"><a href="#cb73-344" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">URN =</span> <span class="fu">as.character</span>(URN)) <span class="sc">|&gt;</span></span>
<span id="cb73-345"><a href="#cb73-345" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="dv">8</span><span class="sc">:</span><span class="dv">82</span>, <span class="sc">~</span> <span class="fu">parse_number</span>(<span class="fu">as.character</span>(.))))</span>
<span id="cb73-346"><a href="#cb73-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-347"><a href="#cb73-347" aria-hidden="true" tabindex="-1"></a><span class="co"># KS4 final attainment data</span></span>
<span id="cb73-348"><a href="#cb73-348" aria-hidden="true" tabindex="-1"></a>england_ks4final <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">file.path</span>(base_path, <span class="st">"england_ks4final.csv"</span>), <span class="at">na =</span> na_all) <span class="sc">|&gt;</span></span>
<span id="cb73-349"><a href="#cb73-349" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">URN =</span> <span class="fu">as.character</span>(URN)) <span class="sc">|&gt;</span></span>
<span id="cb73-350"><a href="#cb73-350" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(TOTPUPS<span class="sc">:</span>PTOTENT_E_COVID_IMPACTED_PTQ_EE, <span class="sc">~</span> <span class="fu">parse_number</span>(<span class="fu">as.character</span>(.))))</span>
<span id="cb73-351"><a href="#cb73-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-352"><a href="#cb73-352" aria-hidden="true" tabindex="-1"></a><span class="co"># School information data</span></span>
<span id="cb73-353"><a href="#cb73-353" aria-hidden="true" tabindex="-1"></a>england_school_information <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb73-354"><a href="#cb73-354" aria-hidden="true" tabindex="-1"></a>  <span class="fu">file.path</span>(base_path, <span class="st">"england_school_information.csv"</span>),</span>
<span id="cb73-355"><a href="#cb73-355" aria-hidden="true" tabindex="-1"></a>  <span class="at">na =</span> na_all,</span>
<span id="cb73-356"><a href="#cb73-356" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_types =</span> <span class="fu">cols</span>(</span>
<span id="cb73-357"><a href="#cb73-357" aria-hidden="true" tabindex="-1"></a>    <span class="at">URN =</span> <span class="fu">col_character</span>(),</span>
<span id="cb73-358"><a href="#cb73-358" aria-hidden="true" tabindex="-1"></a>    <span class="at">OFSTEDLASTINSP =</span> <span class="fu">col_date</span>(<span class="at">format =</span> <span class="st">"%d-%m-%Y"</span>)</span>
<span id="cb73-359"><a href="#cb73-359" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb73-360"><a href="#cb73-360" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb73-361"><a href="#cb73-361" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-362"><a href="#cb73-362" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb73-363"><a href="#cb73-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-364"><a href="#cb73-364" aria-hidden="true" tabindex="-1"></a><span class="fu">## Task 2 - Data Munging</span></span>
<span id="cb73-365"><a href="#cb73-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-366"><a href="#cb73-366" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Use Python or R to join all of the datasets you loaded in the previous step into a single master file that we will called <span class="in">`england_school_2022_23`</span> using the unique school reference number (URN) as the key.</span>
<span id="cb73-367"><a href="#cb73-367" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Create the master file:</span>
<span id="cb73-368"><a href="#cb73-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-369"><a href="#cb73-369" aria-hidden="true" tabindex="-1"></a>::: qna</span>
<span id="cb73-370"><a href="#cb73-370" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/python-logo-only.png){width="30"}</span></span>
<span id="cb73-371"><a href="#cb73-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-374"><a href="#cb73-374" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb73-375"><a href="#cb73-375" aria-hidden="true" tabindex="-1"></a><span class="co"># Left join england_ks4final with england_abs, census, and school information</span></span>
<span id="cb73-376"><a href="#cb73-376" aria-hidden="true" tabindex="-1"></a>england_school_2022_23 <span class="op">=</span> (</span>
<span id="cb73-377"><a href="#cb73-377" aria-hidden="true" tabindex="-1"></a>    england_ks4final</span>
<span id="cb73-378"><a href="#cb73-378" aria-hidden="true" tabindex="-1"></a>    .merge(england_abs, on<span class="op">=</span><span class="st">"URN"</span>, how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb73-379"><a href="#cb73-379" aria-hidden="true" tabindex="-1"></a>    .merge(england_census, on<span class="op">=</span><span class="st">"URN"</span>, how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb73-380"><a href="#cb73-380" aria-hidden="true" tabindex="-1"></a>    .merge(england_school_information, on<span class="op">=</span><span class="st">"URN"</span>, how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb73-381"><a href="#cb73-381" aria-hidden="true" tabindex="-1"></a>    .merge(edubase_schools, left_on<span class="op">=</span><span class="st">"URN"</span>, right_on<span class="op">=</span><span class="st">"urn"</span>, how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb73-382"><a href="#cb73-382" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb73-383"><a href="#cb73-383" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-384"><a href="#cb73-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-385"><a href="#cb73-385" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/Rlogo.png){width="41" height="30"}</span></span>
<span id="cb73-386"><a href="#cb73-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-389"><a href="#cb73-389" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-390"><a href="#cb73-390" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb73-391"><a href="#cb73-391" aria-hidden="true" tabindex="-1"></a><span class="co"># Left join england_ks4final with england_abs</span></span>
<span id="cb73-392"><a href="#cb73-392" aria-hidden="true" tabindex="-1"></a>england_school_2022_23 <span class="ot">&lt;-</span> england_ks4final <span class="sc">%&gt;%</span></span>
<span id="cb73-393"><a href="#cb73-393" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(england_abs, <span class="at">by =</span> <span class="st">"URN"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb73-394"><a href="#cb73-394" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(england_census, <span class="at">by =</span> <span class="st">"URN"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb73-395"><a href="#cb73-395" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(england_school_information, <span class="at">by =</span> <span class="st">"URN"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb73-396"><a href="#cb73-396" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(edubase_schools, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"URN"</span> <span class="ot">=</span> <span class="st">"urn"</span>))</span>
<span id="cb73-397"><a href="#cb73-397" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-398"><a href="#cb73-398" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb73-399"><a href="#cb73-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-400"><a href="#cb73-400" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Iterative Checking and initial exploratory analysis</span></span>
<span id="cb73-401"><a href="#cb73-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-402"><a href="#cb73-402" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>It's never too soon to start exploring your data - even (or indeed especially) in the data 'munging' (processing, cleaning etc.) stage.</span>
<span id="cb73-403"><a href="#cb73-403" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>You will probably find yourself iteratively plotting, filtering, plotting again, switching variables, plotting again, over and over again until you are happy with the data you have. This is all part of the Exploratory Data Analysis Process and vital before applying any other methods to your data!</span>
<span id="cb73-404"><a href="#cb73-404" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>If you recall from the lecture, the histogram of attainment 8 in the whole of England dataset looked a bit odd:</span>
<span id="cb73-405"><a href="#cb73-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-406"><a href="#cb73-406" aria-hidden="true" tabindex="-1"></a>::: {.multicode}</span>
<span id="cb73-407"><a href="#cb73-407" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/python-logo-only.png){width="30"}</span></span>
<span id="cb73-408"><a href="#cb73-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-411"><a href="#cb73-411" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb73-412"><a href="#cb73-412" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb73-413"><a href="#cb73-413" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb73-414"><a href="#cb73-414" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb73-415"><a href="#cb73-415" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb73-416"><a href="#cb73-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-417"><a href="#cb73-417" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute statistics</span></span>
<span id="cb73-418"><a href="#cb73-418" aria-hidden="true" tabindex="-1"></a>median_value <span class="op">=</span> england_school_2022_23[<span class="st">"ATT8SCR"</span>].median(skipna<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb73-419"><a href="#cb73-419" aria-hidden="true" tabindex="-1"></a>mean_value <span class="op">=</span> england_school_2022_23[<span class="st">"ATT8SCR"</span>].mean(skipna<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb73-420"><a href="#cb73-420" aria-hidden="true" tabindex="-1"></a>sd_value <span class="op">=</span> england_school_2022_23[<span class="st">"ATT8SCR"</span>].std(skipna<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb73-421"><a href="#cb73-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-422"><a href="#cb73-422" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up the figure</span></span>
<span id="cb73-423"><a href="#cb73-423" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb73-424"><a href="#cb73-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-425"><a href="#cb73-425" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogram with density</span></span>
<span id="cb73-426"><a href="#cb73-426" aria-hidden="true" tabindex="-1"></a>sns.histplot(</span>
<span id="cb73-427"><a href="#cb73-427" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>england_school_2022_23,</span>
<span id="cb73-428"><a href="#cb73-428" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"ATT8SCR"</span>,</span>
<span id="cb73-429"><a href="#cb73-429" aria-hidden="true" tabindex="-1"></a>    stat<span class="op">=</span><span class="st">"density"</span>,</span>
<span id="cb73-430"><a href="#cb73-430" aria-hidden="true" tabindex="-1"></a>    binwidth<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb73-431"><a href="#cb73-431" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">"#4E3C56"</span>,</span>
<span id="cb73-432"><a href="#cb73-432" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.4</span>,</span>
<span id="cb73-433"><a href="#cb73-433" aria-hidden="true" tabindex="-1"></a>    linewidth<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb73-434"><a href="#cb73-434" aria-hidden="true" tabindex="-1"></a>    edgecolor<span class="op">=</span><span class="st">"white"</span></span>
<span id="cb73-435"><a href="#cb73-435" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb73-436"><a href="#cb73-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-437"><a href="#cb73-437" aria-hidden="true" tabindex="-1"></a><span class="co"># Overlay normal distribution curve</span></span>
<span id="cb73-438"><a href="#cb73-438" aria-hidden="true" tabindex="-1"></a>x_vals <span class="op">=</span> np.linspace(</span>
<span id="cb73-439"><a href="#cb73-439" aria-hidden="true" tabindex="-1"></a>    england_school_2022_23[<span class="st">"ATT8SCR"</span>].<span class="bu">min</span>(),</span>
<span id="cb73-440"><a href="#cb73-440" aria-hidden="true" tabindex="-1"></a>    england_school_2022_23[<span class="st">"ATT8SCR"</span>].<span class="bu">max</span>(),</span>
<span id="cb73-441"><a href="#cb73-441" aria-hidden="true" tabindex="-1"></a>    <span class="dv">500</span></span>
<span id="cb73-442"><a href="#cb73-442" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb73-443"><a href="#cb73-443" aria-hidden="true" tabindex="-1"></a>normal_density <span class="op">=</span> (</span>
<span id="cb73-444"><a href="#cb73-444" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span> <span class="op">/</span> (sd_value <span class="op">*</span> np.sqrt(<span class="dv">2</span> <span class="op">*</span> np.pi))</span>
<span id="cb73-445"><a href="#cb73-445" aria-hidden="true" tabindex="-1"></a>) <span class="op">*</span> np.exp(<span class="op">-</span><span class="fl">0.5</span> <span class="op">*</span> ((x_vals <span class="op">-</span> mean_value) <span class="op">/</span> sd_value) <span class="op">**</span> <span class="dv">2</span>)</span>
<span id="cb73-446"><a href="#cb73-446" aria-hidden="true" tabindex="-1"></a>plt.plot(x_vals, normal_density, color<span class="op">=</span><span class="st">"#2E6260"</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb73-447"><a href="#cb73-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-448"><a href="#cb73-448" aria-hidden="true" tabindex="-1"></a><span class="co"># Add vertical lines for median and mean</span></span>
<span id="cb73-449"><a href="#cb73-449" aria-hidden="true" tabindex="-1"></a>plt.axvline(median_value, color<span class="op">=</span><span class="st">"black"</span>, linestyle<span class="op">=</span><span class="st">"dotted"</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb73-450"><a href="#cb73-450" aria-hidden="true" tabindex="-1"></a>plt.axvline(mean_value, color<span class="op">=</span><span class="st">"#F9DD73"</span>, linestyle<span class="op">=</span><span class="st">"solid"</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb73-451"><a href="#cb73-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-452"><a href="#cb73-452" aria-hidden="true" tabindex="-1"></a><span class="co"># Annotate median and mean</span></span>
<span id="cb73-453"><a href="#cb73-453" aria-hidden="true" tabindex="-1"></a>plt.text(median_value, plt.gca().get_ylim()[<span class="dv">1</span>]<span class="op">*</span><span class="fl">0.95</span>, <span class="ss">f"Median = </span><span class="sc">{</span>median_value<span class="sc">:.1f}</span><span class="ss">"</span>,</span>
<span id="cb73-454"><a href="#cb73-454" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">"black"</span>, ha<span class="op">=</span><span class="st">"center"</span>, va<span class="op">=</span><span class="st">"top"</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb73-455"><a href="#cb73-455" aria-hidden="true" tabindex="-1"></a>plt.text(mean_value, plt.gca().get_ylim()[<span class="dv">1</span>]<span class="op">*</span><span class="fl">0.85</span>, <span class="ss">f"Mean = </span><span class="sc">{</span>mean_value<span class="sc">:.1f}</span><span class="ss">"</span>,</span>
<span id="cb73-456"><a href="#cb73-456" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">"#F9DD73"</span>, ha<span class="op">=</span><span class="st">"center"</span>, va<span class="op">=</span><span class="st">"top"</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb73-457"><a href="#cb73-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-458"><a href="#cb73-458" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize labels and theme</span></span>
<span id="cb73-459"><a href="#cb73-459" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Attainment 8 - All Schools England and Wales, 2022/23 Academic Year"</span>)</span>
<span id="cb73-460"><a href="#cb73-460" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Attainment 8 Score"</span>)</span>
<span id="cb73-461"><a href="#cb73-461" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Density"</span>)</span>
<span id="cb73-462"><a href="#cb73-462" aria-hidden="true" tabindex="-1"></a>sns.despine()</span>
<span id="cb73-463"><a href="#cb73-463" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb73-464"><a href="#cb73-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-465"><a href="#cb73-465" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the plot</span></span>
<span id="cb73-466"><a href="#cb73-466" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.show()</span></span>
<span id="cb73-467"><a href="#cb73-467" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-468"><a href="#cb73-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-469"><a href="#cb73-469" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/Rlogo.png){width="41" height="30"}</span></span>
<span id="cb73-470"><a href="#cb73-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-473"><a href="#cb73-473" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-474"><a href="#cb73-474" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb73-475"><a href="#cb73-475" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb73-476"><a href="#cb73-476" aria-hidden="true" tabindex="-1"></a>median_value <span class="ot">&lt;-</span> <span class="fu">median</span>(england_school_2022_23<span class="sc">$</span>ATT8SCR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb73-477"><a href="#cb73-477" aria-hidden="true" tabindex="-1"></a>mean_value   <span class="ot">&lt;-</span> <span class="fu">mean</span>(england_school_2022_23<span class="sc">$</span>ATT8SCR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb73-478"><a href="#cb73-478" aria-hidden="true" tabindex="-1"></a>sd_value   <span class="ot">&lt;-</span> <span class="fu">sd</span>(england_school_2022_23<span class="sc">$</span>ATT8SCR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb73-479"><a href="#cb73-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-480"><a href="#cb73-480" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(england_school_2022_23, <span class="fu">aes</span>(<span class="at">x =</span> ATT8SCR)) <span class="sc">+</span></span>
<span id="cb73-481"><a href="#cb73-481" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y =</span> ..density..), <span class="at">binwidth =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="st">"#4E3C56"</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb73-482"><a href="#cb73-482" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dnorm, <span class="at">args =</span> <span class="fu">list</span>(<span class="at">mean =</span> mean_value, <span class="at">sd =</span> sd_value), <span class="at">color =</span> <span class="st">"#2E6260"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb73-483"><a href="#cb73-483" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> median_value, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb73-484"><a href="#cb73-484" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> mean_value, <span class="at">color =</span> <span class="st">"#F9DD73"</span>, <span class="at">linetype =</span> <span class="st">"solid"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb73-485"><a href="#cb73-485" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,</span>
<span id="cb73-486"><a href="#cb73-486" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> median_value, <span class="at">y =</span> <span class="cn">Inf</span>,</span>
<span id="cb73-487"><a href="#cb73-487" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste0</span>(<span class="st">"Median = "</span>, <span class="fu">round</span>(median_value, <span class="dv">1</span>)),</span>
<span id="cb73-488"><a href="#cb73-488" aria-hidden="true" tabindex="-1"></a>           <span class="at">vjust =</span> <span class="fl">1.3</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="fl">3.5</span>) <span class="sc">+</span></span>
<span id="cb73-489"><a href="#cb73-489" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,</span>
<span id="cb73-490"><a href="#cb73-490" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> mean_value, <span class="at">y =</span> <span class="cn">Inf</span>,</span>
<span id="cb73-491"><a href="#cb73-491" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste0</span>(<span class="st">"Mean = "</span>, <span class="fu">round</span>(mean_value, <span class="dv">1</span>)),</span>
<span id="cb73-492"><a href="#cb73-492" aria-hidden="true" tabindex="-1"></a>           <span class="at">vjust =</span> <span class="fl">30.5</span>, <span class="at">color =</span> <span class="st">"#F9DD73"</span>, <span class="at">size =</span> <span class="fl">3.5</span>) <span class="sc">+</span></span>
<span id="cb73-493"><a href="#cb73-493" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.08</span>))) <span class="sc">+</span></span>
<span id="cb73-494"><a href="#cb73-494" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb73-495"><a href="#cb73-495" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Attainment 8 - All Schools England and Wales, 2022/23 Academic Year"</span>,</span>
<span id="cb73-496"><a href="#cb73-496" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Attainment 8 Score"</span>,</span>
<span id="cb73-497"><a href="#cb73-497" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Density"</span></span>
<span id="cb73-498"><a href="#cb73-498" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb73-499"><a href="#cb73-499" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb73-500"><a href="#cb73-500" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-501"><a href="#cb73-501" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb73-502"><a href="#cb73-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-503"><a href="#cb73-503" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>You may also recall from the lecture that this odd distribution was related to different types of school in the system. We can create a similar visualisation here:</span>
<span id="cb73-504"><a href="#cb73-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-505"><a href="#cb73-505" aria-hidden="true" tabindex="-1"></a>::: {.multicode}</span>
<span id="cb73-506"><a href="#cb73-506" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/python-logo-only.png){width="30"}</span></span>
<span id="cb73-507"><a href="#cb73-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-510"><a href="#cb73-510" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb73-511"><a href="#cb73-511" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb73-512"><a href="#cb73-512" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb73-513"><a href="#cb73-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-514"><a href="#cb73-514" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up the figure</span></span>
<span id="cb73-515"><a href="#cb73-515" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb73-516"><a href="#cb73-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-517"><a href="#cb73-517" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplot grouped by MINORGROUP</span></span>
<span id="cb73-518"><a href="#cb73-518" aria-hidden="true" tabindex="-1"></a>sns.boxplot(</span>
<span id="cb73-519"><a href="#cb73-519" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'ATT8SCR'</span>,</span>
<span id="cb73-520"><a href="#cb73-520" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>england_school_2022_23,</span>
<span id="cb73-521"><a href="#cb73-521" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">"#EDD971"</span>,</span>
<span id="cb73-522"><a href="#cb73-522" aria-hidden="true" tabindex="-1"></a>    fliersize<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb73-523"><a href="#cb73-523" aria-hidden="true" tabindex="-1"></a>    linewidth<span class="op">=</span><span class="dv">1</span></span>
<span id="cb73-524"><a href="#cb73-524" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb73-525"><a href="#cb73-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-526"><a href="#cb73-526" aria-hidden="true" tabindex="-1"></a><span class="co"># Jittered points</span></span>
<span id="cb73-527"><a href="#cb73-527" aria-hidden="true" tabindex="-1"></a>sns.stripplot(</span>
<span id="cb73-528"><a href="#cb73-528" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'ATT8SCR'</span>,</span>
<span id="cb73-529"><a href="#cb73-529" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>england_school_2022_23,</span>
<span id="cb73-530"><a href="#cb73-530" aria-hidden="true" tabindex="-1"></a>    hue<span class="op">=</span><span class="st">'MINORGROUP'</span>,</span>
<span id="cb73-531"><a href="#cb73-531" aria-hidden="true" tabindex="-1"></a>    dodge<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb73-532"><a href="#cb73-532" aria-hidden="true" tabindex="-1"></a>    jitter<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb73-533"><a href="#cb73-533" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb73-534"><a href="#cb73-534" aria-hidden="true" tabindex="-1"></a>    size<span class="op">=</span><span class="dv">4</span>,</span>
<span id="cb73-535"><a href="#cb73-535" aria-hidden="true" tabindex="-1"></a>    palette<span class="op">=</span><span class="st">'turbo'</span></span>
<span id="cb73-536"><a href="#cb73-536" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb73-537"><a href="#cb73-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-538"><a href="#cb73-538" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize the plot</span></span>
<span id="cb73-539"><a href="#cb73-539" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Attainment 8 - All Schools 2022/23 Academic Year"</span>)</span>
<span id="cb73-540"><a href="#cb73-540" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Attainment 8 Score"</span>)</span>
<span id="cb73-541"><a href="#cb73-541" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">""</span>)</span>
<span id="cb73-542"><a href="#cb73-542" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">"School Type"</span>, loc<span class="op">=</span><span class="st">'lower center'</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.25</span>), ncol<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb73-543"><a href="#cb73-543" aria-hidden="true" tabindex="-1"></a>sns.despine()</span>
<span id="cb73-544"><a href="#cb73-544" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb73-545"><a href="#cb73-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-546"><a href="#cb73-546" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the plot</span></span>
<span id="cb73-547"><a href="#cb73-547" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb73-548"><a href="#cb73-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-549"><a href="#cb73-549" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-550"><a href="#cb73-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-551"><a href="#cb73-551" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/Rlogo.png){width="41" height="30"}</span></span>
<span id="cb73-552"><a href="#cb73-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-555"><a href="#cb73-555" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-556"><a href="#cb73-556" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb73-557"><a href="#cb73-557" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(england_school_2022_23, <span class="fu">aes</span>(<span class="at">x =</span> ATT8SCR, <span class="at">y =</span> <span class="st">""</span>)) <span class="sc">+</span></span>
<span id="cb73-558"><a href="#cb73-558" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"#EDD971"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">outlier.shape =</span> <span class="cn">NA</span>) <span class="sc">+</span>    </span>
<span id="cb73-559"><a href="#cb73-559" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">colour =</span> MINORGROUP), <span class="at">height =</span> <span class="fl">0.2</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb73-560"><a href="#cb73-560" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_viridis_d</span>(<span class="at">option =</span> <span class="st">"turbo"</span>) <span class="sc">+</span>  <span class="co"># applies the default casaviz discrete palette</span></span>
<span id="cb73-561"><a href="#cb73-561" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb73-562"><a href="#cb73-562" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Attainment 8 - All Schools 2022/23 Academic Year"</span>,</span>
<span id="cb73-563"><a href="#cb73-563" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Attainment 8 Score"</span>,</span>
<span id="cb73-564"><a href="#cb73-564" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="cn">NULL</span>,</span>
<span id="cb73-565"><a href="#cb73-565" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">"School Type"</span></span>
<span id="cb73-566"><a href="#cb73-566" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb73-567"><a href="#cb73-567" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb73-568"><a href="#cb73-568" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb73-569"><a href="#cb73-569" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb73-570"><a href="#cb73-570" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">10</span>, <span class="st">"mm"</span>),   <span class="co"># increase dot space</span></span>
<span id="cb73-571"><a href="#cb73-571" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)  <span class="co"># optional: larger legend labels</span></span>
<span id="cb73-572"><a href="#cb73-572" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> <span class="fu">guides</span>(<span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">4</span>)))</span>
<span id="cb73-573"><a href="#cb73-573" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-574"><a href="#cb73-574" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb73-575"><a href="#cb73-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-576"><a href="#cb73-576" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Further filtering and subsetting</span></span>
<span id="cb73-577"><a href="#cb73-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-578"><a href="#cb73-578" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Having joined all of these data frames into a single master dataframe for the whole of England and observed some issues, we will need to filter out some of the rows we don't want and the columns that we don't need</span>
<span id="cb73-579"><a href="#cb73-579" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>In the two folders you downloaded from Moodle, one contains all of the data we need, the other contains all of the metadata which tells us what the variables are</span>
<span id="cb73-580"><a href="#cb73-580" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>If you open up, for example <span class="in">`ks4_meta.xlsx`</span> these are the variables related to attainment for each school.</span>
<span id="cb73-581"><a href="#cb73-581" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Similarly <span class="in">`abbreviations.xlsx`</span> attaches some meaning to some of the codes associated with some of these variables, with other metadata files containing other info. Take some time to look at these so you understand the range of variables we'll be exploring.</span>
<span id="cb73-582"><a href="#cb73-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-583"><a href="#cb73-583" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb73-584"><a href="#cb73-584" aria-hidden="true" tabindex="-1"></a>One of the key filtering asks carried out in the code below is to filter the schools so that we only retain the maintained schools and the academies in the dataset</span>
<span id="cb73-585"><a href="#cb73-585" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb73-586"><a href="#cb73-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-587"><a href="#cb73-587" aria-hidden="true" tabindex="-1"></a><span class="fu">## Task 2 (continued) - Filtering, Selecting and Subsetting</span></span>
<span id="cb73-588"><a href="#cb73-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-589"><a href="#cb73-589" aria-hidden="true" tabindex="-1"></a>The Code Below already has the syntax to allow you to filter your dataset and drop special schools, independent schools and colleges.</span>
<span id="cb73-590"><a href="#cb73-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-591"><a href="#cb73-591" aria-hidden="true" tabindex="-1"></a>It also contains the start of some code to allow you to select a smaller set of variables from the 700-odd in the main file.</span>
<span id="cb73-592"><a href="#cb73-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-593"><a href="#cb73-593" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Adapt this Python or R code so that it contains these variables plus the additional variables listed below (see the note about how you may need to adjust the names depending on whether using Python or R). - You should end up with 34 in total</span>
<span id="cb73-594"><a href="#cb73-594" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Once you have created this filtered and reduced file called <span class="in">`england_filtered`</span>, write it out as a csv (e.g. england_filtered.csv) and save to your local working directory - we will use it again in future practicals</span>
<span id="cb73-595"><a href="#cb73-595" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Now you have your <span class="in">`england_filtered`</span> file, use this code below as the template for creating two new data subsets:</span>
<span id="cb73-596"><a href="#cb73-596" aria-hidden="true" tabindex="-1"></a>    a.  london_borough_sub</span>
<span id="cb73-597"><a href="#cb73-597" aria-hidden="true" tabindex="-1"></a>    b.  england_lad_sub These two new files should create a subset which has filtered on the name or code of a London borough and another local authority in England</span>
<span id="cb73-598"><a href="#cb73-598" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb73-599"><a href="#cb73-599" aria-hidden="true" tabindex="-1"></a>::: {.multicode}</span>
<span id="cb73-600"><a href="#cb73-600" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/python-logo-only.png){width="30"}</span></span>
<span id="cb73-603"><a href="#cb73-603" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb73-604"><a href="#cb73-604" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb73-605"><a href="#cb73-605" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: true</span></span>
<span id="cb73-606"><a href="#cb73-606" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb73-607"><a href="#cb73-607" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming england_filtered is a pandas DataFrame</span></span>
<span id="cb73-608"><a href="#cb73-608" aria-hidden="true" tabindex="-1"></a>england_filtered.to_csv(<span class="st">"england_filtered.csv"</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb73-609"><a href="#cb73-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-610"><a href="#cb73-610" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-611"><a href="#cb73-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-612"><a href="#cb73-612" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/Rlogo.png){width="41" height="30"}</span></span>
<span id="cb73-615"><a href="#cb73-615" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-616"><a href="#cb73-616" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb73-617"><a href="#cb73-617" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: true</span></span>
<span id="cb73-618"><a href="#cb73-618" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb73-619"><a href="#cb73-619" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(england_filtered, <span class="st">"england_filtered.csv"</span>)</span>
<span id="cb73-620"><a href="#cb73-620" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-621"><a href="#cb73-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-622"><a href="#cb73-622" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb73-623"><a href="#cb73-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-624"><a href="#cb73-624" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb73-625"><a href="#cb73-625" aria-hidden="true" tabindex="-1"></a>If you are unsure of the names of the local authorities in England, use the <span class="in">`la_and_region_codes_meta.csv`</span> file in your metadata folder to help you. You might want to name your "sub" files according to the names of the local authorities you choose.</span>
<span id="cb73-626"><a href="#cb73-626" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb73-627"><a href="#cb73-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-630"><a href="#cb73-630" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-631"><a href="#cb73-631" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb73-632"><a href="#cb73-632" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb73-633"><a href="#cb73-633" aria-hidden="true" tabindex="-1"></a><span class="co">#str(england_school_2022_23)</span></span>
<span id="cb73-634"><a href="#cb73-634" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-635"><a href="#cb73-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-636"><a href="#cb73-636" aria-hidden="true" tabindex="-1"></a>::: qna</span>
<span id="cb73-637"><a href="#cb73-637" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/python-logo-only.png){width="30"}</span></span>
<span id="cb73-638"><a href="#cb73-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-641"><a href="#cb73-641" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb73-642"><a href="#cb73-642" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb73-643"><a href="#cb73-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-644"><a href="#cb73-644" aria-hidden="true" tabindex="-1"></a><span class="co">## check all of your variable names first as R and python will call them something different</span></span>
<span id="cb73-645"><a href="#cb73-645" aria-hidden="true" tabindex="-1"></a>column_df <span class="op">=</span> pd.DataFrame({<span class="st">'Column Names'</span>: england_school_2022_23.columns.tolist()})</span>
<span id="cb73-646"><a href="#cb73-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-647"><a href="#cb73-647" aria-hidden="true" tabindex="-1"></a><span class="co"># Define excluded MINORGROUP values</span></span>
<span id="cb73-648"><a href="#cb73-648" aria-hidden="true" tabindex="-1"></a>excluded_groups <span class="op">=</span> [<span class="st">"Special school"</span>, <span class="st">"Independent school"</span>, <span class="st">"College"</span>, <span class="va">None</span>]</span>
<span id="cb73-649"><a href="#cb73-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-650"><a href="#cb73-650" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter and select columns</span></span>
<span id="cb73-651"><a href="#cb73-651" aria-hidden="true" tabindex="-1"></a>england_filtered <span class="op">=</span> (</span>
<span id="cb73-652"><a href="#cb73-652" aria-hidden="true" tabindex="-1"></a>    england_school_2022_23[</span>
<span id="cb73-653"><a href="#cb73-653" aria-hidden="true" tabindex="-1"></a>        <span class="op">~</span>england_school_2022_23[<span class="st">"MINORGROUP"</span>].isin(excluded_groups) <span class="op">&amp;</span></span>
<span id="cb73-654"><a href="#cb73-654" aria-hidden="true" tabindex="-1"></a>        (england_school_2022_23[<span class="st">"phaseofeducation_name_"</span>] <span class="op">==</span> <span class="st">"Secondary"</span>) <span class="op">&amp;</span></span>
<span id="cb73-655"><a href="#cb73-655" aria-hidden="true" tabindex="-1"></a>        (england_school_2022_23[<span class="st">"establishmentstatus_name_"</span>] <span class="op">==</span> <span class="st">"Open"</span>)</span>
<span id="cb73-656"><a href="#cb73-656" aria-hidden="true" tabindex="-1"></a>    ][[<span class="st">"URN"</span>, <span class="st">"SCHNAME_x"</span>, <span class="st">"LEA"</span>, <span class="st">"TOWN_x"</span>, <span class="st">"TOTPUPS"</span>, <span class="st">"ATT8SCR"</span>, <span class="st">"OFSTEDRATING"</span>, <span class="st">"MINORGROUP"</span>, <span class="st">"PTFSM6CLA1A"</span>]]</span>
<span id="cb73-657"><a href="#cb73-657" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb73-658"><a href="#cb73-658" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-659"><a href="#cb73-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-662"><a href="#cb73-662" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb73-663"><a href="#cb73-663" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb73-664"><a href="#cb73-664" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb73-665"><a href="#cb73-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-666"><a href="#cb73-666" aria-hidden="true" tabindex="-1"></a><span class="co">## check all of your variable names first as R and python will call them something different</span></span>
<span id="cb73-667"><a href="#cb73-667" aria-hidden="true" tabindex="-1"></a>column_df <span class="op">=</span> pd.DataFrame({<span class="st">'Column Names'</span>: england_school_2022_23.columns.tolist()})</span>
<span id="cb73-668"><a href="#cb73-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-669"><a href="#cb73-669" aria-hidden="true" tabindex="-1"></a><span class="co"># Define excluded MINORGROUP values</span></span>
<span id="cb73-670"><a href="#cb73-670" aria-hidden="true" tabindex="-1"></a>excluded_groups <span class="op">=</span> [<span class="st">"Special school"</span>, <span class="st">"Independent school"</span>, <span class="st">"College"</span>, <span class="va">None</span>]</span>
<span id="cb73-671"><a href="#cb73-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-672"><a href="#cb73-672" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter and select columns</span></span>
<span id="cb73-673"><a href="#cb73-673" aria-hidden="true" tabindex="-1"></a>england_filtered <span class="op">=</span> (</span>
<span id="cb73-674"><a href="#cb73-674" aria-hidden="true" tabindex="-1"></a>    england_school_2022_23[</span>
<span id="cb73-675"><a href="#cb73-675" aria-hidden="true" tabindex="-1"></a>        <span class="op">~</span>england_school_2022_23[<span class="st">"MINORGROUP"</span>].isin(excluded_groups) <span class="op">&amp;</span></span>
<span id="cb73-676"><a href="#cb73-676" aria-hidden="true" tabindex="-1"></a>        (england_school_2022_23[<span class="st">"phaseofeducation_name_"</span>] <span class="op">==</span> <span class="st">"Secondary"</span>) <span class="op">&amp;</span></span>
<span id="cb73-677"><a href="#cb73-677" aria-hidden="true" tabindex="-1"></a>        (england_school_2022_23[<span class="st">"establishmentstatus_name_"</span>] <span class="op">==</span> <span class="st">"Open"</span>)</span>
<span id="cb73-678"><a href="#cb73-678" aria-hidden="true" tabindex="-1"></a>    ][[<span class="st">"URN"</span>, <span class="st">"SCHNAME_x"</span>, <span class="st">"LEA"</span>, <span class="st">"LANAME"</span>, <span class="st">"TOWN_x"</span>, <span class="st">"gor_name_"</span>, <span class="st">"TOTPUPS"</span>, <span class="st">"ATT8SCR"</span>, <span class="st">"ATT8SCRENG"</span>, <span class="st">"ATT8SCRMAT"</span>, <span class="st">"ATT8SCR_FSM6CLA1A"</span>, <span class="st">"ATT8SCR_NFSM6CLA1A"</span>, <span class="st">"ATT8SCR_BOYS"</span>, <span class="st">"ATT8SCR_GIRLS"</span>, <span class="st">"P8MEA"</span>, <span class="st">"P8MEA_FSM6CLA1A"</span>, <span class="st">"P8MEA_NFSM6CLA1A"</span>, <span class="st">"PTFSM6CLA1A"</span>, <span class="st">"PTNOTFSM6CLA1A"</span>, <span class="st">"PNUMEAL"</span>, <span class="st">"PNUMENGFL"</span>, <span class="st">"PTPRIORLO"</span>, <span class="st">"PTPRIORHI"</span>, <span class="st">"NORB"</span>, <span class="st">"NORG"</span>, <span class="st">"PNUMFSMEVER"</span>, <span class="st">"PERCTOT"</span>, <span class="st">"PPERSABS10"</span>, <span class="st">"SCHOOLTYPE_x"</span>, <span class="st">"RELCHAR"</span>, <span class="st">"ADMPOL_y"</span>, <span class="st">"ADMPOL_PT"</span>, <span class="st">"gender_name_"</span>, <span class="st">"OFSTEDRATING"</span>, <span class="st">"MINORGROUP"</span>, <span class="st">"easting"</span>, <span class="st">"northing"</span>]]</span>
<span id="cb73-679"><a href="#cb73-679" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb73-680"><a href="#cb73-680" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-681"><a href="#cb73-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-682"><a href="#cb73-682" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/Rlogo.png){width="41" height="30"}</span></span>
<span id="cb73-683"><a href="#cb73-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-686"><a href="#cb73-686" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-687"><a href="#cb73-687" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter data</span></span>
<span id="cb73-688"><a href="#cb73-688" aria-hidden="true" tabindex="-1"></a>england_filtered <span class="ot">&lt;-</span> england_school_2022_23 <span class="sc">%&gt;%</span></span>
<span id="cb73-689"><a href="#cb73-689" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>MINORGROUP <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Special school"</span>, <span class="st">"Independent school"</span>, <span class="st">"College"</span>, <span class="cn">NA</span>)) <span class="sc">%&gt;%</span>   <span class="fu">filter</span>(phase_of_education_name <span class="sc">==</span> <span class="st">"Secondary"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb73-690"><a href="#cb73-690" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(establishment_status_name <span class="sc">==</span> <span class="st">"Open"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb73-691"><a href="#cb73-691" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(URN, SCHNAME.x, TOWN.x, TOTPUPS, ATT8SCR, OFSTEDRATING, MINORGROUP, PTFSM6CLA1A)</span>
<span id="cb73-692"><a href="#cb73-692" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-693"><a href="#cb73-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-696"><a href="#cb73-696" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-697"><a href="#cb73-697" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb73-698"><a href="#cb73-698" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter data</span></span>
<span id="cb73-699"><a href="#cb73-699" aria-hidden="true" tabindex="-1"></a>england_filtered <span class="ot">&lt;-</span> england_school_2022_23 <span class="sc">%&gt;%</span></span>
<span id="cb73-700"><a href="#cb73-700" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>MINORGROUP <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Special school"</span>, <span class="st">"Independent school"</span>, <span class="st">"College"</span>, <span class="cn">NA</span>)) <span class="sc">%&gt;%</span>   <span class="fu">filter</span>(phase_of_education_name <span class="sc">==</span> <span class="st">"Secondary"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb73-701"><a href="#cb73-701" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(establishment_status_name <span class="sc">==</span> <span class="st">"Open"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb73-702"><a href="#cb73-702" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(URN, SCHNAME.x, LEA, LANAME, TOWN.x,gor_name, TOTPUPS, ATT8SCR, ATT8SCRENG, ATT8SCRMAT,ATT8SCRMAT,ATT8SCR_FSM6CLA1A,ATT8SCR_FSM6CLA1A,ATT8SCR_NFSM6CLA1A,ATT8SCR_BOYS,ATT8SCR_GIRLS,P8MEA,P8MEA_FSM6CLA1A,P8MEA_NFSM6CLA1A,PTFSM6CLA1A,PTNOTFSM6CLA1A,PNUMEAL,PNUMENGFL,PTPRIORLO,PTPRIORHI,NORB,NORG,PNUMFSMEVER,PERCTOT,PPERSABS10,SCHOOLTYPE.x,RELCHAR,ADMPOL.y,ADMPOL_PT,gender_name,OFSTEDRATING, MINORGROUP, easting, northing)</span>
<span id="cb73-703"><a href="#cb73-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-704"><a href="#cb73-704" aria-hidden="true" tabindex="-1"></a><span class="co">#write_csv(england_filtered, "england_filtered.csv")</span></span>
<span id="cb73-705"><a href="#cb73-705" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-706"><a href="#cb73-706" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb73-707"><a href="#cb73-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-708"><a href="#cb73-708" aria-hidden="true" tabindex="-1"></a>::: {.callout-important title="Other variables to include in your reduced dataset"}</span>
<span id="cb73-709"><a href="#cb73-709" aria-hidden="true" tabindex="-1"></a>Other variables to include in your reduced dataset:</span>
<span id="cb73-710"><a href="#cb73-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-711"><a href="#cb73-711" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Local Authority (LEA) Code and Name - **LEA** and **LANAME**</span>
<span id="cb73-712"><a href="#cb73-712" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Total Number of Pupils on Roll (all ages) - **TOTPUPS**</span>
<span id="cb73-713"><a href="#cb73-713" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Average Attainment 8 score per pupil for English element - **ATT8SCRENG**</span>
<span id="cb73-714"><a href="#cb73-714" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>Average Attainment 8 score per pupil for mathematics element - **ATT8SCRMAT**</span>
<span id="cb73-715"><a href="#cb73-715" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>Average Attainment 8 score per disadvantaged pupil - **ATT8SCR_FSM6CLA1A**</span>
<span id="cb73-716"><a href="#cb73-716" aria-hidden="true" tabindex="-1"></a><span class="ss">6.  </span>Average Attainment 8 score per non-disadvantaged pupil - **ATT8SCR_NFSM6CLA1A**</span>
<span id="cb73-717"><a href="#cb73-717" aria-hidden="true" tabindex="-1"></a><span class="ss">7.  </span>Average Attainment 8 score per boy - **ATT8SCR_BOYS**</span>
<span id="cb73-718"><a href="#cb73-718" aria-hidden="true" tabindex="-1"></a><span class="ss">8.  </span>Average Attainment 8 score per girl - **ATT8SCR_GIRLS**</span>
<span id="cb73-719"><a href="#cb73-719" aria-hidden="true" tabindex="-1"></a><span class="ss">9.  </span>Progress 8 measure after adjustment for extreme scores - **P8MEA**</span>
<span id="cb73-720"><a href="#cb73-720" aria-hidden="true" tabindex="-1"></a><span class="ss">10. </span>Adjusted Progress 8 measure - disadvantaged pupils - **P8MEA_FSM6CLA1A**</span>
<span id="cb73-721"><a href="#cb73-721" aria-hidden="true" tabindex="-1"></a><span class="ss">11. </span>Adjusted Progress 8 measure - non-disadvantaged pupils - **P8MEA_NFSM6CLA1A**</span>
<span id="cb73-722"><a href="#cb73-722" aria-hidden="true" tabindex="-1"></a><span class="ss">12. </span>\% of pupils at the end of key stage 4 who are disadvantaged - **PTFSM6CLA1A**</span>
<span id="cb73-723"><a href="#cb73-723" aria-hidden="true" tabindex="-1"></a><span class="ss">13. </span>\% of pupils at the end of key stage 4 who are not disadvantaged - **PTNOTFSM6CLA1A**</span>
<span id="cb73-724"><a href="#cb73-724" aria-hidden="true" tabindex="-1"></a><span class="ss">14. </span>\% pupils where English not first language - **PNUMEAL**</span>
<span id="cb73-725"><a href="#cb73-725" aria-hidden="true" tabindex="-1"></a><span class="ss">15. </span>\% pupils with English first language - **PNUMENGFL**</span>
<span id="cb73-726"><a href="#cb73-726" aria-hidden="true" tabindex="-1"></a><span class="ss">16. </span>\% of pupils at the end of key stage 4 with low prior attainment at the end of key stage 2 - **PTPRIORLO**</span>
<span id="cb73-727"><a href="#cb73-727" aria-hidden="true" tabindex="-1"></a><span class="ss">17. </span>\% of pupils at the end of key stage 4 with high prior attainment at the end of key stage 2 - **PTPRIORHI**</span>
<span id="cb73-728"><a href="#cb73-728" aria-hidden="true" tabindex="-1"></a><span class="ss">18. </span>Total boys on roll (including part-time pupils) - **NORB**</span>
<span id="cb73-729"><a href="#cb73-729" aria-hidden="true" tabindex="-1"></a><span class="ss">19. </span>Total girls on roll (including part-time pupils) - **NORG**</span>
<span id="cb73-730"><a href="#cb73-730" aria-hidden="true" tabindex="-1"></a><span class="ss">20. </span>Percentage of pupils eligible for FSM at any time during the past 6 years - **PNUMFSMEVER**</span>
<span id="cb73-731"><a href="#cb73-731" aria-hidden="true" tabindex="-1"></a><span class="ss">21. </span>Percentage of overall absence - **PERCTOT**</span>
<span id="cb73-732"><a href="#cb73-732" aria-hidden="true" tabindex="-1"></a><span class="ss">22. </span>Percentage of enrolments who are persistent absentees - **PPERSABS10**</span>
<span id="cb73-733"><a href="#cb73-733" aria-hidden="true" tabindex="-1"></a><span class="ss">23. </span>School Type e.g. Voluntary Aided school - **SCHOOLTYPE**</span>
<span id="cb73-734"><a href="#cb73-734" aria-hidden="true" tabindex="-1"></a><span class="ss">24. </span>Religious character - **RELCHAR**</span>
<span id="cb73-735"><a href="#cb73-735" aria-hidden="true" tabindex="-1"></a><span class="ss">25. </span>Admissions Policy - **ADMPOL**</span>
<span id="cb73-736"><a href="#cb73-736" aria-hidden="true" tabindex="-1"></a><span class="ss">26. </span>Admissions Policy new definition from 2019 - **ADMPOL_PT**</span>
<span id="cb73-737"><a href="#cb73-737" aria-hidden="true" tabindex="-1"></a><span class="ss">27. </span>Government Office Region Name - **gor_name**</span>
<span id="cb73-738"><a href="#cb73-738" aria-hidden="true" tabindex="-1"></a><span class="ss">28. </span>Mixed or Single Sex - **gender_name**</span>
<span id="cb73-739"><a href="#cb73-739" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb73-740"><a href="#cb73-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-741"><a href="#cb73-741" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb73-742"><a href="#cb73-742" aria-hidden="true" tabindex="-1"></a>When you joined your datasets earlier, you will find that some variables appear in more than one of the datasets. This may cause a problem now as R and Python will try and distinguish them in the join by appending a <span class="in">`.x`</span> or <span class="in">`.y`</span> (R) or <span class="in">`_x`</span> or <span class="in">`_y`</span> (Python) so you may get an error when joining, particularly with the **SCHOOLTYPE** and **ADMPOL** variables. For these try **SCHOOLTYPE.x** and **ADMPOL.y** (underscore for Python) instead.</span>
<span id="cb73-743"><a href="#cb73-743" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb73-744"><a href="#cb73-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-745"><a href="#cb73-745" aria-hidden="true" tabindex="-1"></a><span class="fu">## Task 3 - Further Exploratory Analysis and Visual Modelling</span></span>
<span id="cb73-746"><a href="#cb73-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-747"><a href="#cb73-747" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Using the example code below as a guide, select your own $Y$ variable related to attainment from your smaller filtered dataset. You have a range of attainment or progress related variables in there</span>
<span id="cb73-748"><a href="#cb73-748" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Select your own $X$ variable that might help explain attainment, this might relate to disadvantage, prior attainment, absence or anything else that is a **continuous** variable (DO NOT SELECT A CATEGORICAL VARIABLE AT THIS TIME).</span>
<span id="cb73-749"><a href="#cb73-749" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Once you have selected your two variables, plot them against each other on a scatter plot to see if there is an obvious relationship - again, use the code below as a guide.</span>
<span id="cb73-750"><a href="#cb73-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-751"><a href="#cb73-751" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip title="AI tip"}</span>
<span id="cb73-752"><a href="#cb73-752" aria-hidden="true" tabindex="-1"></a>AI - yes, that dreaded thing that's invading everything. Well, it's hear to stay and while it's here, you might as well use it to help you with your coding. Of course, I don't want you to blindly copy things and not understand what's going on, but if you get stuck with syntax and getting plots to look how you want - feed your favourite AI with your code and get it to help you out.</span>
<span id="cb73-753"><a href="#cb73-753" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb73-754"><a href="#cb73-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-755"><a href="#cb73-755" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Exploratory Data Analysis Plots</span></span>
<span id="cb73-756"><a href="#cb73-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-759"><a href="#cb73-759" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb73-760"><a href="#cb73-760" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb73-761"><a href="#cb73-761" aria-hidden="true" tabindex="-1"></a>camden_sub <span class="op">=</span> england_filtered[england_filtered[<span class="st">'LANAME'</span>] <span class="op">==</span> <span class="st">'Camden'</span>]</span>
<span id="cb73-762"><a href="#cb73-762" aria-hidden="true" tabindex="-1"></a>leeds_sub <span class="op">=</span> england_filtered[england_filtered[<span class="st">'LANAME'</span>] <span class="op">==</span> <span class="st">'Leeds'</span>]</span>
<span id="cb73-763"><a href="#cb73-763" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-764"><a href="#cb73-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-767"><a href="#cb73-767" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-768"><a href="#cb73-768" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb73-769"><a href="#cb73-769" aria-hidden="true" tabindex="-1"></a>camden_sub <span class="ot">&lt;-</span> england_filtered <span class="sc">%&gt;%</span> </span>
<span id="cb73-770"><a href="#cb73-770" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(LANAME <span class="sc">==</span> <span class="st">"Camden"</span>)</span>
<span id="cb73-771"><a href="#cb73-771" aria-hidden="true" tabindex="-1"></a>leeds_sub <span class="ot">&lt;-</span> england_filtered <span class="sc">%&gt;%</span> </span>
<span id="cb73-772"><a href="#cb73-772" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(LANAME <span class="sc">==</span> <span class="st">"Leeds"</span>)</span>
<span id="cb73-773"><a href="#cb73-773" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-774"><a href="#cb73-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-775"><a href="#cb73-775" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip title="Questions to Answer"}</span>
<span id="cb73-776"><a href="#cb73-776" aria-hidden="true" tabindex="-1"></a>Just from looking at your plots: - How do you expect the intercepts (baseline Y) to differ between your London and non-London local authority (if at all)? Which is higher and which is lower? - How do you think the slope values (influence of X on Y) are different (if at all)?</span>
<span id="cb73-777"><a href="#cb73-777" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb73-778"><a href="#cb73-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-779"><a href="#cb73-779" aria-hidden="true" tabindex="-1"></a>::: {.multicode}</span>
<span id="cb73-780"><a href="#cb73-780" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/python-logo-only.png){width="30"}</span></span>
<span id="cb73-781"><a href="#cb73-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-784"><a href="#cb73-784" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb73-785"><a href="#cb73-785" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb73-786"><a href="#cb73-786" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb73-787"><a href="#cb73-787" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb73-788"><a href="#cb73-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-789"><a href="#cb73-789" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the datasets</span></span>
<span id="cb73-790"><a href="#cb73-790" aria-hidden="true" tabindex="-1"></a>combined_data <span class="op">=</span> pd.concat([camden_sub, leeds_sub])</span>
<span id="cb73-791"><a href="#cb73-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-792"><a href="#cb73-792" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a function to make and customize the plot</span></span>
<span id="cb73-793"><a href="#cb73-793" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_plot():</span>
<span id="cb73-794"><a href="#cb73-794" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> sns.FacetGrid(combined_data, col<span class="op">=</span><span class="st">"LANAME"</span>, height<span class="op">=</span><span class="dv">5</span>, aspect<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb73-795"><a href="#cb73-795" aria-hidden="true" tabindex="-1"></a>    g.map_dataframe(</span>
<span id="cb73-796"><a href="#cb73-796" aria-hidden="true" tabindex="-1"></a>        sns.scatterplot,</span>
<span id="cb73-797"><a href="#cb73-797" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">"PTFSM6CLA1A"</span>,</span>
<span id="cb73-798"><a href="#cb73-798" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span><span class="st">"ATT8SCR"</span>,</span>
<span id="cb73-799"><a href="#cb73-799" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">"steelblue"</span>,</span>
<span id="cb73-800"><a href="#cb73-800" aria-hidden="true" tabindex="-1"></a>        alpha<span class="op">=</span><span class="fl">0.7</span>,</span>
<span id="cb73-801"><a href="#cb73-801" aria-hidden="true" tabindex="-1"></a>        s<span class="op">=</span><span class="dv">60</span></span>
<span id="cb73-802"><a href="#cb73-802" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb73-803"><a href="#cb73-803" aria-hidden="true" tabindex="-1"></a>    g.set_axis_labels(<span class="st">"% KS4 Pupils Disadvantaged (PTFSM6CLA1A)"</span>, <span class="st">"Attainment 8 Score (ATT8SCR)"</span>)</span>
<span id="cb73-804"><a href="#cb73-804" aria-hidden="true" tabindex="-1"></a>    g.fig.suptitle(<span class="st">"Attainment 8 vs % Disadvantaged by Local Authority"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb73-805"><a href="#cb73-805" aria-hidden="true" tabindex="-1"></a>    g.fig.tight_layout()</span>
<span id="cb73-806"><a href="#cb73-806" aria-hidden="true" tabindex="-1"></a>    g.fig.subplots_adjust(top<span class="op">=</span><span class="fl">0.85</span>)</span>
<span id="cb73-807"><a href="#cb73-807" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb73-808"><a href="#cb73-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-809"><a href="#cb73-809" aria-hidden="true" tabindex="-1"></a><span class="co"># Call the function once</span></span>
<span id="cb73-810"><a href="#cb73-810" aria-hidden="true" tabindex="-1"></a>make_plot()</span>
<span id="cb73-811"><a href="#cb73-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-812"><a href="#cb73-812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-813"><a href="#cb73-813" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-814"><a href="#cb73-814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-815"><a href="#cb73-815" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/Rlogo.png){width="41" height="30"}</span></span>
<span id="cb73-816"><a href="#cb73-816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-819"><a href="#cb73-819" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-820"><a href="#cb73-820" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb73-821"><a href="#cb73-821" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb73-822"><a href="#cb73-822" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb73-823"><a href="#cb73-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-824"><a href="#cb73-824" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the datasets and label them</span></span>
<span id="cb73-825"><a href="#cb73-825" aria-hidden="true" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb73-826"><a href="#cb73-826" aria-hidden="true" tabindex="-1"></a>  camden_sub <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Area =</span> <span class="st">"Camden"</span>),</span>
<span id="cb73-827"><a href="#cb73-827" aria-hidden="true" tabindex="-1"></a>  leeds_sub <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Area =</span> <span class="st">"Leeds"</span>)</span>
<span id="cb73-828"><a href="#cb73-828" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb73-829"><a href="#cb73-829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-830"><a href="#cb73-830" aria-hidden="true" tabindex="-1"></a><span class="co"># Create faceted scatter plot</span></span>
<span id="cb73-831"><a href="#cb73-831" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(combined_data, <span class="fu">aes</span>(<span class="at">x =</span> PTFSM6CLA1A, <span class="at">y =</span> ATT8SCR)) <span class="sc">+</span></span>
<span id="cb73-832"><a href="#cb73-832" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb73-833"><a href="#cb73-833" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Area) <span class="sc">+</span></span>
<span id="cb73-834"><a href="#cb73-834" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb73-835"><a href="#cb73-835" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Attainment 8 vs % Disadvantaged by Local Authority"</span>,</span>
<span id="cb73-836"><a href="#cb73-836" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"% KS4 Pupils Disadvantaged (PTFSM6CLA1A)"</span>,</span>
<span id="cb73-837"><a href="#cb73-837" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Attainment 8 Score (ATT8SCR)"</span></span>
<span id="cb73-838"><a href="#cb73-838" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb73-839"><a href="#cb73-839" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb73-840"><a href="#cb73-840" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-841"><a href="#cb73-841" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb73-842"><a href="#cb73-842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-843"><a href="#cb73-843" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Exploratory Data Analysis Maps</span></span>
<span id="cb73-844"><a href="#cb73-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-845"><a href="#cb73-845" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Maps are great, they help you understand all kinds of things if your data have a spatial identifier. Try some maps out here!</span>
<span id="cb73-846"><a href="#cb73-846" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>You might find R is a bit better at mapping things. Just saying.</span>
<span id="cb73-847"><a href="#cb73-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-848"><a href="#cb73-848" aria-hidden="true" tabindex="-1"></a>::: {.multicode}</span>
<span id="cb73-849"><a href="#cb73-849" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/python-logo-only.png){width="30"}</span></span>
<span id="cb73-850"><a href="#cb73-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-853"><a href="#cb73-853" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb73-854"><a href="#cb73-854" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb73-855"><a href="#cb73-855" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb73-856"><a href="#cb73-856" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> folium</span>
<span id="cb73-857"><a href="#cb73-857" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> branca.colormap <span class="im">import</span> linear</span>
<span id="cb73-858"><a href="#cb73-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-859"><a href="#cb73-859" aria-hidden="true" tabindex="-1"></a><span class="co"># Create GeoDataFrame from BNG coordinates</span></span>
<span id="cb73-860"><a href="#cb73-860" aria-hidden="true" tabindex="-1"></a>sf_df_bng <span class="op">=</span> gpd.GeoDataFrame(</span>
<span id="cb73-861"><a href="#cb73-861" aria-hidden="true" tabindex="-1"></a>    camden_sub,</span>
<span id="cb73-862"><a href="#cb73-862" aria-hidden="true" tabindex="-1"></a>    geometry<span class="op">=</span>gpd.points_from_xy(camden_sub[<span class="st">'easting'</span>], camden_sub[<span class="st">'northing'</span>]),</span>
<span id="cb73-863"><a href="#cb73-863" aria-hidden="true" tabindex="-1"></a>    crs<span class="op">=</span><span class="st">'EPSG:27700'</span></span>
<span id="cb73-864"><a href="#cb73-864" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb73-865"><a href="#cb73-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-866"><a href="#cb73-866" aria-hidden="true" tabindex="-1"></a><span class="co"># Reproject to WGS84</span></span>
<span id="cb73-867"><a href="#cb73-867" aria-hidden="true" tabindex="-1"></a>sf_df <span class="op">=</span> sf_df_bng.to_crs(<span class="st">'EPSG:4326'</span>)</span>
<span id="cb73-868"><a href="#cb73-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-869"><a href="#cb73-869" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract lat/lon from geometry</span></span>
<span id="cb73-870"><a href="#cb73-870" aria-hidden="true" tabindex="-1"></a>sf_df[<span class="st">'lat'</span>] <span class="op">=</span> sf_df.geometry.y</span>
<span id="cb73-871"><a href="#cb73-871" aria-hidden="true" tabindex="-1"></a>sf_df[<span class="st">'lon'</span>] <span class="op">=</span> sf_df.geometry.x</span>
<span id="cb73-872"><a href="#cb73-872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-873"><a href="#cb73-873" aria-hidden="true" tabindex="-1"></a><span class="co"># Scale marker size by TOTPUPS</span></span>
<span id="cb73-874"><a href="#cb73-874" aria-hidden="true" tabindex="-1"></a>min_pupils <span class="op">=</span> sf_df[<span class="st">'TOTPUPS'</span>].<span class="bu">min</span>()</span>
<span id="cb73-875"><a href="#cb73-875" aria-hidden="true" tabindex="-1"></a>max_pupils <span class="op">=</span> sf_df[<span class="st">'TOTPUPS'</span>].<span class="bu">max</span>()</span>
<span id="cb73-876"><a href="#cb73-876" aria-hidden="true" tabindex="-1"></a>sf_df[<span class="st">'size_scale'</span>] <span class="op">=</span> <span class="dv">4</span> <span class="op">+</span> (sf_df[<span class="st">'TOTPUPS'</span>] <span class="op">-</span> min_pupils) <span class="op">*</span> (<span class="dv">12</span> <span class="op">-</span> <span class="dv">4</span>) <span class="op">/</span> (max_pupils <span class="op">-</span> min_pupils)</span>
<span id="cb73-877"><a href="#cb73-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-878"><a href="#cb73-878" aria-hidden="true" tabindex="-1"></a><span class="co"># Create magma color scale based on ATT8SCR</span></span>
<span id="cb73-879"><a href="#cb73-879" aria-hidden="true" tabindex="-1"></a>att_values <span class="op">=</span> sf_df[<span class="st">'ATT8SCR'</span>].dropna()</span>
<span id="cb73-880"><a href="#cb73-880" aria-hidden="true" tabindex="-1"></a>vmin, vmax <span class="op">=</span> <span class="bu">sorted</span>([att_values.<span class="bu">min</span>(), att_values.<span class="bu">max</span>()])</span>
<span id="cb73-881"><a href="#cb73-881" aria-hidden="true" tabindex="-1"></a>magma_scale <span class="op">=</span> linear.magma.scale(vmin, vmax)</span>
<span id="cb73-882"><a href="#cb73-882" aria-hidden="true" tabindex="-1"></a>magma_scale.caption <span class="op">=</span> <span class="st">'ATT8SCR'</span></span>
<span id="cb73-883"><a href="#cb73-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-884"><a href="#cb73-884" aria-hidden="true" tabindex="-1"></a><span class="co"># Create interactive map centered on Camden</span></span>
<span id="cb73-885"><a href="#cb73-885" aria-hidden="true" tabindex="-1"></a>center_lat <span class="op">=</span> sf_df[<span class="st">'lat'</span>].mean()</span>
<span id="cb73-886"><a href="#cb73-886" aria-hidden="true" tabindex="-1"></a>center_lon <span class="op">=</span> sf_df[<span class="st">'lon'</span>].mean()</span>
<span id="cb73-887"><a href="#cb73-887" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> folium.Map(location<span class="op">=</span>[center_lat, center_lon], tiles<span class="op">=</span><span class="st">'CartoDB.Positron'</span>, zoom_start<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb73-888"><a href="#cb73-888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-889"><a href="#cb73-889" aria-hidden="true" tabindex="-1"></a><span class="co"># Add circle markers</span></span>
<span id="cb73-890"><a href="#cb73-890" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _, row <span class="kw">in</span> sf_df.iterrows():</span>
<span id="cb73-891"><a href="#cb73-891" aria-hidden="true" tabindex="-1"></a>    popup_html <span class="op">=</span> <span class="ss">f"&lt;strong&gt;</span><span class="sc">{</span>row[<span class="st">'SCHNAME_x'</span>]<span class="sc">}</span><span class="ss">&lt;/strong&gt;&lt;br&gt;Pupils: </span><span class="sc">{</span>row[<span class="st">'TOTPUPS'</span>]<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb73-892"><a href="#cb73-892" aria-hidden="true" tabindex="-1"></a>    folium.CircleMarker(</span>
<span id="cb73-893"><a href="#cb73-893" aria-hidden="true" tabindex="-1"></a>        location<span class="op">=</span>[row[<span class="st">'lat'</span>], row[<span class="st">'lon'</span>]],</span>
<span id="cb73-894"><a href="#cb73-894" aria-hidden="true" tabindex="-1"></a>        radius<span class="op">=</span>row[<span class="st">'size_scale'</span>],</span>
<span id="cb73-895"><a href="#cb73-895" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span>magma_scale(row[<span class="st">'ATT8SCR'</span>]),</span>
<span id="cb73-896"><a href="#cb73-896" aria-hidden="true" tabindex="-1"></a>        fill<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb73-897"><a href="#cb73-897" aria-hidden="true" tabindex="-1"></a>        fill_color<span class="op">=</span>magma_scale(row[<span class="st">'ATT8SCR'</span>]),</span>
<span id="cb73-898"><a href="#cb73-898" aria-hidden="true" tabindex="-1"></a>        fill_opacity<span class="op">=</span><span class="fl">0.8</span>,</span>
<span id="cb73-899"><a href="#cb73-899" aria-hidden="true" tabindex="-1"></a>        popup<span class="op">=</span>folium.Popup(popup_html, max_width<span class="op">=</span><span class="dv">250</span>)</span>
<span id="cb73-900"><a href="#cb73-900" aria-hidden="true" tabindex="-1"></a>    ).add_to(m)</span>
<span id="cb73-901"><a href="#cb73-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-902"><a href="#cb73-902" aria-hidden="true" tabindex="-1"></a><span class="co"># Add color legend</span></span>
<span id="cb73-903"><a href="#cb73-903" aria-hidden="true" tabindex="-1"></a>magma_scale.add_to(m)</span>
<span id="cb73-904"><a href="#cb73-904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-905"><a href="#cb73-905" aria-hidden="true" tabindex="-1"></a><span class="co"># Save map</span></span>
<span id="cb73-906"><a href="#cb73-906" aria-hidden="true" tabindex="-1"></a>m.save(<span class="st">"interactive_school_map.html"</span>)</span>
<span id="cb73-907"><a href="#cb73-907" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-908"><a href="#cb73-908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-911"><a href="#cb73-911" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb73-912"><a href="#cb73-912" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb73-913"><a href="#cb73-913" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb73-914"><a href="#cb73-914" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.cm <span class="im">as</span> cm</span>
<span id="cb73-915"><a href="#cb73-915" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.colors <span class="im">import</span> Normalize</span>
<span id="cb73-916"><a href="#cb73-916" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> contextily <span class="im">as</span> ctx</span>
<span id="cb73-917"><a href="#cb73-917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-918"><a href="#cb73-918" aria-hidden="true" tabindex="-1"></a><span class="co"># Reproject to Web Mercator for contextily</span></span>
<span id="cb73-919"><a href="#cb73-919" aria-hidden="true" tabindex="-1"></a>sf_df_mercator <span class="op">=</span> sf_df_bng.to_crs(epsg<span class="op">=</span><span class="dv">3857</span>)</span>
<span id="cb73-920"><a href="#cb73-920" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-921"><a href="#cb73-921" aria-hidden="true" tabindex="-1"></a><span class="co"># Scale marker size</span></span>
<span id="cb73-922"><a href="#cb73-922" aria-hidden="true" tabindex="-1"></a>min_val <span class="op">=</span> sf_df_mercator[<span class="st">'TOTPUPS'</span>].<span class="bu">min</span>()</span>
<span id="cb73-923"><a href="#cb73-923" aria-hidden="true" tabindex="-1"></a>max_val <span class="op">=</span> sf_df_mercator[<span class="st">'TOTPUPS'</span>].<span class="bu">max</span>()</span>
<span id="cb73-924"><a href="#cb73-924" aria-hidden="true" tabindex="-1"></a>sf_df_mercator[<span class="st">'size_scale'</span>] <span class="op">=</span> <span class="dv">4</span> <span class="op">+</span> (sf_df_mercator[<span class="st">'TOTPUPS'</span>] <span class="op">-</span> min_val) <span class="op">*</span> (<span class="dv">12</span> <span class="op">-</span> <span class="dv">4</span>) <span class="op">/</span> (max_val <span class="op">-</span> min_val)</span>
<span id="cb73-925"><a href="#cb73-925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-926"><a href="#cb73-926" aria-hidden="true" tabindex="-1"></a><span class="co"># Color mapping</span></span>
<span id="cb73-927"><a href="#cb73-927" aria-hidden="true" tabindex="-1"></a>norm <span class="op">=</span> Normalize(vmin<span class="op">=</span>sf_df_mercator[<span class="st">'ATT8SCR'</span>].<span class="bu">min</span>(), vmax<span class="op">=</span>sf_df_mercator[<span class="st">'ATT8SCR'</span>].<span class="bu">max</span>())</span>
<span id="cb73-928"><a href="#cb73-928" aria-hidden="true" tabindex="-1"></a>cmap <span class="op">=</span> plt.colormaps[<span class="st">'magma'</span>]</span>
<span id="cb73-929"><a href="#cb73-929" aria-hidden="true" tabindex="-1"></a>sf_df_mercator[<span class="st">'color'</span>] <span class="op">=</span> sf_df_mercator[<span class="st">'ATT8SCR'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: cmap(norm(x)))</span>
<span id="cb73-930"><a href="#cb73-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-931"><a href="#cb73-931" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb73-932"><a href="#cb73-932" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb73-933"><a href="#cb73-933" aria-hidden="true" tabindex="-1"></a>sf_df_mercator.plot(ax<span class="op">=</span>ax, color<span class="op">=</span>sf_df_mercator[<span class="st">'color'</span>], markersize<span class="op">=</span>sf_df_mercator[<span class="st">'size_scale'</span>]<span class="op">**</span><span class="dv">2</span>, alpha<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb73-934"><a href="#cb73-934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-935"><a href="#cb73-935" aria-hidden="true" tabindex="-1"></a><span class="co"># Add basemap</span></span>
<span id="cb73-936"><a href="#cb73-936" aria-hidden="true" tabindex="-1"></a>ctx.add_basemap(ax, source<span class="op">=</span>ctx.providers.CartoDB.Positron)</span>
<span id="cb73-937"><a href="#cb73-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-938"><a href="#cb73-938" aria-hidden="true" tabindex="-1"></a><span class="co"># Final touches</span></span>
<span id="cb73-939"><a href="#cb73-939" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Static Map of Schools Colored by ATT8SCR and Sized by TOTPUPS"</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb73-940"><a href="#cb73-940" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb73-941"><a href="#cb73-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-942"><a href="#cb73-942" aria-hidden="true" tabindex="-1"></a><span class="co"># Colorbar</span></span>
<span id="cb73-943"><a href="#cb73-943" aria-hidden="true" tabindex="-1"></a>sm <span class="op">=</span> cm.ScalarMappable(cmap<span class="op">=</span>cmap, norm<span class="op">=</span>norm)</span>
<span id="cb73-944"><a href="#cb73-944" aria-hidden="true" tabindex="-1"></a>sm.set_array([])</span>
<span id="cb73-945"><a href="#cb73-945" aria-hidden="true" tabindex="-1"></a>cbar <span class="op">=</span> fig.colorbar(sm, ax<span class="op">=</span>ax, orientation<span class="op">=</span><span class="st">'vertical'</span>, fraction<span class="op">=</span><span class="fl">0.03</span>, pad<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb73-946"><a href="#cb73-946" aria-hidden="true" tabindex="-1"></a>cbar.set_label(<span class="st">'ATT8SCR'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb73-947"><a href="#cb73-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-948"><a href="#cb73-948" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb73-949"><a href="#cb73-949" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">"static_school_map_with_basemap.png"</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb73-950"><a href="#cb73-950" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb73-951"><a href="#cb73-951" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-952"><a href="#cb73-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-953"><a href="#cb73-953" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/Rlogo.png){width="41" height="30"}</span></span>
<span id="cb73-954"><a href="#cb73-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-957"><a href="#cb73-957" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-958"><a href="#cb73-958" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb73-959"><a href="#cb73-959" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb73-960"><a href="#cb73-960" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb73-961"><a href="#cb73-961" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb73-962"><a href="#cb73-962" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb73-963"><a href="#cb73-963" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb73-964"><a href="#cb73-964" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)</span>
<span id="cb73-965"><a href="#cb73-965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-966"><a href="#cb73-966" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to sf object with EPSG:27700</span></span>
<span id="cb73-967"><a href="#cb73-967" aria-hidden="true" tabindex="-1"></a>sf_df <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(leeds_sub, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"easting"</span>, <span class="st">"northing"</span>), <span class="at">crs =</span> <span class="dv">27700</span>)</span>
<span id="cb73-968"><a href="#cb73-968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-969"><a href="#cb73-969" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform to EPSG:4326</span></span>
<span id="cb73-970"><a href="#cb73-970" aria-hidden="true" tabindex="-1"></a>sf_df <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(sf_df, <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb73-971"><a href="#cb73-971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-972"><a href="#cb73-972" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract lat/lon for leaflet</span></span>
<span id="cb73-973"><a href="#cb73-973" aria-hidden="true" tabindex="-1"></a>sf_df <span class="ot">&lt;-</span> sf_df <span class="sc">%&gt;%</span></span>
<span id="cb73-974"><a href="#cb73-974" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb73-975"><a href="#cb73-975" aria-hidden="true" tabindex="-1"></a>    <span class="at">lon =</span> <span class="fu">st_coordinates</span>(.)[,<span class="dv">1</span>],</span>
<span id="cb73-976"><a href="#cb73-976" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="fu">st_coordinates</span>(.)[,<span class="dv">2</span>]</span>
<span id="cb73-977"><a href="#cb73-977" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb73-978"><a href="#cb73-978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-979"><a href="#cb73-979" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-980"><a href="#cb73-980" aria-hidden="true" tabindex="-1"></a><span class="co"># Define size and color scales</span></span>
<span id="cb73-981"><a href="#cb73-981" aria-hidden="true" tabindex="-1"></a>size_scale <span class="ot">&lt;-</span> <span class="fu">rescale</span>(sf_df<span class="sc">$</span>TOTPUPS, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">15</span>))  <span class="co"># radius from 4 to 12</span></span>
<span id="cb73-982"><a href="#cb73-982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-983"><a href="#cb73-983" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a color palette based on ATT8SCR</span></span>
<span id="cb73-984"><a href="#cb73-984" aria-hidden="true" tabindex="-1"></a>pal <span class="ot">&lt;-</span> <span class="fu">colorNumeric</span>(<span class="at">palette =</span> <span class="st">"magma"</span>, <span class="at">domain =</span> sf_df<span class="sc">$</span>ATT8SCR)</span>
<span id="cb73-985"><a href="#cb73-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-986"><a href="#cb73-986" aria-hidden="true" tabindex="-1"></a><span class="fu">leaflet</span>(sf_df) <span class="sc">%&gt;%</span></span>
<span id="cb73-987"><a href="#cb73-987" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addProviderTiles</span>(<span class="st">"CartoDB.Positron"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb73-988"><a href="#cb73-988" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addCircleMarkers</span>(</span>
<span id="cb73-989"><a href="#cb73-989" aria-hidden="true" tabindex="-1"></a>    <span class="at">lng =</span> <span class="sc">~</span>lon,</span>
<span id="cb73-990"><a href="#cb73-990" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="sc">~</span>lat,</span>
<span id="cb73-991"><a href="#cb73-991" aria-hidden="true" tabindex="-1"></a>    <span class="at">radius =</span> size_scale,</span>
<span id="cb73-992"><a href="#cb73-992" aria-hidden="true" tabindex="-1"></a>    <span class="at">stroke =</span> <span class="cn">FALSE</span>,</span>
<span id="cb73-993"><a href="#cb73-993" aria-hidden="true" tabindex="-1"></a>    <span class="at">fillOpacity =</span> <span class="fl">0.8</span>,</span>
<span id="cb73-994"><a href="#cb73-994" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="sc">~</span><span class="fu">pal</span>(ATT8SCR),</span>
<span id="cb73-995"><a href="#cb73-995" aria-hidden="true" tabindex="-1"></a>    <span class="at">popup =</span> <span class="sc">~</span><span class="fu">paste0</span>(</span>
<span id="cb73-996"><a href="#cb73-996" aria-hidden="true" tabindex="-1"></a>      <span class="st">"&lt;strong&gt;"</span>, SCHNAME.x, <span class="st">"&lt;/strong&gt;&lt;br&gt;"</span>,</span>
<span id="cb73-997"><a href="#cb73-997" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Pupils: "</span>, TOTPUPS</span>
<span id="cb73-998"><a href="#cb73-998" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb73-999"><a href="#cb73-999" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb73-1000"><a href="#cb73-1000" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addLegend</span>(</span>
<span id="cb73-1001"><a href="#cb73-1001" aria-hidden="true" tabindex="-1"></a>    <span class="st">"bottomright"</span>,</span>
<span id="cb73-1002"><a href="#cb73-1002" aria-hidden="true" tabindex="-1"></a>    <span class="at">pal =</span> pal,</span>
<span id="cb73-1003"><a href="#cb73-1003" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="sc">~</span>ATT8SCR,</span>
<span id="cb73-1004"><a href="#cb73-1004" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"ATT8SCR"</span>,</span>
<span id="cb73-1005"><a href="#cb73-1005" aria-hidden="true" tabindex="-1"></a>    <span class="at">opacity =</span> <span class="fl">0.8</span></span>
<span id="cb73-1006"><a href="#cb73-1006" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb73-1007"><a href="#cb73-1007" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-1008"><a href="#cb73-1008" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb73-1009"><a href="#cb73-1009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1010"><a href="#cb73-1010" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Exploratory Data Analysis - Distributions and slicing and dicing</span></span>
<span id="cb73-1011"><a href="#cb73-1011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1012"><a href="#cb73-1012" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>You can also explore the scatter plot for your whole of England dataset.</span>
<span id="cb73-1013"><a href="#cb73-1013" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>One really interesting thing to do is to slice and dice your data according to some of the categorical variables.</span>
<span id="cb73-1014"><a href="#cb73-1014" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>In the R visualisation, you can see how we can start to slide and dice by regions, for example. Maybe try some of your other categorical variables.</span>
<span id="cb73-1015"><a href="#cb73-1015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1016"><a href="#cb73-1016" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb73-1017"><a href="#cb73-1017" aria-hidden="true" tabindex="-1"></a>You will notice that in the plots below I have used a log10() transformation, but you could also use the natural log() or a range of other possible transformations. If you want to understand a bit more about transformations for normalisng your data, you should explore Tukey's Ladder of Powers - <span class="ot">&lt;https://onlinestatbook.com/2/transformations/tukey.html&gt;</span> - in R (and probably in Python too) there are packages to apply appropriate Tukey transformations so your data gets a little closer to a normal distribution.</span>
<span id="cb73-1018"><a href="#cb73-1018" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb73-1019"><a href="#cb73-1019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1020"><a href="#cb73-1020" aria-hidden="true" tabindex="-1"></a>::: {.multicode}</span>
<span id="cb73-1021"><a href="#cb73-1021" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/python-logo-only.png){width="30"}</span></span>
<span id="cb73-1022"><a href="#cb73-1022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1025"><a href="#cb73-1025" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb73-1026"><a href="#cb73-1026" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb73-1027"><a href="#cb73-1027" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb73-1028"><a href="#cb73-1028" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb73-1029"><a href="#cb73-1029" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb73-1030"><a href="#cb73-1030" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb73-1031"><a href="#cb73-1031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1032"><a href="#cb73-1032" aria-hidden="true" tabindex="-1"></a><span class="co"># Load your data into a DataFrame named england_filtered</span></span>
<span id="cb73-1033"><a href="#cb73-1033" aria-hidden="true" tabindex="-1"></a><span class="co"># england_filtered = pd.read_csv("your_data.csv")</span></span>
<span id="cb73-1034"><a href="#cb73-1034" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1035"><a href="#cb73-1035" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply log10 transformation (replace 0s to avoid log(0))</span></span>
<span id="cb73-1036"><a href="#cb73-1036" aria-hidden="true" tabindex="-1"></a>england_filtered[<span class="st">'log_PTFSM6CLA1A'</span>] <span class="op">=</span> np.log10(england_filtered[<span class="st">'PTFSM6CLA1A'</span>].replace(<span class="dv">0</span>, np.nan))</span>
<span id="cb73-1037"><a href="#cb73-1037" aria-hidden="true" tabindex="-1"></a>england_filtered[<span class="st">'log_ATT8SCR'</span>] <span class="op">=</span> np.log10(england_filtered[<span class="st">'ATT8SCR'</span>].replace(<span class="dv">0</span>, np.nan))</span>
<span id="cb73-1038"><a href="#cb73-1038" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1039"><a href="#cb73-1039" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop rows with NaNs from log(0)</span></span>
<span id="cb73-1040"><a href="#cb73-1040" aria-hidden="true" tabindex="-1"></a>england_filtered <span class="op">=</span> england_filtered.dropna(subset<span class="op">=</span>[<span class="st">'log_PTFSM6CLA1A'</span>, <span class="st">'log_ATT8SCR'</span>])</span>
<span id="cb73-1041"><a href="#cb73-1041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1042"><a href="#cb73-1042" aria-hidden="true" tabindex="-1"></a><span class="co"># Set theme</span></span>
<span id="cb73-1043"><a href="#cb73-1043" aria-hidden="true" tabindex="-1"></a>sns.set_theme(style<span class="op">=</span><span class="st">"darkgrid"</span>)</span>
<span id="cb73-1044"><a href="#cb73-1044" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1045"><a href="#cb73-1045" aria-hidden="true" tabindex="-1"></a><span class="co"># Create jointplot</span></span>
<span id="cb73-1046"><a href="#cb73-1046" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> sns.jointplot(</span>
<span id="cb73-1047"><a href="#cb73-1047" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"log_PTFSM6CLA1A"</span>,</span>
<span id="cb73-1048"><a href="#cb73-1048" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">"log_ATT8SCR"</span>,</span>
<span id="cb73-1049"><a href="#cb73-1049" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>england_filtered,</span>
<span id="cb73-1050"><a href="#cb73-1050" aria-hidden="true" tabindex="-1"></a>    kind<span class="op">=</span><span class="st">"reg"</span>,</span>
<span id="cb73-1051"><a href="#cb73-1051" aria-hidden="true" tabindex="-1"></a>    truncate<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb73-1052"><a href="#cb73-1052" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">"m"</span>,</span>
<span id="cb73-1053"><a href="#cb73-1053" aria-hidden="true" tabindex="-1"></a>    height<span class="op">=</span><span class="dv">7</span></span>
<span id="cb73-1054"><a href="#cb73-1054" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb73-1055"><a href="#cb73-1055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1056"><a href="#cb73-1056" aria-hidden="true" tabindex="-1"></a><span class="co"># Label axes</span></span>
<span id="cb73-1057"><a href="#cb73-1057" aria-hidden="true" tabindex="-1"></a>g.set_axis_labels(<span class="st">"log10(PTFSM6CLA1A)"</span>, <span class="st">"log10(ATT8SCR)"</span>)</span>
<span id="cb73-1058"><a href="#cb73-1058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1059"><a href="#cb73-1059" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb73-1060"><a href="#cb73-1060" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-1061"><a href="#cb73-1061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1062"><a href="#cb73-1062" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/Rlogo.png){width="41" height="30"}</span></span>
<span id="cb73-1063"><a href="#cb73-1063" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1066"><a href="#cb73-1066" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-1067"><a href="#cb73-1067" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb73-1068"><a href="#cb73-1068" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggside)</span>
<span id="cb73-1069"><a href="#cb73-1069" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb73-1070"><a href="#cb73-1070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1071"><a href="#cb73-1071" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(england_filtered, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log10</span>(PTFSM6CLA1A), <span class="at">y =</span> <span class="fu">log10</span>(ATT8SCR), <span class="at">colour =</span> gor_name)) <span class="sc">+</span></span>
<span id="cb73-1072"><a href="#cb73-1072" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb73-1073"><a href="#cb73-1073" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_xsidedensity</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">after_stat</span>(density)), <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">position =</span> <span class="st">"stack"</span>) <span class="sc">+</span></span>
<span id="cb73-1074"><a href="#cb73-1074" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ysidedensity</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">after_stat</span>(density)), <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">position =</span> <span class="st">"stack"</span>) <span class="sc">+</span> </span>
<span id="cb73-1075"><a href="#cb73-1075" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">ggside.panel.scale.x =</span> <span class="fl">0.4</span>,<span class="at">ggside.panel.scale.y =</span> <span class="fl">0.4</span>)</span>
<span id="cb73-1076"><a href="#cb73-1076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1077"><a href="#cb73-1077" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-1078"><a href="#cb73-1078" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb73-1079"><a href="#cb73-1079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1080"><a href="#cb73-1080" aria-hidden="true" tabindex="-1"></a>::: {.multicode}</span>
<span id="cb73-1081"><a href="#cb73-1081" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/python-logo-only.png){width="30"}</span></span>
<span id="cb73-1082"><a href="#cb73-1082" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1085"><a href="#cb73-1085" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb73-1086"><a href="#cb73-1086" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb73-1087"><a href="#cb73-1087" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb73-1088"><a href="#cb73-1088" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb73-1089"><a href="#cb73-1089" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1090"><a href="#cb73-1090" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the theme</span></span>
<span id="cb73-1091"><a href="#cb73-1091" aria-hidden="true" tabindex="-1"></a>sns.set_theme(style<span class="op">=</span><span class="st">"darkgrid"</span>)</span>
<span id="cb73-1092"><a href="#cb73-1092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1093"><a href="#cb73-1093" aria-hidden="true" tabindex="-1"></a><span class="co"># Create side-by-side histograms</span></span>
<span id="cb73-1094"><a href="#cb73-1094" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">6</span>))</span>
<span id="cb73-1095"><a href="#cb73-1095" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1096"><a href="#cb73-1096" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogram for PTFSM6CLA1A</span></span>
<span id="cb73-1097"><a href="#cb73-1097" aria-hidden="true" tabindex="-1"></a>sns.histplot(data<span class="op">=</span>england_filtered, x<span class="op">=</span><span class="st">"PTFSM6CLA1A"</span>, ax<span class="op">=</span>axes[<span class="dv">0</span>], kde<span class="op">=</span><span class="va">True</span>, color<span class="op">=</span><span class="st">"skyblue"</span>)</span>
<span id="cb73-1098"><a href="#cb73-1098" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">"Histogram of PTFSM6CLA1A"</span>)</span>
<span id="cb73-1099"><a href="#cb73-1099" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">"PTFSM6CLA1A"</span>)</span>
<span id="cb73-1100"><a href="#cb73-1100" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">"Frequency"</span>)</span>
<span id="cb73-1101"><a href="#cb73-1101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1102"><a href="#cb73-1102" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogram for ATT8SCR</span></span>
<span id="cb73-1103"><a href="#cb73-1103" aria-hidden="true" tabindex="-1"></a>sns.histplot(data<span class="op">=</span>england_filtered, x<span class="op">=</span><span class="st">"ATT8SCR"</span>, ax<span class="op">=</span>axes[<span class="dv">1</span>], kde<span class="op">=</span><span class="va">True</span>, color<span class="op">=</span><span class="st">"salmon"</span>)</span>
<span id="cb73-1104"><a href="#cb73-1104" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">"Histogram of ATT8SCR"</span>)</span>
<span id="cb73-1105"><a href="#cb73-1105" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">"ATT8SCR"</span>)</span>
<span id="cb73-1106"><a href="#cb73-1106" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">"Frequency"</span>)</span>
<span id="cb73-1107"><a href="#cb73-1107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1108"><a href="#cb73-1108" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb73-1109"><a href="#cb73-1109" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb73-1110"><a href="#cb73-1110" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-1111"><a href="#cb73-1111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1112"><a href="#cb73-1112" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/Rlogo.png){width="41" height="30"}</span></span>
<span id="cb73-1113"><a href="#cb73-1113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1116"><a href="#cb73-1116" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-1117"><a href="#cb73-1117" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb73-1118"><a href="#cb73-1118" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb73-1119"><a href="#cb73-1119" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb73-1120"><a href="#cb73-1120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1121"><a href="#cb73-1121" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogram for PTFSM6CLA1A</span></span>
<span id="cb73-1122"><a href="#cb73-1122" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(england_filtered, <span class="fu">aes</span>(<span class="at">x =</span> PTFSM6CLA1A)) <span class="sc">+</span></span>
<span id="cb73-1123"><a href="#cb73-1123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="st">"skyblue"</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb73-1124"><a href="#cb73-1124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">y =</span> ..count..), <span class="at">color =</span> <span class="st">"skyblue"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb73-1125"><a href="#cb73-1125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb73-1126"><a href="#cb73-1126" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb73-1127"><a href="#cb73-1127" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Histogram of PTFSM6CLA1A"</span>,</span>
<span id="cb73-1128"><a href="#cb73-1128" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PTFSM6CLA1A"</span>,</span>
<span id="cb73-1129"><a href="#cb73-1129" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Frequency"</span></span>
<span id="cb73-1130"><a href="#cb73-1130" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb73-1131"><a href="#cb73-1131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1132"><a href="#cb73-1132" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogram for ATT8SCR</span></span>
<span id="cb73-1133"><a href="#cb73-1133" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(england_filtered, <span class="fu">aes</span>(<span class="at">x =</span> ATT8SCR)) <span class="sc">+</span></span>
<span id="cb73-1134"><a href="#cb73-1134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="st">"salmon"</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb73-1135"><a href="#cb73-1135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">y =</span> ..count..), <span class="at">color =</span> <span class="st">"salmon"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb73-1136"><a href="#cb73-1136" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb73-1137"><a href="#cb73-1137" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb73-1138"><a href="#cb73-1138" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Histogram of ATT8SCR"</span>,</span>
<span id="cb73-1139"><a href="#cb73-1139" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"ATT8SCR"</span>,</span>
<span id="cb73-1140"><a href="#cb73-1140" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Frequency"</span></span>
<span id="cb73-1141"><a href="#cb73-1141" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb73-1142"><a href="#cb73-1142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1143"><a href="#cb73-1143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1144"><a href="#cb73-1144" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-1145"><a href="#cb73-1145" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb73-1146"><a href="#cb73-1146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1147"><a href="#cb73-1147" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip title="Explore Different Visualisations"}</span>
<span id="cb73-1148"><a href="#cb73-1148" aria-hidden="true" tabindex="-1"></a>I've just given you a few very basic visualisation types here, but there are so many extensions and options available in packages like <span class="co">[</span><span class="ot">ggplot2</span><span class="co">](https://exts.ggplot2.tidyverse.org/gallery/)</span> in R and <span class="co">[</span><span class="ot">Seaborn</span><span class="co">](https://seaborn.pydata.org/examples/index.html)</span> in Python so you can get visualising in very creative ways - have a look at some of these gallery examples in the links and maybe try experimenting with a few different ones! There are no excuses these days for 💩 data visualisations!</span>
<span id="cb73-1149"><a href="#cb73-1149" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb73-1150"><a href="#cb73-1150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1153"><a href="#cb73-1153" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-1154"><a href="#cb73-1154" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb73-1155"><a href="#cb73-1155" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(england_filtered, <span class="fu">aes</span>(<span class="at">x =</span> PTFSM6CLA1A, <span class="at">y =</span> ATT8SCR, <span class="at">fill =</span> gor_name)) <span class="sc">+</span></span>
<span id="cb73-1156"><a href="#cb73-1156" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>(</span>
<span id="cb73-1157"><a href="#cb73-1157" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.8</span>),</span>
<span id="cb73-1158"><a href="#cb73-1158" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.6</span>,</span>
<span id="cb73-1159"><a href="#cb73-1159" aria-hidden="true" tabindex="-1"></a>    <span class="at">draw_quantiles =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>)</span>
<span id="cb73-1160"><a href="#cb73-1160" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb73-1161"><a href="#cb73-1161" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> gor_name) <span class="sc">+</span></span>
<span id="cb73-1162"><a href="#cb73-1162" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb73-1163"><a href="#cb73-1163" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb73-1164"><a href="#cb73-1164" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Violin Plot of Attainment 8 Score with Quantiles by Region"</span>,</span>
<span id="cb73-1165"><a href="#cb73-1165" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"% Disadvantaged"</span>,</span>
<span id="cb73-1166"><a href="#cb73-1166" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Attainment 8 Score"</span>,</span>
<span id="cb73-1167"><a href="#cb73-1167" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Region"</span></span>
<span id="cb73-1168"><a href="#cb73-1168" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb73-1169"><a href="#cb73-1169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1170"><a href="#cb73-1170" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-1171"><a href="#cb73-1171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1174"><a href="#cb73-1174" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-1175"><a href="#cb73-1175" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb73-1176"><a href="#cb73-1176" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggdist)</span>
<span id="cb73-1177"><a href="#cb73-1177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1178"><a href="#cb73-1178" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(england_filtered, <span class="fu">aes</span>(<span class="at">x =</span> PTFSM6CLA1A, <span class="at">y =</span> gor_name, <span class="at">fill =</span> gor_name)) <span class="sc">+</span> </span>
<span id="cb73-1179"><a href="#cb73-1179" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_slab</span>(<span class="fu">aes</span>(<span class="at">thickness =</span> <span class="fu">after_stat</span>(pdf<span class="sc">*</span>n)), <span class="at">scale =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb73-1180"><a href="#cb73-1180" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_dotsinterval</span>(<span class="at">side =</span> <span class="st">"bottom"</span>, <span class="at">scale =</span> <span class="dv">1</span>, <span class="at">slab_linewidth =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb73-1181"><a href="#cb73-1181" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Set2"</span>) <span class="sc">+</span></span>
<span id="cb73-1182"><a href="#cb73-1182" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_ggdist</span>() <span class="sc">+</span></span>
<span id="cb73-1183"><a href="#cb73-1183" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb73-1184"><a href="#cb73-1184" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Rain Cloud Plot of % Disadvantage in Schools by Region"</span>,</span>
<span id="cb73-1185"><a href="#cb73-1185" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"% Disadvantaged"</span>,</span>
<span id="cb73-1186"><a href="#cb73-1186" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Region"</span>,</span>
<span id="cb73-1187"><a href="#cb73-1187" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Region"</span></span>
<span id="cb73-1188"><a href="#cb73-1188" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb73-1189"><a href="#cb73-1189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1190"><a href="#cb73-1190" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-1191"><a href="#cb73-1191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1192"><a href="#cb73-1192" aria-hidden="true" tabindex="-1"></a><span class="fu">## Task 4 - Explanatory Analysis - Running Your Regression Model</span></span>
<span id="cb73-1193"><a href="#cb73-1193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1194"><a href="#cb73-1194" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Now you have carried out some appropriate exploratory data analysis, you should run a simple bi-variate regression model for your two local authority areas and compare it with a similar analysis run on the national dataset</span>
<span id="cb73-1195"><a href="#cb73-1195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1196"><a href="#cb73-1196" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb73-1197"><a href="#cb73-1197" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Depending on your variables and whether or not there appears to be a linear relationship or a log-log or level-log relationship, if you transform a variable for the national data or one of your subsets, you could also transform it for the others, otherwise it will be impossible to compare</span>
<span id="cb73-1198"><a href="#cb73-1198" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb73-1199"><a href="#cb73-1199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1200"><a href="#cb73-1200" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The Code below is an example using my variables, but you should use the variables you have selected.</span>
<span id="cb73-1201"><a href="#cb73-1201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1202"><a href="#cb73-1202" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Running the Model for the first (London) local authority</span></span>
<span id="cb73-1203"><a href="#cb73-1203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1204"><a href="#cb73-1204" aria-hidden="true" tabindex="-1"></a>::: {.multicode}</span>
<span id="cb73-1205"><a href="#cb73-1205" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/python-logo-only.png){width="30"}</span></span>
<span id="cb73-1206"><a href="#cb73-1206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1209"><a href="#cb73-1209" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb73-1210"><a href="#cb73-1210" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb73-1211"><a href="#cb73-1211" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb73-1212"><a href="#cb73-1212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1213"><a href="#cb73-1213" aria-hidden="true" tabindex="-1"></a><span class="co"># Log-transform the variables</span></span>
<span id="cb73-1214"><a href="#cb73-1214" aria-hidden="true" tabindex="-1"></a>camden_sub[<span class="st">'log_ATT8SCR'</span>] <span class="op">=</span> np.log(camden_sub[<span class="st">'ATT8SCR'</span>])</span>
<span id="cb73-1215"><a href="#cb73-1215" aria-hidden="true" tabindex="-1"></a>camden_sub[<span class="st">'log_PTFSM6CLA1A'</span>] <span class="op">=</span> np.log(camden_sub[<span class="st">'PTFSM6CLA1A'</span>])</span>
<span id="cb73-1216"><a href="#cb73-1216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1217"><a href="#cb73-1217" aria-hidden="true" tabindex="-1"></a><span class="co"># Define independent and dependent variables</span></span>
<span id="cb73-1218"><a href="#cb73-1218" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(camden_sub[<span class="st">'log_PTFSM6CLA1A'</span>])  <span class="co"># adds intercept</span></span>
<span id="cb73-1219"><a href="#cb73-1219" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> camden_sub[<span class="st">'log_ATT8SCR'</span>]</span>
<span id="cb73-1220"><a href="#cb73-1220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1221"><a href="#cb73-1221" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb73-1222"><a href="#cb73-1222" aria-hidden="true" tabindex="-1"></a>camden_model1 <span class="op">=</span> sm.OLS(y, X).fit()</span>
<span id="cb73-1223"><a href="#cb73-1223" aria-hidden="true" tabindex="-1"></a><span class="co">#camden_summary = extract_model_summary(camden_model1, 'Camden Model')</span></span>
<span id="cb73-1224"><a href="#cb73-1224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1225"><a href="#cb73-1225" aria-hidden="true" tabindex="-1"></a><span class="co"># Print summary</span></span>
<span id="cb73-1226"><a href="#cb73-1226" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(camden_model1.summary())</span>
<span id="cb73-1227"><a href="#cb73-1227" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-1228"><a href="#cb73-1228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1229"><a href="#cb73-1229" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/Rlogo.png){width="41" height="30"}</span></span>
<span id="cb73-1230"><a href="#cb73-1230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1233"><a href="#cb73-1233" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-1234"><a href="#cb73-1234" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit linear model and get predicted values</span></span>
<span id="cb73-1235"><a href="#cb73-1235" aria-hidden="true" tabindex="-1"></a>camden_model1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(ATT8SCR) <span class="sc">~</span> <span class="fu">log</span>(PTFSM6CLA1A), <span class="at">data =</span> camden_sub)</span>
<span id="cb73-1236"><a href="#cb73-1236" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(camden_model1)</span>
<span id="cb73-1237"><a href="#cb73-1237" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-1238"><a href="#cb73-1238" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb73-1239"><a href="#cb73-1239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1240"><a href="#cb73-1240" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Running the Model for the second local authority</span></span>
<span id="cb73-1241"><a href="#cb73-1241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1242"><a href="#cb73-1242" aria-hidden="true" tabindex="-1"></a>::: {.multicode}</span>
<span id="cb73-1243"><a href="#cb73-1243" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/python-logo-only.png){width="30"}</span></span>
<span id="cb73-1244"><a href="#cb73-1244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1247"><a href="#cb73-1247" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb73-1248"><a href="#cb73-1248" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb73-1249"><a href="#cb73-1249" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb73-1250"><a href="#cb73-1250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1251"><a href="#cb73-1251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1252"><a href="#cb73-1252" aria-hidden="true" tabindex="-1"></a><span class="co"># Log-transform safely: replace non-positive values with NaN</span></span>
<span id="cb73-1253"><a href="#cb73-1253" aria-hidden="true" tabindex="-1"></a>leeds_sub[<span class="st">'log_ATT8SCR'</span>] <span class="op">=</span> np.where(leeds_sub[<span class="st">'ATT8SCR'</span>] <span class="op">&gt;</span> <span class="dv">0</span>, np.log(leeds_sub[<span class="st">'ATT8SCR'</span>]), np.nan)</span>
<span id="cb73-1254"><a href="#cb73-1254" aria-hidden="true" tabindex="-1"></a>leeds_sub[<span class="st">'log_PTFSM6CLA1A'</span>] <span class="op">=</span> np.where(leeds_sub[<span class="st">'PTFSM6CLA1A'</span>] <span class="op">&gt;</span> <span class="dv">0</span>, np.log(leeds_sub[<span class="st">'PTFSM6CLA1A'</span>]), np.nan)</span>
<span id="cb73-1255"><a href="#cb73-1255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1256"><a href="#cb73-1256" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop rows with NaNs in either column</span></span>
<span id="cb73-1257"><a href="#cb73-1257" aria-hidden="true" tabindex="-1"></a>leeds_clean <span class="op">=</span> leeds_sub.dropna(subset<span class="op">=</span>[<span class="st">'log_ATT8SCR'</span>, <span class="st">'log_PTFSM6CLA1A'</span>])</span>
<span id="cb73-1258"><a href="#cb73-1258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1259"><a href="#cb73-1259" aria-hidden="true" tabindex="-1"></a><span class="co"># Define independent and dependent variables</span></span>
<span id="cb73-1260"><a href="#cb73-1260" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(leeds_clean[<span class="st">'log_PTFSM6CLA1A'</span>])  <span class="co"># adds intercept</span></span>
<span id="cb73-1261"><a href="#cb73-1261" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> leeds_clean[<span class="st">'log_ATT8SCR'</span>]</span>
<span id="cb73-1262"><a href="#cb73-1262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1263"><a href="#cb73-1263" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb73-1264"><a href="#cb73-1264" aria-hidden="true" tabindex="-1"></a>leeds_model1 <span class="op">=</span> sm.OLS(y, X).fit()</span>
<span id="cb73-1265"><a href="#cb73-1265" aria-hidden="true" tabindex="-1"></a><span class="co">#leeds_summary = extract_model_summary(leeds_model1, 'Leeds Model')</span></span>
<span id="cb73-1266"><a href="#cb73-1266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1267"><a href="#cb73-1267" aria-hidden="true" tabindex="-1"></a><span class="co"># Print summary</span></span>
<span id="cb73-1268"><a href="#cb73-1268" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(leeds_model1.summary())</span>
<span id="cb73-1269"><a href="#cb73-1269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1270"><a href="#cb73-1270" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-1271"><a href="#cb73-1271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1272"><a href="#cb73-1272" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/Rlogo.png){width="41" height="30"}</span></span>
<span id="cb73-1273"><a href="#cb73-1273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1276"><a href="#cb73-1276" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-1277"><a href="#cb73-1277" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit linear model and get predicted values</span></span>
<span id="cb73-1278"><a href="#cb73-1278" aria-hidden="true" tabindex="-1"></a>leeds_model1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(ATT8SCR) <span class="sc">~</span> <span class="fu">log</span>(PTFSM6CLA1A), <span class="at">data =</span> leeds_sub)</span>
<span id="cb73-1279"><a href="#cb73-1279" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(leeds_model1)</span>
<span id="cb73-1280"><a href="#cb73-1280" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-1281"><a href="#cb73-1281" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb73-1282"><a href="#cb73-1282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1283"><a href="#cb73-1283" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Running the Model for all Schools in England</span></span>
<span id="cb73-1284"><a href="#cb73-1284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1285"><a href="#cb73-1285" aria-hidden="true" tabindex="-1"></a>::: {.multicode}</span>
<span id="cb73-1286"><a href="#cb73-1286" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/python-logo-only.png){width="30"}</span></span>
<span id="cb73-1287"><a href="#cb73-1287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1290"><a href="#cb73-1290" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb73-1291"><a href="#cb73-1291" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb73-1292"><a href="#cb73-1292" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb73-1293"><a href="#cb73-1293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1294"><a href="#cb73-1294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1295"><a href="#cb73-1295" aria-hidden="true" tabindex="-1"></a><span class="co"># Log-transform safely: replace non-positive values with NaN</span></span>
<span id="cb73-1296"><a href="#cb73-1296" aria-hidden="true" tabindex="-1"></a>england_filtered[<span class="st">'log_ATT8SCR'</span>] <span class="op">=</span> np.where(england_filtered[<span class="st">'ATT8SCR'</span>] <span class="op">&gt;</span> <span class="dv">0</span>, np.log(england_filtered[<span class="st">'ATT8SCR'</span>]), np.nan)</span>
<span id="cb73-1297"><a href="#cb73-1297" aria-hidden="true" tabindex="-1"></a>england_filtered[<span class="st">'log_PTFSM6CLA1A'</span>] <span class="op">=</span> np.where(england_filtered[<span class="st">'PTFSM6CLA1A'</span>] <span class="op">&gt;</span> <span class="dv">0</span>, np.log(england_filtered[<span class="st">'PTFSM6CLA1A'</span>]), np.nan)</span>
<span id="cb73-1298"><a href="#cb73-1298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1299"><a href="#cb73-1299" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop rows with NaNs in either column</span></span>
<span id="cb73-1300"><a href="#cb73-1300" aria-hidden="true" tabindex="-1"></a>england_clean <span class="op">=</span> england_filtered.dropna(subset<span class="op">=</span>[<span class="st">'log_ATT8SCR'</span>, <span class="st">'log_PTFSM6CLA1A'</span>])</span>
<span id="cb73-1301"><a href="#cb73-1301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1302"><a href="#cb73-1302" aria-hidden="true" tabindex="-1"></a><span class="co"># Define independent and dependent variables</span></span>
<span id="cb73-1303"><a href="#cb73-1303" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(england_clean[<span class="st">'log_PTFSM6CLA1A'</span>])  <span class="co"># adds intercept</span></span>
<span id="cb73-1304"><a href="#cb73-1304" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> england_clean[<span class="st">'log_ATT8SCR'</span>]</span>
<span id="cb73-1305"><a href="#cb73-1305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1306"><a href="#cb73-1306" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb73-1307"><a href="#cb73-1307" aria-hidden="true" tabindex="-1"></a>england_model1 <span class="op">=</span> sm.OLS(y, X).fit()</span>
<span id="cb73-1308"><a href="#cb73-1308" aria-hidden="true" tabindex="-1"></a><span class="co">#england_summary = extract_model_summary(england_model1, 'England Model')</span></span>
<span id="cb73-1309"><a href="#cb73-1309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1310"><a href="#cb73-1310" aria-hidden="true" tabindex="-1"></a><span class="co"># Print summary</span></span>
<span id="cb73-1311"><a href="#cb73-1311" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(england_model1.summary())</span>
<span id="cb73-1312"><a href="#cb73-1312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1313"><a href="#cb73-1313" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-1314"><a href="#cb73-1314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1315"><a href="#cb73-1315" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/Rlogo.png){width="41" height="30"}</span></span>
<span id="cb73-1316"><a href="#cb73-1316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1319"><a href="#cb73-1319" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-1320"><a href="#cb73-1320" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit linear model and get predicted values</span></span>
<span id="cb73-1321"><a href="#cb73-1321" aria-hidden="true" tabindex="-1"></a>england_filtered_clean <span class="ot">&lt;-</span> england_filtered[</span>
<span id="cb73-1322"><a href="#cb73-1322" aria-hidden="true" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(england_filtered<span class="sc">$</span>ATT8SCR) <span class="sc">&amp;</span> </span>
<span id="cb73-1323"><a href="#cb73-1323" aria-hidden="true" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(england_filtered<span class="sc">$</span>PTFSM6CLA1A) <span class="sc">&amp;</span></span>
<span id="cb73-1324"><a href="#cb73-1324" aria-hidden="true" tabindex="-1"></a>  england_filtered<span class="sc">$</span>ATT8SCR <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span></span>
<span id="cb73-1325"><a href="#cb73-1325" aria-hidden="true" tabindex="-1"></a>  england_filtered<span class="sc">$</span>PTFSM6CLA1A <span class="sc">&gt;</span> <span class="dv">0</span>, </span>
<span id="cb73-1326"><a href="#cb73-1326" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb73-1327"><a href="#cb73-1327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1328"><a href="#cb73-1328" aria-hidden="true" tabindex="-1"></a>england_model1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(ATT8SCR) <span class="sc">~</span> <span class="fu">log</span>(PTFSM6CLA1A), <span class="at">data =</span> england_filtered_clean)</span>
<span id="cb73-1329"><a href="#cb73-1329" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(england_model1)</span>
<span id="cb73-1330"><a href="#cb73-1330" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-1331"><a href="#cb73-1331" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb73-1332"><a href="#cb73-1332" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Combining your outputs for comparison</span></span>
<span id="cb73-1333"><a href="#cb73-1333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1334"><a href="#cb73-1334" aria-hidden="true" tabindex="-1"></a>Don't forget to run some basic regression modelling checks on all of your models:</span>
<span id="cb73-1335"><a href="#cb73-1335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1336"><a href="#cb73-1336" aria-hidden="true" tabindex="-1"></a>:::callout-note</span>
<span id="cb73-1337"><a href="#cb73-1337" aria-hidden="true" tabindex="-1"></a>If you are doing this in Python, it appears there isn't a nice little package with the code for diagnostic plots already created. However, the statsmodels pages do have some code we can borrow - https://www.statsmodels.org/dev/examples/notebooks/generated/linear_regression_diagnostics_plots.html - run this first before using the functions below</span>
<span id="cb73-1338"><a href="#cb73-1338" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb73-1339"><a href="#cb73-1339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1342"><a href="#cb73-1342" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb73-1343"><a href="#cb73-1343" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb73-1344"><a href="#cb73-1344" aria-hidden="true" tabindex="-1"></a><span class="co"># base code</span></span>
<span id="cb73-1345"><a href="#cb73-1345" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb73-1346"><a href="#cb73-1346" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb73-1347"><a href="#cb73-1347" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels <span class="im">as</span> statsmodels</span>
<span id="cb73-1348"><a href="#cb73-1348" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tools.tools <span class="im">import</span> maybe_unwrap_results</span>
<span id="cb73-1349"><a href="#cb73-1349" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.graphics.gofplots <span class="im">import</span> ProbPlot</span>
<span id="cb73-1350"><a href="#cb73-1350" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.stats.outliers_influence <span class="im">import</span> variance_inflation_factor</span>
<span id="cb73-1351"><a href="#cb73-1351" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb73-1352"><a href="#cb73-1352" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Type</span>
<span id="cb73-1353"><a href="#cb73-1353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1354"><a href="#cb73-1354" aria-hidden="true" tabindex="-1"></a>style_talk <span class="op">=</span> <span class="st">"seaborn-talk"</span>  <span class="co"># refer to plt.style.available</span></span>
<span id="cb73-1355"><a href="#cb73-1355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1356"><a href="#cb73-1356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1357"><a href="#cb73-1357" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> LinearRegDiagnostic:</span>
<span id="cb73-1358"><a href="#cb73-1358" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb73-1359"><a href="#cb73-1359" aria-hidden="true" tabindex="-1"></a><span class="co">    Diagnostic plots to identify potential problems in a linear regression fit.</span></span>
<span id="cb73-1360"><a href="#cb73-1360" aria-hidden="true" tabindex="-1"></a><span class="co">    Mainly,</span></span>
<span id="cb73-1361"><a href="#cb73-1361" aria-hidden="true" tabindex="-1"></a><span class="co">        a. non-linearity of data</span></span>
<span id="cb73-1362"><a href="#cb73-1362" aria-hidden="true" tabindex="-1"></a><span class="co">        b. Correlation of error terms</span></span>
<span id="cb73-1363"><a href="#cb73-1363" aria-hidden="true" tabindex="-1"></a><span class="co">        c. non-constant variance</span></span>
<span id="cb73-1364"><a href="#cb73-1364" aria-hidden="true" tabindex="-1"></a><span class="co">        d. outliers</span></span>
<span id="cb73-1365"><a href="#cb73-1365" aria-hidden="true" tabindex="-1"></a><span class="co">        e. high-leverage points</span></span>
<span id="cb73-1366"><a href="#cb73-1366" aria-hidden="true" tabindex="-1"></a><span class="co">        f. collinearity</span></span>
<span id="cb73-1367"><a href="#cb73-1367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1368"><a href="#cb73-1368" aria-hidden="true" tabindex="-1"></a><span class="co">    Authors:</span></span>
<span id="cb73-1369"><a href="#cb73-1369" aria-hidden="true" tabindex="-1"></a><span class="co">        Prajwal Kafle (p33ajkafle@gmail.com, where 3 = r)</span></span>
<span id="cb73-1370"><a href="#cb73-1370" aria-hidden="true" tabindex="-1"></a><span class="co">        Does not come with any sort of warranty.</span></span>
<span id="cb73-1371"><a href="#cb73-1371" aria-hidden="true" tabindex="-1"></a><span class="co">        Please test the code one your end before using.</span></span>
<span id="cb73-1372"><a href="#cb73-1372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1373"><a href="#cb73-1373" aria-hidden="true" tabindex="-1"></a><span class="co">        Matt Spinelli (m3spinelli@gmail.com, where 3 = r)</span></span>
<span id="cb73-1374"><a href="#cb73-1374" aria-hidden="true" tabindex="-1"></a><span class="co">        (1) Fixed incorrect annotation of the top most extreme residuals in</span></span>
<span id="cb73-1375"><a href="#cb73-1375" aria-hidden="true" tabindex="-1"></a><span class="co">            the Residuals vs Fitted and, especially, the Normal Q-Q plots.</span></span>
<span id="cb73-1376"><a href="#cb73-1376" aria-hidden="true" tabindex="-1"></a><span class="co">        (2) Changed Residuals vs Leverage plot to match closer the y-axis</span></span>
<span id="cb73-1377"><a href="#cb73-1377" aria-hidden="true" tabindex="-1"></a><span class="co">            range shown in the equivalent plot in the R package ggfortify.</span></span>
<span id="cb73-1378"><a href="#cb73-1378" aria-hidden="true" tabindex="-1"></a><span class="co">        (3) Added horizontal line at y=0 in Residuals vs Leverage plot to</span></span>
<span id="cb73-1379"><a href="#cb73-1379" aria-hidden="true" tabindex="-1"></a><span class="co">            match the plots in R package ggfortify and base R.</span></span>
<span id="cb73-1380"><a href="#cb73-1380" aria-hidden="true" tabindex="-1"></a><span class="co">        (4) Added option for placing a vertical guideline on the Residuals</span></span>
<span id="cb73-1381"><a href="#cb73-1381" aria-hidden="true" tabindex="-1"></a><span class="co">            vs Leverage plot using the rule of thumb of h = 2p/n to denote</span></span>
<span id="cb73-1382"><a href="#cb73-1382" aria-hidden="true" tabindex="-1"></a><span class="co">            high leverage (high_leverage_threshold=True).</span></span>
<span id="cb73-1383"><a href="#cb73-1383" aria-hidden="true" tabindex="-1"></a><span class="co">        (5) Added two more ways to compute the Cook's Distance (D) threshold:</span></span>
<span id="cb73-1384"><a href="#cb73-1384" aria-hidden="true" tabindex="-1"></a><span class="co">            * 'baseR': D &gt; 1 and D &gt; 0.5 (default)</span></span>
<span id="cb73-1385"><a href="#cb73-1385" aria-hidden="true" tabindex="-1"></a><span class="co">            * 'convention': D &gt; 4/n</span></span>
<span id="cb73-1386"><a href="#cb73-1386" aria-hidden="true" tabindex="-1"></a><span class="co">            * 'dof': D &gt; 4 / (n - k - 1)</span></span>
<span id="cb73-1387"><a href="#cb73-1387" aria-hidden="true" tabindex="-1"></a><span class="co">        (6) Fixed class name to conform to Pascal casing convention</span></span>
<span id="cb73-1388"><a href="#cb73-1388" aria-hidden="true" tabindex="-1"></a><span class="co">        (7) Fixed Residuals vs Leverage legend to work with loc='best'</span></span>
<span id="cb73-1389"><a href="#cb73-1389" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb73-1390"><a href="#cb73-1390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1391"><a href="#cb73-1391" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(</span>
<span id="cb73-1392"><a href="#cb73-1392" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>,</span>
<span id="cb73-1393"><a href="#cb73-1393" aria-hidden="true" tabindex="-1"></a>        results: Type[statsmodels.regression.linear_model.RegressionResultsWrapper],</span>
<span id="cb73-1394"><a href="#cb73-1394" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb73-1395"><a href="#cb73-1395" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb73-1396"><a href="#cb73-1396" aria-hidden="true" tabindex="-1"></a><span class="co">        For a linear regression model, generates following diagnostic plots:</span></span>
<span id="cb73-1397"><a href="#cb73-1397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1398"><a href="#cb73-1398" aria-hidden="true" tabindex="-1"></a><span class="co">        a. residual</span></span>
<span id="cb73-1399"><a href="#cb73-1399" aria-hidden="true" tabindex="-1"></a><span class="co">        b. qq</span></span>
<span id="cb73-1400"><a href="#cb73-1400" aria-hidden="true" tabindex="-1"></a><span class="co">        c. scale location and</span></span>
<span id="cb73-1401"><a href="#cb73-1401" aria-hidden="true" tabindex="-1"></a><span class="co">        d. leverage</span></span>
<span id="cb73-1402"><a href="#cb73-1402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1403"><a href="#cb73-1403" aria-hidden="true" tabindex="-1"></a><span class="co">        and a table</span></span>
<span id="cb73-1404"><a href="#cb73-1404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1405"><a href="#cb73-1405" aria-hidden="true" tabindex="-1"></a><span class="co">        e. vif</span></span>
<span id="cb73-1406"><a href="#cb73-1406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1407"><a href="#cb73-1407" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb73-1408"><a href="#cb73-1408" aria-hidden="true" tabindex="-1"></a><span class="co">            results (Type[statsmodels.regression.linear_model.RegressionResultsWrapper]):</span></span>
<span id="cb73-1409"><a href="#cb73-1409" aria-hidden="true" tabindex="-1"></a><span class="co">                must be instance of statsmodels.regression.linear_model object</span></span>
<span id="cb73-1410"><a href="#cb73-1410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1411"><a href="#cb73-1411" aria-hidden="true" tabindex="-1"></a><span class="co">        Raises:</span></span>
<span id="cb73-1412"><a href="#cb73-1412" aria-hidden="true" tabindex="-1"></a><span class="co">            TypeError: if instance does not belong to above object</span></span>
<span id="cb73-1413"><a href="#cb73-1413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1414"><a href="#cb73-1414" aria-hidden="true" tabindex="-1"></a><span class="co">        Example:</span></span>
<span id="cb73-1415"><a href="#cb73-1415" aria-hidden="true" tabindex="-1"></a><span class="co">        &gt;&gt;&gt; import numpy as np</span></span>
<span id="cb73-1416"><a href="#cb73-1416" aria-hidden="true" tabindex="-1"></a><span class="co">        &gt;&gt;&gt; import pandas as pd</span></span>
<span id="cb73-1417"><a href="#cb73-1417" aria-hidden="true" tabindex="-1"></a><span class="co">        &gt;&gt;&gt; import statsmodels.formula.api as smf</span></span>
<span id="cb73-1418"><a href="#cb73-1418" aria-hidden="true" tabindex="-1"></a><span class="co">        &gt;&gt;&gt; x = np.linspace(-np.pi, np.pi, 100)</span></span>
<span id="cb73-1419"><a href="#cb73-1419" aria-hidden="true" tabindex="-1"></a><span class="co">        &gt;&gt;&gt; y = 3*x + 8 + np.random.normal(0,1, 100)</span></span>
<span id="cb73-1420"><a href="#cb73-1420" aria-hidden="true" tabindex="-1"></a><span class="co">        &gt;&gt;&gt; df = pd.DataFrame({'x':x, 'y':y})</span></span>
<span id="cb73-1421"><a href="#cb73-1421" aria-hidden="true" tabindex="-1"></a><span class="co">        &gt;&gt;&gt; res = smf.ols(formula= "y ~ x", data=df).fit()</span></span>
<span id="cb73-1422"><a href="#cb73-1422" aria-hidden="true" tabindex="-1"></a><span class="co">        &gt;&gt;&gt; cls = Linear_Reg_Diagnostic(res)</span></span>
<span id="cb73-1423"><a href="#cb73-1423" aria-hidden="true" tabindex="-1"></a><span class="co">        &gt;&gt;&gt; cls(plot_context="seaborn-v0_8-paper")</span></span>
<span id="cb73-1424"><a href="#cb73-1424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1425"><a href="#cb73-1425" aria-hidden="true" tabindex="-1"></a><span class="co">        In case you do not need all plots you can also independently make an individual plot/table</span></span>
<span id="cb73-1426"><a href="#cb73-1426" aria-hidden="true" tabindex="-1"></a><span class="co">        in following ways</span></span>
<span id="cb73-1427"><a href="#cb73-1427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1428"><a href="#cb73-1428" aria-hidden="true" tabindex="-1"></a><span class="co">        &gt;&gt;&gt; cls = Linear_Reg_Diagnostic(res)</span></span>
<span id="cb73-1429"><a href="#cb73-1429" aria-hidden="true" tabindex="-1"></a><span class="co">        &gt;&gt;&gt; cls.residual_plot()</span></span>
<span id="cb73-1430"><a href="#cb73-1430" aria-hidden="true" tabindex="-1"></a><span class="co">        &gt;&gt;&gt; cls.qq_plot()</span></span>
<span id="cb73-1431"><a href="#cb73-1431" aria-hidden="true" tabindex="-1"></a><span class="co">        &gt;&gt;&gt; cls.scale_location_plot()</span></span>
<span id="cb73-1432"><a href="#cb73-1432" aria-hidden="true" tabindex="-1"></a><span class="co">        &gt;&gt;&gt; cls.leverage_plot()</span></span>
<span id="cb73-1433"><a href="#cb73-1433" aria-hidden="true" tabindex="-1"></a><span class="co">        &gt;&gt;&gt; cls.vif_table()</span></span>
<span id="cb73-1434"><a href="#cb73-1434" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb73-1435"><a href="#cb73-1435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1436"><a href="#cb73-1436" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (</span>
<span id="cb73-1437"><a href="#cb73-1437" aria-hidden="true" tabindex="-1"></a>            <span class="bu">isinstance</span>(</span>
<span id="cb73-1438"><a href="#cb73-1438" aria-hidden="true" tabindex="-1"></a>                results, statsmodels.regression.linear_model.RegressionResultsWrapper</span>
<span id="cb73-1439"><a href="#cb73-1439" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb73-1440"><a href="#cb73-1440" aria-hidden="true" tabindex="-1"></a>            <span class="kw">is</span> <span class="va">False</span></span>
<span id="cb73-1441"><a href="#cb73-1441" aria-hidden="true" tabindex="-1"></a>        ):</span>
<span id="cb73-1442"><a href="#cb73-1442" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">TypeError</span>(</span>
<span id="cb73-1443"><a href="#cb73-1443" aria-hidden="true" tabindex="-1"></a>                <span class="st">"result must be instance of statsmodels.regression.linear_model.RegressionResultsWrapper object"</span></span>
<span id="cb73-1444"><a href="#cb73-1444" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb73-1445"><a href="#cb73-1445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1446"><a href="#cb73-1446" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.results <span class="op">=</span> maybe_unwrap_results(results)</span>
<span id="cb73-1447"><a href="#cb73-1447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1448"><a href="#cb73-1448" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.y_true <span class="op">=</span> <span class="va">self</span>.results.model.endog</span>
<span id="cb73-1449"><a href="#cb73-1449" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.y_predict <span class="op">=</span> <span class="va">self</span>.results.fittedvalues</span>
<span id="cb73-1450"><a href="#cb73-1450" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.xvar <span class="op">=</span> <span class="va">self</span>.results.model.exog</span>
<span id="cb73-1451"><a href="#cb73-1451" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.xvar_names <span class="op">=</span> <span class="va">self</span>.results.model.exog_names</span>
<span id="cb73-1452"><a href="#cb73-1452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1453"><a href="#cb73-1453" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.residual <span class="op">=</span> np.array(<span class="va">self</span>.results.resid)</span>
<span id="cb73-1454"><a href="#cb73-1454" aria-hidden="true" tabindex="-1"></a>        influence <span class="op">=</span> <span class="va">self</span>.results.get_influence()</span>
<span id="cb73-1455"><a href="#cb73-1455" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.residual_norm <span class="op">=</span> influence.resid_studentized_internal</span>
<span id="cb73-1456"><a href="#cb73-1456" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.leverage <span class="op">=</span> influence.hat_matrix_diag</span>
<span id="cb73-1457"><a href="#cb73-1457" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cooks_distance <span class="op">=</span> influence.cooks_distance[<span class="dv">0</span>]</span>
<span id="cb73-1458"><a href="#cb73-1458" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.nparams <span class="op">=</span> <span class="bu">len</span>(<span class="va">self</span>.results.params)</span>
<span id="cb73-1459"><a href="#cb73-1459" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.nresids <span class="op">=</span> <span class="bu">len</span>(<span class="va">self</span>.residual_norm)</span>
<span id="cb73-1460"><a href="#cb73-1460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1461"><a href="#cb73-1461" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__call__</span>(<span class="va">self</span>, plot_context<span class="op">=</span><span class="st">"seaborn-v0_8-paper"</span>, <span class="op">**</span>kwargs):</span>
<span id="cb73-1462"><a href="#cb73-1462" aria-hidden="true" tabindex="-1"></a>        <span class="co"># print(plt.style.available)</span></span>
<span id="cb73-1463"><a href="#cb73-1463" aria-hidden="true" tabindex="-1"></a>        <span class="co"># GH#9157</span></span>
<span id="cb73-1464"><a href="#cb73-1464" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> plot_context <span class="kw">not</span> <span class="kw">in</span> plt.style.available:</span>
<span id="cb73-1465"><a href="#cb73-1465" aria-hidden="true" tabindex="-1"></a>            plot_context <span class="op">=</span> <span class="st">"default"</span></span>
<span id="cb73-1466"><a href="#cb73-1466" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> plt.style.context(plot_context):</span>
<span id="cb73-1467"><a href="#cb73-1467" aria-hidden="true" tabindex="-1"></a>            fig, ax <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">2</span>, ncols<span class="op">=</span><span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb73-1468"><a href="#cb73-1468" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.residual_plot(ax<span class="op">=</span>ax[<span class="dv">0</span>, <span class="dv">0</span>])</span>
<span id="cb73-1469"><a href="#cb73-1469" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.qq_plot(ax<span class="op">=</span>ax[<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb73-1470"><a href="#cb73-1470" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.scale_location_plot(ax<span class="op">=</span>ax[<span class="dv">1</span>, <span class="dv">0</span>])</span>
<span id="cb73-1471"><a href="#cb73-1471" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.leverage_plot(</span>
<span id="cb73-1472"><a href="#cb73-1472" aria-hidden="true" tabindex="-1"></a>                ax<span class="op">=</span>ax[<span class="dv">1</span>, <span class="dv">1</span>],</span>
<span id="cb73-1473"><a href="#cb73-1473" aria-hidden="true" tabindex="-1"></a>                high_leverage_threshold<span class="op">=</span>kwargs.get(<span class="st">"high_leverage_threshold"</span>),</span>
<span id="cb73-1474"><a href="#cb73-1474" aria-hidden="true" tabindex="-1"></a>                cooks_threshold<span class="op">=</span>kwargs.get(<span class="st">"cooks_threshold"</span>),</span>
<span id="cb73-1475"><a href="#cb73-1475" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb73-1476"><a href="#cb73-1476" aria-hidden="true" tabindex="-1"></a>            plt.show()</span>
<span id="cb73-1477"><a href="#cb73-1477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1478"><a href="#cb73-1478" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (</span>
<span id="cb73-1479"><a href="#cb73-1479" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.vif_table(),</span>
<span id="cb73-1480"><a href="#cb73-1480" aria-hidden="true" tabindex="-1"></a>            fig,</span>
<span id="cb73-1481"><a href="#cb73-1481" aria-hidden="true" tabindex="-1"></a>            ax,</span>
<span id="cb73-1482"><a href="#cb73-1482" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb73-1483"><a href="#cb73-1483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1484"><a href="#cb73-1484" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> residual_plot(<span class="va">self</span>, ax<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb73-1485"><a href="#cb73-1485" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb73-1486"><a href="#cb73-1486" aria-hidden="true" tabindex="-1"></a><span class="co">        Residual vs Fitted Plot</span></span>
<span id="cb73-1487"><a href="#cb73-1487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1488"><a href="#cb73-1488" aria-hidden="true" tabindex="-1"></a><span class="co">        Graphical tool to identify non-linearity.</span></span>
<span id="cb73-1489"><a href="#cb73-1489" aria-hidden="true" tabindex="-1"></a><span class="co">        (Roughly) Horizontal red line is an indicator that the residual has a linear pattern</span></span>
<span id="cb73-1490"><a href="#cb73-1490" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb73-1491"><a href="#cb73-1491" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ax <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb73-1492"><a href="#cb73-1492" aria-hidden="true" tabindex="-1"></a>            fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb73-1493"><a href="#cb73-1493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1494"><a href="#cb73-1494" aria-hidden="true" tabindex="-1"></a>        sns.residplot(</span>
<span id="cb73-1495"><a href="#cb73-1495" aria-hidden="true" tabindex="-1"></a>            x<span class="op">=</span><span class="va">self</span>.y_predict,</span>
<span id="cb73-1496"><a href="#cb73-1496" aria-hidden="true" tabindex="-1"></a>            y<span class="op">=</span><span class="va">self</span>.residual,</span>
<span id="cb73-1497"><a href="#cb73-1497" aria-hidden="true" tabindex="-1"></a>            lowess<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb73-1498"><a href="#cb73-1498" aria-hidden="true" tabindex="-1"></a>            scatter_kws<span class="op">=</span>{<span class="st">"alpha"</span>: <span class="fl">0.5</span>},</span>
<span id="cb73-1499"><a href="#cb73-1499" aria-hidden="true" tabindex="-1"></a>            line_kws<span class="op">=</span>{<span class="st">"color"</span>: <span class="st">"red"</span>, <span class="st">"lw"</span>: <span class="dv">1</span>, <span class="st">"alpha"</span>: <span class="fl">0.8</span>},</span>
<span id="cb73-1500"><a href="#cb73-1500" aria-hidden="true" tabindex="-1"></a>            ax<span class="op">=</span>ax,</span>
<span id="cb73-1501"><a href="#cb73-1501" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb73-1502"><a href="#cb73-1502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1503"><a href="#cb73-1503" aria-hidden="true" tabindex="-1"></a>        <span class="co"># annotations</span></span>
<span id="cb73-1504"><a href="#cb73-1504" aria-hidden="true" tabindex="-1"></a>        residual_abs <span class="op">=</span> np.<span class="bu">abs</span>(<span class="va">self</span>.residual)</span>
<span id="cb73-1505"><a href="#cb73-1505" aria-hidden="true" tabindex="-1"></a>        abs_resid <span class="op">=</span> np.flip(np.argsort(residual_abs), <span class="dv">0</span>)</span>
<span id="cb73-1506"><a href="#cb73-1506" aria-hidden="true" tabindex="-1"></a>        abs_resid_top_3 <span class="op">=</span> abs_resid[:<span class="dv">3</span>]</span>
<span id="cb73-1507"><a href="#cb73-1507" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> abs_resid_top_3:</span>
<span id="cb73-1508"><a href="#cb73-1508" aria-hidden="true" tabindex="-1"></a>            ax.annotate(i, xy<span class="op">=</span>(<span class="va">self</span>.y_predict[i], <span class="va">self</span>.residual[i]), color<span class="op">=</span><span class="st">"C3"</span>)</span>
<span id="cb73-1509"><a href="#cb73-1509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1510"><a href="#cb73-1510" aria-hidden="true" tabindex="-1"></a>        ax.set_title(<span class="st">"Residuals vs Fitted"</span>, fontweight<span class="op">=</span><span class="st">"bold"</span>)</span>
<span id="cb73-1511"><a href="#cb73-1511" aria-hidden="true" tabindex="-1"></a>        ax.set_xlabel(<span class="st">"Fitted values"</span>)</span>
<span id="cb73-1512"><a href="#cb73-1512" aria-hidden="true" tabindex="-1"></a>        ax.set_ylabel(<span class="st">"Residuals"</span>)</span>
<span id="cb73-1513"><a href="#cb73-1513" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> ax</span>
<span id="cb73-1514"><a href="#cb73-1514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1515"><a href="#cb73-1515" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> qq_plot(<span class="va">self</span>, ax<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb73-1516"><a href="#cb73-1516" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb73-1517"><a href="#cb73-1517" aria-hidden="true" tabindex="-1"></a><span class="co">        Standarized Residual vs Theoretical Quantile plot</span></span>
<span id="cb73-1518"><a href="#cb73-1518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1519"><a href="#cb73-1519" aria-hidden="true" tabindex="-1"></a><span class="co">        Used to visually check if residuals are normally distributed.</span></span>
<span id="cb73-1520"><a href="#cb73-1520" aria-hidden="true" tabindex="-1"></a><span class="co">        Points spread along the diagonal line will suggest so.</span></span>
<span id="cb73-1521"><a href="#cb73-1521" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb73-1522"><a href="#cb73-1522" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ax <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb73-1523"><a href="#cb73-1523" aria-hidden="true" tabindex="-1"></a>            fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb73-1524"><a href="#cb73-1524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1525"><a href="#cb73-1525" aria-hidden="true" tabindex="-1"></a>        QQ <span class="op">=</span> ProbPlot(<span class="va">self</span>.residual_norm)</span>
<span id="cb73-1526"><a href="#cb73-1526" aria-hidden="true" tabindex="-1"></a>        fig <span class="op">=</span> QQ.qqplot(line<span class="op">=</span><span class="st">"45"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, lw<span class="op">=</span><span class="dv">1</span>, ax<span class="op">=</span>ax)</span>
<span id="cb73-1527"><a href="#cb73-1527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1528"><a href="#cb73-1528" aria-hidden="true" tabindex="-1"></a>        <span class="co"># annotations</span></span>
<span id="cb73-1529"><a href="#cb73-1529" aria-hidden="true" tabindex="-1"></a>        abs_norm_resid <span class="op">=</span> np.flip(np.argsort(np.<span class="bu">abs</span>(<span class="va">self</span>.residual_norm)), <span class="dv">0</span>)</span>
<span id="cb73-1530"><a href="#cb73-1530" aria-hidden="true" tabindex="-1"></a>        abs_norm_resid_top_3 <span class="op">=</span> abs_norm_resid[:<span class="dv">3</span>]</span>
<span id="cb73-1531"><a href="#cb73-1531" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, x, y <span class="kw">in</span> <span class="va">self</span>.__qq_top_resid(</span>
<span id="cb73-1532"><a href="#cb73-1532" aria-hidden="true" tabindex="-1"></a>            QQ.theoretical_quantiles, abs_norm_resid_top_3</span>
<span id="cb73-1533"><a href="#cb73-1533" aria-hidden="true" tabindex="-1"></a>        ):</span>
<span id="cb73-1534"><a href="#cb73-1534" aria-hidden="true" tabindex="-1"></a>            ax.annotate(i, xy<span class="op">=</span>(x, y), ha<span class="op">=</span><span class="st">"right"</span>, color<span class="op">=</span><span class="st">"C3"</span>)</span>
<span id="cb73-1535"><a href="#cb73-1535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1536"><a href="#cb73-1536" aria-hidden="true" tabindex="-1"></a>        ax.set_title(<span class="st">"Normal Q-Q"</span>, fontweight<span class="op">=</span><span class="st">"bold"</span>)</span>
<span id="cb73-1537"><a href="#cb73-1537" aria-hidden="true" tabindex="-1"></a>        ax.set_xlabel(<span class="st">"Theoretical Quantiles"</span>)</span>
<span id="cb73-1538"><a href="#cb73-1538" aria-hidden="true" tabindex="-1"></a>        ax.set_ylabel(<span class="st">"Standardized Residuals"</span>)</span>
<span id="cb73-1539"><a href="#cb73-1539" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> ax</span>
<span id="cb73-1540"><a href="#cb73-1540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1541"><a href="#cb73-1541" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> scale_location_plot(<span class="va">self</span>, ax<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb73-1542"><a href="#cb73-1542" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb73-1543"><a href="#cb73-1543" aria-hidden="true" tabindex="-1"></a><span class="co">        Sqrt(Standarized Residual) vs Fitted values plot</span></span>
<span id="cb73-1544"><a href="#cb73-1544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1545"><a href="#cb73-1545" aria-hidden="true" tabindex="-1"></a><span class="co">        Used to check homoscedasticity of the residuals.</span></span>
<span id="cb73-1546"><a href="#cb73-1546" aria-hidden="true" tabindex="-1"></a><span class="co">        Horizontal line will suggest so.</span></span>
<span id="cb73-1547"><a href="#cb73-1547" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb73-1548"><a href="#cb73-1548" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ax <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb73-1549"><a href="#cb73-1549" aria-hidden="true" tabindex="-1"></a>            fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb73-1550"><a href="#cb73-1550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1551"><a href="#cb73-1551" aria-hidden="true" tabindex="-1"></a>        residual_norm_abs_sqrt <span class="op">=</span> np.sqrt(np.<span class="bu">abs</span>(<span class="va">self</span>.residual_norm))</span>
<span id="cb73-1552"><a href="#cb73-1552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1553"><a href="#cb73-1553" aria-hidden="true" tabindex="-1"></a>        ax.scatter(<span class="va">self</span>.y_predict, residual_norm_abs_sqrt, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb73-1554"><a href="#cb73-1554" aria-hidden="true" tabindex="-1"></a>        sns.regplot(</span>
<span id="cb73-1555"><a href="#cb73-1555" aria-hidden="true" tabindex="-1"></a>            x<span class="op">=</span><span class="va">self</span>.y_predict,</span>
<span id="cb73-1556"><a href="#cb73-1556" aria-hidden="true" tabindex="-1"></a>            y<span class="op">=</span>residual_norm_abs_sqrt,</span>
<span id="cb73-1557"><a href="#cb73-1557" aria-hidden="true" tabindex="-1"></a>            scatter<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb73-1558"><a href="#cb73-1558" aria-hidden="true" tabindex="-1"></a>            ci<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb73-1559"><a href="#cb73-1559" aria-hidden="true" tabindex="-1"></a>            lowess<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb73-1560"><a href="#cb73-1560" aria-hidden="true" tabindex="-1"></a>            line_kws<span class="op">=</span>{<span class="st">"color"</span>: <span class="st">"red"</span>, <span class="st">"lw"</span>: <span class="dv">1</span>, <span class="st">"alpha"</span>: <span class="fl">0.8</span>},</span>
<span id="cb73-1561"><a href="#cb73-1561" aria-hidden="true" tabindex="-1"></a>            ax<span class="op">=</span>ax,</span>
<span id="cb73-1562"><a href="#cb73-1562" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb73-1563"><a href="#cb73-1563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1564"><a href="#cb73-1564" aria-hidden="true" tabindex="-1"></a>        <span class="co"># annotations</span></span>
<span id="cb73-1565"><a href="#cb73-1565" aria-hidden="true" tabindex="-1"></a>        abs_sq_norm_resid <span class="op">=</span> np.flip(np.argsort(residual_norm_abs_sqrt), <span class="dv">0</span>)</span>
<span id="cb73-1566"><a href="#cb73-1566" aria-hidden="true" tabindex="-1"></a>        abs_sq_norm_resid_top_3 <span class="op">=</span> abs_sq_norm_resid[:<span class="dv">3</span>]</span>
<span id="cb73-1567"><a href="#cb73-1567" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> abs_sq_norm_resid_top_3:</span>
<span id="cb73-1568"><a href="#cb73-1568" aria-hidden="true" tabindex="-1"></a>            ax.annotate(</span>
<span id="cb73-1569"><a href="#cb73-1569" aria-hidden="true" tabindex="-1"></a>                i, xy<span class="op">=</span>(<span class="va">self</span>.y_predict[i], residual_norm_abs_sqrt[i]), color<span class="op">=</span><span class="st">"C3"</span></span>
<span id="cb73-1570"><a href="#cb73-1570" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb73-1571"><a href="#cb73-1571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1572"><a href="#cb73-1572" aria-hidden="true" tabindex="-1"></a>        ax.set_title(<span class="st">"Scale-Location"</span>, fontweight<span class="op">=</span><span class="st">"bold"</span>)</span>
<span id="cb73-1573"><a href="#cb73-1573" aria-hidden="true" tabindex="-1"></a>        ax.set_xlabel(<span class="st">"Fitted values"</span>)</span>
<span id="cb73-1574"><a href="#cb73-1574" aria-hidden="true" tabindex="-1"></a>        ax.set_ylabel(<span class="vs">r"</span><span class="dv">$\s</span><span class="vs">qrt{</span><span class="cf">|</span><span class="dv">\m</span><span class="vs">athrm{Standardized</span><span class="ch">\ </span><span class="vs">Residuals}</span><span class="cf">|</span><span class="vs">}</span><span class="dv">$</span><span class="vs">"</span>)</span>
<span id="cb73-1575"><a href="#cb73-1575" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> ax</span>
<span id="cb73-1576"><a href="#cb73-1576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1577"><a href="#cb73-1577" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> leverage_plot(</span>
<span id="cb73-1578"><a href="#cb73-1578" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>, ax<span class="op">=</span><span class="va">None</span>, high_leverage_threshold<span class="op">=</span><span class="va">False</span>, cooks_threshold<span class="op">=</span><span class="st">"baseR"</span></span>
<span id="cb73-1579"><a href="#cb73-1579" aria-hidden="true" tabindex="-1"></a>    ):</span>
<span id="cb73-1580"><a href="#cb73-1580" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb73-1581"><a href="#cb73-1581" aria-hidden="true" tabindex="-1"></a><span class="co">        Residual vs Leverage plot</span></span>
<span id="cb73-1582"><a href="#cb73-1582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1583"><a href="#cb73-1583" aria-hidden="true" tabindex="-1"></a><span class="co">        Points falling outside Cook's distance curves are considered observation that can sway the fit</span></span>
<span id="cb73-1584"><a href="#cb73-1584" aria-hidden="true" tabindex="-1"></a><span class="co">        aka are influential.</span></span>
<span id="cb73-1585"><a href="#cb73-1585" aria-hidden="true" tabindex="-1"></a><span class="co">        Good to have none outside the curves.</span></span>
<span id="cb73-1586"><a href="#cb73-1586" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb73-1587"><a href="#cb73-1587" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ax <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb73-1588"><a href="#cb73-1588" aria-hidden="true" tabindex="-1"></a>            fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb73-1589"><a href="#cb73-1589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1590"><a href="#cb73-1590" aria-hidden="true" tabindex="-1"></a>        ax.scatter(<span class="va">self</span>.leverage, <span class="va">self</span>.residual_norm, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb73-1591"><a href="#cb73-1591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1592"><a href="#cb73-1592" aria-hidden="true" tabindex="-1"></a>        sns.regplot(</span>
<span id="cb73-1593"><a href="#cb73-1593" aria-hidden="true" tabindex="-1"></a>            x<span class="op">=</span><span class="va">self</span>.leverage,</span>
<span id="cb73-1594"><a href="#cb73-1594" aria-hidden="true" tabindex="-1"></a>            y<span class="op">=</span><span class="va">self</span>.residual_norm,</span>
<span id="cb73-1595"><a href="#cb73-1595" aria-hidden="true" tabindex="-1"></a>            scatter<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb73-1596"><a href="#cb73-1596" aria-hidden="true" tabindex="-1"></a>            ci<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb73-1597"><a href="#cb73-1597" aria-hidden="true" tabindex="-1"></a>            lowess<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb73-1598"><a href="#cb73-1598" aria-hidden="true" tabindex="-1"></a>            line_kws<span class="op">=</span>{<span class="st">"color"</span>: <span class="st">"red"</span>, <span class="st">"lw"</span>: <span class="dv">1</span>, <span class="st">"alpha"</span>: <span class="fl">0.8</span>},</span>
<span id="cb73-1599"><a href="#cb73-1599" aria-hidden="true" tabindex="-1"></a>            ax<span class="op">=</span>ax,</span>
<span id="cb73-1600"><a href="#cb73-1600" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb73-1601"><a href="#cb73-1601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1602"><a href="#cb73-1602" aria-hidden="true" tabindex="-1"></a>        <span class="co"># annotations</span></span>
<span id="cb73-1603"><a href="#cb73-1603" aria-hidden="true" tabindex="-1"></a>        leverage_top_3 <span class="op">=</span> np.flip(np.argsort(<span class="va">self</span>.cooks_distance), <span class="dv">0</span>)[:<span class="dv">3</span>]</span>
<span id="cb73-1604"><a href="#cb73-1604" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> leverage_top_3:</span>
<span id="cb73-1605"><a href="#cb73-1605" aria-hidden="true" tabindex="-1"></a>            ax.annotate(i, xy<span class="op">=</span>(<span class="va">self</span>.leverage[i], <span class="va">self</span>.residual_norm[i]), color<span class="op">=</span><span class="st">"C3"</span>)</span>
<span id="cb73-1606"><a href="#cb73-1606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1607"><a href="#cb73-1607" aria-hidden="true" tabindex="-1"></a>        factors <span class="op">=</span> []</span>
<span id="cb73-1608"><a href="#cb73-1608" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> cooks_threshold <span class="op">==</span> <span class="st">"baseR"</span> <span class="kw">or</span> cooks_threshold <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb73-1609"><a href="#cb73-1609" aria-hidden="true" tabindex="-1"></a>            factors <span class="op">=</span> [<span class="dv">1</span>, <span class="fl">0.5</span>]</span>
<span id="cb73-1610"><a href="#cb73-1610" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> cooks_threshold <span class="op">==</span> <span class="st">"convention"</span>:</span>
<span id="cb73-1611"><a href="#cb73-1611" aria-hidden="true" tabindex="-1"></a>            factors <span class="op">=</span> [<span class="dv">4</span> <span class="op">/</span> <span class="va">self</span>.nresids]</span>
<span id="cb73-1612"><a href="#cb73-1612" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> cooks_threshold <span class="op">==</span> <span class="st">"dof"</span>:</span>
<span id="cb73-1613"><a href="#cb73-1613" aria-hidden="true" tabindex="-1"></a>            factors <span class="op">=</span> [<span class="dv">4</span> <span class="op">/</span> (<span class="va">self</span>.nresids <span class="op">-</span> <span class="va">self</span>.nparams)]</span>
<span id="cb73-1614"><a href="#cb73-1614" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb73-1615"><a href="#cb73-1615" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(</span>
<span id="cb73-1616"><a href="#cb73-1616" aria-hidden="true" tabindex="-1"></a>                <span class="st">"threshold_method must be one of the following: 'convention', 'dof', or 'baseR' (default)"</span></span>
<span id="cb73-1617"><a href="#cb73-1617" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb73-1618"><a href="#cb73-1618" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, factor <span class="kw">in</span> <span class="bu">enumerate</span>(factors):</span>
<span id="cb73-1619"><a href="#cb73-1619" aria-hidden="true" tabindex="-1"></a>            label <span class="op">=</span> <span class="st">"Cook's distance"</span> <span class="cf">if</span> i <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb73-1620"><a href="#cb73-1620" aria-hidden="true" tabindex="-1"></a>            xtemp, ytemp <span class="op">=</span> <span class="va">self</span>.__cooks_dist_line(factor)</span>
<span id="cb73-1621"><a href="#cb73-1621" aria-hidden="true" tabindex="-1"></a>            ax.plot(xtemp, ytemp, label<span class="op">=</span>label, lw<span class="op">=</span><span class="fl">1.25</span>, ls<span class="op">=</span><span class="st">"--"</span>, color<span class="op">=</span><span class="st">"red"</span>)</span>
<span id="cb73-1622"><a href="#cb73-1622" aria-hidden="true" tabindex="-1"></a>            ax.plot(xtemp, np.negative(ytemp), lw<span class="op">=</span><span class="fl">1.25</span>, ls<span class="op">=</span><span class="st">"--"</span>, color<span class="op">=</span><span class="st">"red"</span>)</span>
<span id="cb73-1623"><a href="#cb73-1623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1624"><a href="#cb73-1624" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> high_leverage_threshold:</span>
<span id="cb73-1625"><a href="#cb73-1625" aria-hidden="true" tabindex="-1"></a>            high_leverage <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> <span class="va">self</span>.nparams <span class="op">/</span> <span class="va">self</span>.nresids</span>
<span id="cb73-1626"><a href="#cb73-1626" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">max</span>(<span class="va">self</span>.leverage) <span class="op">&gt;</span> high_leverage:</span>
<span id="cb73-1627"><a href="#cb73-1627" aria-hidden="true" tabindex="-1"></a>                ax.axvline(</span>
<span id="cb73-1628"><a href="#cb73-1628" aria-hidden="true" tabindex="-1"></a>                    high_leverage, label<span class="op">=</span><span class="st">"High leverage"</span>, ls<span class="op">=</span><span class="st">"-."</span>, color<span class="op">=</span><span class="st">"purple"</span>, lw<span class="op">=</span><span class="dv">1</span></span>
<span id="cb73-1629"><a href="#cb73-1629" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb73-1630"><a href="#cb73-1630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1631"><a href="#cb73-1631" aria-hidden="true" tabindex="-1"></a>        ax.axhline(<span class="dv">0</span>, ls<span class="op">=</span><span class="st">"dotted"</span>, color<span class="op">=</span><span class="st">"black"</span>, lw<span class="op">=</span><span class="fl">1.25</span>)</span>
<span id="cb73-1632"><a href="#cb73-1632" aria-hidden="true" tabindex="-1"></a>        ax.set_xlim(<span class="dv">0</span>, <span class="bu">max</span>(<span class="va">self</span>.leverage) <span class="op">+</span> <span class="fl">0.01</span>)</span>
<span id="cb73-1633"><a href="#cb73-1633" aria-hidden="true" tabindex="-1"></a>        ax.set_ylim(<span class="bu">min</span>(<span class="va">self</span>.residual_norm) <span class="op">-</span> <span class="fl">0.1</span>, <span class="bu">max</span>(<span class="va">self</span>.residual_norm) <span class="op">+</span> <span class="fl">0.1</span>)</span>
<span id="cb73-1634"><a href="#cb73-1634" aria-hidden="true" tabindex="-1"></a>        ax.set_title(<span class="st">"Residuals vs Leverage"</span>, fontweight<span class="op">=</span><span class="st">"bold"</span>)</span>
<span id="cb73-1635"><a href="#cb73-1635" aria-hidden="true" tabindex="-1"></a>        ax.set_xlabel(<span class="st">"Leverage"</span>)</span>
<span id="cb73-1636"><a href="#cb73-1636" aria-hidden="true" tabindex="-1"></a>        ax.set_ylabel(<span class="st">"Standardized Residuals"</span>)</span>
<span id="cb73-1637"><a href="#cb73-1637" aria-hidden="true" tabindex="-1"></a>        plt.legend(loc<span class="op">=</span><span class="st">"best"</span>)</span>
<span id="cb73-1638"><a href="#cb73-1638" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> ax</span>
<span id="cb73-1639"><a href="#cb73-1639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1640"><a href="#cb73-1640" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> vif_table(<span class="va">self</span>):</span>
<span id="cb73-1641"><a href="#cb73-1641" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb73-1642"><a href="#cb73-1642" aria-hidden="true" tabindex="-1"></a><span class="co">        VIF table</span></span>
<span id="cb73-1643"><a href="#cb73-1643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1644"><a href="#cb73-1644" aria-hidden="true" tabindex="-1"></a><span class="co">        VIF, the variance inflation factor, is a measure of multicollinearity.</span></span>
<span id="cb73-1645"><a href="#cb73-1645" aria-hidden="true" tabindex="-1"></a><span class="co">        VIF &gt; 5 for a variable indicates that it is highly collinear with the</span></span>
<span id="cb73-1646"><a href="#cb73-1646" aria-hidden="true" tabindex="-1"></a><span class="co">        other input variables.</span></span>
<span id="cb73-1647"><a href="#cb73-1647" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb73-1648"><a href="#cb73-1648" aria-hidden="true" tabindex="-1"></a>        vif_df <span class="op">=</span> pd.DataFrame()</span>
<span id="cb73-1649"><a href="#cb73-1649" aria-hidden="true" tabindex="-1"></a>        vif_df[<span class="st">"Features"</span>] <span class="op">=</span> <span class="va">self</span>.xvar_names</span>
<span id="cb73-1650"><a href="#cb73-1650" aria-hidden="true" tabindex="-1"></a>        vif_df[<span class="st">"VIF Factor"</span>] <span class="op">=</span> [</span>
<span id="cb73-1651"><a href="#cb73-1651" aria-hidden="true" tabindex="-1"></a>            variance_inflation_factor(<span class="va">self</span>.xvar, i) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.xvar.shape[<span class="dv">1</span>])</span>
<span id="cb73-1652"><a href="#cb73-1652" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb73-1653"><a href="#cb73-1653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1654"><a href="#cb73-1654" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> vif_df.sort_values(<span class="st">"VIF Factor"</span>).<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb73-1655"><a href="#cb73-1655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1656"><a href="#cb73-1656" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> __cooks_dist_line(<span class="va">self</span>, factor):</span>
<span id="cb73-1657"><a href="#cb73-1657" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb73-1658"><a href="#cb73-1658" aria-hidden="true" tabindex="-1"></a><span class="co">        Helper function for plotting Cook's distance curves</span></span>
<span id="cb73-1659"><a href="#cb73-1659" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb73-1660"><a href="#cb73-1660" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> <span class="va">self</span>.nparams</span>
<span id="cb73-1661"><a href="#cb73-1661" aria-hidden="true" tabindex="-1"></a>        formula <span class="op">=</span> <span class="kw">lambda</span> x: np.sqrt((factor <span class="op">*</span> p <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> x)) <span class="op">/</span> x)</span>
<span id="cb73-1662"><a href="#cb73-1662" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> np.linspace(<span class="fl">0.001</span>, <span class="bu">max</span>(<span class="va">self</span>.leverage), <span class="dv">50</span>)</span>
<span id="cb73-1663"><a href="#cb73-1663" aria-hidden="true" tabindex="-1"></a>        y <span class="op">=</span> formula(x)</span>
<span id="cb73-1664"><a href="#cb73-1664" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> x, y</span>
<span id="cb73-1665"><a href="#cb73-1665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1666"><a href="#cb73-1666" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> __qq_top_resid(<span class="va">self</span>, quantiles, top_residual_indices):</span>
<span id="cb73-1667"><a href="#cb73-1667" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb73-1668"><a href="#cb73-1668" aria-hidden="true" tabindex="-1"></a><span class="co">        Helper generator function yielding the index and coordinates</span></span>
<span id="cb73-1669"><a href="#cb73-1669" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb73-1670"><a href="#cb73-1670" aria-hidden="true" tabindex="-1"></a>        offset <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb73-1671"><a href="#cb73-1671" aria-hidden="true" tabindex="-1"></a>        quant_index <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb73-1672"><a href="#cb73-1672" aria-hidden="true" tabindex="-1"></a>        previous_is_negative <span class="op">=</span> <span class="va">None</span></span>
<span id="cb73-1673"><a href="#cb73-1673" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> resid_index <span class="kw">in</span> top_residual_indices:</span>
<span id="cb73-1674"><a href="#cb73-1674" aria-hidden="true" tabindex="-1"></a>            y <span class="op">=</span> <span class="va">self</span>.residual_norm[resid_index]</span>
<span id="cb73-1675"><a href="#cb73-1675" aria-hidden="true" tabindex="-1"></a>            is_negative <span class="op">=</span> y <span class="op">&lt;</span> <span class="dv">0</span></span>
<span id="cb73-1676"><a href="#cb73-1676" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> previous_is_negative <span class="op">==</span> <span class="va">None</span> <span class="kw">or</span> previous_is_negative <span class="op">==</span> is_negative:</span>
<span id="cb73-1677"><a href="#cb73-1677" aria-hidden="true" tabindex="-1"></a>                offset <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb73-1678"><a href="#cb73-1678" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb73-1679"><a href="#cb73-1679" aria-hidden="true" tabindex="-1"></a>                quant_index <span class="op">-=</span> offset</span>
<span id="cb73-1680"><a href="#cb73-1680" aria-hidden="true" tabindex="-1"></a>            x <span class="op">=</span> (</span>
<span id="cb73-1681"><a href="#cb73-1681" aria-hidden="true" tabindex="-1"></a>                quantiles[quant_index]</span>
<span id="cb73-1682"><a href="#cb73-1682" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> is_negative</span>
<span id="cb73-1683"><a href="#cb73-1683" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span> np.flip(quantiles, <span class="dv">0</span>)[quant_index]</span>
<span id="cb73-1684"><a href="#cb73-1684" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb73-1685"><a href="#cb73-1685" aria-hidden="true" tabindex="-1"></a>            quant_index <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb73-1686"><a href="#cb73-1686" aria-hidden="true" tabindex="-1"></a>            previous_is_negative <span class="op">=</span> is_negative</span>
<span id="cb73-1687"><a href="#cb73-1687" aria-hidden="true" tabindex="-1"></a>            <span class="cf">yield</span> resid_index, x, y</span>
<span id="cb73-1688"><a href="#cb73-1688" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-1689"><a href="#cb73-1689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1690"><a href="#cb73-1690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1691"><a href="#cb73-1691" aria-hidden="true" tabindex="-1"></a><span class="fu">### Linearity</span></span>
<span id="cb73-1692"><a href="#cb73-1692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1693"><a href="#cb73-1693" aria-hidden="true" tabindex="-1"></a>::: {.multicode}</span>
<span id="cb73-1694"><a href="#cb73-1694" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/python-logo-only.png){width="30"}</span></span>
<span id="cb73-1695"><a href="#cb73-1695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1698"><a href="#cb73-1698" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb73-1699"><a href="#cb73-1699" aria-hidden="true" tabindex="-1"></a>cls <span class="op">=</span> LinearRegDiagnostic(england_model1)</span>
<span id="cb73-1700"><a href="#cb73-1700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1701"><a href="#cb73-1701" aria-hidden="true" tabindex="-1"></a>cls.residual_plot()<span class="op">;</span></span>
<span id="cb73-1702"><a href="#cb73-1702" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb73-1703"><a href="#cb73-1703" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-1704"><a href="#cb73-1704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1705"><a href="#cb73-1705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1706"><a href="#cb73-1706" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/Rlogo.png){width="41" height="30"}</span></span>
<span id="cb73-1707"><a href="#cb73-1707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1710"><a href="#cb73-1710" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-1711"><a href="#cb73-1711" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(performance)</span>
<span id="cb73-1712"><a href="#cb73-1712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1713"><a href="#cb73-1713" aria-hidden="true" tabindex="-1"></a><span class="fu">check_model</span>(england_model1, </span>
<span id="cb73-1714"><a href="#cb73-1714" aria-hidden="true" tabindex="-1"></a>            <span class="at">check =</span> <span class="fu">c</span>(<span class="st">"linearity"</span>))</span>
<span id="cb73-1715"><a href="#cb73-1715" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-1716"><a href="#cb73-1716" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb73-1717"><a href="#cb73-1717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1718"><a href="#cb73-1718" aria-hidden="true" tabindex="-1"></a><span class="fu">### Homoscedasticity (Constant variance)?</span></span>
<span id="cb73-1719"><a href="#cb73-1719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1720"><a href="#cb73-1720" aria-hidden="true" tabindex="-1"></a>::: {.multicode}</span>
<span id="cb73-1721"><a href="#cb73-1721" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/python-logo-only.png){width="30"}</span></span>
<span id="cb73-1722"><a href="#cb73-1722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1725"><a href="#cb73-1725" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb73-1726"><a href="#cb73-1726" aria-hidden="true" tabindex="-1"></a>cls.scale_location_plot()<span class="op">;</span></span>
<span id="cb73-1727"><a href="#cb73-1727" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb73-1728"><a href="#cb73-1728" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-1729"><a href="#cb73-1729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1730"><a href="#cb73-1730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1731"><a href="#cb73-1731" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/Rlogo.png){width="41" height="30"}</span></span>
<span id="cb73-1732"><a href="#cb73-1732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1735"><a href="#cb73-1735" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-1736"><a href="#cb73-1736" aria-hidden="true" tabindex="-1"></a><span class="fu">check_model</span>(england_model1, </span>
<span id="cb73-1737"><a href="#cb73-1737" aria-hidden="true" tabindex="-1"></a>            <span class="at">check =</span> <span class="fu">c</span>(<span class="st">"homogeneity"</span>))</span>
<span id="cb73-1738"><a href="#cb73-1738" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-1739"><a href="#cb73-1739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1740"><a href="#cb73-1740" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb73-1741"><a href="#cb73-1741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1742"><a href="#cb73-1742" aria-hidden="true" tabindex="-1"></a><span class="fu">### Normality of Residuals</span></span>
<span id="cb73-1743"><a href="#cb73-1743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1744"><a href="#cb73-1744" aria-hidden="true" tabindex="-1"></a>::: {.multicode}</span>
<span id="cb73-1745"><a href="#cb73-1745" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/python-logo-only.png){width="30"}</span></span>
<span id="cb73-1746"><a href="#cb73-1746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1749"><a href="#cb73-1749" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb73-1750"><a href="#cb73-1750" aria-hidden="true" tabindex="-1"></a>cls.qq_plot()</span>
<span id="cb73-1751"><a href="#cb73-1751" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb73-1752"><a href="#cb73-1752" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-1753"><a href="#cb73-1753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1754"><a href="#cb73-1754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1755"><a href="#cb73-1755" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/Rlogo.png){width="41" height="30"}</span></span>
<span id="cb73-1756"><a href="#cb73-1756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1759"><a href="#cb73-1759" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-1760"><a href="#cb73-1760" aria-hidden="true" tabindex="-1"></a><span class="fu">check_model</span>(england_model1, </span>
<span id="cb73-1761"><a href="#cb73-1761" aria-hidden="true" tabindex="-1"></a>            <span class="at">check =</span> <span class="fu">c</span>(<span class="st">"qq"</span>))</span>
<span id="cb73-1762"><a href="#cb73-1762" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-1763"><a href="#cb73-1763" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb73-1764"><a href="#cb73-1764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1765"><a href="#cb73-1765" aria-hidden="true" tabindex="-1"></a><span class="fu">### Influence of Outliers</span></span>
<span id="cb73-1766"><a href="#cb73-1766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1767"><a href="#cb73-1767" aria-hidden="true" tabindex="-1"></a>::: {.multicode}</span>
<span id="cb73-1768"><a href="#cb73-1768" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/python-logo-only.png){width="30"}</span></span>
<span id="cb73-1769"><a href="#cb73-1769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1772"><a href="#cb73-1772" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb73-1773"><a href="#cb73-1773" aria-hidden="true" tabindex="-1"></a>cls.leverage_plot(high_leverage_threshold<span class="op">=</span><span class="va">True</span>, cooks_threshold<span class="op">=</span><span class="st">"dof"</span>)</span>
<span id="cb73-1774"><a href="#cb73-1774" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb73-1775"><a href="#cb73-1775" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-1776"><a href="#cb73-1776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1777"><a href="#cb73-1777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1778"><a href="#cb73-1778" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/Rlogo.png){width="41" height="30"}</span></span>
<span id="cb73-1779"><a href="#cb73-1779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1782"><a href="#cb73-1782" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-1783"><a href="#cb73-1783" aria-hidden="true" tabindex="-1"></a><span class="fu">check_model</span>(england_model1, </span>
<span id="cb73-1784"><a href="#cb73-1784" aria-hidden="true" tabindex="-1"></a>            <span class="at">check =</span> <span class="fu">c</span>(<span class="st">"outliers"</span>))</span>
<span id="cb73-1785"><a href="#cb73-1785" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-1786"><a href="#cb73-1786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1787"><a href="#cb73-1787" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb73-1788"><a href="#cb73-1788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1789"><a href="#cb73-1789" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Combining your outputs for comparison</span></span>
<span id="cb73-1790"><a href="#cb73-1790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1791"><a href="#cb73-1791" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb73-1792"><a href="#cb73-1792" aria-hidden="true" tabindex="-1"></a>You might notice that R is a bit better at things like manipulating model outputs than Python!</span>
<span id="cb73-1793"><a href="#cb73-1793" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb73-1794"><a href="#cb73-1794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1795"><a href="#cb73-1795" aria-hidden="true" tabindex="-1"></a>::: {.multicode}</span>
<span id="cb73-1796"><a href="#cb73-1796" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/python-logo-only.png){width="30"}</span></span>
<span id="cb73-1797"><a href="#cb73-1797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1800"><a href="#cb73-1800" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb73-1801"><a href="#cb73-1801" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb73-1802"><a href="#cb73-1802" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb73-1803"><a href="#cb73-1803" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.iolib.summary2 <span class="im">import</span> summary_col </span>
<span id="cb73-1804"><a href="#cb73-1804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1805"><a href="#cb73-1805" aria-hidden="true" tabindex="-1"></a>results_table <span class="op">=</span> summary_col(</span>
<span id="cb73-1806"><a href="#cb73-1806" aria-hidden="true" tabindex="-1"></a>    results<span class="op">=</span>[camden_model1, leeds_model1, england_model1],</span>
<span id="cb73-1807"><a href="#cb73-1807" aria-hidden="true" tabindex="-1"></a>    model_names<span class="op">=</span>[<span class="st">'Camden Model'</span>, <span class="st">'Leeds Model'</span>, <span class="st">'England Model'</span>],</span>
<span id="cb73-1808"><a href="#cb73-1808" aria-hidden="true" tabindex="-1"></a>    stars<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb73-1809"><a href="#cb73-1809" aria-hidden="true" tabindex="-1"></a>    float_format<span class="op">=</span><span class="st">"</span><span class="sc">%0.3f</span><span class="st">"</span>,</span>
<span id="cb73-1810"><a href="#cb73-1810" aria-hidden="true" tabindex="-1"></a>    <span class="co"># You can customize what model statistics show up here (like R2, N, F-stat)</span></span>
<span id="cb73-1811"><a href="#cb73-1811" aria-hidden="true" tabindex="-1"></a>    info_dict<span class="op">=</span>{<span class="st">'N'</span>:<span class="kw">lambda</span> x: <span class="st">"</span><span class="sc">{0:d}</span><span class="st">"</span>.<span class="bu">format</span>(<span class="bu">int</span>(x.nobs))}</span>
<span id="cb73-1812"><a href="#cb73-1812" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb73-1813"><a href="#cb73-1813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1814"><a href="#cb73-1814" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb73-1815"><a href="#cb73-1815" aria-hidden="true" tabindex="-1"></a><span class="co"># # Round for readability</span></span>
<span id="cb73-1816"><a href="#cb73-1816" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(results_table)</span>
<span id="cb73-1817"><a href="#cb73-1817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1818"><a href="#cb73-1818" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-1819"><a href="#cb73-1819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1820"><a href="#cb73-1820" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ![](L6_images/Rlogo.png){width="41" height="30"}</span></span>
<span id="cb73-1821"><a href="#cb73-1821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1824"><a href="#cb73-1824" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-1825"><a href="#cb73-1825" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jtools)</span>
<span id="cb73-1826"><a href="#cb73-1826" aria-hidden="true" tabindex="-1"></a><span class="fu">export_summs</span>(camden_model1, leeds_model1, england_model1, <span class="at">error_format =</span> <span class="st">""</span>, <span class="at">error_pos =</span> <span class="st">"same"</span>, <span class="at">model.names =</span> <span class="fu">c</span>(<span class="st">"Camden Model"</span>, <span class="st">"Leeds Model"</span>, <span class="st">"England Model"</span>))</span>
<span id="cb73-1827"><a href="#cb73-1827" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-1828"><a href="#cb73-1828" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb73-1829"><a href="#cb73-1829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1830"><a href="#cb73-1830" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip title="Questions to Answer"}</span>
<span id="cb73-1831"><a href="#cb73-1831" aria-hidden="true" tabindex="-1"></a>Comparing your three regression models:</span>
<span id="cb73-1832"><a href="#cb73-1832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1833"><a href="#cb73-1833" aria-hidden="true" tabindex="-1"></a>1<span class="sc">\.</span> How do the intercept (baseline) attainment values differ between your three models? **remember, if you (natural)logged your variables, you will need to take the exponential of the coefficient to interpret it back on the original scale.**</span>
<span id="cb73-1834"><a href="#cb73-1834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1835"><a href="#cb73-1835" aria-hidden="true" tabindex="-1"></a>2<span class="sc">\.</span> What do the differences in the slope values tell you?</span>
<span id="cb73-1836"><a href="#cb73-1836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1837"><a href="#cb73-1837" aria-hidden="true" tabindex="-1"></a>3<span class="sc">\.</span> Are your intercept and slope values statistically significant? If so, at what level?</span>
<span id="cb73-1838"><a href="#cb73-1838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1839"><a href="#cb73-1839" aria-hidden="true" tabindex="-1"></a>4<span class="sc">\.</span> How do the R-squared values differ between your models?</span>
<span id="cb73-1840"><a href="#cb73-1840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1841"><a href="#cb73-1841" aria-hidden="true" tabindex="-1"></a>5<span class="sc">\.</span> What can you say about your degrees of freedom and the reliability of your R-squared and other coefficients between your models?</span>
<span id="cb73-1842"><a href="#cb73-1842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1843"><a href="#cb73-1843" aria-hidden="true" tabindex="-1"></a>6<span class="sc">\.</span> What is the overall story of the relationship between your attainment variable and your explanatory variable considering both your local examples and comparison with schools across the rest of England?</span>
<span id="cb73-1844"><a href="#cb73-1844" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb73-1845"><a href="#cb73-1845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1846"><a href="#cb73-1846" aria-hidden="true" tabindex="-1"></a><span class="fu">### What does my model show?</span></span>
<span id="cb73-1847"><a href="#cb73-1847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1848"><a href="#cb73-1848" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Baseline attainment (intercept) is much higher in Camden than in Leeds or the whole of England. Exp(6.12) = 455.32. So the Attainment 8 Score in Camden would be 455 (an impossible score) when % of disadvantaged children in a school are 0. This compares to exp(4.547) = 94.35 in Leeds and exp(4.478) = 88.06 in England as a whole. All of these intercepts are statistically significant (i.e. observed values not a chance relationship). While unrealistic (potentially due to the low degrees of freedom), the Camden intercept shows us that after controlling for disadvantage, baseline attainment in Camden is better than in Leeds or the rest of England. </span>
<span id="cb73-1849"><a href="#cb73-1849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1850"><a href="#cb73-1850" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>The slope value of -0.207 for England shows that across the country. As this is a log-log model, it is an **Elasticity**: A 1% increase in % of disadvantaged students in a school is associated with a 0.21% decrease in attainment. HOWEVER, as this is a log-log model, the effect is far stronger at one end of the distribution than the other. </span>
<span id="cb73-1851"><a href="#cb73-1851" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>What this means is that a change from 1% to 10% of disadvantaged students in a school there is a 37.9% decrease in attainment, however, change from 21% to 30% leads to just a 7.1% decrease in attainment. </span>
<span id="cb73-1852"><a href="#cb73-1852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1853"><a href="#cb73-1853" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip title="AI can help here!"}</span>
<span id="cb73-1854"><a href="#cb73-1854" aria-hidden="true" tabindex="-1"></a>One of the things that large language models are quite good at is interpreting regression coefficients in the context of real data. </span>
<span id="cb73-1855"><a href="#cb73-1855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1856"><a href="#cb73-1856" aria-hidden="true" tabindex="-1"></a>They don't always get it right, so **USE WITH EXTREME CAUTION AND ALWAYS DOUBLE CHECK WITH YOUR OWN UNDERSTANDING**, however, they *can* help explain what YOUR model coefficients mean in relation to YOUR data in an incredibly helpful way. If you get stuck, try feeding an LLM (ChatGTP, Gemini etc.) with your regression outputs and a description of your data and see what it can tell you</span>
<span id="cb73-1857"><a href="#cb73-1857" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb73-1858"><a href="#cb73-1858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1859"><a href="#cb73-1859" aria-hidden="true" tabindex="-1"></a>This effect is similar for Leeds, but apparently far more severe in Camden where the slope is much steeper. However, Camden doesn't experience very low levels of disadvantage in its schools (unlike in Leeds and the rest of the county), with the lowest level around 35%. With low numbers of schools in the Borough, this observation is potentially unreliable.</span>
<span id="cb73-1860"><a href="#cb73-1860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1861"><a href="#cb73-1861" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>The slopes and intercept coefficients in all models are all apparently statistically significant - but as we have seen with Camden, this does not necessarily mean our observations are generalisable! This is a good lesson in the difference between statistical significance (p-values are not a panacea!) and why you should always interrogate your model fully when interpreting outputs. </span>
<span id="cb73-1862"><a href="#cb73-1862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1863"><a href="#cb73-1863" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Again, R-squared values might fool you into thinking the Camden model is 'better' than the other models, however, the R-squared is partially an artefact of the low degrees of freedom in the model. </span>
<span id="cb73-1864"><a href="#cb73-1864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1865"><a href="#cb73-1865" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>See above. </span>
<span id="cb73-1866"><a href="#cb73-1866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1867"><a href="#cb73-1867" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>Overall, we can make some crucial observations that encourage further research. While the model for England suggests a moderately strong log-log relationship between levels of disadvantage in a school and attainment, looking at this relationship for a London Borough (Camden) - and another Local Authority in England (Leeds) it's the case that this is unlikely to be a universal relationship. </span>
<span id="cb73-1868"><a href="#cb73-1868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1869"><a href="#cb73-1869" aria-hidden="true" tabindex="-1"></a>The baseline of attainment in Camden, controlling for disadvantage, is much higher than in the rest of the country. Students get higher levels of attainment, even when controlling for disadvantage. The log log relationship is crucial as it shows that on average, at low levels of disadvantage small increases have a more severe impact on attainment level, whereas at higher levels, similar changes have much reduced effects. </span>
<span id="cb73-1870"><a href="#cb73-1870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1871"><a href="#cb73-1871" aria-hidden="true" tabindex="-1"></a><span class="fu">### Your Turn</span></span>
<span id="cb73-1872"><a href="#cb73-1872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1873"><a href="#cb73-1873" aria-hidden="true" tabindex="-1"></a>To finish off the practical, see if you can answer the questions above for your example. </span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 2025–, Huanfa Chen, Adam Dennett, Bea Taylor</p>
</div>   
    <div class="nav-footer-center">
<p><img src="../img/logo/logo_only_sm.png" height="25"> Quantitative Methods</p>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/huanfachen/QM/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
<li class="nav-item compact">
    <a class="nav-link" href="https://github.com/huanfachen/QM">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/huanfa-chen/">
      <i class="bi bi-LinkedIn" role="img">
</i> 
    </a>
  </li>  
</ul>
</div>
  </div>
</footer><script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>


</body></html>